import{r as o,a as $e,R as Cr}from"./vendor-react-wGySg1uH.js";import{r as Mr,u as je}from"./vendor-xlsx-DLNWaC59.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))i(d);new MutationObserver(d=>{for(const n of d)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function a(d){const n={};return d.integrity&&(n.integrity=d.integrity),d.referrerPolicy&&(n.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?n.credentials="include":d.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(d){if(d.ep)return;d.ep=!0;const n=a(d);fetch(d.href,n)}})();var It={exports:{}},ot={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _r=o,Sr=Symbol.for("react.element"),Lr=Symbol.for("react.fragment"),Tr=Object.prototype.hasOwnProperty,Er=_r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Dr={key:!0,ref:!0,__self:!0,__source:!0};function $t(t,r,a){var i,d={},n=null,u=null;a!==void 0&&(n=""+a),r.key!==void 0&&(n=""+r.key),r.ref!==void 0&&(u=r.ref);for(i in r)Tr.call(r,i)&&!Dr.hasOwnProperty(i)&&(d[i]=r[i]);if(t&&t.defaultProps)for(i in r=t.defaultProps,r)d[i]===void 0&&(d[i]=r[i]);return{$$typeof:Sr,type:t,key:n,ref:u,props:d,_owner:Er.current}}ot.Fragment=Lr;ot.jsx=$t;ot.jsxs=$t;It.exports=ot;var e=It.exports,bt={},_t=$e;bt.createRoot=_t.createRoot,bt.hydrateRoot=_t.hydrateRoot;const Br=/^[\p{L}\s]*$/u;function Rr(t){return Br.test(t)&&t.length>0&&new RegExp("\\p{L}","u").test(t)}function Ar({onEnter:t}){const[r,a]=o.useState(""),[i,d]=o.useState(""),n=Rr(r.trim());function u(m){const h=m.target.value;/\d/.test(h)||(a(h),d(""))}function x(m){m.preventDefault();const h=r.trim();if(/\d/.test(h)){d("الاسم حروف فقط — بدون أرقام");return}if(!new RegExp("\\p{L}","u").test(h)){d("أدخل اسمك (حروف فقط)");return}d(""),t(h)}return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-[#f4ebe0] via-[#f8f3ed] to-[#efe6dc] dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex flex-col items-center justify-center p-6",children:e.jsxs("div",{className:"w-full max-w-md bg-stone-50 dark:bg-slate-800/60 backdrop-blur-xl rounded-3xl border border-stone-300 dark:border-white/20 shadow-xl dark:shadow-2xl p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary-500 font-cairo mb-2",children:"أهلاً بك"}),e.jsx("p",{className:"text-stone-700 dark:text-slate-400 font-cairo",children:"اكتب اسمك للدخول"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-5",children:[i&&e.jsx("div",{className:"p-3 rounded-xl bg-red-50 dark:bg-red-500/20 border border-red-200 dark:border-red-500/40 text-red-700 dark:text-red-300 text-sm font-cairo",children:i}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الاسم (حروف فقط)"}),e.jsx("input",{id:"name",type:"text",value:r,onChange:u,placeholder:"أدخل اسمك",className:"w-full px-4 py-3 rounded-xl bg-stone-100 dark:bg-slate-900/80 border border-stone-300 dark:border-white/20 text-stone-900 dark:text-white placeholder-stone-500 dark:placeholder-slate-500 focus:border-primary-500/50 focus:ring-1 focus:ring-primary-500/25 focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-900 font-cairo",autoComplete:"off",autoFocus:!0})]}),e.jsx("button",{type:"submit",disabled:!n,className:"w-full py-3.5 rounded-xl font-bold font-cairo bg-primary-500 hover:bg-primary-600 text-white disabled:opacity-40 disabled:cursor-not-allowed transition focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none",children:"دخول"})]})]})})}const Wt="cashbox_rows";function Ir(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function we(){try{const t=localStorage.getItem(Wt);return t?JSON.parse(t).map(a=>{const i=a,d=Array.isArray(i.expenseItems)?i.expenseItems.filter(n=>typeof n.amount=="number"&&typeof n.description=="string"):[];return{...a,sentToTreasury:typeof i.sentToTreasury=="number"?i.sentToTreasury:0,expenseCompensation:typeof i.expenseCompensation=="number"?i.expenseCompensation:0,expenses:typeof a.expenses=="number"?a.expenses:0,carriedExpenseCount:typeof i.carriedExpenseCount=="number"&&i.carriedExpenseCount>=0?i.carriedExpenseCount:0,expenseItems:d,mastercard:typeof a.mastercard=="number"?a.mastercard:0,programBalanceCash:typeof a.programBalanceCash=="number"?a.programBalanceCash:0,programBalanceBank:typeof a.programBalanceBank=="number"?a.programBalanceBank:0}}):[]}catch{return[]}}function Xe(t){try{localStorage.setItem(Wt,JSON.stringify(t))}catch{}}function St(){const t=we(),r=t.filter(i=>i.status!=="closed").sort((i,d)=>new Date(d.createdAt).getTime()-new Date(i.createdAt).getTime()),a=t.filter(i=>i.status==="closed").sort((i,d)=>new Date((d.closedAt??"").toString()).getTime()-new Date((i.closedAt??"").toString()).getTime());return[...r,...a]}function $r(t){return we().find(a=>a.id===t)??null}function Ft(t,r){const a=we(),i=new Date().toISOString(),d=(r==null?void 0:r.expenses)??0,n=(r==null?void 0:r.expenseItems)??[],u=(r==null?void 0:r.carriedExpenseCount)??0;a.push({id:Ir(),employeeName:t,cash:0,sentToTreasury:0,expenseCompensation:0,expenses:d,carriedExpenseCount:u,expenseItems:n,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0,status:"active",notes:"",closedAt:null,createdAt:i}),Xe(a)}function fe(t,r){const a=we(),i=a.findIndex(d=>d.id===t);i!==-1&&(a[i]={...a[i],...r},Xe(a))}function Wr(t,r){const a=we(),i=a.findIndex(n=>n.id===t);if(i===-1)return;const d=new Date().toISOString();a[i]={...a[i],...r,status:"closed",closedAt:d},Xe(a)}function Fr(t){const r=we().filter(a=>a.id!==t);Xe(r)}function Or(){const t=we().filter(r=>r.status!=="closed");Xe(t)}function Pr(t){return we().filter(r=>r.status==="closed"&&r.closedAt).sort((r,a)=>new Date((a.closedAt??"").toString()).getTime()-new Date((r.closedAt??"").toString()).getTime()).slice(0,t)}const zr="٠١٢٣٤٥٦٧٨٩",Vr="0123456789";function Ot(t){let r="";for(let a=0;a<t.length;a++){const i=zr.indexOf(t[a]);r+=i>=0?Vr[i]:t[a]}return r}function Hr(t){return t.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a/g,"").replace(/\u202b/g,"").replace(/\u202c/g,"").replace(/[\u0640\u066a]/g,"").replace(/\/\s*/g,"/").trim()}function Kr(t){const r=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2})\s*([صم])/);if(!r)return null;const a=parseInt(r[2],10)-1,i=parseInt(r[3],10),d=parseInt(r[1],10);let n=parseInt(r[4],10);const u=parseInt(r[5],10),x=r[6];x==="م"&&n!==12&&(n+=12),x==="ص"&&n===12&&(n=0);const m=new Date(i,a,d,n,u,0,0);return isNaN(m.getTime())?null:m}function Ur(t){let r=t.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(r){let a=parseInt(r[1],10);const i=parseInt(r[2],10),d=r[3],n=parseInt(r[4],10),u=parseInt(r[5],10)-1,x=parseInt(r[6],10);d==="م"&&a!==12&&(a+=12),d==="ص"&&a===12&&(a=0);const m=new Date(n,u,x,a,i,0,0);return isNaN(m.getTime())?null:m}if(r=t.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{1,2})\/(\d{1,2})\/(\d{4})/),r){let a=parseInt(r[1],10);const i=parseInt(r[2],10),d=r[3],n=parseInt(r[4],10),u=parseInt(r[5],10)-1,x=parseInt(r[6],10);d==="م"&&a!==12&&(a+=12),d==="ص"&&a===12&&(a=0);const m=new Date(x,u,n,a,i,0,0);return isNaN(m.getTime())?null:m}return null}function Lt(t){const r=Hr((t||"").toString());if(!r)return null;const a=Ot(r);return Ur(a)??Kr(a)}const Yr=32874,qr=52100;function Gr(t){if(t instanceof Date)return isNaN(t.getTime())?null:t;if(typeof t=="number"&&Number.isFinite(t)){if(t<Yr||t>qr)return null;const a=(t-25569)*86400*1e3,i=new Date(a);return isNaN(i.getTime())?null:i}return null}const Xr="٫";function pt(t){let r=(t||"").toString().trim();r=r.replace(/\s*SAR\s*/gi," ").replace(/\s*ر\.?\s*س\.?\s*/g," ").replace(/\s*ريال\s*(سعودي)?\s*/gi," ").trim();let i=Ot(r).replace(Xr,".").replace(/[^\d.,\-]/g,"");if(!i)return 0;if(/^-?\d+,\d{1,3}$/.test(i)?i=i.replace(",","."):i=i.replace(/,/g,""),i.includes(".")){const u=i.split("."),x=u[u.length-1];x&&x.length===3&&/^\d+$/.test(x)&&(i=i.replace(/\./g,""))}const n=parseFloat(i);return Number.isFinite(n)?n:0}const Pt={مدى:"mada",فيزا:"visa","ماستر كارد":"mastercard",ماستركارد:"mastercard","تحويل بنكي":"bankTransfer",تحويل:"bankTransfer"},Jr=["شيك","أمريكان إكسبريس","امريكان اكسبريس","نقداً","نقدا","كاش"];function zt(t){const r=t.replace(/\s+/g," ").trim();return Jr.some(a=>r===a||r.includes(a))}function Qr(t,r,a){const i={...Ke},d={...Ue},n={mada:[],visa:[],mastercard:[],bankTransfer:[]},u=Math.min(t.length,500);for(let x=a;x<u;x++){const m=t[x];if(!m||!Array.isArray(m))continue;const h=Math.min(Math.max(m.length,4),120);let y=null,N=-1;for(let E=0;E<h;E++){const R=r?Ge(r,m,x,E):(m[E]??"").toString().trim(),p=Te(R);if(!p||zt(p))continue;const A=Pt[p]??(p.includes("مدى")?"mada":null);if(A&&A!=="cash"){y=A,N=E;break}}if(y==null||y==="cash")continue;let P=0;for(let E=0;E<h;E++){if(E===N)continue;const R=r?Ge(r,m,x,E):(m[E]??"").toString().trim(),p=pt(R);if(p>0&&p<=Vt){P=p;break}}if(P<=0)continue;const _=(m[N]??"").toString().trim();_.includes("إجمالي")||_.includes("مجموع")||_.includes("المجموع")||(i[y]+=P,d[y]+=1,n[y].push({date:new Date(0),amount:P,employeeName:void 0,purpose:void 0}))}return{sums:i,counts:d,details:n}}const Ke={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},Ue={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},dt={mada:[],visa:[],mastercard:[],bankTransfer:[]};function Te(t){let r=(t??"").toString();return r=r.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a|\u202b|\u202c/g,"").replace(/\u200b|\u200c|\u200d|\ufeff/g,"").replace(/\s+/g," "),r=r.replace(/SAR/gi,"").replace(/ر\.?\s*س\.?/g,"").replace(/ريال\s*(سعودي)?/g,""),r.trim()}function Ge(t,r,a,i){const d=je.encode_cell({r:a,c:i}),n=t[d];if(n!=null){if(typeof n.w=="string"&&n.w.trim())return n.w.trim();if(typeof n.v=="number"&&!Number.isNaN(n.v))return String(n.v);if(typeof n.v=="string")return n.v.trim()}return(r[i]??"").toString().trim()}function ft(t){const r=Te(t);return r.includes("طريقةالدفع")||r.includes("طريقة الدفع")||r.includes("الدفع")&&r.length<30||r.includes("طريقة")&&(r.includes("دفع")||r.includes("الدفع"))}function gt(t){const r=Te(t);return r.includes("المبلغ")||r.includes("قيمةالسند")||r.includes("قيمة السند")||r.includes("المقبوضات")||r.includes("مقبوضات")||r.includes("قبوضات")||r.includes("المصروفات")||r.includes("مصروفات")||r.includes("الصافي")||r.includes("صافي")||r.includes("مبلغ")||r.includes("قيمة")&&!r.includes("رقم")&&r.length<35}function et(t){const r=new Map;for(const d of Object.keys(t)){if(d.startsWith("!"))continue;const n=je.decode_cell(d);if(n==null||typeof n.r!="number")continue;const u=n.r,x=n.c,m=t[d],h=m&&typeof m.w=="string"&&m.w.trim()||m&&typeof m.v=="string"&&m.v.trim()||(m&&typeof m.v=="number"&&!Number.isNaN(m.v)?String(m.v):"");r.has(u)||r.set(u,new Map),r.get(u).set(x,h)}const a=r.size===0?0:Math.max(...r.keys()),i=[];for(let d=0;d<=a;d++){const n=r.get(d),u=n?Math.max(...n.keys()):0,x=[];for(let m=0;m<=u;m++)x.push((n==null?void 0:n.get(m))??"");i.push(x)}return i}function Zr(t){const r=new Map;for(const i of Object.keys(t)){if(i.startsWith("!"))continue;const d=je.decode_cell(i);if(d==null||typeof d.r!="number")continue;const n=d.r,u=d.c,x=t[i],m=x&&typeof x.w=="string"&&x.w.trim()||x&&typeof x.v=="string"&&x.v.trim()||(x&&typeof x.v=="number"&&!Number.isNaN(x.v)?String(x.v):"");if(!m)continue;r.has(n)||r.set(n,[]);const h=r.get(n);for(;h.length<=u;)h.push("");h[u]=m}const a=Array.from(r.keys()).sort((i,d)=>i-d);for(const i of a){const d=r.get(i)||[];let n=!1,u=!1;for(const x of d){const m=Te(x);m&&(gt(m)&&(n=!0),ft(m)&&(u=!0))}if(n&&u)return i}return-1}const es=["مدى","فيزا","ماستر كارد","ماستركارد","تحويل بنكي","تحويل","نقداً","نقدا","شيك","أمريكان إكسبريس"];function ts(t){const r=Te(t);return!r||r.length>50?!1:es.some(a=>r===a||r.includes(a))}function rs(t,r){const a=Math.min(t.length,200);for(let i=1;i<a;i++){const d=t[i];if(!d||!Array.isArray(d))continue;const n=Math.min(Math.max(d.length,50),120);for(let u=0;u<n;u++){const x=r?Ge(r,d,i,u):(d[u]??"").toString().trim();if(ts(x))return i-1}}return-1}function Tt(t,r){const a=Math.min(t.length,200);for(let i=0;i<a;i++){const d=t[i];if(!d||!Array.isArray(d))continue;const n=Math.min(Math.max(d.length,50),120);let u=!1,x=!1;for(let m=0;m<n;m++){const h=r?Ge(r,d,i,m):(d[m]??"").toString().trim(),y=Te(h);y&&(gt(y)&&(u=!0),ft(y)&&(x=!0))}if(u&&x)return i}return-1}const ss=["الموظف","اسم الموظف","الاسم","اسم","المستخدم","اسم المستخدم","الموظف المسؤول","المسؤول","كاشير","الكاشير","المحاسب","اسم المحاسب"];function as(t){const r=t.replace(/\s+/g," ").replace(/\u200e|\u200f/g,"").trim();return r?r.includes("موظف")||r.includes("كاشير")||r.includes("محاسب")?!0:ss.some(a=>r===a||r.includes(a)):!1}const ns=["الغرض","الوصف","البيان","الغرض من العملية","تفاصيل","ملاحظات","وصف العملية"];function os(t){const r=t.replace(/\s+/g," ").trim();return r?ns.some(a=>r.includes(a)):!1}function ls(t){let r=-1,a=-1,i=-1,d=-1,n=-1,u=-1;const x=Math.min(Math.max((t==null?void 0:t.length)??0,10),120);let m=-1;for(let h=0;h<x;h++){const y=t[h],N=Te(y);(N.includes("الوقت")||N.includes("التاريخ"))&&r<0&&(r=h),a<0&&ft(N)&&(a=h),(N.includes("الإتجاه")||N.includes("الاتجاه"))&&d<0&&(d=h),n<0&&as(N)&&(n=h),u<0&&os(N)&&(u=h),gt(N)&&((N.includes("المقبوضات")||N.includes("مقبوضات")||N.includes("قبوضات"))&&(m=h),i<0&&(i=h)),N.includes("رقم السند")&&N.includes("قيمة السند")}return m>=0&&(i=m),a>=0&&i>=0?{date:r,method:a,amount:i,direction:d,employeeName:n,purpose:u}:null}function is(t){const r=(t??"").toString().trim();return typeof t=="string"||typeof t=="number"&&t<3e4?r?Lt(r):null:Gr(t)??(r?Lt(r):null)}const Vt=999999;function ds(t,r){try{const a=Mr(t,{type:"array"}),i=a.SheetNames||[];if(i.length===0)return{sums:Ke,counts:Ue,details:dt,employeeName:null,employeeNamesList:[],error:"الملف لا يحتوي على أي sheet"};let d=[],n={},u="",x=-1;for(let L=0;L<i.length;L++)if(u=i[L],n=a.Sheets[u],d=je.sheet_to_json(n,{header:1,defval:""}),x=Tt(d,n),x<0&&(d=et(n),x=Tt(d,n)),x<0&&(x=Zr(n)),x>=0){d.length<=x&&(d=et(n));break}if(x>=0&&d.length<=x&&(d=et(n)),x<0&&(x=rs(d,n)),x>=0&&d.length<=x&&(d=et(n)),x<0)return{sums:Ke,counts:Ue,details:dt,employeeName:null,employeeNamesList:[],error:"لم يُعثر على صف العناوين (طريقة الدفع، المبلغ أو المقبوضات)"};const m=d[x],h=[];for(let L=0;L<Math.max((m==null?void 0:m.length)??0,80);L++)h.push(Ge(n,m,x,L)||m[L]);let y=ls(h);if(!y){const L=Qr(d,n,x+1);return{sums:L.sums,counts:L.counts,details:L.details,employeeName:null,employeeNamesList:[],error:null}}const P={...Ke},_={...Ue},E={mada:[],visa:[],mastercard:[],bankTransfer:[]},R=new Set,p=r.getTime();for(let L=x+1;L<d.length;L++){const O=d[L],S=(O[y.method]??"").toString().trim();if(!S||zt(S))continue;const X=y.date>=0?O[y.date]:void 0,se=y.date>=0?is(X):null;if(y.date>=0&&(!se||se.getTime()<p))continue;const f=se??new Date(0),W=(y.direction>=0?(O[y.direction]??"").toString().trim():"").replace(/\u200e/g,"").replace(/\u200f/g,"").trim();if(y.direction>=0&&W!=="داخل")continue;const V=O[y.amount];if(y.employeeName>=0){const te=je.encode_cell({r:L,c:y.employeeName}),U=n[te],Y=(U&&typeof U.w=="string"?U.w.trim():"")||(O[y.employeeName]??"").toString().trim();Y&&R.add(Y)}const I=je.encode_cell({r:L,c:y.amount}),g=n[I],T=g&&typeof g.w=="string"?g.w.trim():"";let q;if(T)q=pt(T);else if(typeof V=="number"&&Number.isFinite(V))q=V;else{const te=(V??"").toString().trim();q=pt(te)}if(q<=0||q>Vt)continue;const G=S.replace(/\s+/g," ").trim();if(G.includes("إجمالي")||G.includes("مجموع")||G.includes("المجموع"))continue;const K=Pt[S]??(S.toLowerCase().includes("مدى")?"mada":null);if(K&&(P[K]+=q,_[K]+=1,K!=="cash")){const te=y.employeeName>=0?(()=>{const re=je.encode_cell({r:L,c:y.employeeName}),Y=n[re];return(Y&&typeof Y.w=="string"?Y.w.trim():"")||(O[y.employeeName]??"").toString().trim()||void 0})():void 0;let U;if(y.purpose>=0){const re=je.encode_cell({r:L,c:y.purpose}),Y=n[re];U=(Y&&typeof Y.w=="string"?Y.w.trim():"")||(O[y.purpose]??"").toString().trim()||void 0}E[K].push({date:f,amount:q,employeeName:te,purpose:U})}}const A=[...R],z=R.size===0?null:R.size===1?A[0]:"أكثر من موظف";return{sums:P,counts:_,details:E,employeeName:z,employeeNamesList:A,error:null}}catch(a){const i=a instanceof Error?a.message:String(a);return{sums:Ke,counts:Ue,details:dt,employeeName:null,employeeNamesList:[],error:`خطأ في قراءة الملف: ${i}`}}}function cs(t){const r=t.getHours();return r>=5&&r<12?{label:"صباح الخير",kind:"morning"}:r>=12&&r<17?{label:"مساء الخير",kind:"noon"}:r>=17&&r<21?{label:"أمسية سعيدة",kind:"evening"}:{label:"ليلة سعيدة",kind:"night"}}function st(t){const r=t.mada+t.visa+t.mastercard;return Math.round((r-t.programBalanceBank)*100)/100}function at(t){const r=t.cash??0,a=t.sentToTreasury??0,i=t.expenses??0,d=t.expenseCompensation??0,n=Math.max(0,i-d),u=r+a+n;return Math.round((u-t.programBalanceCash)*100)/100}function tt(t){const r=t.cash+t.mada+t.visa+t.mastercard,a=t.programBalanceCash+t.programBalanceBank;return Math.round((r-a)*100)/100}function nt(t){const r=typeof t=="string"?new Date(t):t,a={calendar:"gregory",numberingSystem:"latn"},i=r.toLocaleDateString("ar-SA",{...a,weekday:"long"}),d=r.getDate(),n=r.toLocaleDateString("ar-SA",{...a,month:"long"}),u=r.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",numberingSystem:"latn"});return`${i} ${d} ${n} ${u}`}const xs="٠١٢٣٤٥٦٧٨٩",ms="0123456789";function Le(t){if(typeof t!="string")return String(t);let r="";for(let a=0;a<t.length;a++){const i=xs.indexOf(t[a]);r+=i>=0?ms[i]:t[a]}return r}function k(t){return new Intl.NumberFormat("ar-SA",{minimumFractionDigits:2,maximumFractionDigits:2,numberingSystem:"latn"}).format(t)}function us(t){const r=new Date(t),a=new Date;return r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()}function bs(t){const r=new Date(t),a=new Date;return a.setDate(a.getDate()-1),r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()}function ps(t){const r=new Date(t),a=new Date,i=new Date(a);return i.setDate(i.getDate()-7),r>=i&&r<=a}function Et(t,r){return r==="today"?t.filter(a=>a.closedAt&&us(a.closedAt)):r==="yesterday"?t.filter(a=>a.closedAt&&bs(a.closedAt)):r==="lastWeek"?t.filter(a=>a.closedAt&&ps(a.closedAt)):t}const Dt=["cash","sentToTreasury","expenseCompensation","expenses","programBalanceCash","mada","visa","mastercard","bankTransfer","programBalanceBank"];function hs({row:t,rowNumber:r,isFirstActive:a,liveNow:i,closingRowId:d,closingSecondsLeft:n,onUpdate:u,isSelected:x=!1,onToggleSelect:m,onDeleteRow:h,onPrintRow:y,onOpenExpenseDetails:N,onClearExpensesAndOpen:P,onLockedFieldClick:_,onExpenseCompensationExceeded:E,lastExcelDetails:R,onShowExcelDetails:p,onRequestConfirmBankEdit:A,onShowEmployeeNames:z,onShowVarianceExplanation:L,currentUserName:O,onClearRow:S,isStickyRows:X=!1}){const se=a&&O?O:t.employeeName,f=o.useMemo(()=>st(t),[t.mada,t.visa,t.mastercard,t.bankTransfer,t.programBalanceBank]),$=o.useMemo(()=>at(t),[t.cash,t.sentToTreasury,t.programBalanceCash,t.expenses,t.expenseCompensation]),W=o.useMemo(()=>{const C=t.carriedExpenseCount??0;return(t.expenseItems??[]).slice(0,C).reduce((Q,Z)=>Q+Z.amount,0)},[t.carriedExpenseCount,t.expenseItems]),V=t.status==="closed",I=d===t.id,g=o.useCallback((C,be)=>{const Q=Le(be);let Z=parseFloat(Q)||0;C==="expenses"&&W>0&&Z<W&&(Z=W);const pe=t.expenses??0;C==="expenseCompensation"&&Z>pe&&(E==null||E(pe),Z=pe),u(t.id,C,Z)},[t.id,t.expenses,u,W,E]),T=o.useCallback(C=>{if(C.key==="Enter"||C.key==="Tab"){const be=C.currentTarget.closest("tr");if(!be)return;const Q=Array.from(be.querySelectorAll("input:not([disabled])")),Z=Q.indexOf(C.currentTarget),pe=C.key==="Tab"&&C.shiftKey,he=C.key==="Enter"||C.key==="Tab"&&!C.shiftKey;pe&&Z>0?(C.preventDefault(),Q[Z-1].focus()):he&&Z>=0&&Z<Q.length-1&&(C.preventDefault(),Q[Z+1].focus())}},[]),q=$>0?"text-emerald-700 dark:text-emerald-400":$<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",G=f>0?"text-emerald-700 dark:text-emerald-400":f<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",K=t.programBalanceCash>0,te=["programBalanceCash","expenses"],[U,re]=o.useState(!1),[Y,ue]=o.useState(null),[oe,Ee]=o.useState(null),We=o.useCallback(C=>{_==null||_(),re(!0),ue(C)},[_]);o.useEffect(()=>{if(!U)return;const C=setTimeout(()=>re(!1),3e3);return()=>clearTimeout(C)},[U]),o.useEffect(()=>{if(Y===null)return;const C=setTimeout(()=>ue(null),1200);return()=>clearTimeout(C)},[Y]);const ye=(C,be)=>{var H;const Q=t[C]??0,Z=(C==="mada"||C==="visa"||C==="mastercard"||C==="bankTransfer")&&((H=R==null?void 0:R[C])==null?void 0:H.length)>0&&p;if(V||I)return C==="expenses"&&N?e.jsx("button",{type:"button",onClick:()=>N(t.id),className:"block w-full py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/[0.06] rounded-xl transition cursor-pointer",title:"عرض تفاصيل المصروفات",children:Q===0?"—":k(Q)}):Z&&p?e.jsxs("div",{className:"flex items-center gap-1 w-full",children:[e.jsx("span",{className:"flex-1 min-w-0 py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center tabular-nums",children:Q===0?"—":k(Q)}),e.jsx("button",{type:"button",onClick:()=>p(C,t.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 8v4l2 2"}),e.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):e.jsx("span",{className:"block py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center",children:Q===0?"—":k(Q)});const pe=C==="expenses",he=!te.includes(C)&&!K,De=C==="programBalanceCash"&&a?0:he?-1:1,Ne=Z&&A&&["mada","visa","mastercard","bankTransfer"].includes(C),le=Ne&&(oe==null?void 0:oe.field)===C?oe.value===0?"":String(oe.value):Q===0?"":String(Q),Ce=e.jsx("input",{type:"text",inputMode:"decimal",value:le,onChange:ee=>{const Me=Le(ee.target.value).replace(/[^\d.]/g,""),Be=Me.indexOf("."),Je=Be===-1?Me:Me.slice(0,Be+1)+Me.slice(Be+1).replace(/\./g,""),ie=parseFloat(Je)||0;Ne?Ee({field:C,value:ie}):g(C,Je)},onBlur:()=>{if(Ne&&(oe==null?void 0:oe.field)===C){const ee=oe.value;Ee(null),ee!==Q&&A(t.id,C,Q,ee)}},dir:"ltr","aria-label":C,onKeyDown:T,onFocus:ee=>{ee.currentTarget.select(),pe&&N&&N(t.id)},placeholder:"—",tabIndex:De,disabled:he,title:he?"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش":C==="expenseCompensation"?"يجب أن يكون مساوياً أو أقل من مبلغ المصروفات":void 0,className:"cashbox-input w-full px-2 py-2 rounded-xl bg-white dark:bg-slate-900/70 border-2 border-stone-400 dark:border-white/[0.06] text-stone-900 dark:text-white text-sm font-cairo text-center focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 dark:focus:border-amber-500/40 dark:focus:ring-amber-500/20 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm"});return he&&_?e.jsx("div",{role:"button",tabIndex:0,className:"locked-field-wrapper w-full cursor-not-allowed rounded-lg",onClick:ee=>{ee.preventDefault(),ee.stopPropagation(),We(C)},onKeyDown:ee=>{(ee.key==="Enter"||ee.key===" ")&&(ee.preventDefault(),We(C))},title:"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش",children:Ce}):Z&&p?e.jsxs("div",{className:"flex items-center gap-1 w-full",children:[e.jsx("div",{className:"flex-1 min-w-0",children:Ce}),e.jsx("button",{type:"button",onClick:()=>p(C,t.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 8v4l2 2"}),e.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):Ce},ge=I&&n>0?n<=1?"0.35s":n<=2?"0.6s":n<=3?"1s":"1.5s":void 0,lt=V&&t.closedAt?nt(t.closedAt):nt(i),Fe=X?"sticky top-14 z-[9] bg-stone-50 dark:bg-amber-500/[0.06] shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]":"",de=X?"sticky top-[5.75rem] z-[9] bg-white dark:bg-slate-800/95 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]":"";return e.jsxs(e.Fragment,{children:[e.jsx("tr",{"data-row-id":t.id,className:"bg-stone-50 dark:bg-amber-500/[0.06] border-l-2 border-l-teal-500 dark:border-l-amber-500/40 border-b-2 border-stone-400 dark:border-amber-500/15",children:e.jsx("td",{colSpan:16,className:`py-1 px-3 align-middle text-[11px] font-semibold font-cairo text-stone-800 dark:text-amber-200/90 whitespace-nowrap ${Fe}`,style:{lineHeight:1.2,verticalAlign:"middle"},children:e.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap rounded-lg border-2 border-teal-400 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 px-2.5 py-1 shadow-md dark:shadow-[0_2px_6px_rgba(245,158,11,0.08)]",children:[se==="أكثر من موظف"&&z?e.jsx("button",{type:"button",onClick:z,className:"text-teal-600 dark:text-amber-400/95 hover:text-teal-700 dark:hover:text-amber-300 underline underline-offset-1 cursor-pointer transition-colors",title:"عرض أسماء الموظفين",children:"أكثر من موظف"}):e.jsx("span",{className:"font-semibold",children:se}),e.jsx("span",{className:"text-stone-500 dark:text-slate-400",children:"·"}),e.jsx("span",{className:"tabular-nums font-semibold text-stone-600 dark:text-slate-400",children:lt})]})})}),e.jsxs("tr",{"data-row-id":t.id,className:`${I?"bg-sky-100 dark:bg-sky-500/10 animate-pulse border-l-2 border-r-2 border-l-sky-400/50 border-r-sky-400/50 border-b-2 border-stone-400 dark:border-amber-500/15":V?"bg-stone-100 dark:bg-slate-800/30 border-b-2 border-stone-400 dark:border-amber-500/15":"bg-white dark:bg-slate-800/20 hover:bg-stone-50 dark:hover:bg-slate-800/35 border-b-2 border-stone-400 dark:border-amber-500/15 transition-colors"}`,style:ge?{animationDuration:ge}:void 0,children:[e.jsx("td",{className:`p-1.5 text-center align-middle border-r-2 border-stone-400 dark:border-amber-500/10 ${de}`,children:m&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>m(t.id),"aria-label":x?"إلغاء تحديد الصف":"تحديد الصف للطباعة",className:`inline-flex items-center justify-center w-5 h-5 rounded-lg border-2 transition-all ${x?"border-teal-500 bg-teal-100 text-teal-600 ring-2 ring-teal-500/30 ring-offset-2 ring-offset-stone-50 dark:border-amber-500/60 dark:bg-amber-500/20 dark:text-amber-400 dark:ring-amber-500/30 dark:ring-offset-slate-800":"border-2 border-stone-400 dark:border-white/20 bg-stone-300 dark:bg-slate-800/60 text-stone-800 dark:text-slate-400 hover:border-teal-400 dark:hover:border-amber-500/40 hover:text-teal-600 dark:hover:text-amber-400/90 shadow-sm"}`,children:x?e.jsx("svg",{className:"w-2.5 h-2.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}):e.jsx("span",{className:"w-2.5 h-2.5 block shrink-0"})})})}),e.jsx("td",{className:`p-1.5 text-center text-stone-800 dark:text-slate-500 text-sm font-medium font-cairo border-r-2 border-stone-400 dark:border-amber-500/10 align-middle tabular-nums ${de}`,children:r}),Dt.slice(0,4).map(C=>e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${Y===C?"locked-cell-pulse":""} ${de}`,children:ye(C)},C)),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${U&&a?"program-balance-pulse-cell":""} ${de}`,title:!K&&a?"لا يمكن الإدخال في الخانات الأخرى قبل إدخال رصيد البرنامج كاش هنا":void 0,children:ye("programBalanceCash")}),e.jsx("td",{className:`p-1.5 text-center font-bold font-cairo align-middle border-2 border-red-300 dark:border-red-500/20 rounded-xl bg-red-50 dark:bg-slate-800/40 shadow-sm dark:shadow-[0_0_0_1px_rgba(248,113,113,0.08)] ${q} ${de}`,children:L?e.jsx("button",{type:"button",onClick:()=>L("cash",t),className:`block w-full py-1.5 rounded-lg transition cursor-pointer hover:bg-red-100/50 dark:hover:bg-white/[0.06] ${$===0?"cursor-default hover:bg-transparent":""}`,title:$===0?void 0:"شرح سبب انحراف الكاش",disabled:$===0,children:$===0?"—":k($)}):e.jsx("span",{className:"block py-1",children:$===0?"—":k($)})}),Dt.slice(5,9).map(C=>e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${Y===C?"locked-cell-pulse":""} ${de}`,children:ye(C)},C)),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle bg-stone-300 dark:bg-slate-800/40 ${de}`,children:e.jsx("span",{className:"block py-1.5 text-sm text-teal-700 dark:text-emerald-400/95 font-semibold font-cairo tabular-nums",children:(()=>{const C=t.mada+t.visa+t.mastercard;return C===0?"—":k(C)})()})}),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${Y==="programBalanceBank"?"locked-cell-pulse":""} ${de}`,children:ye("programBalanceBank")}),e.jsx("td",{className:`p-1.5 text-center font-bold font-cairo align-middle border-2 border-red-300 dark:border-red-500/20 rounded-xl bg-red-50 dark:bg-slate-800/40 shadow-sm dark:shadow-[0_0_0_1px_rgba(248,113,113,0.08)] ${G} ${de}`,children:L?e.jsx("button",{type:"button",onClick:()=>L("bank",t),className:`block w-full py-1.5 rounded-lg transition cursor-pointer hover:bg-red-100/50 dark:hover:bg-white/[0.06] ${f===0?"cursor-default hover:bg-transparent":""}`,title:f===0?void 0:"شرح سبب انحراف البنك",disabled:f===0,children:f===0?"—":k(f)}):e.jsx("span",{className:"block py-1",children:f===0?"—":k(f)})}),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle overflow-hidden min-w-0 ${de}`,children:V?e.jsxs("div",{className:"flex flex-row items-center justify-center gap-1 flex-wrap min-w-0 w-full",children:[e.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded-full px-1.5 py-0.5 bg-emerald-100 dark:bg-emerald-500/15 border border-emerald-300 dark:border-emerald-500/25 text-[9px] font-medium text-emerald-700 dark:text-emerald-400/95 font-cairo whitespace-nowrap shrink-0",children:[e.jsx("svg",{className:"w-2 h-2 text-emerald-600 dark:text-emerald-500 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),"تم الإغلاق"]}),(h||y)&&e.jsxs("div",{className:"inline-flex items-center justify-center gap-0.5 shrink-0",children:[h&&e.jsx("button",{type:"button",onClick:()=>h(t.id),"aria-label":"حذف الصف",className:"inline-flex items-center justify-center w-5 h-5 rounded-md border-2 border-stone-400 dark:border-red-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 transition-all shrink-0 shadow-sm",title:"حذف الصف",children:e.jsx("svg",{className:"w-2.5 h-2.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),y&&e.jsx("button",{type:"button",onClick:()=>y(t.id),"aria-label":"طباعة الصف",className:"inline-flex items-center justify-center w-5 h-5 rounded-md border-2 border-teal-400 dark:border-amber-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-teal-100 dark:hover:bg-amber-500/15 hover:text-teal-600 dark:hover:text-amber-400 hover:border-teal-300 dark:hover:border-amber-500/30 transition-all shrink-0 shadow-sm",title:"طباعة هذه التقفيلة",children:e.jsxs("svg",{className:"w-2.5 h-2.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 9V2h12v7"}),e.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),e.jsx("path",{d:"M6 14h12v8H6z"})]})})]})]}):S?e.jsx("button",{type:"button",onClick:()=>S(t.id),title:"افراغ كل المدخلات في الصف النشط",className:"inline-flex items-center justify-center gap-0.5 rounded-full px-1.5 py-0.5 bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/25 text-[9px] font-medium text-teal-700 dark:text-amber-400 font-cairo whitespace-nowrap w-full min-w-0 truncate hover:bg-teal-200 dark:hover:bg-amber-500/25 transition",children:"افراغ الصف"}):e.jsx("span",{className:"inline-flex items-center justify-center gap-0.5 rounded-full px-1.5 py-0.5 bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/25 text-[9px] font-medium text-teal-700 dark:text-amber-400 font-cairo whitespace-nowrap w-full min-w-0 truncate",children:"الشفت الحالي"})})]})]})}const fs={Enter:"=","=":"=",Backspace:"⌫",Escape:"C",",":"."},gs="programBalanceBank",ct="اجمالى الموازنه";function ks({onTransfer:t,hasActiveRow:r}={}){const[a,i]=o.useState("0"),[d,n]=o.useState(""),[u,x]=o.useState([]),[m,h]=o.useState(!1),y=o.useRef(null),[N,P]=o.useState(null);o.useLayoutEffect(()=>{if(!m){P(null);return}const g=y.current;if(!g){P(null);return}const T=g.getBoundingClientRect();P({right:window.innerWidth-T.right,bottom:window.innerHeight-T.top+8})},[m]);const _=o.useRef("0"),E=o.useRef(""),R=o.useRef(null),p=o.useRef(!1),A=o.useRef(()=>{}),z=o.useRef(null),L=o.useCallback(g=>{_.current=g,i(g)},[]),O=o.useCallback(g=>{i(g)},[]),S=o.useCallback((g,T,q)=>{const G=parseFloat(g)||0,K=parseFloat(q)||0;return T?T==="+"?G+K:T==="-"?G-K:T==="*"?G*K:T==="/"?K===0?0:G/K:T==="%"?K===0?0:G*K/100:K:K},[]),X=o.useCallback(()=>{const g=S(E.current,R.current,_.current),T=`${E.current} ${R.current} ${_.current} = ${g}`;x(q=>[T,...q].slice(0,20)),L(String(g)),n(""),E.current="",R.current=null,p.current=!0},[L,S]),se=o.useCallback(g=>{if(g==="C"){L("0"),n(""),x([]),h(!1),E.current="",R.current=null,p.current=!1;return}if(g==="⌫"){const T=_.current;if(T.length<=1){L("0");return}L(T.slice(0,-1));return}if(g==="="){R.current&&X();return}if(["+","-","*","/","%"].includes(g)){R.current&&X(),E.current=_.current,R.current=g,n(T=>T+" "+g),p.current=!0;return}if(g==="."){if(p.current){L("0."),_.current="0.",p.current=!1;return}if(_.current.includes("."))return;const T=_.current+".";_.current=T,R.current?O(String(S(E.current,R.current,T))):L(T),n(q=>q+g);return}if(/\d/.test(g)){if(p.current)_.current=g,R.current?O(String(S(E.current,R.current,g))):L(g),p.current=!1;else{const T=_.current==="0"?g:_.current+g;_.current=T,R.current?O(String(S(E.current,R.current,T))):L(T)}n(T=>T+g)}},[L,O,X,S]);A.current=se,o.useEffect(()=>{const g=T=>{var te;const q=T.target;if(q.closest("input, textarea, select")||!((te=z.current)!=null&&te.contains(q)))return;const G=fs[T.key]??(T.key.length===1?T.key:"");!G||!["C","⌫","%","/","*","-","+","=",".","0","1","2","3","4","5","6","7","8","9"].includes(G)&&!/^\d$/.test(G)||(T.preventDefault(),A.current(G))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[]);const f=[["C","⌫","%","/"],["7","8","9","*"],["4","5","6","-"],["1","2","3","+"],["0",".","="]],$=g=>["+","-","*","/","%"].includes(g),W=g=>g==="="?"col-span-2 bg-teal-500 hover:bg-teal-600 dark:bg-amber-500/20 dark:hover:bg-amber-500/30 text-white dark:text-amber-400 font-bold text-lg border-2 border-teal-400 dark:border-amber-500/40 shadow-sm":$(g)?"bg-teal-100 hover:bg-teal-200 dark:bg-amber-500/20 dark:hover:bg-amber-500/30 text-teal-700 dark:text-amber-400 font-bold border-2 border-teal-300 dark:border-amber-500/40 flex items-center justify-center shadow-sm":g==="C"?"bg-red-100 hover:bg-red-200 dark:bg-red-500/20 dark:hover:bg-red-500/30 text-red-600 dark:text-red-400 border-2 border-red-300 dark:border-red-500/40 text-base shadow-sm":g==="⌫"?"bg-stone-400 hover:bg-stone-500 dark:bg-slate-600/40 dark:hover:bg-slate-500/50 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 text-base shadow-sm":"bg-white dark:bg-slate-700/40 hover:bg-stone-100 dark:hover:bg-slate-600/50 text-stone-900 dark:text-slate-200 border-2 border-stone-400 dark:border-white/10 active:scale-[0.98] text-base shadow-sm",V={"+":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),"-":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:e.jsx("path",{d:"M5 12h14"})}),"*":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M7 7l10 10M17 7L7 17"})}),"/":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M5 4l14 16"})}),"%":e.jsxs("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"6",cy:"6",r:"2.5"}),e.jsx("circle",{cx:"18",cy:"18",r:"2.5"}),e.jsx("path",{d:"M6 18L18 6"})]})},I=g=>V[g]?V[g]:e.jsx("span",{className:"inline-block leading-none",children:g});return e.jsxs("div",{ref:z,className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",tabIndex:0,title:"انقر هنا ثم استخدم لوحة المفاتيح. النتيجة لا تتغير عند الكتابة في الجدول.",children:[e.jsxs("div",{className:"bg-gradient-to-b from-teal-100 to-stone-200 dark:from-amber-500/15 dark:to-slate-800/60 px-4 py-3 border-b-2 border-teal-400 dark:border-amber-500/25 flex items-center justify-between gap-2 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[e.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide",children:[e.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400",children:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2"}),e.jsx("path",{d:"M6 6h12M6 10h12"}),e.jsx("rect",{x:"6.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"10.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"14.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"6.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"10.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"14.5",y:"17.5",width:"3",height:"3",rx:"0.5"})]})}),"الآلة الحاسبة"]}),e.jsx("button",{ref:y,type:"button",onClick:()=>h(g=>!g),className:`p-1.5 rounded-lg transition ${m?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:m?"إخفاء السجل":"سجل العمليات","aria-label":"سجل العمليات",children:e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col p-4 space-y-3 min-h-0",children:[e.jsxs("div",{className:"rounded-xl bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-amber-500/30 p-2 shadow-inner dark:shadow-[0_0_18px_rgba(245,158,11,0.14)]",children:[e.jsx("div",{className:"text-right text-stone-700 text-xs min-h-[16px] font-cairo tabular-nums select-none","aria-hidden":"true",children:d||"​"}),e.jsx("div",{className:"w-full px-3 py-2.5 rounded-lg bg-stone-50 dark:bg-slate-900/50 border-2 border-stone-300 dark:border-transparent text-stone-900 dark:text-white text-right font-cairo text-2xl font-semibold tabular-nums min-h-[2.5rem] flex items-center justify-end","aria-live":"polite","aria-label":`النتيجة: ${a}`,children:a})]}),t&&e.jsxs("button",{type:"button",onClick:()=>{const g=parseFloat(a)||0;!r||g<=0||(t(g,gs),x(T=>[`مرحّل → ${ct}: ${g}`,...T].slice(0,20)),L("0"),n(""))},disabled:!r||!parseFloat(a),title:`ترحيل الرقم إلى ${ct}`,className:"w-full py-2 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل إلى ",ct]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:f.flat().map(g=>e.jsx("button",{type:"button",onClick:()=>se(g),className:`py-2.5 rounded-xl font-cairo transition-all duration-150 ${W(g)}`,"aria-label":g==="⌫"?"حذف":g,children:I(g)},g))}),m&&N&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>h(!1)}),e.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[180px] max-h-[280px] overflow-y-auto",style:{right:N.right,bottom:N.bottom},children:[e.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"سجل العمليات"}),u.length===0?e.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لا يوجد سجل بعد"}):e.jsx("ul",{className:"space-y-1 mb-1 max-h-48 overflow-y-auto scrollbar-thin",children:u.map((g,T)=>e.jsx("li",{className:"tabular-nums px-2 py-1 rounded-md bg-stone-100 dark:bg-slate-800/40 text-stone-800 dark:text-slate-300 border border-stone-300 dark:border-transparent",children:g},T))}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]})}const Ye=[500,200,100,50,10,5,1],xt=()=>Object.fromEntries(Ye.map(t=>[t,0]));function vs({onApplyToCash:t,hasActiveRow:r}){const[a,i]=o.useState(xt()),[d,n]=o.useState(xt()),[u,x]=o.useState(!1),m=o.useRef(null),[h,y]=o.useState(null);o.useLayoutEffect(()=>{if(!u){y(null);return}const p=m.current;if(!p){y(null);return}const A=p.getBoundingClientRect();y({right:window.innerWidth-A.right,bottom:window.innerHeight-A.top+8})},[u]);const N=Ye.reduce((p,A)=>p+(a[A]??0)*A,0),P=Ye.reduce((p,A)=>p+(d[A]??0)*A,0),_=o.useCallback((p,A)=>{i(z=>({...z,[p]:A}))},[]),E=o.useCallback(()=>{i(xt())},[]),R=o.useCallback(()=>{r&&(n({...a}),t(N),E())},[r,N,t,E,a]);return e.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[e.jsxs("div",{className:"relative bg-gradient-to-b from-teal-100 to-stone-200 dark:from-amber-500/15 dark:to-slate-800/60 px-4 py-3 border-b-2 border-teal-300 dark:border-amber-500/25 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide",children:[e.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400",children:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),e.jsx("path",{d:"M2 10h20M2 14h20M7 8v8M12 8v8M17 8v8"})]})}),"حاسبة الكاش"]}),e.jsx("button",{ref:m,type:"button",onClick:()=>x(p=>!p),className:`p-1.5 rounded-lg transition shrink-0 ${u?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:"آخر عمليات رُحّلت إلى الكاش","aria-label":"سجل العمليات",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]})})]}),e.jsx("span",{className:"text-xs font-semibold text-stone-800 dark:text-amber-200/95 font-cairo",children:"المجموع"}),e.jsx("span",{className:"text-sm font-semibold text-teal-700 dark:text-amber-400 font-cairo tabular-nums",children:N>0?`${N} ريال سعودي`:"— ريال سعودي"}),u&&h&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>x(!1)}),e.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[280px] overflow-y-auto",style:{right:h.right,bottom:h.bottom},children:[e.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"آخر عمليات رُحّلت إلى الكاش:"}),P===0?e.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-0.5 mb-1",children:Ye.map(p=>{const A=d[p]??0;return A===0?null:e.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:["فئة ",p,": ",A," × ",p," = ",A*p," ريال"]},p)})}),e.jsxs("p",{className:"border-t border-stone-300 dark:border-white/10 pt-1 font-semibold text-teal-700 dark:text-amber-400 tabular-nums",children:["المجموع: ",P," ريال سعودي"]})]}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]}),e.jsxs("div",{className:"flex-1 flex flex-col p-4 min-h-0 overflow-hidden gap-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-5 shrink-0",children:Ye.map(p=>{const A=(a[p]??0)*p;return e.jsxs("div",{className:"flex flex-col items-center gap-4 rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-amber-500/15 px-6 py-5 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-w-0",children:[e.jsxs("span",{className:"text-teal-700 dark:text-amber-400/90 text-xs font-cairo font-semibold tabular-nums",children:["فئة النقد ",p]}),e.jsxs("div",{className:"flex items-center gap-2.5 w-full justify-center px-1",children:[e.jsx("button",{type:"button","aria-label":"نقص واحد",onClick:()=>_(p,Math.max(0,(a[p]??0)-1)),disabled:(a[p]??0)<=0,className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-red-100 dark:hover:bg-red-500/20 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 disabled:opacity-40 disabled:pointer-events-none transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"−"})}),e.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",value:a[p]===0||a[p]==null?"":String(a[p]),onChange:z=>{const L=Le(z.target.value).replace(/\D/g,"");_(p,Math.max(0,parseInt(L,10)||0))},onFocus:z=>{const L=z.target.value;(L===""||Number(L)===0)&&_(p,0)},className:"w-full min-w-[3rem] max-w-[4.5rem] px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums cashbox-input focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-amber-500/50 dark:focus:ring-amber-500/25 focus:outline-none"}),e.jsx("button",{type:"button","aria-label":"زد واحد",onClick:()=>_(p,(a[p]??0)+1),className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-teal-100 dark:hover:bg-emerald-500/20 hover:text-teal-700 dark:hover:text-emerald-400 hover:border-teal-300 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"+"})})]}),A>0?e.jsxs("span",{className:"text-stone-800 dark:text-slate-300 text-[10px] font-semibold font-cairo tabular-nums whitespace-nowrap",children:[A," ريال سعودي"]}):e.jsx("span",{className:"text-stone-600 dark:text-slate-500/60 text-[10px] font-semibold font-cairo whitespace-nowrap",children:"— ريال سعودي"})]},p)})}),e.jsxs("div",{className:"w-full py-3 px-4 rounded-xl text-sm font-cairo font-semibold bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/30 text-teal-800 dark:text-amber-400 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_0_12px_rgba(245,158,11,0.08)]",children:[e.jsx("span",{children:"المجموع"}),e.jsx("span",{className:"text-base font-semibold tabular-nums",children:N>0?`${N} ريال سعودي`:"— ريال سعودي"})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsxs("button",{type:"button",onClick:R,disabled:!r||N===0,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل للكاش"]}),e.jsxs("button",{type:"button",onClick:E,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),e.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح"]})]})]})]})}const js=[{field:"mada",label:"مدى"},{field:"visa",label:"فيزا"},{field:"mastercard",label:"ماستر كارد"}];function ws({onTransfer:t,hasActiveRow:r}){const[a,i]=o.useState({mada:[],visa:[],mastercard:[]}),[d,n]=o.useState({mada:"",visa:"",mastercard:""}),[u,x]=o.useState({mada:[],visa:[],mastercard:[]}),[m,h]=o.useState(null),y=o.useRef(null),[N,P]=o.useState(null);o.useLayoutEffect(()=>{if(m===null){P(null);return}const f=y.current;if(!f){P(null);return}const $=f.getBoundingClientRect();P({right:window.innerWidth-$.right,bottom:window.innerHeight-$.top+8})},[m]);const _=o.useCallback(f=>f.reduce(($,W)=>$+W,0),[]),E=_(a.mada),R=_(a.visa),p=_(a.mastercard),A=E+R+p,z=o.useCallback(f=>{const $=Le(d[f]).replace(",",".").replace(/[^\d.]/g,""),W=parseFloat($)||0;W<=0||(i(V=>({...V,[f]:[...V[f],W]})),n(V=>({...V,[f]:""})))},[d]),L=o.useCallback((f,$)=>{i(W=>({...W,[f]:W[f].filter((V,I)=>I!==$)}))},[]),O=o.useCallback((f,$)=>{n(W=>({...W,[f]:$}))},[]),S=o.useCallback(()=>{i({mada:[],visa:[],mastercard:[]}),n({mada:"",visa:"",mastercard:""})},[]),X=o.useCallback(f=>{if(!r)return;const $=a[f],W=f==="mada"?E:f==="visa"?R:p;if(W===0)return;x(I=>({...I,[f]:[...I[f],...$]}));const V=f==="mada"?[W,0,0]:f==="visa"?[0,W,0]:[0,0,W];t(V[0],V[1],V[2]),i(I=>({...I,[f]:[]})),n(I=>({...I,[f]:""}))},[r,E,R,p,t,a]),se=o.useCallback(()=>{!r||E===0&&R===0&&p===0||(x(f=>({mada:[...f.mada,...a.mada],visa:[...f.visa,...a.visa],mastercard:[...f.mastercard,...a.mastercard]})),t(E,R,p),S())},[r,E,R,p,t,a,S]);return e.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-gradient-to-b from-teal-100 to-slate-200 dark:from-amber-500/15 dark:to-slate-800/60 px-4 py-3 border-b-2 border-teal-300 dark:border-amber-500/25 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[e.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide",children:[e.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400",children:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"1"}),e.jsx("path",{d:"M2 10h20M7 14h2"})]})}),"حاسبه العمليات البنكيه"]}),e.jsx("span",{className:"text-xs font-semibold text-slate-700 font-cairo tabular-nums",children:A>0?`${A} ريال`:"—"})]}),e.jsxs("div",{className:"flex-1 flex flex-col p-4 min-h-0 overflow-hidden gap-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1 min-h-0",children:js.map(({field:f,label:$})=>{const W=a[f],V=_(W);return e.jsxs("div",{className:"relative flex flex-col rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-amber-500/15 px-3 py-3 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1 shrink-0",children:[e.jsx("span",{className:"text-teal-700 dark:text-amber-400/90 text-xs font-cairo font-semibold",children:$}),e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("button",{ref:m===f?y:void 0,type:"button",onClick:()=>h(I=>I===f?null:f),className:`p-1.5 rounded-lg transition ${m===f?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:"كل العمليات المرحّلة لهذا النوع","aria-label":"سجل العمليات",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]})}),m===f&&N&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>h(null)}),e.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[140px] max-h-[220px] overflow-y-auto",style:{right:N.right,bottom:N.bottom},children:[e.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"كل العمليات المرحّلة إلى الصف:"}),u[f].length===0?e.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-0.5 mb-1",children:u[f].map((I,g)=>e.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[I," ريال"]},g))}),e.jsxs("p",{className:"border-t border-stone-200 dark:border-white/10 pt-1 font-semibold text-teal-700 dark:text-amber-400 tabular-nums",children:["المجموع: ",_(u[f])," ريال"]})]}),e.jsx("button",{type:"button",onClick:()=>h(null),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]}),e.jsx("p",{className:"text-[9px] text-stone-500 dark:text-slate-500 font-cairo mb-1.5 shrink-0",children:"أدخل المبلغ ثم +"}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2 shrink-0",children:[e.jsx("input",{type:"text",inputMode:"decimal",dir:"ltr",placeholder:"مبلغ العملية",value:d[f],onChange:I=>{const T=(Le(I.target.value).replace(",",".").replace(/[^\d.]/g,"").match(/^\d*\.?\d*/)||[""])[0];O(f,T)},onKeyDown:I=>{I.key==="Enter"&&(I.preventDefault(),z(f))},className:"flex-1 min-w-0 px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums placeholder:text-xs placeholder:text-stone-400 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-amber-500/50 dark:focus:ring-amber-500/25 focus:outline-none"}),e.jsx("button",{type:"button","aria-label":`إضافة لـ ${$}`,onClick:()=>z(f),className:"flex items-center justify-center w-8 h-8 rounded-lg bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-teal-100 dark:hover:bg-emerald-500/20 hover:text-teal-700 dark:hover:text-emerald-400 hover:border-teal-300 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm",children:e.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-auto space-y-1",children:W.length===0?e.jsx("span",{className:"text-stone-600 dark:text-slate-500 text-[10px] font-cairo",children:"لا عمليات — أضف مبالغ بالزر +"}):W.map((I,g)=>e.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-lg bg-white dark:bg-slate-700/50 px-2 py-1 border-2 border-stone-400 dark:border-white/10 shadow-sm",children:[e.jsxs("span",{className:"text-xs font-cairo tabular-nums text-stone-800 dark:text-slate-200",children:[I," ريال"]}),e.jsx("button",{type:"button",onClick:()=>L(f,g),"aria-label":"حذف",className:"w-5 h-5 rounded flex items-center justify-center text-stone-600 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-500/20 transition shrink-0",children:e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},`${f}-${g}`))}),e.jsxs("div",{className:"pt-2 mt-auto border-t-2 border-stone-400 dark:border-white/10 shrink-0 space-y-2",children:[e.jsxs("span",{className:"text-xs font-semibold font-cairo text-teal-700 dark:text-amber-400 tabular-nums block",children:["المجموع: ",V>0?`${V} ريال`:"—"]}),e.jsxs("button",{type:"button",onClick:()=>X(f),disabled:!r||V===0,title:`ترحيل ${$} إلى الصف النشط`,className:"w-full py-2 rounded-lg text-xs font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-1.5",children:[e.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل ",$]})]})]},f)})}),e.jsxs("div",{className:"w-full py-2.5 px-4 rounded-xl text-xs font-cairo font-semibold bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/30 text-teal-800 dark:text-amber-400 flex items-center justify-between gap-6 shrink-0",children:[e.jsxs("span",{className:"tabular-nums",children:["مدى ",e.jsx("span",{className:"font-bold",children:E})]}),e.jsxs("span",{className:"tabular-nums",children:["فيزا ",e.jsx("span",{className:"font-bold",children:R})]}),e.jsxs("span",{className:"tabular-nums",children:["ماستر ",e.jsx("span",{className:"font-bold",children:p})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsxs("button",{type:"button",onClick:se,disabled:!r||E===0&&R===0&&p===0,title:"ترحيل مدى + فيزا + ماستر كارد معاً إلى الصف النشط",className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الكل"]}),e.jsxs("button",{type:"button",onClick:S,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),e.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح الكل"]})]})]})]})}const ys={success:{bg:"bg-emerald-100 dark:bg-emerald-500/15",border:"border-emerald-400 dark:border-emerald-500/40",icon:"text-emerald-700 dark:text-emerald-400"},error:{bg:"bg-red-100 dark:bg-red-500/15",border:"border-red-400 dark:border-red-500/40",icon:"text-red-700 dark:text-red-400"},warning:{bg:"bg-amber-100 dark:bg-amber-500/15",border:"border-amber-400 dark:border-amber-500/40",icon:"text-amber-700 dark:text-amber-400"},info:{bg:"bg-sky-100 dark:bg-sky-500/15",border:"border-sky-400 dark:border-sky-500/40",icon:"text-sky-700 dark:text-sky-400"}},Ns={success:e.jsx("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),error:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),warning:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 9v4M12 17h.01"}),e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})]}),info:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4M12 8h.01"})]})},Bt=3e3;function Cs({message:t,type:r,onClose:a,position:i="bottom",autoHideMs:d=Bt}){const n=o.useRef(a);n.current=a,o.useEffect(()=>{const m=d>0?d:Bt,h=setTimeout(()=>n.current(),m);return()=>clearTimeout(h)},[t,d]);const u=ys[r],x=i==="center"?"fixed top-1/2 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2":"fixed bottom-6 left-1/2 z-50 -translate-x-1/2";return e.jsxs("div",{role:"alert",className:`${x} flex items-center gap-3 px-4 py-3 rounded-2xl border ${u.bg} ${u.border} shadow-xl shadow-black/10 dark:shadow-black/20 backdrop-blur-md min-w-[200px] max-w-[90vw]`,children:[e.jsx("span",{className:u.icon,"aria-hidden":"true",children:Ns[r]}),e.jsx("span",{className:"font-cairo text-sm text-stone-800 dark:text-slate-200 flex-1",children:t}),e.jsx("button",{type:"button",onClick:a,className:"p-1 rounded-lg text-stone-600 dark:text-slate-400 hover:text-stone-900 dark:hover:text-slate-200 hover:bg-stone-300 dark:hover:bg-white/10 transition focus-visible:ring-2 focus-visible:ring-teal-400 dark:focus-visible:ring-amber-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none","aria-label":"إغلاق",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})}function Ms(t){const[r,a]=o.useState([]),i=o.useRef({}),d=o.useRef({}),n=o.useCallback(()=>{const u=St();a(u),u.forEach(x=>{d.current[x.id]=x})},[]);return o.useEffect(()=>(n(),St().length===0&&(Ft(t),n()),()=>{Object.values(i.current).forEach(clearTimeout),i.current={}}),[t,n]),{rows:r,setRows:a,loadRows:n,debounceRef:i,rowDataRef:d}}function _s(){const[t,r]=o.useState(()=>new Date),[a,i]=o.useState(null),[d,n]=o.useState(null),[u,x]=o.useState(0);return o.useEffect(()=>{const m=setInterval(()=>{const h=Date.now();r(new Date(h)),d!==null&&x(Math.max(0,Math.ceil((d-h)/1e3)))},1e3);return()=>clearInterval(m)},[d]),{liveNow:t,closingRowId:a,setClosingRowId:i,closingEndsAt:d,setClosingEndsAt:n,closingSecondsLeft:u,setClosingSecondsLeft:x}}function Ss(t,r){const[a,i]=o.useState(null),[d,n]=o.useState(null),u=o.useRef({}),x=o.useRef(null),m=o.useRef(null);m.current=(a==null?void 0:a.rowId)??null;const h=o.useCallback(y=>{var L;if(m.current===y)return;u.current={},n(null);const N=t.find(O=>O.id===y)??r.current[y],P=(N==null?void 0:N.expenses)??0;let _=(L=N==null?void 0:N.expenseItems)!=null&&L.length?N.expenseItems.map(O=>({amount:String(O.amount),description:O.description||""})):[{amount:P?String(P):"",description:""}];const E=O=>(Number(O.amount)||0)!==0||String(O.description||"").trim()!=="",R=(N==null?void 0:N.carriedExpenseCount)??0,p=_.slice(0,R).filter(E).length;_=_.filter(E);let A=p;const z=(N==null?void 0:N.status)==="closed";if(!z&&_.length>0){const O=_[_.length-1];if(String(O.amount||"").trim()!==""||String(O.description||"").trim()!==""){const S=_.reduce((f,$)=>f+(Number($.amount)||0),0),X=P-S,se=X>0?String(X):"";_=[..._,{amount:se,description:""}]}}!z&&_.length===0&&(_=[{amount:P?String(P):"",description:""}]),i({rowId:y,items:_,readOnly:z,carriedCount:A})},[t,r]);return o.useEffect(()=>{a||(x.current=null)},[a]),o.useEffect(()=>{if(d===null)return;const y=setTimeout(()=>n(null),3e3);return()=>clearTimeout(y)},[d]),{expenseModal:a,setExpenseModal:i,pulseExpenseDescriptionIndex:d,setPulseExpenseDescriptionIndex:n,openExpenseDetails:h,expenseAmountRef:u,expenseModalFocusedRowIdRef:x}}const Ht="cashbox_theme",qe=typeof document<"u"?document.documentElement:null,Rt=typeof document<"u"?document.body:null;function Ls(){try{if(typeof localStorage>"u")return"dark";const t=localStorage.getItem(Ht);return t==="light"||t==="dark"?t:"dark"}catch{return"dark"}}function ht(t){if(!qe)return;const r=t==="dark";qe.classList.toggle("dark",r),Rt&&Rt.classList.toggle("dark",r);try{localStorage.setItem(Ht,t)}catch{}qe.offsetHeight}function Ts(t){try{window.dispatchEvent(new CustomEvent("cashbox-theme-change",{detail:t}))}catch{}}function Kt(){if(!qe)return;const r=qe.classList.contains("dark")?"light":"dark";ht(r),Ts(r)}const Ie=5,rt=10,Es=2;function mt(){return""}const Ds=[{id:"today",label:"اليوم"},{id:"yesterday",label:"أمس"},{id:"lastWeek",label:"الأسبوع الماضي"}];function At(){Kt()}function Bs({name:t,onExit:r,theme:a,onToggleTheme:i}){const d=o.useRef(null),{rows:n,setRows:u,loadRows:x,debounceRef:m,rowDataRef:h}=Ms(t),{liveNow:y,closingRowId:N,setClosingRowId:P,setClosingEndsAt:_,closingSecondsLeft:E,setClosingSecondsLeft:R}=_s(),[p,A]=o.useState("today"),[z,L]=o.useState(1),[O,S]=o.useState(null),[X,se]=o.useState(null),[f,$]=o.useState(null),[W,V]=o.useState(new Set),[I,g]=o.useState(null),[T,q]=o.useState(null),[G,K]=o.useState(null),[te,U]=o.useState(""),[re,Y]=o.useState(!1),[ue,oe]=o.useState(null),[Ee,We]=o.useState(0),ye=o.useRef(null),[ge,lt]=o.useState(null),[Fe,de]=o.useState([]),[C,be]=o.useState(null),[Q,Z]=o.useState(!1),[pe,he]=o.useState(null),[De,Ne]=o.useState(null),[le,Ce]=o.useState(null);o.useEffect(()=>{const s=d.current;if(!s)return;const l=c=>{c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation(),At()};return s.addEventListener("click",l,!0),()=>s.removeEventListener("click",l,!0)},[]);const{expenseModal:H,setExpenseModal:ee,pulseExpenseDescriptionIndex:Me,setPulseExpenseDescriptionIndex:Be,openExpenseDetails:Je,expenseAmountRef:ie,expenseModalFocusedRowIdRef:kt}=Ss(n,h);o.useEffect(()=>{if(N===null||E>0)return;const s=N,l=n.find(J=>J.id===s);if(!l||l.status==="closed"){P(null),_(null);return}P(null),_(null);const c=m.current[s];c&&(clearTimeout(c),delete m.current[s],fe(s,l));const b=$r(s),w=b?{...b,...l,id:s,status:"active"}:l,M=tt(w);Wr(s,{...w,employeeName:t,variance:M});const v=w.expenses??0,j=w.expenseCompensation??0,D=Math.max(0,v-j),B=w.expenseItems??[],me=j>0?D>0?[{amount:D,description:"مرحّل (صافي بعد التعويض)"}]:[]:B.map(J=>({amount:J.amount,description:J.description||""}));Ft(t,{expenses:D,expenseItems:me,carriedExpenseCount:me.length}),x(),S({msg:"تم إغلاق الشفت وإضافة صف جديد",type:"success"}),We(J=>J+1)},[E,N,n,t,x]);const xe=o.useMemo(()=>{const s=n.filter(c=>c.status!=="closed").sort((c,b)=>new Date(b.createdAt).getTime()-new Date(c.createdAt).getTime()),l=Et(n.filter(c=>c.status==="closed"),p).sort((c,b)=>new Date((b.closedAt??"").toString()).getTime()-new Date((c.closedAt??"").toString()).getTime());return p==="today"?[...s,...l]:l},[n,p]),Oe=Math.max(1,Math.ceil(xe.length/Ie));o.useEffect(()=>{z>Oe&&L(1)},[z,Oe]);const Ut=o.useMemo(()=>xe.slice((z-1)*Ie,z*Ie),[xe,z]),F=o.useMemo(()=>{var s;return((s=xe.find(l=>l.status!=="closed"))==null?void 0:s.id)??null},[xe]);o.useMemo(()=>{const s=n.filter(l=>l.status==="closed"&&l.closedAt);return s.length===0?null:s.sort((l,c)=>new Date((c.closedAt??"").toString()).getTime()-new Date((l.closedAt??"").toString()).getTime())[0]??null},[n]);const ve=o.useMemo(()=>n.find(s=>s.status!=="closed")??null,[n]),Qe=o.useMemo(()=>{if(!ve)return!1;const s=ve.cash??0,l=ve.programBalanceCash??0,c=ve.programBalanceBank??0;return s>0&&l>0&&c>0},[ve]),Yt=o.useCallback(async s=>{var Ae;const l=(Ae=s.target.files)==null?void 0:Ae[0];if(s.target.value="",!l)return;const c=ve;if(!c){S({msg:"لا يوجد صف نشط لملء البيانات",type:"warning"});return}let b;try{b=await l.arrayBuffer()}catch{S({msg:"تعذر قراءة الملف",type:"error"});return}const w=new Date(0),{sums:M,counts:v,details:j,employeeName:D,employeeNamesList:B,error:ae}=ds(b,w);if(ae){S({msg:ae,type:"error"});return}lt(j),de(B??[]);const me=m.current[c.id];me&&(clearTimeout(me),delete m.current[c.id],fe(c.id,h.current[c.id]??c));const J=h.current[c.id]??c,ke={mada:M.mada,visa:M.visa,mastercard:M.mastercard,bankTransfer:M.bankTransfer},_e=M.mada+M.visa+M.mastercard,Ve=D&&D.trim()!==""?D.trim():J.employeeName,Se={...J,...ke,employeeName:Ve,variance:tt({...J,...ke})};fe(c.id,Se),h.current[c.id]=Se,u(it=>it.map(Ze=>Ze.id===c.id?Se:Ze)),x();const ce=[];v.mada>0&&ce.push(`مدى ${k(M.mada)}`),v.visa>0&&ce.push(`فيزا ${k(M.visa)}`),v.mastercard>0&&ce.push(`ماستر كارد ${k(M.mastercard)}`),v.bankTransfer>0&&ce.push(`تحويل بنكي ${k(M.bankTransfer)}`);const He=ce.length>0?ce.join(" — ")+` — المجموع: ${k(_e)}`:"";S({msg:_e>0?`تم استخراج: ${He}`:"لم يُعثر على مدى/فيزا/ماستر كارد/تحويل بنكي في الملف",type:_e>0?"success":"info"})},[ve,x]),qt=o.useCallback(()=>{var s;(s=ye.current)==null||s.click()},[]),Gt=o.useCallback(s=>{const l=m.current[s];l&&(clearTimeout(l),delete m.current[s]);const c=n.find(v=>v.id===s),b=(c==null?void 0:c.carriedExpenseCount)??0,w=((c==null?void 0:c.expenseItems)??[]).slice(0,b),M=w.reduce((v,j)=>v+j.amount,0);if(fe(s,{expenses:M,expenseItems:w}),c){const v={...c,expenses:M,expenseItems:w,variance:tt({...c})};h.current[s]=v,u(j=>j.map(D=>D.id!==s?D:v))}x(),ie.current={}},[n,x]),vt=o.useCallback((s,l,c)=>{ee(b=>b?{...b,items:b.items.map((w,M)=>M===s?{...w,[l]:String(c)}:w)}:null)},[]),Xt=o.useCallback(()=>{ie.current={},ee(s=>s?{...s,items:[...s.items,{amount:"",description:""}]}:null)},[]),Jt=o.useCallback(s=>{ee(l=>{if(!l)return l;const c=l.carriedCount??0;return s<c||l.items.length<=1?l:(ie.current={},{...l,items:l.items.filter((b,w)=>w!==s)})})},[]),Qt=o.useCallback((s,l)=>{U(""),K({rowId:s,itemIndex:l,step:"confirm"})},[]),Zt=o.useCallback(()=>{G&&K(s=>s?{...s,step:"code"}:null)},[G]),jt=o.useCallback(()=>{if(!G)return;if(te.trim()!==mt()){S({msg:"كود الأدمن غير صحيح",type:"error"});return}const{rowId:s,itemIndex:l}=G,c=n.find(D=>D.id===s)??h.current[s];if(!c){K(null),U("");return}const b=(c.expenseItems??[]).slice(),w=c.carriedExpenseCount??0;if(l>=b.length||l>=w){K(null),U("");return}b.splice(l,1);const M=Math.max(0,w-1),v=b.reduce((D,B)=>D+B.amount,0);fe(s,{expenseItems:b,expenses:v,carriedExpenseCount:M});const j={...c,expenseItems:b,expenses:v,carriedExpenseCount:M};h.current[s]=j,u(D=>D.map(B=>B.id===s?j:B)),ee(D=>{if(!D||D.rowId!==s)return D;const B=D.items.filter((ae,me)=>me!==l);return{...D,items:B,carriedCount:M}}),ie.current={},x(),K(null),U(""),Y(!1),S({msg:"تم حذف البند المرحّل",type:"success"})},[G,te,n,x,fe]),Pe=o.useCallback(()=>{if(!H)return;const s=H.rowId,l=H.carriedCount??0,c=H.items.map((v,j)=>{const D=ie.current[j]!==void 0?ie.current[j]:String(v.amount??"");return{amount:Number(String(D).replace(/,/g,""))||0,description:String(v.description||"").trim(),index:j}}),b=c.find(v=>v.index>=l&&v.amount>0&&!v.description);if(b){S({msg:"يجب إدخال وصف لكل بند فيه مبلغ",type:"warning"}),Be(b.index);return}const w=c.map(({amount:v,description:j})=>({amount:v,description:j})),M=w.reduce((v,j)=>v+j.amount,0);fe(s,{expenseItems:w,expenses:M}),ee(null),x(),requestAnimationFrame(()=>{setTimeout(()=>{const v=document.querySelectorAll(`tr[data-row-id="${s}"] input.cashbox-input`);let j=v[5]??v[0];for(let D=5;D<v.length;D++)if(!v[D].disabled){j=v[D];break}j==null||j.focus()},0)})},[H,x,fe]),er=o.useCallback(()=>{S({msg:"يجب إدخال رصيد البرنامج كاش أولاً",type:"warning"})},[]),tr=o.useCallback(s=>{S({msg:`تعويض المصروفات يجب ألا يتخطى مبلغ المصروفات (المصروفات: ${k(s)})`,type:"warning"})},[]),wt=o.useCallback(s=>{const l=n.find(b=>b.id===s);if(!l||l.status==="closed")return;const c={cash:0,sentToTreasury:0,expenseCompensation:0,expenses:0,expenseItems:[],carriedExpenseCount:0,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0};fe(s,c),$e.flushSync(()=>{u(b=>{const w=b.map(v=>v.id!==s?v:{...v,...c}),M=w.find(v=>v.id===s);return M&&(h.current[s]=M),w})}),x(),Ne(null),We(b=>b+1),S({msg:"تم إفراغ كل المدخلات في الصف النشط ومسح سجلات الحاسبات",type:"success"})},[n,x]),rr=o.useCallback(()=>{De&&wt(De)},[De,wt]),sr=o.useCallback(()=>{Ne(null)},[]),ne=o.useCallback((s,l,c)=>{const b=n.find(j=>j.id===s);if(!b||b.status==="closed")return;const w={[l]:c};if(l==="expenses"&&typeof c=="number"){const j=b.expenseCompensation??0;c<j&&(w.expenseCompensation=c)}if(Rs.includes(l)){const j={...b,...w};w.variance=tt(j)}const v=m.current[s];v&&clearTimeout(v),m.current[s]=setTimeout(()=>{const j=h.current[s];j&&fe(s,j),x()},400),$e.flushSync(()=>{u(j=>{const D=j.map(ae=>ae.id!==s?ae:{...ae,...w}),B=D.find(ae=>ae.id===s);return B&&(h.current[s]=B),D})})},[n,x]),ar=o.useCallback(s=>{const l=n.find(w=>w.id===s);if(!l||l.status!=="active")return;const c=at(l),b=st(l);if(c!==0||b!==0){oe({rowId:s,cashVar:c,bankVar:b});return}S({msg:"الصندوق مظبوط — تم عمل جيد ✓",type:"success"}),P(s),_(Date.now()+rt*1e3),R(rt)},[n]),nr=o.useCallback(()=>{if(!ue)return;const{rowId:s}=ue;oe(null),P(s),_(Date.now()+rt*1e3),R(rt)},[ue]),or=o.useCallback(()=>{oe(null)},[]),lr=o.useCallback(()=>{P(null),_(null),R(0),S({msg:"تم التراجع — يمكنك تعديل الصف",type:"info"})},[]),Re=o.useCallback((s,l,c)=>{if(s.length===0){S({msg:"لا توجد تقفيلات للطباعة",type:"warning"});return}const b=window.open("","_blank","width=800,height=900");if(!b){S({msg:"السماح بالنوافذ المنبثقة للطباعة",type:"warning"});return}const{firstActiveId:w,currentUserName:M}=c??{},v=s.map((j,D)=>{const ae=((j.status==="closed"?j.employeeName:w&&j.id===w&&M?M:j.employeeName)??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),me=j.mada+j.visa+j.mastercard,J=st(j),ke=at(j),_e=j.expenses??0,Ve=j.expenseCompensation??0,Se=j.sentToTreasury??0,ce=j.expenseItems??[],He=ke>0?"variance pos":ke<0?"variance neg":"variance",Ae=J>0?"variance pos":J<0?"variance neg":"variance",it=ce.length>0?`<div class="block expenses-detail">
                  <div class="block-title">تفاصيل المصروفات</div>
                  <div class="block-body">${ce.map(Mt=>`<div class="expense-item">${k(Mt.amount)} — ${(Mt.description||"—").replace(/</g,"&lt;")}</div>`).join("")}</div>
                </div>`:"",Ze=(j.notes||"").trim()?`<div class="block notes-block"><div class="block-title">ملاحظات</div><div class="block-body">${(j.notes||"").replace(/</g,"&lt;")}</div></div>`:"",Ct=(D>0?"page-break-before: always;":"")+(D<s.length-1?"page-break-after: always;":"");return`
            <div class="page" ${Ct?`style="${Ct}"`:""}>
              <header class="page-header">
                <h1 class="page-title">تقرير تقفيلة</h1>
                <p class="page-sub">${ae}</p>
                <p class="page-time">${j.closedAt?nt(j.closedAt):"—"}</p>
              </header>
              <div class="grid">
                <div class="block cash-block">
                  <div class="block-title">الكاش</div>
                  <div class="block-body">
                    <div class="row"><span class="label">كاش</span><span class="val">${k(j.cash)}</span></div>
                    <div class="row"><span class="label">مرسل للخزنة</span><span class="val">${k(Se)}</span></div>
                    <div class="row"><span class="label">المصروفات</span><span class="val">${k(_e)}</span></div>
                    <div class="row"><span class="label">تعويض مصروفات</span><span class="val">${k(Ve)}</span></div>
                    <div class="row"><span class="label">رصيد البرنامج كاش</span><span class="val">${k(j.programBalanceCash)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف الكاش</span><span class="val ${He}">${k(ke)}</span></div>
                  </div>
                </div>
                <div class="block bank-block">
                  <div class="block-title">البنك</div>
                  <div class="block-body">
                    <div class="row"><span class="label">مدى</span><span class="val">${k(j.mada)}</span></div>
                    <div class="row"><span class="label">فيزا</span><span class="val">${k(j.visa)}</span></div>
                    <div class="row"><span class="label">ماستر كارد</span><span class="val">${k(j.mastercard)}</span></div>
                    <div class="row"><span class="label">تحويل بنكي</span><span class="val">${k(j.bankTransfer)}</span></div>
                    <div class="row"><span class="label">بنك نزيل (مدى+فيزا+ماستر)</span><span class="val total">${k(me)}</span></div>
                    <div class="row"><span class="label">اجمالى الموازنه</span><span class="val">${k(j.programBalanceBank??0)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف البنك</span><span class="val ${Ae}">${k(J)}</span></div>
                  </div>
                </div>
              </div>
              ${it}
              ${Ze}
              <footer class="page-footer">
                <p class="footer-formulas">بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط) — انحراف البنك = بنك نزيل − اجمالى الموازنه — انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش</p>
                <p>تاريخ الطباعة: ${nt(new Date)} ${s.length>1?` — تقفيلة ${D+1} من ${s.length}`:""}</p>
              </footer>
            </div>`}).join("");b.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
          <head>
            <meta charset="utf-8">
            <title>${l}</title>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
            <style>
              * { box-sizing: border-box; margin: 0; padding: 0; }
              @page { size: A4 portrait; margin: 10mm; }
              html, body {
                font-family: 'Cairo', sans-serif;
                background: #fff;
                color: #1e293b;
                font-size: 11px;
                line-height: 1.25;
                padding: 8px;
                margin: 0;
                height: auto;
              }
              @media print {
                html, body {
                  padding: 0 !important;
                  margin: 0 !important;
                  height: auto !important;
                  min-height: unset !important;
                  overflow: visible !important;
                  background: #fff;
                  font-size: 10px !important;
                }
                .page {
                  box-shadow: none !important;
                  margin: 0 auto !important;
                  min-height: 0 !important;
                  height: auto !important;
                  page-break-inside: avoid;
                }
                .page:last-child { page-break-after: avoid !important; }
              }
              .page {
                width: 100%;
                max-width: 210mm;
                margin: 0 auto 12px;
                padding: 0 8px 10px;
                background: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
              }
              .page-header {
                text-align: center;
                padding: 8px 0 6px;
                border-bottom: 1px solid #0f172a;
                margin-bottom: 8px;
              }
              .page-title {
                font-size: 1.15rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 2px;
              }
              .page-sub {
                font-size: 0.95rem;
                font-weight: 600;
                color: #334155;
                margin-bottom: 1px;
              }
              .page-time {
                font-size: 0.8rem;
                color: #64748b;
              }
              .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-bottom: 8px;
              }
              .block {
                border: 1px solid #e2e8f0;
                border-radius: 4px;
                overflow: hidden;
              }
              .block-title {
                background: #f1f5f9;
                padding: 4px 8px;
                font-weight: 700;
                font-size: 0.8rem;
                color: #334155;
                border-bottom: 1px solid #e2e8f0;
              }
              .block-body {
                padding: 4px 8px;
                background: #fff;
              }
              .block .row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2px 0;
                border-bottom: 1px solid #f1f5f9;
                font-size: 0.8rem;
              }
              .block .row:last-child { border-bottom: none; }
              .block .row.highlight { font-weight: 700; background: #f8fafc; margin: 2px -8px -2px; padding: 4px 8px; }
              .block .row.variance-row {
                margin: 4px -8px -2px;
                padding: 6px 8px;
                background: #f1f5f9;
                border-top: 1px solid #cbd5e1;
                font-size: 0.9rem;
              }
              .block .row.variance-row .label {
                font-size: 0.9rem;
                font-weight: 800;
                color: #0f172a;
              }
              .block .row.variance-row .val { font-size: 0.9rem; font-weight: 800; }
              .block .label { color: #475569; }
              .block .val {
                font-variant-numeric: tabular-nums;
                font-weight: 500;
                color: #0f172a;
              }
              .block .val.total { font-weight: 700; }
              .block .val.variance.pos { color: #059669; }
              .block .val.variance.neg { color: #dc2626; }
              .expenses-detail, .notes-block {
                margin-top: 6px;
                border: 1px solid #e2e8f0;
                border-radius: 4px;
                overflow: hidden;
              }
              .expenses-detail .block-title, .notes-block .block-title {
                padding: 3px 8px;
                font-size: 0.75rem;
              }
              .expenses-detail .block-body, .notes-block .block-body {
                padding: 3px 8px;
              }
              .expense-item {
                padding: 2px 8px;
                font-size: 0.75rem;
                border-bottom: 1px solid #f1f5f9;
              }
              .expense-item:last-child { border-bottom: none; }
              .page-footer {
                margin-top: 8px;
                padding-top: 6px;
                border-top: 1px solid #e2e8f0;
                font-size: 0.7rem;
                color: #64748b;
                text-align: center;
              }
              .page-footer .footer-formulas {
                font-size: 0.6rem;
                color: #94a3b8;
                margin-bottom: 3px;
                line-height: 1.3;
              }
            </style>
          </head>
          <body>
            ${v}
            <script>setTimeout(function(){ window.print(); window.close(); }, 350);<\/script>
          </body>
        </html>
      `),b.document.close()},[]),ir=o.useCallback(()=>{const l=Et(Pr(p==="today"?50:p==="yesterday"?100:200),p);Re(l,`تقرير التقفيلات — ${p==="today"?"اليوم":p==="yesterday"?"أمس":"الأسبوع الماضي"}`,{firstActiveId:F,currentUserName:t})},[p,Re,F,t]),dr=o.useCallback(s=>{V(l=>{const c=new Set(l);return c.has(s)?c.delete(s):c.add(s),c})},[]),cr=o.useCallback(()=>{if(W.size===0){S({msg:"لم تحدد أي صفوف للطباعة",type:"warning"});return}const s=xe.filter(l=>W.has(l.id));Re(s,"طباعة الصفوف المحددة",{firstActiveId:F,currentUserName:t})},[W,xe,Re,F,t]),xr=o.useCallback(s=>{const l=xe.find(c=>c.id===s);l&&Re([l],"طباعة تقفيلة",{firstActiveId:F,currentUserName:t})},[xe,Re,F,t]),mr=o.useCallback(s=>{U(""),g({rowId:s,step:"confirm"})},[]),ur=o.useCallback(()=>{I&&g(s=>s?{...s,step:"code"}:null)},[I]),yt=o.useCallback(()=>{if(I){if(te.trim()!==mt()){S({msg:"كود الأدمن غير صحيح",type:"error"});return}Fr(I.rowId),V(s=>{const l=new Set(s);return l.delete(I.rowId),l}),x(),g(null),U(""),Y(!1),S({msg:"تم حذف الصف",type:"success"})}},[I,te,x]),br=o.useCallback(()=>{U(""),q({step:"confirm"})},[]),pr=o.useCallback(()=>{T&&q(s=>s?{...s,step:"code"}:null)},[T]),Nt=o.useCallback(()=>{if(T){if(te.trim()!==mt()){S({msg:"كود الأدمن غير صحيح",type:"error"});return}Or(),V(new Set),x(),q(null),U(""),Y(!1),S({msg:"تم حذف كل التقفيلات المغلقة",type:"success"})}},[T,te,x]),ze=s=>s==="cash"?"الكاش":s==="programBalanceBank"?"اجمالى الموازنه":s==="mada"?"مدى":s==="visa"?"فيزا":s==="mastercard"?"ماستر كارد":"تحويل بنكي",hr=o.useCallback(s=>{if(!F){S({msg:"لا يوجد صف نشط لترحيل الكاش إليه",type:"warning"});return}const l=n.find(b=>b.id===F),c=(l==null?void 0:l.cash)??0;if(c>0){se({amount:s,currentValue:c,field:"cash"});return}ne(F,"cash",s),S({msg:`تم ترحيل ${k(s)} إلى خانة الكاش`,type:"success"})},[F,n,ne]),fr=o.useCallback((s,l,c)=>{if(!F){S({msg:"لا يوجد صف نشط لترحيل العمليات البنكية إليه",type:"warning"});return}const b=n.find(B=>B.id===F);if(!b)return;const w=b.mada??0,M=b.visa??0,v=b.mastercard??0;if(w>0&&s>0||M>0&&l>0||v>0&&c>0){$({mada:s,visa:l,mastercard:c,currentMada:w,currentVisa:M,currentMaster:v});return}ne(F,"mada",w+s),ne(F,"visa",M+l),ne(F,"mastercard",v+c);const D=[];s>0&&D.push(`مدى ${k(s)}`),l>0&&D.push(`فيزا ${k(l)}`),c>0&&D.push(`ماستر ${k(c)}`),S({msg:`تم ترحيل العمليات البنكية: ${D.join("، ")||"—"}`,type:"success"})},[F,n,ne]),gr=o.useCallback(()=>{if(!f||!F)return;const{mada:s,visa:l,mastercard:c,currentMada:b,currentVisa:w,currentMaster:M}=f;ne(F,"mada",b+s),ne(F,"visa",w+l),ne(F,"mastercard",M+c);const v=[];s>0&&v.push(`مدى ${k(s)}`),l>0&&v.push(`فيزا ${k(l)}`),c>0&&v.push(`ماستر ${k(c)}`),S({msg:`تم ترحيل العمليات البنكية: ${v.join("، ")||"—"}`,type:"success"}),$(null)},[f,F,ne]),kr=o.useCallback(()=>{$(null)},[]),vr=o.useCallback(()=>{if(!le)return;ne(le.rowId,le.field,le.newValue);const s=ze(le.field);S({msg:`تم تعديل ${s} إلى ${k(le.newValue)}`,type:"success"}),Ce(null)},[le,ne]),jr=o.useCallback(()=>{Ce(null)},[]),wr=o.useCallback(()=>{!X||!F||(ne(F,X.field,X.amount),S({msg:`تم ترحيل ${k(X.amount)} إلى ${ze(X.field)}`,type:"success"}),se(null))},[X,F,ne]),yr=o.useCallback(()=>{se(null)},[]),Nr=o.useCallback((s,l)=>{if(!F){S({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const c=n.find(w=>w.id===F),b=c?c[l]??0:0;if(b>0){se({amount:s,currentValue:b,field:l});return}ne(F,l,s),S({msg:`تم ترحيل ${k(s)} إلى ${ze(l)}`,type:"success"})},[F,n,ne]);return e.jsxs("div",{className:"min-h-screen page-bg-warm dark:bg-slate-900 text-stone-900 dark:text-slate-200 font-cairo page-bg-pattern",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-900/95 backdrop-blur shadow-sm",children:e.jsxs("div",{className:"mx-auto w-full max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-4 py-2 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const{label:s,kind:l}=cs(y),c="w-4 h-4 shrink-0",b={morning:e.jsxs("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),e.jsx("path",{d:"M12 2v1.5M12 20.5V22M4.22 4.22l1.06 1.06M18.72 18.72l1.06 1.06M2 12h1.5M20.5 12H22M4.22 19.78l1.06-1.06M18.72 5.28l1.06-1.06"})]}),noon:e.jsxs("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),e.jsx("path",{d:"M12 2.5v2M12 19.5V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2.5 12H5M19 12h2.5M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"}),e.jsx("path",{d:"M12 7.5v4l2.5 2.5",strokeWidth:"1.8"})]}),evening:e.jsxs("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}),e.jsx("path",{d:"M12 2v3M12 19v3M3.5 12H6.5M17.5 12h3M4.93 4.93l2.12 2.12M16.95 16.95l2.12 2.12M4.93 19.07l2.12-2.12M16.95 7.05l2.12-2.12",strokeWidth:"1.2",opacity:"0.7"})]}),night:e.jsx("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})},w=l==="night";return e.jsxs("h1",{className:"flex items-center gap-2 py-1.5 px-3 rounded-xl border border-stone-300 dark:border-white/10 bg-stone-200 dark:bg-slate-800/50 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)]",children:[e.jsx("span",{className:`flex items-center justify-center w-8 h-8 rounded-lg ${w?"bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300":"bg-teal-100 text-teal-700 dark:bg-amber-500/15 dark:text-amber-400"}`,children:b[l]}),e.jsxs("span",{className:"text-sm font-semibold text-stone-800 dark:text-slate-200 tracking-tight flex items-center gap-1",children:[e.jsx("span",{className:w?"text-indigo-700 dark:text-indigo-300/90":"text-teal-700 dark:text-amber-400/95",children:s}),e.jsx("span",{className:"text-stone-600 dark:text-slate-400 font-normal",children:"،"}),e.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-cairo text-right",children:t})]})]})})(),e.jsx("div",{className:"relative z-[50] rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:e.jsx("button",{ref:d,type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),At()},className:"flex items-center justify-center w-9 h-9 rounded-lg text-stone-700 hover:text-teal-600 hover:bg-teal-500/15 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 transition cursor-pointer select-none touch-manipulation",title:a==="dark"?"الوضع الفاتح":"الوضع الداكن","aria-label":a==="dark"?"الوضع الفاتح":"الوضع الداكن",children:a==="dark"?e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"4"}),e.jsx("path",{d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"})]}):e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})}),e.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:e.jsxs("button",{type:"button",onClick:r,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-teal-600 hover:bg-teal-500/15 dark:text-slate-400 dark:hover:text-amber-400 dark:hover:bg-amber-500/10 text-xs font-cairo transition",title:"تغيير المستخدم",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"8",r:"4"}),e.jsx("path",{d:"M4 20c0-3.3 2.7-6 6-6s6 2.7 6 6"}),e.jsx("path",{d:"M16 11l3 3-3 3"}),e.jsx("path",{d:"M19 14h-5"})]}),e.jsx("span",{children:"تغيير المستخدم"})]})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{ref:ye,type:"file",accept:".xlsx,.xls",className:"hidden","aria-hidden":!0,onChange:Yt}),e.jsx("div",{className:"rounded-xl border border-violet-300 dark:border-violet-500/25 bg-violet-100 dark:bg-violet-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_8px_rgba(139,92,246,0.12)]",children:e.jsxs("button",{type:"button",onClick:qt,className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg text-sm font-cairo font-bold bg-teal-500 hover:bg-teal-600 dark:bg-gradient-to-r dark:from-violet-600 dark:to-indigo-600 dark:hover:from-violet-500 dark:hover:to-indigo-500 text-white border border-teal-400/50 dark:border-violet-400/30 shadow-md transition-all hover:scale-[1.02] active:scale-[0.98]",title:"استخراج قيم مدى، فيزا، ماستر كارد، تحويل بنكي من تقرير إكسل",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),e.jsx("path",{d:"M17 8l-5-5-5 5"}),e.jsx("path",{d:"M12 3v12"})]}),e.jsx("span",{children:"استخراج قيم"})]})}),e.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-1 rounded-xl border-2 border-teal-300 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(245,158,11,0.08)]",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-md bg-teal-200 text-teal-800 dark:bg-amber-500/15 dark:text-amber-400/90 shrink-0","aria-hidden":"true",children:e.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})}),Ds.map(s=>e.jsx("button",{type:"button",onClick:()=>A(s.id),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition ${p===s.id?"bg-teal-500/20 text-teal-800 border border-teal-600 dark:bg-amber-500/25 dark:text-amber-300 dark:border-amber-500/40 shadow-sm":"text-stone-700 border border-transparent hover:bg-stone-300 hover:text-stone-900 dark:text-slate-400 dark:hover:bg-white/5 dark:hover:text-slate-300"}`,children:s.label},s.id))]}),e.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-xl border border-stone-300 dark:border-sky-500/25 bg-stone-200 dark:bg-sky-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(14,165,233,0.08)]",children:[e.jsxs("button",{type:"button",onClick:ir,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-500 hover:bg-teal-600 dark:bg-sky-600 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:"طباعة كل الصفوف المعروضة",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M6 9V2h12v7"}),e.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),e.jsx("path",{d:"M6 14h12v8H6z"})]}),e.jsx("span",{children:"الكل"})]}),W.size>0&&e.jsxs("button",{type:"button",onClick:cr,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-400 hover:bg-teal-500 dark:bg-sky-500/90 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:`طباعة ${W.size} صف محدد`,children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M6 9V2h12v7"}),e.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),e.jsx("path",{d:"M6 14h12v8H6z"})]}),e.jsxs("span",{children:["المحددة (",W.size,")"]})]})]})]})]})}),e.jsxs("main",{className:"mx-auto w-full max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-4 py-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"rounded-3xl overflow-hidden flex flex-col border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/30 backdrop-blur-sm shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)]",style:{minHeight:Ie*52+48+56+44},children:[e.jsx("div",{className:"overflow-auto flex-1 min-h-0 scrollbar-thin",style:{scrollbarGutter:"stable"},children:e.jsxs("table",{className:"w-full text-sm border-collapse table-fixed",style:{tableLayout:"fixed",width:"100%",minWidth:"100%"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"3%"}}),e.jsx("col",{style:{width:"2.5%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"12%"}})]}),e.jsx("thead",{className:"sticky top-0 z-10 bg-stone-100 dark:bg-amber-500/[0.08] backdrop-blur-md border-b-2 border-stone-500 dark:border-amber-500/20 shadow-md dark:shadow-[0_2px_8px_rgba(245,158,11,0.06)]",children:e.jsxs("tr",{className:"h-14",children:[e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"تحديد"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"م"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"كاش"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"مرسل للخزنة — يدخل في معادلة انحراف الكاش",children:"مرسل للخزنة"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"يُخصم من المصروفات في انحراف الكاش",children:"تعويض مصروفات"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"المصروفات"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-semibold text-teal-800 dark:text-teal-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"رصيد البرنامج كاش"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-red-700 dark:text-red-400 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 bg-red-100 dark:bg-red-500/10 font-cairo rounded-sm shadow-sm",title:"خانة مهمة: الفرق بين المتوقع والفعلي للكاش",children:"انحراف الكاش"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"مدى"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"فيزا"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"ماستر كارد"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-semibold text-sky-700 dark:text-sky-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"للعرض فقط — لا يدخل في بنك نزيل ولا انحراف البنك",children:"تحويل بنكي"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-semibold text-teal-800 dark:text-teal-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط)",children:"بنك نزيل"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"اجمالى الموازنه"}),e.jsx("th",{className:"px-2 py-3 text-center text-[11px] font-bold text-red-700 dark:text-red-400 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 bg-red-100 dark:bg-red-500/10 font-cairo rounded-sm shadow-sm",title:"خانة مهمة: الفرق بين بنك نزيل واجمالى الموازنه",children:"انحراف البنك"}),e.jsx("th",{className:"px-1.5 py-3 text-center text-[10px] font-semibold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 overflow-hidden min-w-0 font-cairo",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 h-full min-w-0",children:[e.jsx("span",{className:"truncate max-w-full",children:"الحالة / إجراءات"}),e.jsx("button",{type:"button",onClick:br,"aria-label":"حذف كل التقفيلات المغلقة",className:"inline-flex items-center justify-center w-7 h-7 rounded-lg border-2 border-stone-400 dark:border-white/10 bg-stone-200 dark:bg-slate-700/50 text-stone-800 dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 transition-all shrink-0 shadow-sm",title:"حذف كل التقفيلات المغلقة",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),e.jsx("path",{d:"M10 11v6M14 11v6"})]})})]})})]})}),e.jsx("tbody",{children:Ut.map((s,l)=>e.jsx(hs,{row:s,rowNumber:(z-1)*Ie+l+1,isFirstActive:s.id===F,liveNow:y,closingRowId:N,closingSecondsLeft:N===s.id?E:0,onUpdate:ne,isSelected:W.has(s.id),onToggleSelect:dr,onDeleteRow:mr,onPrintRow:xr,onOpenExpenseDetails:Je,onClearExpensesAndOpen:Gt,onLockedFieldClick:er,onExpenseCompensationExceeded:tr,lastExcelDetails:ge,onShowExcelDetails:(c,b)=>be({field:c,rowId:b}),onRequestConfirmBankEdit:ge?(c,b,w,M)=>Ce({rowId:c,field:b,oldValue:w,newValue:M}):void 0,onShowEmployeeNames:Fe.length>0?()=>Z(!0):void 0,onShowVarianceExplanation:(c,b)=>he({type:c,row:b}),currentUserName:t,onClearRow:c=>Ne(c),isStickyRows:l===0},s.id))})]})}),xe.length>Ie&&e.jsxs("div",{className:"px-4 py-3 border-t border-stone-300 dark:border-white/[0.06] flex items-center justify-center gap-2 flex-wrap rounded-b-3xl bg-stone-200 dark:bg-slate-800/50 backdrop-blur-sm",children:[e.jsxs("button",{type:"button",onClick:()=>L(s=>Math.max(1,s-1)),disabled:z<=1,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-teal-200 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 text-teal-700 dark:text-amber-400/95 hover:bg-teal-100 hover:border-teal-300 dark:hover:bg-amber-500/20 dark:hover:border-amber-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة السابقة",children:[e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})}),"السابق"]}),e.jsxs("span",{className:"inline-flex items-center min-w-[4rem] justify-center px-3 py-2 rounded-xl bg-teal-100 dark:bg-amber-500/15 border border-teal-200 dark:border-amber-500/30 text-teal-700 dark:text-amber-400 text-sm font-cairo font-semibold tabular-nums shadow-sm dark:shadow-[0_0_12px_rgba(245,158,11,0.1)]",children:[z===1?"الرئيسية":z," / ",Oe]}),e.jsxs("button",{type:"button",onClick:()=>L(s=>Math.min(Oe,s+1)),disabled:z>=Oe,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-teal-200 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 text-teal-700 dark:text-amber-400/95 hover:bg-teal-100 hover:border-teal-300 dark:hover:bg-amber-500/20 dark:hover:border-amber-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة التالية",children:["التالي",e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})]})]}),xe.length===0&&e.jsxs("div",{className:"py-16 px-4 text-center rounded-b-3xl bg-stone-100 dark:bg-slate-800/20",children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-500 font-cairo mb-1",children:"لا توجد تقفيلات"}),e.jsx("p",{className:"text-stone-700 dark:text-slate-600 text-sm font-cairo",children:"اختر فلتراً مختلفاً أو ابدأ شفتاً جديداً"})]})]}),e.jsx("div",{className:"flex flex-col items-center justify-center gap-2 py-3 px-4 rounded-xl border-2 border-teal-500 dark:border-amber-500/30 bg-gradient-to-b from-teal-50 to-stone-200 dark:from-amber-500/10 dark:to-slate-800/60 min-h-0 shadow-md dark:shadow-[0_4px_20px_rgba(245,158,11,0.12),0_0_1px_rgba(255,255,255,0.06)]",children:N?e.jsx("div",{className:"flex flex-wrap items-center justify-center w-full",dir:"ltr",children:E>0?e.jsxs("button",{type:"button",onClick:lr,className:"btn-close-shift inline-flex items-center justify-center gap-3 px-7 py-3.5 rounded-2xl text-base font-cairo font-bold whitespace-nowrap border-2 border-teal-400 bg-teal-500 hover:bg-teal-600 text-white shadow-md dark:border-emerald-500/60 dark:bg-gradient-to-b dark:from-emerald-500/30 dark:to-emerald-600/20 dark:text-emerald-50 dark:shadow-[0_4px_24px_rgba(16,185,129,0.25)] dark:hover:from-emerald-500/40 dark:hover:to-emerald-600/30 dark:hover:shadow-[0_6px_28px_rgba(16,185,129,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all select-none",children:[e.jsxs("svg",{className:"w-6 h-6 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 10h10a5 5 0 015 5v2"}),e.jsx("path",{d:"M7 15l-4-4 4-4"})]}),e.jsx("span",{className:"tracking-wide",children:"تراجع"}),e.jsxs("span",{className:"tabular-nums font-cairo",children:["(",E," ثانية)"]})]}):e.jsx("span",{className:"text-sm font-cairo font-medium text-teal-800 dark:text-amber-400 tabular-nums",children:"جاري الإغلاق..."})}):F&&ve?e.jsxs("button",{type:"button",onClick:()=>ar(F),disabled:!Qe,className:`btn-close-shift inline-flex items-center justify-center gap-3 px-8 py-3.5 min-w-[280px] rounded-2xl text-base font-cairo font-bold whitespace-nowrap border-2 select-none transition-all
                ${Qe?"bg-teal-500 hover:bg-teal-600 text-white border-teal-400 shadow-md dark:bg-gradient-to-b dark:from-amber-500/50 dark:to-amber-600/40 dark:text-amber-50 dark:border-amber-400 dark:shadow-[0_4px_24px_rgba(245,158,11,0.3)] dark:hover:from-amber-500/60 dark:hover:to-amber-600/50 dark:hover:shadow-[0_6px_28px_rgba(245,158,11,0.35)] hover:scale-[1.02] active:scale-[0.98]":"opacity-60 bg-stone-200 text-stone-500 border-stone-300 dark:opacity-50 dark:bg-slate-800/40 dark:text-slate-500 dark:border-slate-600/50 cursor-not-allowed"}`,title:Qe?"إغلاق الشفت وحفظ التقفيلة":"أدخل رصيد البرنامج كاش وإجمالي الموازنة (البنك) أولاً",children:[e.jsxs("svg",{className:`btn-close-shift-icon w-6 h-6 shrink-0 ${Qe?"text-white dark:text-amber-200":"text-stone-500 dark:text-slate-500"}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]}),e.jsx("span",{className:"tracking-wide",children:t?`إغلاق شفت ${t}`:"إغلاق الشفت الحالي"})]}):null}),e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-[minmax(260px,320px)_1fr_1fr] gap-4 w-full max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] items-stretch min-h-[420px] [&>div]:min-h-[380px]",children:[e.jsx("div",{className:"min-h-0 flex flex-col",children:e.jsx(ks,{onTransfer:Nr,hasActiveRow:!!F},`calculator-${Ee}`)}),e.jsx("div",{className:"min-h-0 flex flex-col",children:e.jsx(vs,{onApplyToCash:hr,hasActiveRow:!!F},`cashCalculator-${Ee}`)}),e.jsx("div",{className:"min-h-0 flex flex-col",children:e.jsx(ws,{onTransfer:fr,hasActiveRow:!!F},`bankOps-${Ee}`)})]})]}),O&&e.jsx(Cs,{message:O.msg,type:O.type,onClose:()=>S(null),position:"center",autoHideMs:O.autoHideMs}),C&&ge&&(()=>{const{field:s,rowId:l}=C,c=ge[s]??[],b=c.reduce((B,ae)=>B+ae.amount,0),w=n.find(B=>B.id===l),M=w?w[s]??0:0,v=M-b,D=`سجل التغيير — ${{mada:"مدى",visa:"فيزا",mastercard:"ماستر كارد",bankTransfer:"تحويل بنكي"}[s]}`;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"excel-detail-title",onClick:()=>be(null),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-sm w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:B=>B.stopPropagation(),children:[e.jsx("h2",{id:"excel-detail-title",className:"text-base font-bold text-teal-800 dark:text-amber-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:D}),e.jsxs("div",{className:"p-3 space-y-2 border-b border-stone-200 dark:border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"من إكسل (مرفوع):"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-600 dark:text-amber-200/95",children:k(b)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الحالي في الخانة:"}),e.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-slate-200",children:k(M)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الفرق (ترحيل أو تعديل يدوي):"}),e.jsx("span",{className:`tabular-nums font-medium ${v>=0?"text-teal-600 dark:text-amber-400":"text-rose-600 dark:text-rose-400"}`,children:k(v)})]})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-2",children:[e.jsxs("p",{className:"text-xs font-cairo text-stone-500 dark:text-slate-400 mb-1",children:[c.length," عملية من الإكسل"]}),c.map((B,ae)=>e.jsxs("div",{className:"py-2 border-b border-stone-200 dark:border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm text-stone-800 dark:text-slate-300",children:[e.jsx("div",{className:"flex flex-col items-start gap-0.5 min-w-0",children:B.employeeName?e.jsx("span",{className:"text-xs text-stone-500 font-cairo",children:B.employeeName}):null}),e.jsx("span",{className:"tabular-nums font-medium text-teal-600 dark:text-amber-200/95 shrink-0",children:k(B.amount)})]}),B.purpose&&e.jsx("p",{className:"text-xs font-cairo text-stone-600 dark:text-amber-200/80 mt-1 pr-0 border-t border-stone-300 dark:border-amber-500/20 pt-1",children:B.purpose})]},ae))]}),e.jsxs("div",{className:"p-4 pt-2 border-t border-stone-300 dark:border-amber-500/30 flex justify-between items-center bg-stone-100 dark:bg-slate-900/50",children:[e.jsx("span",{className:"font-bold text-stone-800 dark:text-slate-200",children:"إجمالي الإكسل"}),e.jsx("span",{className:"tabular-nums font-bold text-teal-600 dark:text-amber-400",children:k(b)})]})]}),e.jsx("div",{className:"p-3",children:e.jsx("button",{type:"button",onClick:()=>be(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-500 hover:bg-teal-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white dark:text-slate-200 transition",children:"إغلاق"})})]})})})(),Q&&Fe.length>0&&(()=>{const s=Fe.map(l=>{let c=0,b=0;if(ge)for(const w of["mada","visa","mastercard","bankTransfer"]){const M=ge[w]??[];for(const v of M)(v.employeeName??"").trim()===l&&(c+=1,b+=v.amount)}return{name:l,count:c,total:b}});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"employee-names-title",onClick:()=>Z(!1),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:l=>l.stopPropagation(),children:[e.jsx("h2",{id:"employee-names-title",className:"text-base font-bold text-teal-700 dark:text-amber-400 p-4 pb-2 border-b border-white/10",children:"أسماء الموظفين في العمليات المستوردة"}),e.jsx("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-1.5",children:s.map((l,c)=>e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm text-slate-300 py-2 px-3 rounded-lg bg-slate-900/50 border border-white/5 font-cairo",children:[e.jsx("span",{className:"font-medium text-slate-200",children:l.name}),e.jsxs("span",{className:"tabular-nums text-teal-600 dark:text-amber-200/90 text-xs",children:[l.count," عملية — الإجمالي: ",k(l.total)]})]},c))}),e.jsx("div",{className:"p-3 border-t border-white/10",children:e.jsx("button",{type:"button",onClick:()=>Z(!1),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إغلاق"})})]})})})(),pe&&(()=>{const{type:s,row:l}=pe,c=l.cash??0,b=l.sentToTreasury??0,w=l.expenses??0,M=l.expenseCompensation??0,v=Math.max(0,w-M),j=l.programBalanceCash??0,D=c+b+v,B=at(l),ae=l.mada+l.visa+l.mastercard,me=l.programBalanceBank??0,J=st(l),ke=s==="cash",_e=ke?"شرح انحراف الكاش":"شرح انحراف البنك",Ve=B!==0&&J!==0&&B>0!=J>0,Se=Math.abs(Math.abs(B)-Math.abs(J))<=Es,ce=Ve&&Se,He=ce?Math.abs(B):0;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"variance-explanation-title",onClick:()=>he(null),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:Ae=>Ae.stopPropagation(),children:[e.jsx("h2",{id:"variance-explanation-title",className:"text-base font-bold text-teal-800 dark:text-amber-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:_e}),e.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-4 space-y-3 text-sm text-stone-800 dark:text-slate-300",children:[ke?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-800 dark:text-slate-200 font-semibold text-teal-800 dark:text-teal-300",children:"انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش"}),e.jsxs("ul",{className:"space-y-1.5 list-none",children:[e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"كاش"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(c)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مرسل للخزنة"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(b)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مصروفات"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(w)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"تعويض مصروفات"}),e.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",k(M)]})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5",children:[e.jsx("span",{children:"مصروفات فعّالة (صافي)"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(v)})]}),e.jsxs("li",{className:"flex justify-between gap-2 font-medium",children:[e.jsx("span",{children:"كاش + مرسل للخزنة + مصروفات فعّالة"}),e.jsx("span",{className:"tabular-nums font-bold text-teal-800 dark:text-teal-300",children:k(D)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"رصيد البرنامج كاش"}),e.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",k(j)]})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-teal-400 dark:border-amber-500/30 pt-2 font-bold text-teal-800 dark:text-amber-300",children:[e.jsx("span",{children:"انحراف الكاش"}),e.jsxs("span",{className:"tabular-nums",children:[B>0?"+":"",k(B)]})]})]}),e.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:B>0?"زيادة: الكاش الفعلي (أو المرسل + المصروف الفعلي) أكبر من رصيد البرنامج.":B<0?"عجز: رصيد البرنامج كاش أكبر من المتوقّع من الكاش والمرسل والمصروف.":"لا يوجد انحراف."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-800 dark:text-slate-200 font-semibold text-teal-800 dark:text-teal-300",children:"انحراف البنك = بنك نزيل − اجمالى الموازنه"}),e.jsxs("ul",{className:"space-y-1.5 list-none",children:[e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مدى"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.mada)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"فيزا"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.visa)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"ماستر كارد"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.mastercard)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsxs("span",{children:["تحويل بنكي ",e.jsx("span",{className:"text-stone-500 dark:text-slate-500 text-[10px]",children:"(للعرض فقط)"})]}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.bankTransfer)})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5 font-medium",children:[e.jsx("span",{children:"بنك نزيل (مدى+فيزا+ماستر)"}),e.jsx("span",{className:"tabular-nums font-bold text-teal-800 dark:text-teal-300",children:k(ae)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"اجمالى الموازنه"}),e.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",k(me)]})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-teal-400 dark:border-amber-500/30 pt-2 font-bold text-teal-800 dark:text-amber-300",children:[e.jsx("span",{children:"انحراف البنك"}),e.jsxs("span",{className:"tabular-nums",children:[J>0?"+":"",k(J)]})]})]}),e.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:J>0?"زيادة: بنك نزيل أكبر من اجمالى الموازنه المدخل.":J<0?"عجز: اجمالى الموازنه أكبر من بنك نزيل.":"لا يوجد انحراف."})]}),ce&&e.jsxs("div",{className:"mt-3 p-3 rounded-xl border-2 border-teal-400/60 dark:border-amber-500/30 bg-teal-50 dark:bg-amber-900/20 text-teal-800 dark:text-amber-200 text-sm font-medium",children:["تنبيه: قد تكون سندات بقيمة ",e.jsx("strong",{children:He.toLocaleString("ar-SA",{minimumFractionDigits:2})})," ريال دخلت في خانة خاطئة (نقداً ↔ شبكة). راجع تحويل المبلغ بين الكاش وبنك نزيل."]})]}),e.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/10",children:e.jsx("button",{type:"button",onClick:()=>he(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),ue&&(()=>{const{cashVar:s,bankVar:l}=ue,c=s!==0?s>0?"زيادة في صندوق الكاش — راجع الرصيد الفعلي":"عجز في صندوق الكاش — راجع الكاش والرصيد والمصروف":"",b=l!==0?l>0?"زيادة في البنك — راجع إدخالات مدى/فيزا/ماستر أو اجمالى الموازنه":"عجز في البنك — راجع بنك نزيل أو اجمالى الموازنه":"";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"close-variance-title",children:e.jsxs("div",{className:"rounded-2xl border-2 border-teal-300 dark:border-amber-500/30 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"close-variance-title",className:"text-lg font-bold text-teal-800 dark:text-amber-400 mb-3",children:"تنبيه: يوجد انحراف"}),e.jsxs("div",{className:"text-stone-800 dark:text-slate-300 text-sm leading-relaxed mb-4 space-y-2",children:[s!==0&&e.jsxs("p",{className:"block",children:[e.jsx("span",{className:"font-medium",children:"انحراف الكاش: "}),e.jsxs("span",{className:"font-bold tabular-nums text-teal-700 dark:text-teal-400",children:[s>0?"+":"",k(s)]}),c&&e.jsx("span",{className:"block text-stone-600 dark:text-amber-200/90 text-xs mt-0.5",children:c})]}),l!==0&&e.jsxs("p",{className:"block",children:[e.jsx("span",{className:"font-medium",children:"انحراف البنك: "}),e.jsxs("span",{className:"font-bold tabular-nums text-teal-700 dark:text-teal-400",children:[l>0?"+":"",k(l)]}),b&&e.jsx("span",{className:"block text-stone-600 dark:text-amber-200/90 text-xs mt-0.5",children:b})]}),e.jsx("p",{className:"pt-2 text-stone-700 dark:text-slate-200",children:"هل تريد الإغلاق مع هذا الانحراف؟"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:nr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، إغلاق الشفت"}),e.jsx("button",{type:"button",onClick:or,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا، متابعة التعديل"})]})]})})})(),X&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"transfer-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsxs("h2",{id:"transfer-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:["ترحيل إلى ",ze(X.field)]}),e.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد ترحيل الرقم الجديد وهو ",e.jsx("span",{className:"font-bold text-white tabular-nums",children:k(X.amount)}),"؟ يوجد رقم في الخانة وهو ",e.jsx("span",{className:"font-bold text-white tabular-nums",children:k(X.currentValue)}),"."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:wr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:yr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-transfer-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"bank-transfer-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:"ترحيل العمليات البنكية"}),e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"هل تريد ترحيل الأرقام الجديدة؟ توجد قيم في الخانات:"}),e.jsxs("ul",{className:"text-sm text-stone-700 dark:text-slate-300 space-y-1.5 mb-4",children:[f.mada>0&&e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مدى:"}),e.jsxs("span",{className:"tabular-nums",children:["مرحّل ",e.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:k(f.mada)})," — في الخانة ",e.jsx("strong",{children:k(f.currentMada)})]})]}),f.visa>0&&e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"فيزا:"}),e.jsxs("span",{className:"tabular-nums",children:["مرحّل ",e.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:k(f.visa)})," — في الخانة ",e.jsx("strong",{children:k(f.currentVisa)})]})]}),f.mastercard>0&&e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"ماستر:"}),e.jsxs("span",{className:"tabular-nums",children:["مرحّل ",e.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:k(f.mastercard)})," — في الخانة ",e.jsx("strong",{children:k(f.currentMaster)})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:gr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:kr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),le&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-edit-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsxs("h2",{id:"bank-edit-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:["تعديل خانة ",ze(le.field)]}),e.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد تعديل الرقم من ",e.jsx("span",{className:"font-bold tabular-nums",children:k(le.oldValue)})," إلى ",e.jsx("span",{className:"font-bold tabular-nums text-teal-600 dark:text-amber-400",children:k(le.newValue)}),"؟"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:vr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:jr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),De&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"clear-row-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"clear-row-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:"إفراغ الصف"}),e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد إفراغ كل المدخلات في هذا الصف؟ (كاش، مدى، فيزا، ماستر، اجمالى الموازنه، مصروفات، وغيرها)"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:rr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:sr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),H&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"expense-modal-title",onClick:()=>ee(null),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-lg w-full max-h-[85vh] flex flex-col font-cairo cursor-auto",onClick:s=>s.stopPropagation(),onKeyDown:s=>{s.key==="Enter"&&!H.readOnly&&(s.preventDefault(),Pe())},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsx("h2",{id:"expense-modal-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400",children:H.readOnly?"تفاصيل المصروفات":"تصنيف المبلغ المصروف"}),e.jsx("button",{type:"button",onClick:()=>ee(null),className:"p-2 rounded-lg text-stone-500 hover:text-white hover:bg-white/10 transition","aria-label":"إغلاق",children:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),!H.readOnly&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-500 text-sm px-4 pt-2",children:"أدخل تفاصيل المصروف (مثال: 10 ريال كتب، 10 ريال مسطرة)"}),(H.carriedCount??0)>0&&e.jsx("p",{className:"text-stone-600 dark:text-amber-200/80 text-xs px-4 pt-0.5 font-cairo",children:"البنود المرحّلة للعرض فقط — يمكنك إضافة تصنيف ومبلغ جديد فقط، ويُحدَّث المجموع وخانة المصروفات تلقائياً."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[!H.readOnly&&H.items.length>0&&e.jsxs("div",{className:"flex gap-2 items-center pb-0.5",children:[e.jsx("span",{className:"flex-1 text-xs font-medium text-stone-700 font-cairo",children:"بند المصروف"}),e.jsx("span",{className:"w-24 text-xs font-medium text-stone-700 font-cairo text-center",children:"مبلغ المصروف"}),e.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}),H.items.map((s,l)=>{const c=H.carriedCount??0,b=!H.readOnly&&l<c;return e.jsx("div",{className:"flex gap-2 items-center",children:H.readOnly||b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-24 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm text-center tabular-nums",children:k(Number(s.amount)||0)}),e.jsxs("span",{className:"flex-1 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm font-cairo",children:[s.description||"—",b&&e.jsx("span",{className:"mr-1 text-[10px] text-stone-600 font-cairo",title:"من الشفت السابق",children:" (مرحّل)"})]}),!H.readOnly&&b?e.jsx("button",{type:"button",onClick:()=>Qt(H.rowId,l),className:"shrink-0 w-8 h-8 flex items-center justify-center rounded-lg border border-red-500/20 text-slate-400 hover:text-red-400 hover:border-red-500/40",title:"حذف البند المرحّل (يتطلب كود أدمن)","aria-label":"حذف بند مرحّل",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}):e.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:[(()=>{const w=ie.current[l]!==void 0?ie.current[l]:String(s.amount??""),M=(Number(String(w).replace(/,/g,""))||0)>0,v=!String(s.description||"").trim(),j=M&&v,D=Me===l;return e.jsx("input",{ref:B=>{!B||l!==c||H.readOnly||kt.current===H.rowId||(kt.current=H.rowId,B.focus())},type:"text",tabIndex:l===c?0:-1,value:s.description,onChange:B=>{vt(l,"description",B.target.value),Me===l&&Be(null)},onKeyDown:B=>{B.key==="Enter"&&(B.preventDefault(),Pe())},placeholder:M?"الوصف إلزامي":"الوصف",title:M?"الوصف إلزامي عند وجود مبلغ":void 0,"aria-required":M,className:`flex-1 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 dark:focus:border-amber-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-amber-500/25 ${j?"border-teal-500 dark:border-amber-500/50 ring-1 ring-teal-500/25":"border-stone-300 dark:border-amber-500/25"} ${D?"expense-description-pulse":""}`})})(),e.jsx("input",{type:"text",inputMode:"decimal",tabIndex:-1,dir:"ltr",value:Le(ie.current[l]!==void 0?ie.current[l]:String(s.amount??"")),onChange:w=>{let M=Le(w.target.value).replace(/[^\d.]/g,"");const v=M.indexOf(".");v>=0&&(M=M.slice(0,v+1)+M.slice(v+1).replace(/\./g,"")),ie.current[l]=M,vt(l,"amount",M)},onKeyDown:w=>{w.key==="Enter"&&(w.preventDefault(),Pe())},placeholder:"مبلغ",className:"cashbox-input w-24 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border border-stone-300 dark:border-amber-500/25 text-stone-900 dark:text-white text-sm text-center focus:border-teal-500/50 dark:focus:border-amber-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-amber-500/25"}),e.jsx("button",{type:"button",tabIndex:-1,onClick:()=>Jt(l),disabled:H.items.length<=1,className:"p-2 rounded-lg text-stone-500 hover:text-red-400 hover:bg-red-500/20 disabled:opacity-40 disabled:pointer-events-none transition","aria-label":"حذف السطر",title:"حذف",children:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})},l)})]}),e.jsxs("div",{className:"p-4 border-t border-white/10 flex flex-wrap items-center gap-3",children:[!H.readOnly&&e.jsxs("button",{type:"button",tabIndex:-1,onClick:Xt,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium bg-teal-100 text-teal-700 border-2 border-teal-400 hover:bg-teal-200 transition",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),"إضافة سطر"]}),e.jsx("div",{className:"flex-1"}),H.readOnly?e.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",e.jsx("span",{className:"font-bold text-teal-700 dark:text-amber-400 tabular-nums",children:k(H.items.reduce((s,l)=>s+(Number(l.amount)||0),0))})]}):e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",e.jsx("span",{className:"font-bold text-teal-700 dark:text-amber-400 tabular-nums",children:k(H.items.reduce((s,l)=>s+(Number(l.amount)||0),0))})]}),e.jsx("button",{type:"button",onClick:Pe,onKeyDown:s=>{(s.key==="Enter"||s.key===" "||s.key==="Tab")&&(s.preventDefault(),Pe())},className:"px-4 py-2 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-slate-800 focus:shadow-[0_0_16px_rgba(16,185,129,0.4)]",children:"تعديل مبلغ المصروفات"})]})]})]})}),G&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-carried-dialog-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"delete-carried-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:G.step==="confirm"?"حذف بند مرحّل":"كود الأدمن"}),G.step==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف هذا البند المرحّل؟ يتطلب إدخال كود الأدمن في الخطوة التالية."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:Zt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:()=>{K(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:re?"text":"password",value:te,onChange:s=>U(s.target.value),onKeyDown:s=>{s.key==="Enter"&&jt(),s.key==="Escape"&&(K(null),U(""))},placeholder:"كود الأدمن",className:"w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border border-white/10 text-white text-sm font-cairo focus:border-amber-500/50 focus:ring-1 focus:ring-amber-500/25",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>Y(s=>!s),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":re?"إخفاء الكود":"إظهار الكود",children:re?e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),e.jsx("path",{d:"M1 1l22 22"})]}):e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:jt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),e.jsx("button",{type:"button",onClick:()=>{K(null),U(""),Y(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-dialog-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"delete-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:I.step==="confirm"?"حذف الصف":"كود الأدمن"}),I.step==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف الصف؟"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:ur,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:()=>g(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:re?"text":"password",value:te,onChange:s=>U(s.target.value),onKeyDown:s=>{s.key==="Enter"&&yt(),s.key==="Escape"&&g(null)},placeholder:"كود الأدمن",className:"w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border border-white/10 text-white text-sm font-cairo focus:border-amber-500/50 focus:ring-1 focus:ring-amber-500/25",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>Y(s=>!s),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":re?"إخفاء الكود":"إظهار الكود",title:re?"إخفاء":"إظهار",children:re?e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),e.jsx("path",{d:"M1 1l22 22"})]}):e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:yt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),e.jsx("button",{type:"button",onClick:()=>{g(null),U(""),Y(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-all-dialog-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"delete-all-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:T.step==="confirm"?"حذف كل التقفيلات المغلقة":"كود الأدمن"}),T.step==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف كل التقفيلات المغلقة؟"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:pr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:()=>q(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:re?"text":"password",value:te,onChange:s=>U(s.target.value),onKeyDown:s=>{s.key==="Enter"&&Nt(),s.key==="Escape"&&q(null)},placeholder:"كود الأدمن",className:"w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border border-white/10 text-white text-sm font-cairo focus:border-amber-500/50 focus:ring-1 focus:ring-amber-500/25",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>Y(s=>!s),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":re?"إخفاء الكود":"إظهار الكود",title:re?"إخفاء":"إظهار",children:re?e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),e.jsx("path",{d:"M1 1l22 22"})]}):e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:Nt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),e.jsx("button",{type:"button",onClick:()=>{q(null),U(""),Y(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})})]})}const Rs=["cash","sentToTreasury","expenseCompensation","expenses","mada","visa","mastercard","bankTransfer","programBalanceCash","programBalanceBank"],ut="cashbox_name";function As(){const[t,r]=o.useState(null),[a,i]=o.useState(!1),[d,n]=o.useState("dark");o.useEffect(()=>{const h=sessionStorage.getItem(ut);h!=null&&h.trim()&&r(h.trim());const y=Ls();n(y),ht(y),i(!0)},[]),o.useEffect(()=>{const h=y=>n(y.detail);return window.addEventListener("cashbox-theme-change",h),()=>window.removeEventListener("cashbox-theme-change",h)},[]),o.useEffect(()=>{ht(d)},[d]);const u=h=>{sessionStorage.setItem(ut,h),r(h)},x=()=>{sessionStorage.removeItem(ut),r(null)};if(!a)return e.jsx("div",{className:"min-h-screen page-bg-warm dark:bg-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-700 dark:text-slate-500 font-cairo",children:"جاري التحميل..."})});const m=()=>Kt();return t?e.jsx(Bs,{name:t,onExit:x,theme:d,onToggleTheme:m}):e.jsx(Ar,{onEnter:u})}bt.createRoot(document.getElementById("root")).render(e.jsx(Cr.StrictMode,{children:e.jsx(As,{})}));
