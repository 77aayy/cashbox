import{r as I,a as xn,R as gd}from"./vendor-react-wGySg1uH.js";import{r as xd,u as un}from"./vendor-xlsx-DLNWaC59.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var uc={exports:{}},hi={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bd=I,yd=Symbol.for("react.element"),_d=Symbol.for("react.fragment"),wd=Object.prototype.hasOwnProperty,vd=bd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kd={key:!0,ref:!0,__self:!0,__source:!0};function dc(n,e,t){var r,s={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)wd.call(e,r)&&!kd.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:yd,type:n,key:o,ref:a,props:s,_owner:vd.current}}hi.Fragment=_d;hi.jsx=dc;hi.jsxs=dc;uc.exports=hi;var l=uc.exports,io={},Fa=xn;io.createRoot=Fa.createRoot,io.hydrateRoot=Fa.hydrateRoot;const Ed=/^[\p{L}\s]*$/u;function Td(n){return Ed.test(n)&&n.length>0&&new RegExp("\\p{L}","u").test(n)}const Id=[{id:"corniche",label:"الكورنيش"},{id:"andalusia",label:"الأندلس"}];function Ad({onEnter:n}){const[e,t]=I.useState(""),[r,s]=I.useState("corniche"),[o,a]=I.useState(""),u=Td(e.trim());function h(m){const g=m.target.value;/\d/.test(g)||(t(g),a(""))}function f(m){m.preventDefault();const g=e.trim();if(/\d/.test(g)){a("الاسم حروف فقط — بدون أرقام");return}if(!new RegExp("\\p{L}","u").test(g)){a("أدخل اسمك (حروف فقط)");return}a(""),n(g,r)}return l.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-br from-[#f4ebe0] via-[#f8f3ed] to-[#efe6dc] dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex flex-col items-center justify-center p-4 sm:p-6 safe-top safe-bottom",children:l.jsxs("div",{className:"w-full max-w-[95vw] sm:max-w-md bg-stone-50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl sm:rounded-3xl border border-stone-300 dark:border-white/20 shadow-xl dark:shadow-2xl p-5 sm:p-8",children:[l.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[l.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-primary-500 font-cairo mb-2",children:"أهلاً بك"}),l.jsx("p",{className:"text-sm sm:text-base text-stone-700 dark:text-slate-400 font-cairo",children:"اكتب اسمك للدخول"})]}),l.jsxs("form",{onSubmit:f,className:"space-y-4 sm:space-y-5",children:[o&&l.jsx("div",{className:"p-3 rounded-xl bg-red-50 dark:bg-red-500/20 border border-red-200 dark:border-red-500/40 text-red-700 dark:text-red-300 text-sm font-cairo",children:o}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الاسم (حروف فقط)"}),l.jsx("input",{id:"name",type:"text",value:e,onChange:h,placeholder:"أدخل اسمك",className:"w-full px-4 py-3 rounded-xl bg-stone-100 dark:bg-slate-900/80 border border-stone-300 dark:border-white/20 text-stone-900 dark:text-white placeholder-stone-500 dark:placeholder-slate-500 focus:border-primary-500/50 focus:ring-1 focus:ring-primary-500/25 focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-900 font-cairo",autoComplete:"off",autoFocus:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الفرع"}),l.jsx("div",{className:"flex gap-2",children:Id.map(m=>l.jsx("button",{type:"button",onClick:()=>s(m.id),className:`flex-1 py-3 rounded-xl font-cairo font-semibold text-sm border-2 transition ${r===m.id?"bg-primary-500 border-primary-600 text-white dark:bg-amber-500/30 dark:border-amber-500/50 dark:text-amber-200":"bg-stone-100 dark:bg-slate-900/80 border-stone-300 dark:border-white/20 text-stone-700 dark:text-slate-300 hover:border-primary-400 dark:hover:border-amber-500/40"}`,children:m.label},m.id))})]}),l.jsx("button",{type:"submit",disabled:!u,className:"w-full py-3 sm:py-3.5 rounded-xl font-bold font-cairo text-sm sm:text-base bg-primary-500 hover:bg-primary-600 text-white disabled:opacity-40 disabled:cursor-not-allowed transition focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none min-h-[44px] touch-manipulation",children:"دخول"})]})]})})}const Cd="modulepreload",Nd=function(n){return"/cashbox/"+n},Ba={},Rd=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(h=>{if(h=Nd(h),h in Ba)return;Ba[h]=!0;const f=h.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":Cd,f||(g.as="script"),g.crossOrigin="",g.href=h,u&&g.setAttribute("nonce",u),document.head.appendChild(g),f)return new Promise((E,N)=>{g.addEventListener("load",E),g.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return s.then(a=>{for(const u of a||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})},Sd=()=>{};var $a={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hc=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},jd=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],a=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},fc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,m=o>>2,g=(o&3)<<4|u>>4;let E=(u&15)<<2|f>>6,N=f&63;h||(N=64,a||(E=64)),r.push(t[m],t[g],t[E],t[N])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(hc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):jd(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const f=s<n.length?t[n.charAt(s)]:64;++s;const g=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||f==null||g==null)throw new Pd;const E=o<<2|u>>4;if(r.push(E),f!==64){const N=u<<4&240|f>>2;if(r.push(N),g!==64){const j=f<<6&192|g;r.push(j)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Pd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Vd=function(n){const e=hc(n);return fc.encodeByteArray(e,!0)},Qs=function(n){return Vd(n).replace(/\./g,"")},Dd=function(n){try{return fc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Md(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld=()=>Md().__FIREBASE_DEFAULTS__,Od=()=>{if(typeof process>"u"||typeof $a>"u")return;const n=$a.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Fd=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Dd(n[1]);return e&&JSON.parse(e)},So=()=>{try{return Sd()||Ld()||Od()||Fd()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Bd=n=>{var e,t;return(t=(e=So())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},$d=n=>{const e=Bd(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},mc=()=>{var n;return(n=So())==null?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function qd(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Qs(JSON.stringify(t)),Qs(JSON.stringify(a)),""].join(".")}const Ur={};function Wd(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ur))Ur[e]?n.emulator.push(e):n.prod.push(e);return n}function Hd(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ua=!1;function Gd(n,e){if(typeof window>"u"||typeof document>"u"||!jo(window.location.host)||Ur[n]===e||Ur[n]||Ua)return;Ur[n]=e;function t(E){return`__firebase__banner__${E}`}const r="__firebase__banner",o=Wd().prod.length>0;function a(){const E=document.getElementById(r);E&&E.remove()}function u(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,N){E.setAttribute("width","24"),E.setAttribute("id",N),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function f(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Ua=!0,a()},E}function m(E,N){E.setAttribute("id",N),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function g(){const E=Hd(r),N=t("text"),j=document.getElementById(N)||document.createElement("span"),L=t("learnmore"),V=document.getElementById(L)||document.createElement("a"),O=t("preprendIcon"),$=document.getElementById(O)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const H=E.element;u(H),m(V,L);const J=f();h($,O),H.append($,j,V,J),document.body.appendChild(H)}o?(j.innerText="Preview backend disconnected.",$.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):($.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,j.innerText="Preview backend running in this workspace."),j.setAttribute("id",N)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Qd(){var e;const n=(e=So())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Yd(){return!Qd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Jd(){try{return typeof indexedDB=="object"}catch{return!1}}function Xd(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)==null?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zd="FirebaseError";class fr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Zd,Object.setPrototypeOf(this,fr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,pc.prototype.create)}}class pc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?eh(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new fr(s,u,r)}}function eh(n,e){return n.replace(th,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const th=/\{\$([^}]+)}/g;function Ys(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],a=e[s];if(qa(o)&&qa(a)){if(!Ys(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function qa(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pn(n){return n&&n._delegate?n._delegate:n}class Gr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Ud;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(sh(e))try{this.getOrInitializeService({instanceIdentifier:Sn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=Sn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Sn){return this.instances.has(e)}getOptions(e=Sn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:rh(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Sn){return this.component?this.component.multipleInstances?e:Sn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function rh(n){return n===Sn?void 0:n}function sh(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new nh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var be;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(be||(be={}));const oh={debug:be.DEBUG,verbose:be.VERBOSE,info:be.INFO,warn:be.WARN,error:be.ERROR,silent:be.SILENT},ah=be.INFO,lh={[be.DEBUG]:"log",[be.VERBOSE]:"log",[be.INFO]:"info",[be.WARN]:"warn",[be.ERROR]:"error"},ch=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=lh[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class gc{constructor(e){this.name=e,this._logLevel=ah,this._logHandler=ch,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in be))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?oh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,be.DEBUG,...e),this._logHandler(this,be.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,be.VERBOSE,...e),this._logHandler(this,be.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,be.INFO,...e),this._logHandler(this,be.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,be.WARN,...e),this._logHandler(this,be.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,be.ERROR,...e),this._logHandler(this,be.ERROR,...e)}}const uh=(n,e)=>e.some(t=>n instanceof t);let za,Wa;function dh(){return za||(za=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hh(){return Wa||(Wa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xc=new WeakMap,oo=new WeakMap,bc=new WeakMap,zi=new WeakMap,Po=new WeakMap;function fh(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(hn(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&xc.set(t,n)}).catch(()=>{}),Po.set(e,n),e}function mh(n){if(oo.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});oo.set(n,e)}let ao={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return oo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||bc.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return hn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ph(n){ao=n(ao)}function gh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Wi(this),e,...t);return bc.set(r,e.sort?e.sort():[e]),hn(r)}:hh().includes(n)?function(...e){return n.apply(Wi(this),e),hn(xc.get(this))}:function(...e){return hn(n.apply(Wi(this),e))}}function xh(n){return typeof n=="function"?gh(n):(n instanceof IDBTransaction&&mh(n),uh(n,dh())?new Proxy(n,ao):n)}function hn(n){if(n instanceof IDBRequest)return fh(n);if(zi.has(n))return zi.get(n);const e=xh(n);return e!==n&&(zi.set(n,e),Po.set(e,n)),e}const Wi=n=>Po.get(n);function bh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,e),u=hn(a);return r&&a.addEventListener("upgradeneeded",h=>{r(hn(a.result),h.oldVersion,h.newVersion,hn(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const yh=["get","getKey","getAll","getAllKeys","count"],_h=["put","add","delete","clear"],Hi=new Map;function Ha(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Hi.get(e))return Hi.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=_h.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||yh.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),s&&h.done]))[0]};return Hi.set(e,o),o}ph(n=>({...n,get:(e,t,r)=>Ha(e,t)||n.get(e,t,r),has:(e,t)=>!!Ha(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(vh(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function vh(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const lo="@firebase/app",Ga="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yt=new gc("@firebase/app"),kh="@firebase/app-compat",Eh="@firebase/analytics-compat",Th="@firebase/analytics",Ih="@firebase/app-check-compat",Ah="@firebase/app-check",Ch="@firebase/auth",Nh="@firebase/auth-compat",Rh="@firebase/database",Sh="@firebase/data-connect",jh="@firebase/database-compat",Ph="@firebase/functions",Vh="@firebase/functions-compat",Dh="@firebase/installations",Mh="@firebase/installations-compat",Lh="@firebase/messaging",Oh="@firebase/messaging-compat",Fh="@firebase/performance",Bh="@firebase/performance-compat",$h="@firebase/remote-config",Uh="@firebase/remote-config-compat",qh="@firebase/storage",zh="@firebase/storage-compat",Wh="@firebase/firestore",Hh="@firebase/ai",Gh="@firebase/firestore-compat",Kh="firebase",Qh="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const co="[DEFAULT]",Yh={[lo]:"fire-core",[kh]:"fire-core-compat",[Th]:"fire-analytics",[Eh]:"fire-analytics-compat",[Ah]:"fire-app-check",[Ih]:"fire-app-check-compat",[Ch]:"fire-auth",[Nh]:"fire-auth-compat",[Rh]:"fire-rtdb",[Sh]:"fire-data-connect",[jh]:"fire-rtdb-compat",[Ph]:"fire-fn",[Vh]:"fire-fn-compat",[Dh]:"fire-iid",[Mh]:"fire-iid-compat",[Lh]:"fire-fcm",[Oh]:"fire-fcm-compat",[Fh]:"fire-perf",[Bh]:"fire-perf-compat",[$h]:"fire-rc",[Uh]:"fire-rc-compat",[qh]:"fire-gcs",[zh]:"fire-gcs-compat",[Wh]:"fire-fst",[Gh]:"fire-fst-compat",[Hh]:"fire-vertex","fire-js":"fire-js",[Kh]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Js=new Map,Jh=new Map,uo=new Map;function Ka(n,e){try{n.container.addComponent(e)}catch(t){Yt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Xs(n){const e=n.name;if(uo.has(e))return Yt.debug(`There were multiple attempts to register component ${e}.`),!1;uo.set(e,n);for(const t of Js.values())Ka(t,n);for(const t of Jh.values())Ka(t,n);return!0}function Xh(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Zh(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ef={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fn=new pc("app","Firebase",ef);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tf{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Gr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nf=Qh;function yc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:co,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw fn.create("bad-app-name",{appName:String(s)});if(t||(t=mc()),!t)throw fn.create("no-options");const o=Js.get(s);if(o){if(Ys(t,o.options)&&Ys(r,o.config))return o;throw fn.create("duplicate-app",{appName:s})}const a=new ih(s);for(const h of uo.values())a.addComponent(h);const u=new tf(t,r,a);return Js.set(s,u),u}function rf(n=co){const e=Js.get(n);if(!e&&n===co&&mc())return yc();if(!e)throw fn.create("no-app",{appName:n});return e}function er(n,e,t){let r=Yh[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Yt.warn(a.join(" "));return}Xs(new Gr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf="firebase-heartbeat-database",of=1,Kr="firebase-heartbeat-store";let Gi=null;function _c(){return Gi||(Gi=bh(sf,of,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Kr)}catch(t){console.warn(t)}}}}).catch(n=>{throw fn.create("idb-open",{originalErrorMessage:n.message})})),Gi}async function af(n){try{const t=(await _c()).transaction(Kr),r=await t.objectStore(Kr).get(wc(n));return await t.done,r}catch(e){if(e instanceof fr)Yt.warn(e.message);else{const t=fn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Yt.warn(t.message)}}}async function Qa(n,e){try{const r=(await _c()).transaction(Kr,"readwrite");await r.objectStore(Kr).put(e,wc(n)),await r.done}catch(t){if(t instanceof fr)Yt.warn(t.message);else{const r=fn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Yt.warn(r.message)}}}function wc(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lf=1024,cf=30;class uf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new hf(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ya();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>cf){const a=ff(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Yt.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ya(),{heartbeatsToSend:r,unsentEntries:s}=df(this._heartbeatsCache.heartbeats),o=Qs(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Yt.warn(t),""}}}function Ya(){return new Date().toISOString().substring(0,10)}function df(n,e=lf){const t=[];let r=n.slice();for(const s of n){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Ja(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Ja(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class hf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Jd()?Xd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await af(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Qa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Qa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Ja(n){return Qs(JSON.stringify({version:2,heartbeats:n})).length}function ff(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mf(n){Xs(new Gr("platform-logger",e=>new wh(e),"PRIVATE")),Xs(new Gr("heartbeat",e=>new uf(e),"PRIVATE")),er(lo,Ga,n),er(lo,Ga,"esm2020"),er("fire-js","")}mf("");var Xa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var mn,vc;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,x){function b(){}b.prototype=x.prototype,v.F=x.prototype,v.prototype=new b,v.prototype.constructor=v,v.D=function(w,k,T){for(var y=Array(arguments.length-2),F=2;F<arguments.length;F++)y[F-2]=arguments[F];return x.prototype[k].apply(w,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,x,b){b||(b=0);const w=Array(16);if(typeof x=="string")for(var k=0;k<16;++k)w[k]=x.charCodeAt(b++)|x.charCodeAt(b++)<<8|x.charCodeAt(b++)<<16|x.charCodeAt(b++)<<24;else for(k=0;k<16;++k)w[k]=x[b++]|x[b++]<<8|x[b++]<<16|x[b++]<<24;x=v.g[0],b=v.g[1],k=v.g[2];let T=v.g[3],y;y=x+(T^b&(k^T))+w[0]+3614090360&4294967295,x=b+(y<<7&4294967295|y>>>25),y=T+(k^x&(b^k))+w[1]+3905402710&4294967295,T=x+(y<<12&4294967295|y>>>20),y=k+(b^T&(x^b))+w[2]+606105819&4294967295,k=T+(y<<17&4294967295|y>>>15),y=b+(x^k&(T^x))+w[3]+3250441966&4294967295,b=k+(y<<22&4294967295|y>>>10),y=x+(T^b&(k^T))+w[4]+4118548399&4294967295,x=b+(y<<7&4294967295|y>>>25),y=T+(k^x&(b^k))+w[5]+1200080426&4294967295,T=x+(y<<12&4294967295|y>>>20),y=k+(b^T&(x^b))+w[6]+2821735955&4294967295,k=T+(y<<17&4294967295|y>>>15),y=b+(x^k&(T^x))+w[7]+4249261313&4294967295,b=k+(y<<22&4294967295|y>>>10),y=x+(T^b&(k^T))+w[8]+1770035416&4294967295,x=b+(y<<7&4294967295|y>>>25),y=T+(k^x&(b^k))+w[9]+2336552879&4294967295,T=x+(y<<12&4294967295|y>>>20),y=k+(b^T&(x^b))+w[10]+4294925233&4294967295,k=T+(y<<17&4294967295|y>>>15),y=b+(x^k&(T^x))+w[11]+2304563134&4294967295,b=k+(y<<22&4294967295|y>>>10),y=x+(T^b&(k^T))+w[12]+1804603682&4294967295,x=b+(y<<7&4294967295|y>>>25),y=T+(k^x&(b^k))+w[13]+4254626195&4294967295,T=x+(y<<12&4294967295|y>>>20),y=k+(b^T&(x^b))+w[14]+2792965006&4294967295,k=T+(y<<17&4294967295|y>>>15),y=b+(x^k&(T^x))+w[15]+1236535329&4294967295,b=k+(y<<22&4294967295|y>>>10),y=x+(k^T&(b^k))+w[1]+4129170786&4294967295,x=b+(y<<5&4294967295|y>>>27),y=T+(b^k&(x^b))+w[6]+3225465664&4294967295,T=x+(y<<9&4294967295|y>>>23),y=k+(x^b&(T^x))+w[11]+643717713&4294967295,k=T+(y<<14&4294967295|y>>>18),y=b+(T^x&(k^T))+w[0]+3921069994&4294967295,b=k+(y<<20&4294967295|y>>>12),y=x+(k^T&(b^k))+w[5]+3593408605&4294967295,x=b+(y<<5&4294967295|y>>>27),y=T+(b^k&(x^b))+w[10]+38016083&4294967295,T=x+(y<<9&4294967295|y>>>23),y=k+(x^b&(T^x))+w[15]+3634488961&4294967295,k=T+(y<<14&4294967295|y>>>18),y=b+(T^x&(k^T))+w[4]+3889429448&4294967295,b=k+(y<<20&4294967295|y>>>12),y=x+(k^T&(b^k))+w[9]+568446438&4294967295,x=b+(y<<5&4294967295|y>>>27),y=T+(b^k&(x^b))+w[14]+3275163606&4294967295,T=x+(y<<9&4294967295|y>>>23),y=k+(x^b&(T^x))+w[3]+4107603335&4294967295,k=T+(y<<14&4294967295|y>>>18),y=b+(T^x&(k^T))+w[8]+1163531501&4294967295,b=k+(y<<20&4294967295|y>>>12),y=x+(k^T&(b^k))+w[13]+2850285829&4294967295,x=b+(y<<5&4294967295|y>>>27),y=T+(b^k&(x^b))+w[2]+4243563512&4294967295,T=x+(y<<9&4294967295|y>>>23),y=k+(x^b&(T^x))+w[7]+1735328473&4294967295,k=T+(y<<14&4294967295|y>>>18),y=b+(T^x&(k^T))+w[12]+2368359562&4294967295,b=k+(y<<20&4294967295|y>>>12),y=x+(b^k^T)+w[5]+4294588738&4294967295,x=b+(y<<4&4294967295|y>>>28),y=T+(x^b^k)+w[8]+2272392833&4294967295,T=x+(y<<11&4294967295|y>>>21),y=k+(T^x^b)+w[11]+1839030562&4294967295,k=T+(y<<16&4294967295|y>>>16),y=b+(k^T^x)+w[14]+4259657740&4294967295,b=k+(y<<23&4294967295|y>>>9),y=x+(b^k^T)+w[1]+2763975236&4294967295,x=b+(y<<4&4294967295|y>>>28),y=T+(x^b^k)+w[4]+1272893353&4294967295,T=x+(y<<11&4294967295|y>>>21),y=k+(T^x^b)+w[7]+4139469664&4294967295,k=T+(y<<16&4294967295|y>>>16),y=b+(k^T^x)+w[10]+3200236656&4294967295,b=k+(y<<23&4294967295|y>>>9),y=x+(b^k^T)+w[13]+681279174&4294967295,x=b+(y<<4&4294967295|y>>>28),y=T+(x^b^k)+w[0]+3936430074&4294967295,T=x+(y<<11&4294967295|y>>>21),y=k+(T^x^b)+w[3]+3572445317&4294967295,k=T+(y<<16&4294967295|y>>>16),y=b+(k^T^x)+w[6]+76029189&4294967295,b=k+(y<<23&4294967295|y>>>9),y=x+(b^k^T)+w[9]+3654602809&4294967295,x=b+(y<<4&4294967295|y>>>28),y=T+(x^b^k)+w[12]+3873151461&4294967295,T=x+(y<<11&4294967295|y>>>21),y=k+(T^x^b)+w[15]+530742520&4294967295,k=T+(y<<16&4294967295|y>>>16),y=b+(k^T^x)+w[2]+3299628645&4294967295,b=k+(y<<23&4294967295|y>>>9),y=x+(k^(b|~T))+w[0]+4096336452&4294967295,x=b+(y<<6&4294967295|y>>>26),y=T+(b^(x|~k))+w[7]+1126891415&4294967295,T=x+(y<<10&4294967295|y>>>22),y=k+(x^(T|~b))+w[14]+2878612391&4294967295,k=T+(y<<15&4294967295|y>>>17),y=b+(T^(k|~x))+w[5]+4237533241&4294967295,b=k+(y<<21&4294967295|y>>>11),y=x+(k^(b|~T))+w[12]+1700485571&4294967295,x=b+(y<<6&4294967295|y>>>26),y=T+(b^(x|~k))+w[3]+2399980690&4294967295,T=x+(y<<10&4294967295|y>>>22),y=k+(x^(T|~b))+w[10]+4293915773&4294967295,k=T+(y<<15&4294967295|y>>>17),y=b+(T^(k|~x))+w[1]+2240044497&4294967295,b=k+(y<<21&4294967295|y>>>11),y=x+(k^(b|~T))+w[8]+1873313359&4294967295,x=b+(y<<6&4294967295|y>>>26),y=T+(b^(x|~k))+w[15]+4264355552&4294967295,T=x+(y<<10&4294967295|y>>>22),y=k+(x^(T|~b))+w[6]+2734768916&4294967295,k=T+(y<<15&4294967295|y>>>17),y=b+(T^(k|~x))+w[13]+1309151649&4294967295,b=k+(y<<21&4294967295|y>>>11),y=x+(k^(b|~T))+w[4]+4149444226&4294967295,x=b+(y<<6&4294967295|y>>>26),y=T+(b^(x|~k))+w[11]+3174756917&4294967295,T=x+(y<<10&4294967295|y>>>22),y=k+(x^(T|~b))+w[2]+718787259&4294967295,k=T+(y<<15&4294967295|y>>>17),y=b+(T^(k|~x))+w[9]+3951481745&4294967295,v.g[0]=v.g[0]+x&4294967295,v.g[1]=v.g[1]+(k+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+k&4294967295,v.g[3]=v.g[3]+T&4294967295}r.prototype.v=function(v,x){x===void 0&&(x=v.length);const b=x-this.blockSize,w=this.C;let k=this.h,T=0;for(;T<x;){if(k==0)for(;T<=b;)s(this,v,T),T+=this.blockSize;if(typeof v=="string"){for(;T<x;)if(w[k++]=v.charCodeAt(T++),k==this.blockSize){s(this,w),k=0;break}}else for(;T<x;)if(w[k++]=v[T++],k==this.blockSize){s(this,w),k=0;break}}this.h=k,this.o+=x},r.prototype.A=function(){var v=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);v[0]=128;for(var x=1;x<v.length-8;++x)v[x]=0;x=this.o*8;for(var b=v.length-8;b<v.length;++b)v[b]=x&255,x/=256;for(this.v(v),v=Array(16),x=0,b=0;b<4;++b)for(let w=0;w<32;w+=8)v[x++]=this.g[b]>>>w&255;return v};function o(v,x){var b=u;return Object.prototype.hasOwnProperty.call(b,v)?b[v]:b[v]=x(v)}function a(v,x){this.h=x;const b=[];let w=!0;for(let k=v.length-1;k>=0;k--){const T=v[k]|0;w&&T==x||(b[k]=T,w=!1)}this.g=b}var u={};function h(v){return-128<=v&&v<128?o(v,function(x){return new a([x|0],x<0?-1:0)}):new a([v|0],v<0?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return g;if(v<0)return V(f(-v));const x=[];let b=1;for(let w=0;v>=b;w++)x[w]=v/b|0,b*=4294967296;return new a(x,0)}function m(v,x){if(v.length==0)throw Error("number format error: empty string");if(x=x||10,x<2||36<x)throw Error("radix out of range: "+x);if(v.charAt(0)=="-")return V(m(v.substring(1),x));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const b=f(Math.pow(x,8));let w=g;for(let T=0;T<v.length;T+=8){var k=Math.min(8,v.length-T);const y=parseInt(v.substring(T,T+k),x);k<8?(k=f(Math.pow(x,k)),w=w.j(k).add(f(y))):(w=w.j(b),w=w.add(f(y)))}return w}var g=h(0),E=h(1),N=h(16777216);n=a.prototype,n.m=function(){if(L(this))return-V(this).m();let v=0,x=1;for(let b=0;b<this.g.length;b++){const w=this.i(b);v+=(w>=0?w:4294967296+w)*x,x*=4294967296}return v},n.toString=function(v){if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(j(this))return"0";if(L(this))return"-"+V(this).toString(v);const x=f(Math.pow(v,6));var b=this;let w="";for(;;){const k=J(b,x).g;b=O(b,k.j(x));let T=((b.g.length>0?b.g[0]:b.h)>>>0).toString(v);if(b=k,j(b))return T+w;for(;T.length<6;)T="0"+T;w=T+w}},n.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h};function j(v){if(v.h!=0)return!1;for(let x=0;x<v.g.length;x++)if(v.g[x]!=0)return!1;return!0}function L(v){return v.h==-1}n.l=function(v){return v=O(this,v),L(v)?-1:j(v)?0:1};function V(v){const x=v.g.length,b=[];for(let w=0;w<x;w++)b[w]=~v.g[w];return new a(b,~v.h).add(E)}n.abs=function(){return L(this)?V(this):this},n.add=function(v){const x=Math.max(this.g.length,v.g.length),b=[];let w=0;for(let k=0;k<=x;k++){let T=w+(this.i(k)&65535)+(v.i(k)&65535),y=(T>>>16)+(this.i(k)>>>16)+(v.i(k)>>>16);w=y>>>16,T&=65535,y&=65535,b[k]=y<<16|T}return new a(b,b[b.length-1]&-2147483648?-1:0)};function O(v,x){return v.add(V(x))}n.j=function(v){if(j(this)||j(v))return g;if(L(this))return L(v)?V(this).j(V(v)):V(V(this).j(v));if(L(v))return V(this.j(V(v)));if(this.l(N)<0&&v.l(N)<0)return f(this.m()*v.m());const x=this.g.length+v.g.length,b=[];for(var w=0;w<2*x;w++)b[w]=0;for(w=0;w<this.g.length;w++)for(let k=0;k<v.g.length;k++){const T=this.i(w)>>>16,y=this.i(w)&65535,F=v.i(k)>>>16,ee=v.i(k)&65535;b[2*w+2*k]+=y*ee,$(b,2*w+2*k),b[2*w+2*k+1]+=T*ee,$(b,2*w+2*k+1),b[2*w+2*k+1]+=y*F,$(b,2*w+2*k+1),b[2*w+2*k+2]+=T*F,$(b,2*w+2*k+2)}for(v=0;v<x;v++)b[v]=b[2*v+1]<<16|b[2*v];for(v=x;v<2*x;v++)b[v]=0;return new a(b,0)};function $(v,x){for(;(v[x]&65535)!=v[x];)v[x+1]+=v[x]>>>16,v[x]&=65535,x++}function H(v,x){this.g=v,this.h=x}function J(v,x){if(j(x))throw Error("division by zero");if(j(v))return new H(g,g);if(L(v))return x=J(V(v),x),new H(V(x.g),V(x.h));if(L(x))return x=J(v,V(x)),new H(V(x.g),x.h);if(v.g.length>30){if(L(v)||L(x))throw Error("slowDivide_ only works with positive integers.");for(var b=E,w=x;w.l(v)<=0;)b=z(b),w=z(w);var k=ne(b,1),T=ne(w,1);for(w=ne(w,2),b=ne(b,2);!j(w);){var y=T.add(w);y.l(v)<=0&&(k=k.add(b),T=y),w=ne(w,1),b=ne(b,1)}return x=O(v,k.j(x)),new H(k,x)}for(k=g;v.l(x)>=0;){for(b=Math.max(1,Math.floor(v.m()/x.m())),w=Math.ceil(Math.log(b)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),T=f(b),y=T.j(x);L(y)||y.l(v)>0;)b-=w,T=f(b),y=T.j(x);j(T)&&(T=E),k=k.add(T),v=O(v,y)}return new H(k,v)}n.B=function(v){return J(this,v).h},n.and=function(v){const x=Math.max(this.g.length,v.g.length),b=[];for(let w=0;w<x;w++)b[w]=this.i(w)&v.i(w);return new a(b,this.h&v.h)},n.or=function(v){const x=Math.max(this.g.length,v.g.length),b=[];for(let w=0;w<x;w++)b[w]=this.i(w)|v.i(w);return new a(b,this.h|v.h)},n.xor=function(v){const x=Math.max(this.g.length,v.g.length),b=[];for(let w=0;w<x;w++)b[w]=this.i(w)^v.i(w);return new a(b,this.h^v.h)};function z(v){const x=v.g.length+1,b=[];for(let w=0;w<x;w++)b[w]=v.i(w)<<1|v.i(w-1)>>>31;return new a(b,v.h)}function ne(v,x){const b=x>>5;x%=32;const w=v.g.length-b,k=[];for(let T=0;T<w;T++)k[T]=x>0?v.i(T+b)>>>x|v.i(T+b+1)<<32-x:v.i(T+b);return new a(k,v.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,vc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,mn=a}).apply(typeof Xa<"u"?Xa:typeof self<"u"?self:typeof window<"u"?window:{});var Ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kc,Mr,Ec,Bs,ho,Tc,Ic,Ac;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ns=="object"&&Ns];for(var c=0;c<i.length;++c){var d=i[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var d=r;i=i.split(".");for(var p=0;p<i.length-1;p++){var R=i[p];if(!(R in d))break e;d=d[R]}i=i[i.length-1],p=d[i],c=c(p),c!=p&&c!=null&&e(d,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var d=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push([p,c[p]]);return d}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,d){return i.call.apply(i.bind,arguments)}function f(i,c,d){return f=h,f.apply(null,arguments)}function m(i,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),i.apply(this,p)}}function g(i,c){function d(){}d.prototype=c.prototype,i.Z=c.prototype,i.prototype=new d,i.prototype.constructor=i,i.Ob=function(p,R,S){for(var q=Array(arguments.length-2),he=2;he<arguments.length;he++)q[he-2]=arguments[he];return c.prototype[R].apply(p,q)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function N(i){const c=i.length;if(c>0){const d=Array(c);for(let p=0;p<c;p++)d[p]=i[p];return d}return[]}function j(i,c){for(let p=1;p<arguments.length;p++){const R=arguments[p];var d=typeof R;if(d=d!="object"?d:R?Array.isArray(R)?"array":d:"null",d=="array"||d=="object"&&typeof R.length=="number"){d=i.length||0;const S=R.length||0;i.length=d+S;for(let q=0;q<S;q++)i[d+q]=R[q]}else i.push(R)}}class L{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function V(i){a.setTimeout(()=>{throw i},0)}function O(){var i=v;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class ${constructor(){this.h=this.g=null}add(c,d){const p=H.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var H=new L(()=>new J,i=>i.reset());class J{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let z,ne=!1,v=new $,x=()=>{const i=Promise.resolve(void 0);z=()=>{i.then(b)}};function b(){for(var i;i=O();){try{i.h.call(i.g)}catch(d){V(d)}var c=H;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ne=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function k(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}k.prototype.h=function(){this.defaultPrevented=!0};var T=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const d=()=>{};a.addEventListener("test",d,c),a.removeEventListener("test",d,c)}catch{}return i}();function y(i){return/^[\s\xa0]*$/.test(i)}function F(i,c){k.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}g(F,k),F.prototype.init=function(i,c){const d=this.type=i.type,p=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(d=="mouseover"?c=i.fromElement:d=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&F.Z.h.call(this)},F.prototype.h=function(){F.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var ee="closure_listenable_"+(Math.random()*1e6|0),B=0;function te(i,c,d,p,R){this.listener=i,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=R,this.key=++B,this.da=this.fa=!1}function oe(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function de(i,c,d){for(const p in i)c.call(d,i[p],p,i)}function me(i,c){for(const d in i)c.call(void 0,i[d],d,i)}function fe(i){const c={};for(const d in i)c[d]=i[d];return c}const _e="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function st(i,c){let d,p;for(let R=1;R<arguments.length;R++){p=arguments[R];for(d in p)i[d]=p[d];for(let S=0;S<_e.length;S++)d=_e[S],Object.prototype.hasOwnProperty.call(p,d)&&(i[d]=p[d])}}function ye(i){this.src=i,this.g={},this.h=0}ye.prototype.add=function(i,c,d,p,R){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const q=et(i,c,p,R);return q>-1?(c=i[q],d||(c.fa=!1)):(c=new te(c,this.src,S,!!p,R),c.fa=d,i.push(c)),c};function ze(i,c){const d=c.type;if(d in i.g){var p=i.g[d],R=Array.prototype.indexOf.call(p,c,void 0),S;(S=R>=0)&&Array.prototype.splice.call(p,R,1),S&&(oe(c),i.g[d].length==0&&(delete i.g[d],i.h--))}}function et(i,c,d,p){for(let R=0;R<i.length;++R){const S=i[R];if(!S.da&&S.listener==c&&S.capture==!!d&&S.ha==p)return R}return-1}var it="closure_lm_"+(Math.random()*1e6|0),Ne={};function kt(i,c,d,p,R){if(Array.isArray(c)){for(let S=0;S<c.length;S++)kt(i,c[S],d,p,R);return null}return d=gt(d),i&&i[ee]?i.J(c,d,u(p)?!!p.capture:!1,R):Et(i,c,d,!1,p,R)}function Et(i,c,d,p,R,S){if(!c)throw Error("Invalid event type");const q=u(R)?!!R.capture:!!R;let he=ke(i);if(he||(i[it]=he=new ye(i)),d=he.add(c,d,p,q,S),d.proxy)return d;if(p=We(),d.proxy=p,p.src=i,p.listener=d,i.addEventListener)T||(R=q),R===void 0&&(R=!1),i.addEventListener(c.toString(),p,R);else if(i.attachEvent)i.attachEvent(bt(c.toString()),p);else if(i.addListener&&i.removeListener)i.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function We(){function i(d){return c.call(i.src,i.listener,d)}const c=Se;return i}function ct(i,c,d,p,R){if(Array.isArray(c))for(var S=0;S<c.length;S++)ct(i,c[S],d,p,R);else p=u(p)?!!p.capture:!!p,d=gt(d),i&&i[ee]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],d=et(c,d,p,R),d>-1&&(oe(c[d]),Array.prototype.splice.call(c,d,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=ke(i))&&(c=i.g[c.toString()],i=-1,c&&(i=et(c,d,p,R)),(d=i>-1?c[i]:null)&&X(d))}function X(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[ee])ze(c.i,i);else{var d=i.type,p=i.proxy;c.removeEventListener?c.removeEventListener(d,p,i.capture):c.detachEvent?c.detachEvent(bt(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=ke(c))?(ze(d,i),d.h==0&&(d.src=null,c[it]=null)):oe(i)}}}function bt(i){return i in Ne?Ne[i]:Ne[i]="on"+i}function Se(i,c){if(i.da)i=!0;else{c=new F(c,this);const d=i.listener,p=i.ha||i.src;i.fa&&X(i),i=d.call(p,c)}return i}function ke(i){return i=i[it],i instanceof ye?i:null}var pt="__closure_events_fn_"+(Math.random()*1e9>>>0);function gt(i){return typeof i=="function"?i:(i[pt]||(i[pt]=function(c){return i.handleEvent(c)}),i[pt])}function Me(){w.call(this),this.i=new ye(this),this.M=this,this.G=null}g(Me,w),Me.prototype[ee]=!0,Me.prototype.removeEventListener=function(i,c,d,p){ct(this,i,c,d,p)};function Pe(i,c){var d,p=i.G;if(p)for(d=[];p;p=p.G)d.push(p);if(i=i.M,p=c.type||c,typeof c=="string")c=new k(c,i);else if(c instanceof k)c.target=c.target||i;else{var R=c;c=new k(p,i),st(c,R)}R=!0;let S,q;if(d)for(q=d.length-1;q>=0;q--)S=c.g=d[q],R=Rt(S,p,!0,c)&&R;if(S=c.g=i,R=Rt(S,p,!0,c)&&R,R=Rt(S,p,!1,c)&&R,d)for(q=0;q<d.length;q++)S=c.g=d[q],R=Rt(S,p,!1,c)&&R}Me.prototype.N=function(){if(Me.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const d=i.g[c];for(let p=0;p<d.length;p++)oe(d[p]);delete i.g[c],i.h--}}this.G=null},Me.prototype.J=function(i,c,d,p){return this.i.add(String(i),c,!1,d,p)},Me.prototype.K=function(i,c,d,p){return this.i.add(String(i),c,!0,d,p)};function Rt(i,c,d,p){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let R=!0;for(let S=0;S<c.length;++S){const q=c[S];if(q&&!q.da&&q.capture==d){const he=q.listener,$e=q.ha||q.src;q.fa&&ze(i.i,q),R=he.call($e,p)!==!1&&R}}return R&&!p.defaultPrevented}function En(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Ht(i){i.g=En(()=>{i.g=null,i.i&&(i.i=!1,Ht(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class He extends w{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ht(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ut(i){w.call(this),this.h=i,this.g={}}g(ut,w);var Tt=[];function Gt(i){de(i.g,function(c,d){this.g.hasOwnProperty(d)&&X(c)},i),i.g={}}ut.prototype.N=function(){ut.Z.N.call(this),Gt(this)},ut.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Qe=a.JSON.stringify,yr=a.JSON.parse,Ee=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function St(){}function _r(){}var en={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function wr(){k.call(this,"d")}g(wr,k);function ot(){k.call(this,"c")}g(ot,k);var jt={},It=null;function zn(){return It=It||new Me}jt.Ia="serverreachability";function ie(i){k.call(this,jt.Ia,i)}g(ie,k);function dt(i){const c=zn();Pe(c,new ie(c))}jt.STAT_EVENT="statevent";function Tn(i,c){k.call(this,jt.STAT_EVENT,i),this.stat=c}g(Tn,k);function Ye(i){const c=zn();Pe(c,new Tn(c,i))}jt.Ja="timingevent";function ls(i,c){k.call(this,jt.Ja,i),this.size=c}g(ls,k);function In(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function tn(){this.g=!0}tn.prototype.ua=function(){this.g=!1};function Si(i,c,d,p,R,S){i.info(function(){if(i.g)if(S){var q="",he=S.split("&");for(let Ae=0;Ae<he.length;Ae++){var $e=he[Ae].split("=");if($e.length>1){const Ge=$e[0];$e=$e[1];const Ot=Ge.split("_");q=Ot.length>=2&&Ot[1]=="type"?q+(Ge+"="+$e+"&"):q+(Ge+"=redacted&")}}}else q=null;else q=S;return"XMLHTTP REQ ("+p+") [attempt "+R+"]: "+c+`
`+d+`
`+q})}function ji(i,c,d,p,R,S,q){i.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+R+"]: "+c+`
`+d+`
`+S+" "+q})}function nn(i,c,d,p){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+cs(i,d)+(p?" "+p:"")})}function Pi(i,c){i.info(function(){return"TIMEOUT: "+c})}tn.prototype.info=function(){};function cs(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var d=S[i];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var R=p[0];if(R!="noop"&&R!="stop"&&R!="close")for(let q=1;q<p.length;q++)p[q]=""}}}}return Qe(S)}catch{return c}}var Pt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},us={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ds;function Wn(){}g(Wn,St),Wn.prototype.g=function(){return new XMLHttpRequest},ds=new Wn;function An(i){return encodeURIComponent(String(i))}function Vi(i){var c=1;i=i.split(":");const d=[];for(;c>0&&i.length;)d.push(i.shift()),c--;return i.length&&d.push(i.join(":")),d}function Te(i,c,d,p){this.j=i,this.i=c,this.l=d,this.S=p||1,this.V=new ut(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new hs}function hs(){this.i=null,this.g="",this.h=!1}var fs={},vr={};function kr(i,c,d){i.M=1,i.A=M(yt(c)),i.u=d,i.R=!0,Kt(i,null)}function Kt(i,c){i.F=Date.now(),Hn(i),i.B=yt(i.A);var d=i.B,p=i.S;Array.isArray(p)||(p=[String(p)]),ht(d.i,"t",p),i.C=0,d=i.j.L,i.h=new hs,i.g=Da(i.j,d?c:null,!i.u),i.P>0&&(i.O=new He(f(i.Y,i,i.g),i.P)),c=i.V,d=i.g,p=i.ba;var R="readystatechange";Array.isArray(R)||(R&&(Tt[0]=R.toString()),R=Tt);for(let S=0;S<R.length;S++){const q=kt(d,R[S],p||c.handleEvent,!1,c.h||c);if(!q)break;c.g[q.key]=q}c=i.J?fe(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),dt(),Si(i.i,i.v,i.B,i.l,i.S,i.u)}Te.prototype.ba=function(i){i=i.target;const c=this.O;c&&an(i)==3?c.j():this.Y(i)},Te.prototype.Y=function(i){try{if(i==this.g)e:{const he=an(this.g),$e=this.g.ya(),Ae=this.g.ca();if(!(he<3)&&(he!=3||this.g&&(this.h.h||this.g.la()||Ea(this.g)))){this.K||he!=4||$e==7||($e==8||Ae<=0?dt(3):dt(2)),Er(this);var c=this.g.ca();this.X=c;var d=Di(this);if(this.o=c==200,ji(this.i,this.v,this.B,this.l,this.S,he,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,R=this.g;if((p=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(p)){var S=p;break t}}S=null}if(i=S)nn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Tr(this,i);else{this.o=!1,this.m=3,Ye(12),Qt(this),rn(this);break e}}if(this.R){i=!0;let Ge;for(;!this.K&&this.C<d.length;)if(Ge=Mi(this,d),Ge==vr){he==4&&(this.m=4,Ye(14),i=!1),nn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ge==fs){this.m=4,Ye(15),nn(this.i,this.l,d,"[Invalid Chunk]"),i=!1;break}else nn(this.i,this.l,Ge,null),Tr(this,Ge);if(ms(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),he!=4||d.length!=0||this.h.h||(this.m=1,Ye(16),i=!1),this.o=this.o&&i,!i)nn(this.i,this.l,d,"[Invalid Chunked Response]"),Qt(this),rn(this);else if(d.length>0&&!this.W){this.W=!0;var q=this.j;q.g==this&&q.aa&&!q.P&&(q.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Ui(q),q.P=!0,Ye(11))}}else nn(this.i,this.l,d,null),Tr(this,d);he==4&&Qt(this),this.o&&!this.K&&(he==4?Sa(this.j,this):(this.o=!1,Hn(this)))}else md(this.g),c==400&&d.indexOf("Unknown SID")>0?(this.m=3,Ye(12)):(this.m=0,Ye(13)),Qt(this),rn(this)}}}catch{}finally{}};function Di(i){if(!ms(i))return i.g.la();const c=Ea(i.g);if(c==="")return"";let d="";const p=c.length,R=an(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Qt(i),rn(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<p;S++)i.h.h=!0,d+=i.h.i.decode(c[S],{stream:!(R&&S==p-1)});return c.length=0,i.h.g+=d,i.C=0,i.h.g}function ms(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Mi(i,c){var d=i.C,p=c.indexOf(`
`,d);return p==-1?vr:(d=Number(c.substring(d,p)),isNaN(d)?fs:(p+=1,p+d>c.length?vr:(c=c.slice(p,p+d),i.C=p+d,c)))}Te.prototype.cancel=function(){this.K=!0,Qt(this)};function Hn(i){i.T=Date.now()+i.H,ps(i,i.H)}function ps(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=In(f(i.aa,i),c)}function Er(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Te.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Pi(this.i,this.B),this.M!=2&&(dt(),Ye(17)),Qt(this),this.m=2,rn(this)):ps(this,this.T-i)};function rn(i){i.j.I==0||i.K||Sa(i.j,i)}function Qt(i){Er(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Gt(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Tr(i,c){try{var d=i.j;if(d.I!=0&&(d.g==i||Ir(d.h,i))){if(!i.L&&Ir(d.h,i)&&d.I==3){try{var p=d.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var R=p;if(R[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<i.F)Is(d),Es(d);else break e;$i(d),Ye(18)}}else d.xa=R[1],0<d.xa-d.K&&R[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=In(f(d.Va,d),6e3));xs(d.h)<=1&&d.ta&&(d.ta=void 0)}else Nn(d,11)}else if((i.L||d.g==i)&&Is(d),!y(c))for(R=d.Ba.g.parse(c),c=0;c<R.length;c++){let Ae=R[c];const Ge=Ae[0];if(!(Ge<=d.K))if(d.K=Ge,Ae=Ae[1],d.I==2)if(Ae[0]=="c"){d.M=Ae[1],d.ba=Ae[2];const Ot=Ae[3];Ot!=null&&(d.ka=Ot,d.j.info("VER="+d.ka));const Rn=Ae[4];Rn!=null&&(d.za=Rn,d.j.info("SVER="+d.za));const ln=Ae[5];ln!=null&&typeof ln=="number"&&ln>0&&(p=1.5*ln,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const cn=i.g;if(cn){const Cs=cn.g?cn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Cs){var S=p.h;S.g||Cs.indexOf("spdy")==-1&&Cs.indexOf("quic")==-1&&Cs.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Ar(S,S.h),S.h=null))}if(p.G){const qi=cn.g?cn.g.getResponseHeader("X-HTTP-Session-Id"):null;qi&&(p.wa=qi,C(p.J,p.G,qi))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-i.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var q=i;if(p.na=Va(p,p.L?p.ba:null,p.W),q.L){bs(p.h,q);var he=q,$e=p.O;$e&&(he.H=$e),he.D&&(Er(he),Hn(he)),p.g=q}else Na(p);d.i.length>0&&Ts(d)}else Ae[0]!="stop"&&Ae[0]!="close"||Nn(d,7);else d.I==3&&(Ae[0]=="stop"||Ae[0]=="close"?Ae[0]=="stop"?Nn(d,7):Bi(d):Ae[0]!="noop"&&d.l&&d.l.qa(Ae),d.A=0)}}dt(4)}catch{}}var gs=class{constructor(i,c){this.g=i,this.map=c}};function sn(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function at(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function xs(i){return i.h?1:i.g?i.g.size:0}function Ir(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Ar(i,c){i.g?i.g.add(c):i.h=c}function bs(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}sn.prototype.cancel=function(){if(this.i=ys(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function ys(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const d of i.g.values())c=c.concat(d.G);return c}return N(i.i)}var _s=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Li(i,c){if(i){i=i.split("&");for(let d=0;d<i.length;d++){const p=i[d].indexOf("=");let R,S=null;p>=0?(R=i[d].substring(0,p),S=i[d].substring(p+1)):R=i[d],c(R,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Vt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Vt?(this.l=i.l,Cn(this,i.j),this.o=i.o,this.g=i.g,_(this,i.u),this.h=i.h,A(this,on(i.i)),this.m=i.m):i&&(c=String(i).match(_s))?(this.l=!1,Cn(this,c[1]||"",!0),this.o=U(c[2]||""),this.g=U(c[3]||"",!0),_(this,c[4]),this.h=U(c[5]||"",!0),A(this,c[6]||"",!0),this.m=U(c[7]||"")):(this.l=!1,this.i=new Ie(null,this.l))}Vt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(Y(c,se,!0),":");var d=this.g;return(d||c=="file")&&(i.push("//"),(c=this.o)&&i.push(Y(c,se,!0),"@"),i.push(An(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&i.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&i.push("/"),i.push(Y(d,d.charAt(0)=="/"?K:le,!0))),(d=this.i.toString())&&i.push("?",d),(d=this.m)&&i.push("#",Y(d,Be)),i.join("")},Vt.prototype.resolve=function(i){const c=yt(this);let d=!!i.j;d?Cn(c,i.j):d=!!i.o,d?c.o=i.o:d=!!i.g,d?c.g=i.g:d=i.u!=null;var p=i.h;if(d)_(c,i.u);else if(d=!!i.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var R=c.h.lastIndexOf("/");R!=-1&&(p=c.h.slice(0,R+1)+p)}if(R=p,R==".."||R==".")p="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){p=R.lastIndexOf("/",0)==0,R=R.split("/");const S=[];for(let q=0;q<R.length;){const he=R[q++];he=="."?p&&q==R.length&&S.push(""):he==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),p&&q==R.length&&S.push("")):(S.push(he),p=!0)}p=S.join("/")}else p=R}return d?c.h=p:d=i.i.toString()!=="",d?A(c,on(i.i)):d=!!i.m,d&&(c.m=i.m),c};function yt(i){return new Vt(i)}function Cn(i,c,d){i.j=d?U(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function _(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function A(i,c,d){c instanceof Ie?(i.i=c,Cr(i.i,i.l)):(d||(c=Y(c,we)),i.i=new Ie(c,i.l))}function C(i,c,d){i.i.set(c,d)}function M(i){return C(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function U(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Y(i,c,d){return typeof i=="string"?(i=encodeURI(i).replace(c,Q),d&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Q(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var se=/[#\/\?@]/g,le=/[#\?:]/g,K=/[#\?]/g,we=/[#\?@]/g,Be=/#/g;function Ie(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function lt(i){i.g||(i.g=new Map,i.h=0,i.i&&Li(i.i,function(c,d){i.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}n=Ie.prototype,n.add=function(i,c){lt(this),this.i=null,i=ft(this,i);let d=this.g.get(i);return d||this.g.set(i,d=[]),d.push(c),this.h+=1,this};function _t(i,c){lt(i),c=ft(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Dt(i,c){return lt(i),c=ft(i,c),i.g.has(c)}n.forEach=function(i,c){lt(this),this.g.forEach(function(d,p){d.forEach(function(R){i.call(c,R,p,this)},this)},this)};function Mt(i,c){lt(i);let d=[];if(typeof c=="string")Dt(i,c)&&(d=d.concat(i.g.get(ft(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)d=d.concat(i[c]);return d}n.set=function(i,c){return lt(this),this.i=null,i=ft(this,i),Dt(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Mt(this,i),i.length>0?String(i[0]):c):c};function ht(i,c,d){_t(i,c),d.length>0&&(i.i=null,i.g.set(ft(i,c),N(d)),i.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var d=c[p];const R=An(d);d=Mt(this,d);for(let S=0;S<d.length;S++){let q=R;d[S]!==""&&(q+="="+An(d[S])),i.push(q)}}return this.i=i.join("&")};function on(i){const c=new Ie;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function ft(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function Cr(i,c){c&&!i.j&&(lt(i),i.i=null,i.g.forEach(function(d,p){const R=p.toLowerCase();p!=R&&(_t(this,p),ht(this,R,d))},i)),i.j=c}function Gn(i,c){const d=new tn;if(a.Image){const p=new Image;p.onload=m(Lt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=m(Lt,d,"TestLoadImage: error",!1,c,p),p.onabort=m(Lt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=m(Lt,d,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=i}else c(!1)}function Oi(i,c){const d=new tn,p=new AbortController,R=setTimeout(()=>{p.abort(),Lt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:p.signal}).then(S=>{clearTimeout(R),S.ok?Lt(d,"TestPingServer: ok",!0,c):Lt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(R),Lt(d,"TestPingServer: error",!1,c)})}function Lt(i,c,d,p,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),p(d)}catch{}}function ws(){this.g=new Ee}function Kn(i){this.i=i.Sb||null,this.h=i.ab||!1}g(Kn,St),Kn.prototype.g=function(){return new vs(this.i,this.h)};function vs(i,c){Me.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(vs,Me),n=vs.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Rr(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Nr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Rr(this)),this.g&&(this.readyState=3,Rr(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ya(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function ya(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Nr(this):Rr(this),this.readyState==3&&ya(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Nr(this))},n.Na=function(i){this.g&&(this.response=i,Nr(this))},n.ga=function(){this.g&&Nr(this)};function Nr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Rr(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,i.push(d[0]+": "+d[1]),d=c.next();return i.join(`\r
`)};function Rr(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(vs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function _a(i){let c="";return de(i,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function Fi(i,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=_a(d),typeof i=="string"?d!=null&&An(d):C(i,c,d))}function Ve(i){Me.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Ve,Me);var hd=/^https?$/i,fd=["POST","PUT"];n=Ve.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ds.g(),this.g.onreadystatechange=E(f(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){wa(this,S);return}if(i=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var R in p)d.set(R,p[R]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const S of p.keys())d.set(S,p.get(S));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),R=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(fd,c,void 0)>=0)||p||R||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,q]of d)this.g.setRequestHeader(S,q);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){wa(this,S)}};function wa(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,va(i),ks(i)}function va(i){i.A||(i.A=!0,Pe(i,"complete"),Pe(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Pe(this,"complete"),Pe(this,"abort"),ks(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ks(this,!0)),Ve.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ka(this):this.Xa())},n.Xa=function(){ka(this)};function ka(i){if(i.h&&typeof o<"u"){if(i.v&&an(i)==4)setTimeout(i.Ca.bind(i),0);else if(Pe(i,"readystatechange"),an(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=S===0){let q=String(i.D).match(_s)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),p=!hd.test(q?q.toLowerCase():"")}d=p}if(d)Pe(i,"complete"),Pe(i,"success");else{i.o=6;try{var R=an(i)>2?i.g.statusText:""}catch{R=""}i.l=R+" ["+i.ca()+"]",va(i)}}finally{ks(i)}}}}function ks(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const d=i.g;i.g=null,c||Pe(i,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function an(i){return i.g?i.g.readyState:0}n.ca=function(){try{return an(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),yr(c)}};function Ea(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function md(i){const c={};i=(i.g&&an(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<i.length;p++){if(y(i[p]))continue;var d=Vi(i[p]);const R=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const S=c[R]||[];c[R]=S,S.push(d)}me(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sr(i,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[i]||c}function Ta(i){this.za=0,this.i=[],this.j=new tn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Sr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Sr("baseRetryDelayMs",5e3,i),this.Za=Sr("retryDelaySeedMs",1e4,i),this.Ta=Sr("forwardChannelMaxRetries",2,i),this.va=Sr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new sn(i&&i.concurrentRequestLimit),this.Ba=new ws,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ta.prototype,n.ka=8,n.I=1,n.connect=function(i,c,d,p){Ye(0),this.W=i,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=Va(this,null,this.W),Ts(this)};function Bi(i){if(Ia(i),i.I==3){var c=i.V++,d=yt(i.J);if(C(d,"SID",i.M),C(d,"RID",c),C(d,"TYPE","terminate"),jr(i,d),c=new Te(i,i.j,c),c.M=2,c.A=M(yt(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=c.A,d=!0),d||(c.g=Da(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Hn(c)}Pa(i)}function Es(i){i.g&&(Ui(i),i.g.cancel(),i.g=null)}function Ia(i){Es(i),i.v&&(a.clearTimeout(i.v),i.v=null),Is(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Ts(i){if(!at(i.h)&&!i.m){i.m=!0;var c=i.Ea;z||x(),ne||(z(),ne=!0),v.add(c,i),i.D=0}}function pd(i,c){return xs(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=In(f(i.Ea,i,c),ja(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const R=new Te(this,this.j,i);let S=this.o;if(this.U&&(S?(S=fe(S),st(S,this.U)):S=this.U),this.u!==null||this.R||(R.J=S,S=null),this.S)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=Ca(this,R,c),d=yt(this.J),C(d,"RID",i),C(d,"CVER",22),this.G&&C(d,"X-HTTP-Session-Id",this.G),jr(this,d),S&&(this.R?c="headers="+An(_a(S))+"&"+c:this.u&&Fi(d,this.u,S)),Ar(this.h,R),this.Ra&&C(d,"TYPE","init"),this.S?(C(d,"$req",c),C(d,"SID","null"),R.U=!0,kr(R,d,null)):kr(R,d,c),this.I=2}}else this.I==3&&(i?Aa(this,i):this.i.length==0||at(this.h)||Aa(this))};function Aa(i,c){var d;c?d=c.l:d=i.V++;const p=yt(i.J);C(p,"SID",i.M),C(p,"RID",d),C(p,"AID",i.K),jr(i,p),i.u&&i.o&&Fi(p,i.u,i.o),d=new Te(i,i.j,d,i.D+1),i.u===null&&(d.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Ca(i,d,1e3),d.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Ar(i.h,d),kr(d,p,c)}function jr(i,c){i.H&&de(i.H,function(d,p){C(c,p,d)}),i.l&&de({},function(d,p){C(c,p,d)})}function Ca(i,c,d){d=Math.min(i.i.length,d);const p=i.l?f(i.l.Ka,i.l,i):null;e:{var R=i.i;let he=-1;for(;;){const $e=["count="+d];he==-1?d>0?(he=R[0].g,$e.push("ofs="+he)):he=0:$e.push("ofs="+he);let Ae=!0;for(let Ge=0;Ge<d;Ge++){var S=R[Ge].g;const Ot=R[Ge].map;if(S-=he,S<0)he=Math.max(0,R[Ge].g-100),Ae=!1;else try{S="req"+S+"_"||"";try{var q=Ot instanceof Map?Ot:Object.entries(Ot);for(const[Rn,ln]of q){let cn=ln;u(ln)&&(cn=Qe(ln)),$e.push(S+Rn+"="+encodeURIComponent(cn))}}catch(Rn){throw $e.push(S+"type="+encodeURIComponent("_badmap")),Rn}}catch{p&&p(Ot)}}if(Ae){q=$e.join("&");break e}}q=void 0}return i=i.i.splice(0,d),c.G=i,q}function Na(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;z||x(),ne||(z(),ne=!0),v.add(c,i),i.A=0}}function $i(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=In(f(i.Da,i),ja(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Ra(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=In(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ye(10),Es(this),Ra(this))};function Ui(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Ra(i){i.g=new Te(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=yt(i.na);C(c,"RID","rpc"),C(c,"SID",i.M),C(c,"AID",i.K),C(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&C(c,"TO",i.ia),C(c,"TYPE","xmlhttp"),jr(i,c),i.u&&i.o&&Fi(c,i.u,i.o),i.O&&(i.g.H=i.O);var d=i.g;i=i.ba,d.M=1,d.A=M(yt(c)),d.u=null,d.R=!0,Kt(d,i)}n.Va=function(){this.C!=null&&(this.C=null,Es(this),$i(this),Ye(19))};function Is(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Sa(i,c){var d=null;if(i.g==c){Is(i),Ui(i),i.g=null;var p=2}else if(Ir(i.h,c))d=c.G,bs(i.h,c),p=1;else return;if(i.I!=0){if(c.o)if(p==1){d=c.u?c.u.length:0,c=Date.now()-c.F;var R=i.D;p=zn(),Pe(p,new ls(p,d)),Ts(i)}else Na(i);else if(R=c.m,R==3||R==0&&c.X>0||!(p==1&&pd(i,c)||p==2&&$i(i)))switch(d&&d.length>0&&(c=i.h,c.i=c.i.concat(d)),R){case 1:Nn(i,5);break;case 4:Nn(i,10);break;case 3:Nn(i,6);break;default:Nn(i,2)}}}function ja(i,c){let d=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(d*=2),d*c}function Nn(i,c){if(i.j.info("Error code "+c),c==2){var d=f(i.bb,i),p=i.Ua;const R=!p;p=new Vt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Cn(p,"https"),M(p),R?Gn(p.toString(),d):Oi(p.toString(),d)}else Ye(2);i.I=0,i.l&&i.l.pa(c),Pa(i),Ia(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),Ye(2)):(this.j.info("Failed to ping google.com"),Ye(1))};function Pa(i){if(i.I=0,i.ja=[],i.l){const c=ys(i.h);(c.length!=0||i.i.length!=0)&&(j(i.ja,c),j(i.ja,i.i),i.h.i.length=0,N(i.i),i.i.length=0),i.l.oa()}}function Va(i,c,d){var p=d instanceof Vt?yt(d):new Vt(d);if(p.g!="")c&&(p.g=c+"."+p.g),_(p,p.u);else{var R=a.location;p=R.protocol,c=c?c+"."+R.hostname:R.hostname,R=+R.port;const S=new Vt(null);p&&Cn(S,p),c&&(S.g=c),R&&_(S,R),d&&(S.h=d),p=S}return d=i.G,c=i.wa,d&&c&&C(p,d,c),C(p,"VER",i.ka),jr(i,p),p}function Da(i,c,d){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Ve(new Kn({ab:d})):new Ve(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ma(){}n=Ma.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function As(){}As.prototype.g=function(i,c){return new xt(i,c)};function xt(i,c){Me.call(this),this.g=new Ta(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!y(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!y(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Qn(this)}g(xt,Me),xt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xt.prototype.close=function(){Bi(this.g)},xt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var d={};d.__data__=i,i=d}else this.v&&(d={},d.__data__=Qe(i),i=d);c.i.push(new gs(c.Ya++,i)),c.I==3&&Ts(c)},xt.prototype.N=function(){this.g.l=null,delete this.j,Bi(this.g),delete this.g,xt.Z.N.call(this)};function La(i){wr.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const d in c){i=d;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}g(La,wr);function Oa(){ot.call(this),this.status=1}g(Oa,ot);function Qn(i){this.g=i}g(Qn,Ma),Qn.prototype.ra=function(){Pe(this.g,"a")},Qn.prototype.qa=function(i){Pe(this.g,new La(i))},Qn.prototype.pa=function(i){Pe(this.g,new Oa)},Qn.prototype.oa=function(){Pe(this.g,"b")},As.prototype.createWebChannel=As.prototype.g,xt.prototype.send=xt.prototype.o,xt.prototype.open=xt.prototype.m,xt.prototype.close=xt.prototype.close,Ac=function(){return new As},Ic=function(){return zn()},Tc=jt,ho={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Pt.NO_ERROR=0,Pt.TIMEOUT=8,Pt.HTTP_ERROR=6,Bs=Pt,us.COMPLETE="complete",Ec=us,_r.EventType=en,en.OPEN="a",en.CLOSE="b",en.ERROR="c",en.MESSAGE="d",Me.prototype.listen=Me.prototype.J,Mr=_r,Ve.prototype.listenOnce=Ve.prototype.K,Ve.prototype.getLastError=Ve.prototype.Ha,Ve.prototype.getLastErrorCode=Ve.prototype.ya,Ve.prototype.getStatus=Ve.prototype.ca,Ve.prototype.getResponseJson=Ve.prototype.La,Ve.prototype.getResponseText=Ve.prototype.la,Ve.prototype.send=Ve.prototype.ea,Ve.prototype.setWithCredentials=Ve.prototype.Fa,kc=Ve}).apply(typeof Ns<"u"?Ns:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nt.UNAUTHENTICATED=new nt(null),nt.GOOGLE_CREDENTIALS=new nt("google-credentials-uid"),nt.FIRST_PARTY=new nt("first-party-uid"),nt.MOCK_USER=new nt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mr="12.9.0";function pf(n){mr=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vn=new gc("@firebase/firestore");function Yn(){return Vn.logLevel}function Z(n,...e){if(Vn.logLevel<=be.DEBUG){const t=e.map(Vo);Vn.debug(`Firestore (${mr}): ${n}`,...t)}}function Jt(n,...e){if(Vn.logLevel<=be.ERROR){const t=e.map(Vo);Vn.error(`Firestore (${mr}): ${n}`,...t)}}function Dn(n,...e){if(Vn.logLevel<=be.WARN){const t=e.map(Vo);Vn.warn(`Firestore (${mr}): ${n}`,...t)}}function Vo(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ae(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Cc(n,r,t)}function Cc(n,e,t){let r=`FIRESTORE (${mr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw Jt(r),new Error(r)}function ve(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Cc(e,s,r)}function ue(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends fr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class gf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nt.UNAUTHENTICATED))}shutdown(){}}class xf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class bf{constructor(e){this.t=e,this.currentUser=nt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ve(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new pn;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new pn,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const h=o;e.enqueueRetryable(async()=>{await h.promise,await s(this.currentUser)})},u=h=>{Z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(Z("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new pn)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ve(typeof r.accessToken=="string",31837,{l:r}),new Nc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ve(e===null||typeof e=="string",2055,{h:e}),new nt(e)}}class yf{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=nt.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class _f{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new yf(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(nt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Za{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class wf{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Zh(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ve(this.o===void 0,3512);const r=o=>{o.error!=null&&Z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,Z("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const s=o=>{Z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):Z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Za(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ve(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Za(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vf(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=vf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function pe(n,e){return n<e?-1:n>e?1:0}function fo(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Ki(s)===Ki(o)?pe(s,o):Ki(s)?1:-1}return pe(n.length,e.length)}const kf=55296,Ef=57343;function Ki(n){const e=n.charCodeAt(0);return e>=kf&&e<=Ef}function or(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el="__name__";class Bt{constructor(e,t,r){t===void 0?t=0:t>e.length&&ae(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ae(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Bt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Bt?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=Bt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return pe(e.length,t.length)}static compareSegments(e,t){const r=Bt.isNumericId(e),s=Bt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Bt.extractNumericId(e).compare(Bt.extractNumericId(t)):fo(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mn.fromString(e.substring(4,e.length-2))}}class Ce extends Bt{construct(e,t,r){return new Ce(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new W(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ce(t)}static emptyPath(){return new Ce([])}}const Tf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Xe extends Bt{construct(e,t,r){return new Xe(e,t,r)}static isValidIdentifier(e){return Tf.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Xe.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===el}static keyField(){return new Xe([el])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new W(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new W(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new W(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new W(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Xe(t)}static emptyPath(){return new Xe([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.path=e}static fromPath(e){return new re(Ce.fromString(e))}static fromName(e){return new re(Ce.fromString(e).popFirst(5))}static empty(){return new re(Ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new Ce(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(n,e,t){if(!t)throw new W(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function If(n,e,t,r){if(e===!0&&r===!0)throw new W(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function tl(n){if(!re.isDocumentKey(n))throw new W(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function nl(n){if(re.isDocumentKey(n))throw new W(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Sc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function fi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ae(12329,{type:typeof n})}function ar(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new W(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=fi(n);throw new W(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Af(n,e){if(e<=0)throw new W(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fe(n,e){const t={typeString:n};return e&&(t.value=e),t}function rs(n,e){if(!Sc(n))throw new W(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new W(P.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl=-62135596800,sl=1e6;class Re{static now(){return Re.fromMillis(Date.now())}static fromDate(e){return Re.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*sl);return new Re(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new W(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new W(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<rl)throw new W(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new W(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/sl}_compareTo(e){return this.seconds===e.seconds?pe(this.nanoseconds,e.nanoseconds):pe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Re._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(rs(e,Re._jsonSchema))return new Re(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-rl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Re._jsonSchemaVersion="firestore/timestamp/1.0",Re._jsonSchema={type:Fe("string",Re._jsonSchemaVersion),seconds:Fe("number"),nanoseconds:Fe("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{static fromTimestamp(e){return new ce(e)}static min(){return new ce(new Re(0,0))}static max(){return new ce(new Re(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qr=-1;function Cf(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ce.fromTimestamp(r===1e9?new Re(t+1,0):new Re(t,r));return new bn(s,re.empty(),e)}function Nf(n){return new bn(n.readTime,n.key,Qr)}class bn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new bn(ce.min(),re.empty(),Qr)}static max(){return new bn(ce.max(),re.empty(),Qr)}}function Rf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=re.comparator(n.documentKey,e.documentKey),t!==0?t:pe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pr(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==Sf)throw n;Z("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ae(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):D.reject(t)}static resolve(e){return new D((t,r)=>{t(e)})}static reject(e){return new D((t,r)=>{r(e)})}static waitFor(e){return new D((t,r)=>{let s=0,o=0,a=!1;e.forEach(u=>{++s,u.next(()=>{++o,a&&o===s&&t()},h=>r(h))}),a=!0,o===s&&t()})}static or(e){let t=D.resolve(!1);for(const r of e)t=t.next(s=>s?D.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,o)=>{r.push(t.call(this,s,o))}),this.waitFor(r)}static mapArray(e,t){return new D((r,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;t(e[f]).next(m=>{a[f]=m,++u,u===o&&r(a)},m=>s(m))}})}static doWhile(e,t){return new D((r,s)=>{const o=()=>{e()===!0?t().next(()=>{o()},s):r()};o()})}}function Pf(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function gr(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}mi.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo=-1;function pi(n){return n==null}function Zs(n){return n===0&&1/n==-1/0}function Vf(n){return typeof n=="number"&&Number.isInteger(n)&&!Zs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc="";function Df(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=il(e)),e=Mf(n.get(t),e);return il(e)}function Mf(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case jc:t+="";break;default:t+=o}}return t}function il(n){return n+jc+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function On(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Pc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{constructor(e,t){this.comparator=e,this.root=t||Je.EMPTY}insert(e,t){return new je(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Je.BLACK,null,null))}remove(e){return new je(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Je.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Rs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Rs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Rs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Rs(this.root,e,this.comparator,!0)}}class Rs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Je{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Je.RED,this.left=s??Je.EMPTY,this.right=o??Je.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Je(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Je.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Je.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Je.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Je.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ae(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ae(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ae(27949);return e+(this.isRed()?0:1)}}Je.EMPTY=null,Je.RED=!0,Je.BLACK=!1;Je.EMPTY=new class{constructor(){this.size=0}get key(){throw ae(57766)}get value(){throw ae(16141)}get color(){throw ae(16727)}get left(){throw ae(29726)}get right(){throw ae(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Je(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e){this.comparator=e,this.data=new je(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new al(this.data.getIterator())}getIteratorFrom(e){return new al(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof qe)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new qe(this.comparator);return t.data=e,t}}class al{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.fields=e,e.sort(Xe.comparator)}static empty(){return new At([])}unionWith(e){let t=new qe(Xe.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new At(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return or(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Vc("Invalid base64 string: "+o):o}}(e);return new Ze(t)}static fromUint8Array(e){const t=function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o}(e);return new Ze(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ze.EMPTY_BYTE_STRING=new Ze("");const Lf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yn(n){if(ve(!!n,39018),typeof n=="string"){let e=0;const t=Lf.exec(n);if(ve(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:De(n.seconds),nanos:De(n.nanos)}}function De(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Ze.fromBase64String(n):Ze.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc="server_timestamp",Mc="__type__",Lc="__previous_value__",Oc="__local_write_time__";function gi(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Mc])==null?void 0:r.stringValue)===Dc}function xi(n){const e=n.mapValue.fields[Lc];return gi(e)?xi(e):e}function Yr(n){const e=yn(n.mapValue.fields[Oc].timestampValue);return new Re(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(e,t,r,s,o,a,u,h,f,m,g){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=m,this.apiKey=g}}const ei="(default)";class Jr{constructor(e,t){this.projectId=e,this.database=t||ei}static empty(){return new Jr("","")}get isDefaultDatabase(){return this.database===ei}isEqual(e){return e instanceof Jr&&e.projectId===this.projectId&&e.database===this.database}}function Ff(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new W(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jr(n.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fc="__type__",Bf="__max__",Ss={mapValue:{}},Bc="__vector__",ti="value";function wn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?gi(n)?4:Uf(n)?9007199254740991:$f(n)?10:11:ae(28295,{value:n})}function Wt(n,e){if(n===e)return!0;const t=wn(n);if(t!==wn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Yr(n).isEqual(Yr(e));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=yn(s.timestampValue),u=yn(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,o){return _n(s.bytesValue).isEqual(_n(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,o){return De(s.geoPointValue.latitude)===De(o.geoPointValue.latitude)&&De(s.geoPointValue.longitude)===De(o.geoPointValue.longitude)}(n,e);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return De(s.integerValue)===De(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=De(s.doubleValue),u=De(o.doubleValue);return a===u?Zs(a)===Zs(u):isNaN(a)&&isNaN(u)}return!1}(n,e);case 9:return or(n.arrayValue.values||[],e.arrayValue.values||[],Wt);case 10:case 11:return function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(ol(a)!==ol(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Wt(a[h],u[h])))return!1;return!0}(n,e);default:return ae(52216,{left:n})}}function Xr(n,e){return(n.values||[]).find(t=>Wt(t,e))!==void 0}function lr(n,e){if(n===e)return 0;const t=wn(n),r=wn(e);if(t!==r)return pe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return pe(n.booleanValue,e.booleanValue);case 2:return function(o,a){const u=De(o.integerValue||o.doubleValue),h=De(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return ll(n.timestampValue,e.timestampValue);case 4:return ll(Yr(n),Yr(e));case 5:return fo(n.stringValue,e.stringValue);case 6:return function(o,a){const u=_n(o),h=_n(a);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,a){const u=o.split("/"),h=a.split("/");for(let f=0;f<u.length&&f<h.length;f++){const m=pe(u[f],h[f]);if(m!==0)return m}return pe(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,a){const u=pe(De(o.latitude),De(a.latitude));return u!==0?u:pe(De(o.longitude),De(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return cl(n.arrayValue,e.arrayValue);case 10:return function(o,a){var E,N,j,L;const u=o.fields||{},h=a.fields||{},f=(E=u[ti])==null?void 0:E.arrayValue,m=(N=h[ti])==null?void 0:N.arrayValue,g=pe(((j=f==null?void 0:f.values)==null?void 0:j.length)||0,((L=m==null?void 0:m.values)==null?void 0:L.length)||0);return g!==0?g:cl(f,m)}(n.mapValue,e.mapValue);case 11:return function(o,a){if(o===Ss.mapValue&&a===Ss.mapValue)return 0;if(o===Ss.mapValue)return 1;if(a===Ss.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=a.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let g=0;g<h.length&&g<m.length;++g){const E=fo(h[g],m[g]);if(E!==0)return E;const N=lr(u[h[g]],f[m[g]]);if(N!==0)return N}return pe(h.length,m.length)}(n.mapValue,e.mapValue);default:throw ae(23264,{he:t})}}function ll(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return pe(n,e);const t=yn(n),r=yn(e),s=pe(t.seconds,r.seconds);return s!==0?s:pe(t.nanos,r.nanos)}function cl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=lr(t[s],r[s]);if(o)return o}return pe(t.length,r.length)}function cr(n){return mo(n)}function mo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=yn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return _n(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=mo(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${mo(t.fields[a])}`;return s+"}"}(n.mapValue):ae(61005,{value:n})}function $s(n){switch(wn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=xi(n);return e?16+$s(e):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+$s(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return On(r.fields,(o,a)=>{s+=o.length+$s(a)}),s}(n.mapValue);default:throw ae(13486,{value:n})}}function ni(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function po(n){return!!n&&"integerValue"in n}function Lo(n){return!!n&&"arrayValue"in n}function ul(n){return!!n&&"nullValue"in n}function dl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Us(n){return!!n&&"mapValue"in n}function $f(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Fc])==null?void 0:r.stringValue)===Bc}function qr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return On(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=qr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qr(n.arrayValue.values[t]);return e}return{...n}}function Uf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Bf}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this.value=e}static empty(){return new wt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Us(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qr(t)}setAll(e){let t=Xe.emptyPath(),r={},s=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}a?r[u.lastSegment()]=qr(a):s.push(u.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Us(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Wt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Us(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){On(t,(s,o)=>e[s]=o);for(const s of r)delete e[s]}clone(){return new wt(qr(this.value))}}function $c(n){const e=[];return On(n.fields,(t,r)=>{const s=new Xe([t]);if(Us(r)){const o=$c(r.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)}),new At(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e,t,r,s,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new rt(e,0,ce.min(),ce.min(),ce.min(),wt.empty(),0)}static newFoundDocument(e,t,r,s){return new rt(e,1,t,ce.min(),r,s,0)}static newNoDocument(e,t){return new rt(e,2,t,ce.min(),ce.min(),wt.empty(),0)}static newUnknownDocument(e,t){return new rt(e,3,t,ce.min(),ce.min(),wt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ce.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=wt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=wt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof rt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new rt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(e,t){this.position=e,this.inclusive=t}}function hl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],a=n.position[s];if(o.field.isKeyField()?r=re.comparator(re.fromName(a.referenceValue),t.key):r=lr(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function fl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Wt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e,t="asc"){this.field=e,this.dir=t}}function qf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{}class Oe extends Uc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Wf(e,t,r):t==="array-contains"?new Kf(e,r):t==="in"?new Qf(e,r):t==="not-in"?new Yf(e,r):t==="array-contains-any"?new Jf(e,r):new Oe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Hf(e,r):new Gf(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(lr(t,this.value)):t!==null&&wn(this.value)===wn(t)&&this.matchesComparison(lr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ae(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Nt extends Uc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Nt(e,t)}matches(e){return qc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function qc(n){return n.op==="and"}function zc(n){return zf(n)&&qc(n)}function zf(n){for(const e of n.filters)if(e instanceof Nt)return!1;return!0}function go(n){if(n instanceof Oe)return n.field.canonicalString()+n.op.toString()+cr(n.value);if(zc(n))return n.filters.map(e=>go(e)).join(",");{const e=n.filters.map(t=>go(t)).join(",");return`${n.op}(${e})`}}function Wc(n,e){return n instanceof Oe?function(r,s){return s instanceof Oe&&r.op===s.op&&r.field.isEqual(s.field)&&Wt(r.value,s.value)}(n,e):n instanceof Nt?function(r,s){return s instanceof Nt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,a,u)=>o&&Wc(a,s.filters[u]),!0):!1}(n,e):void ae(19439)}function Hc(n){return n instanceof Oe?function(t){return`${t.field.canonicalString()} ${t.op} ${cr(t.value)}`}(n):n instanceof Nt?function(t){return t.op.toString()+" {"+t.getFilters().map(Hc).join(" ,")+"}"}(n):"Filter"}class Wf extends Oe{constructor(e,t,r){super(e,t,r),this.key=re.fromName(r.referenceValue)}matches(e){const t=re.comparator(e.key,this.key);return this.matchesComparison(t)}}class Hf extends Oe{constructor(e,t){super(e,"in",t),this.keys=Gc("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Gf extends Oe{constructor(e,t){super(e,"not-in",t),this.keys=Gc("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Gc(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>re.fromName(r.referenceValue))}class Kf extends Oe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Lo(t)&&Xr(t.arrayValue,this.value)}}class Qf extends Oe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Xr(this.value.arrayValue,t)}}class Yf extends Oe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Xr(this.value.arrayValue,t)}}class Jf extends Oe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Lo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Xr(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf{constructor(e,t=null,r=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function ml(n,e=null,t=[],r=[],s=null,o=null,a=null){return new Xf(n,e,t,r,s,o,a)}function Oo(n){const e=ue(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>go(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),pi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>cr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>cr(r)).join(",")),e.Te=t}return e.Te}function Fo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!qf(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Wc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!fl(n.startAt,e.startAt)&&fl(n.endAt,e.endAt)}function xo(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e,t=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Zf(n,e,t,r,s,o,a,u){return new Fn(n,e,t,r,s,o,a,u)}function Kc(n){return new Fn(n)}function pl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function em(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Bo(n){return n.collectionGroup!==null}function tr(n){const e=ue(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new qe(Xe.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Zr(o,r))}),t.has(Xe.keyField().canonicalString())||e.Ie.push(new Zr(Xe.keyField(),r))}return e.Ie}function $t(n){const e=ue(n);return e.Ee||(e.Ee=tm(e,tr(n))),e.Ee}function tm(n,e){if(n.limitType==="F")return ml(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const o=s.dir==="desc"?"asc":"desc";return new Zr(s.field,o)});const t=n.endAt?new ur(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ur(n.startAt.position,n.startAt.inclusive):null;return ml(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function bo(n,e){const t=n.filters.concat([e]);return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function nm(n,e){const t=n.explicitOrderBy.concat([e]);return new Fn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ri(n,e,t){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function rm(n,e){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function bi(n,e){return Fo($t(n),$t(e))&&n.limitType===e.limitType}function Qc(n){return`${Oo($t(n))}|lt:${n.limitType}`}function Jn(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Hc(s)).join(", ")}]`),pi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>cr(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>cr(s)).join(",")),`Target(${r})`}($t(n))}; limitType=${n.limitType})`}function yi(n,e){return e.isFoundDocument()&&function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):re.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,s){for(const o of tr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(a,u,h){const f=hl(a,u,h);return a.inclusive?f<=0:f<0}(r.startAt,tr(r),s)||r.endAt&&!function(a,u,h){const f=hl(a,u,h);return a.inclusive?f>=0:f>0}(r.endAt,tr(r),s))}(n,e)}function sm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Yc(n){return(e,t)=>{let r=!1;for(const s of tr(n)){const o=im(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function im(n,e,t){const r=n.field.isKeyField()?re.comparator(e.key,t.key):function(o,a,u){const h=a.data.field(o),f=u.data.field(o);return h!==null&&f!==null?lr(h,f):ae(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ae(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){On(this.inner,(t,r)=>{for(const[s,o]of r)e(s,o)})}isEmpty(){return Pc(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const om=new je(re.comparator);function Xt(){return om}const Jc=new je(re.comparator);function Lr(...n){let e=Jc;for(const t of n)e=e.insert(t.key,t);return e}function Xc(n){let e=Jc;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function jn(){return zr()}function Zc(){return zr()}function zr(){return new Bn(n=>n.toString(),(n,e)=>n.isEqual(e))}const am=new je(re.comparator),lm=new qe(re.comparator);function ge(...n){let e=lm;for(const t of n)e=e.add(t);return e}const cm=new qe(pe);function um(){return cm}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $o(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zs(e)?"-0":e}}function eu(n){return{integerValue:""+n}}function dm(n,e){return Vf(e)?eu(e):$o(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(){this._=void 0}}function hm(n,e,t){return n instanceof si?function(s,o){const a={fields:{[Mc]:{stringValue:Dc},[Oc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&gi(o)&&(o=xi(o)),o&&(a.fields[Lc]=o),{mapValue:a}}(t,e):n instanceof es?nu(n,e):n instanceof ts?ru(n,e):function(s,o){const a=tu(s,o),u=gl(a)+gl(s.Ae);return po(a)&&po(s.Ae)?eu(u):$o(s.serializer,u)}(n,e)}function fm(n,e,t){return n instanceof es?nu(n,e):n instanceof ts?ru(n,e):t}function tu(n,e){return n instanceof ii?function(r){return po(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class si extends _i{}class es extends _i{constructor(e){super(),this.elements=e}}function nu(n,e){const t=su(e);for(const r of n.elements)t.some(s=>Wt(s,r))||t.push(r);return{arrayValue:{values:t}}}class ts extends _i{constructor(e){super(),this.elements=e}}function ru(n,e){let t=su(e);for(const r of n.elements)t=t.filter(s=>!Wt(s,r));return{arrayValue:{values:t}}}class ii extends _i{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function gl(n){return De(n.integerValue||n.doubleValue)}function su(n){return Lo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function mm(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof es&&s instanceof es||r instanceof ts&&s instanceof ts?or(r.elements,s.elements,Wt):r instanceof ii&&s instanceof ii?Wt(r.Ae,s.Ae):r instanceof si&&s instanceof si}(n.transform,e.transform)}class pm{constructor(e,t){this.version=e,this.transformResults=t}}class Ut{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ut}static exists(e){return new Ut(void 0,e)}static updateTime(e){return new Ut(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function qs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class wi{}function iu(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Uo(n.key,Ut.none()):new ss(n.key,n.data,Ut.none());{const t=n.data,r=wt.empty();let s=new qe(Xe.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new $n(n.key,r,new At(s.toArray()),Ut.none())}}function gm(n,e,t){n instanceof ss?function(s,o,a){const u=s.value.clone(),h=bl(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(n,e,t):n instanceof $n?function(s,o,a){if(!qs(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=bl(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(ou(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Wr(n,e,t,r){return n instanceof ss?function(o,a,u,h){if(!qs(o.precondition,a))return u;const f=o.value.clone(),m=yl(o.fieldTransforms,h,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof $n?function(o,a,u,h){if(!qs(o.precondition,a))return u;const f=yl(o.fieldTransforms,h,a),m=a.data;return m.setAll(ou(o)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(g=>g.field))}(n,e,t,r):function(o,a,u){return qs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(n,e,t)}function xm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=tu(r.transform,s||null);o!=null&&(t===null&&(t=wt.empty()),t.set(r.field,o))}return t||null}function xl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&or(r,s,(o,a)=>mm(o,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ss extends wi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class $n extends wi{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function ou(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function bl(n,e,t){const r=new Map;ve(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const o=n[s],a=o.transform,u=e.data.field(o.field);r.set(o.field,fm(a,u,t[s]))}return r}function yl(n,e,t){const r=new Map;for(const s of n){const o=s.transform,a=t.data.field(s.field);r.set(s.field,hm(o,a,e))}return r}class Uo extends wi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bm extends wi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ym{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&gm(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Wr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Wr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Zc();return this.mutations.forEach(s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=iu(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(ce.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ge())}isEqual(e){return this.batchId===e.batchId&&or(this.mutations,e.mutations,(t,r)=>xl(t,r))&&or(this.baseMutations,e.baseMutations,(t,r)=>xl(t,r))}}class qo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ve(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return am}();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new qo(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le,xe;function vm(n){switch(n){case P.OK:return ae(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return ae(15467,{code:n})}}function au(n){if(n===void 0)return Jt("GRPC error has no .code"),P.UNKNOWN;switch(n){case Le.OK:return P.OK;case Le.CANCELLED:return P.CANCELLED;case Le.UNKNOWN:return P.UNKNOWN;case Le.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Le.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Le.INTERNAL:return P.INTERNAL;case Le.UNAVAILABLE:return P.UNAVAILABLE;case Le.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Le.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Le.NOT_FOUND:return P.NOT_FOUND;case Le.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Le.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Le.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Le.ABORTED:return P.ABORTED;case Le.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Le.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Le.DATA_LOSS:return P.DATA_LOSS;default:return ae(39323,{code:n})}}(xe=Le||(Le={}))[xe.OK=0]="OK",xe[xe.CANCELLED=1]="CANCELLED",xe[xe.UNKNOWN=2]="UNKNOWN",xe[xe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",xe[xe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",xe[xe.NOT_FOUND=5]="NOT_FOUND",xe[xe.ALREADY_EXISTS=6]="ALREADY_EXISTS",xe[xe.PERMISSION_DENIED=7]="PERMISSION_DENIED",xe[xe.UNAUTHENTICATED=16]="UNAUTHENTICATED",xe[xe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",xe[xe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",xe[xe.ABORTED=10]="ABORTED",xe[xe.OUT_OF_RANGE=11]="OUT_OF_RANGE",xe[xe.UNIMPLEMENTED=12]="UNIMPLEMENTED",xe[xe.INTERNAL=13]="INTERNAL",xe[xe.UNAVAILABLE=14]="UNAVAILABLE",xe[xe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function km(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Em=new mn([4294967295,4294967295],0);function _l(n){const e=km().encode(n),t=new vc;return t.update(e),new Uint8Array(t.digest())}function wl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new mn([t,r],0),new mn([s,o],0)]}class zo{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Or(`Invalid padding: ${t}`);if(r<0)throw new Or(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Or(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Or(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=mn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(mn.fromNumber(r)));return s.compare(Em)===1&&(s=new mn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=_l(e),[r,s]=wl(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new zo(o,s,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.ge===0)return;const t=_l(e),[r,s]=wl(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.be(a)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Or extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,is.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new vi(ce.min(),s,new je(pe),Xt(),ge())}}class is{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new is(r,t,ge(),ge(),ge())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class lu{constructor(e,t){this.targetId=e,this.Ce=t}}class cu{constructor(e,t,r=Ze.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class vl{constructor(){this.ve=0,this.Fe=kl(),this.Me=Ze.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ge(),t=ge(),r=ge();return this.Fe.forEach((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ae(38017,{changeType:o})}}),new is(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=kl()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ve(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Tm{constructor(e){this.Ge=e,this.ze=new Map,this.je=Xt(),this.He=js(),this.Je=js(),this.Ze=new je(pe)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ae(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(xo(o))if(r===0){const a=new re(o.path);this.et(t,a,rt.newNoDocument(a,ce.min()))}else ve(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let a,u;try{a=_n(r).toUint8Array()}catch(h){if(h instanceof Vc)return Dn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new zo(a,s,o)}catch(h){return Dn(h instanceof Or?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((o,a)=>{const u=this.ot(a);if(u){if(o.current&&xo(u.target)){const h=new re(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,rt.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}});let r=ge();this.Je.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));const s=new vi(e,t,this.Ze,this.je,r);return this.je=Xt(),this.He=js(),this.Je=js(),this.Ze=new je(pe),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new vl,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new qe(pe),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new qe(pe),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||Z("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new vl),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function js(){return new je(re.comparator)}function kl(){return new je(re.comparator)}const Im={asc:"ASCENDING",desc:"DESCENDING"},Am={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cm={and:"AND",or:"OR"};class Nm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function yo(n,e){return n.useProto3Json||pi(e)?e:{value:e}}function oi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function uu(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Rm(n,e){return oi(n,e.toTimestamp())}function qt(n){return ve(!!n,49232),ce.fromTimestamp(function(t){const r=yn(t);return new Re(r.seconds,r.nanos)}(n))}function Wo(n,e){return _o(n,e).canonicalString()}function _o(n,e){const t=function(s){return new Ce(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function du(n){const e=Ce.fromString(n);return ve(gu(e),10190,{key:e.toString()}),e}function wo(n,e){return Wo(n.databaseId,e.path)}function Qi(n,e){const t=du(e);if(t.get(1)!==n.databaseId.projectId)throw new W(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new W(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new re(fu(t))}function hu(n,e){return Wo(n.databaseId,e)}function Sm(n){const e=du(n);return e.length===4?Ce.emptyPath():fu(e)}function vo(n){return new Ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fu(n){return ve(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function El(n,e,t){return{name:wo(n,e),fields:t.value.mapValue.fields}}function jm(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:ae(39313,{state:f})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=function(f,m){return f.useProto3Json?(ve(m===void 0||typeof m=="string",58123),Ze.fromBase64String(m||"")):(ve(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),Ze.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(f){const m=f.code===void 0?P.UNKNOWN:au(f.code);return new W(m,f.message||"")}(a);t=new cu(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Qi(n,r.document.name),o=qt(r.document.updateTime),a=r.document.createTime?qt(r.document.createTime):ce.min(),u=new wt({mapValue:{fields:r.document.fields}}),h=rt.newFoundDocument(s,o,a,u),f=r.targetIds||[],m=r.removedTargetIds||[];t=new zs(f,m,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Qi(n,r.document),o=r.readTime?qt(r.readTime):ce.min(),a=rt.newNoDocument(s,o),u=r.removedTargetIds||[];t=new zs([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Qi(n,r.document),o=r.removedTargetIds||[];t=new zs([],o,s,null)}else{if(!("filter"in e))return ae(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new wm(s,o),u=r.targetId;t=new lu(u,a)}}return t}function Pm(n,e){let t;if(e instanceof ss)t={update:El(n,e.key,e.value)};else if(e instanceof Uo)t={delete:wo(n,e.key)};else if(e instanceof $n)t={update:El(n,e.key,e.data),updateMask:Um(e.fieldMask)};else{if(!(e instanceof bm))return ae(16599,{dt:e.type});t={verify:wo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,a){const u=a.transform;if(u instanceof si)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof es)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof ts)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof ii)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw ae(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Rm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:ae(27497)}(n,e.precondition)),t}function Vm(n,e){return n&&n.length>0?(ve(e!==void 0,14353),n.map(t=>function(s,o){let a=s.updateTime?qt(s.updateTime):qt(o);return a.isEqual(ce.min())&&(a=qt(o)),new pm(a,s.transformResults||[])}(t,e))):[]}function Dm(n,e){return{documents:[hu(n,e.path)]}}function Mm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=hu(n,s);const o=function(f){if(f.length!==0)return pu(Nt.create(f,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const a=function(f){if(f.length!==0)return f.map(m=>function(E){return{field:Xn(E.field),direction:Fm(E.dir)}}(m))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=yo(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{ft:t,parent:s}}function Lm(n){let e=Sm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ve(r===1,65062);const m=t.from[0];m.allDescendants?s=m.collectionId:e=e.child(m.collectionId)}let o=[];t.where&&(o=function(g){const E=mu(g);return E instanceof Nt&&zc(E)?E.getFilters():[E]}(t.where));let a=[];t.orderBy&&(a=function(g){return g.map(E=>function(j){return new Zr(Zn(j.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(E))}(t.orderBy));let u=null;t.limit&&(u=function(g){let E;return E=typeof g=="object"?g.value:g,pi(E)?null:E}(t.limit));let h=null;t.startAt&&(h=function(g){const E=!!g.before,N=g.values||[];return new ur(N,E)}(t.startAt));let f=null;return t.endAt&&(f=function(g){const E=!g.before,N=g.values||[];return new ur(N,E)}(t.endAt)),Zf(e,s,a,o,u,"F",h,f)}function Om(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ae(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function mu(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Zn(t.unaryFilter.field);return Oe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Zn(t.unaryFilter.field);return Oe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Zn(t.unaryFilter.field);return Oe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Zn(t.unaryFilter.field);return Oe.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ae(61313);default:return ae(60726)}}(n):n.fieldFilter!==void 0?function(t){return Oe.create(Zn(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ae(58110);default:return ae(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Nt.create(t.compositeFilter.filters.map(r=>mu(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ae(1026)}}(t.compositeFilter.op))}(n):ae(30097,{filter:n})}function Fm(n){return Im[n]}function Bm(n){return Am[n]}function $m(n){return Cm[n]}function Xn(n){return{fieldPath:n.canonicalString()}}function Zn(n){return Xe.fromServerFormat(n.fieldPath)}function pu(n){return n instanceof Oe?function(t){if(t.op==="=="){if(dl(t.value))return{unaryFilter:{field:Xn(t.field),op:"IS_NAN"}};if(ul(t.value))return{unaryFilter:{field:Xn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dl(t.value))return{unaryFilter:{field:Xn(t.field),op:"IS_NOT_NAN"}};if(ul(t.value))return{unaryFilter:{field:Xn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xn(t.field),op:Bm(t.op),value:t.value}}}(n):n instanceof Nt?function(t){const r=t.getFilters().map(s=>pu(s));return r.length===1?r[0]:{compositeFilter:{op:$m(t.op),filters:r}}}(n):ae(54877,{filter:n})}function Um(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function gu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function xu(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e,t,r,s,o=ce.min(),a=ce.min(),u=Ze.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new dn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new dn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new dn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new dn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(e){this.yt=e}}function zm(n){const e=Lm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ri(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wm{constructor(){this.Sn=new Hm}addToCollectionParentIndex(e,t){return this.Sn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(bn.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(bn.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class Hm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new qe(Ce.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new qe(Ce.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bu=41943040;class mt{static withCacheSize(e){return new mt(e,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mt.DEFAULT_COLLECTION_PERCENTILE=10,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mt.DEFAULT=new mt(bu,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mt.DISABLED=new mt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new dr(0)}static ar(){return new dr(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il="LruGarbageCollector",Gm=1048576;function Al([n,e],[t,r]){const s=pe(n,t);return s===0?pe(e,r):s}class Km{constructor(e){this.Pr=e,this.buffer=new qe(Al),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Al(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Qm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){Z(Il,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){gr(t)?Z(Il,"Ignoring IndexedDB error during garbage collection: ",t):await pr(t)}await this.Ar(3e5)})}}class Ym{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return D.resolve(mi.ce);const r=new Km(t);return this.Vr.forEachTarget(e,s=>r.Er(s.sequenceNumber)).next(()=>this.Vr.mr(e,s=>r.Er(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Z("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(Tl)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Z("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Tl):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,o,a,u,h,f;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(Z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(e,s))).next(g=>(r=g,u=Date.now(),this.removeTargets(e,r,t))).next(g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(g=>(f=Date.now(),Yn()<=be.DEBUG&&Z("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:g})))}}function Jm(n,e){return new Ym(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(){this.changes=new Bn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,rt.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Wr(r.mutation,s,At.empty(),Re.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ge()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ge()){const s=jn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(o=>{let a=Lr();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=jn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ge()))}populateOverlays(e,t,r){const s=[];return r.forEach(o=>{t.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(e,s).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,s){let o=Xt();const a=zr(),u=function(){return zr()}();return t.forEach((h,f)=>{const m=r.get(f.key);s.has(f.key)&&(m===void 0||m.mutation instanceof $n)?o=o.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),Wr(m.mutation,f,m.mutation.getFieldMask(),Re.now())):a.set(f.key,At.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((f,m)=>a.set(f,m)),t.forEach((f,m)=>u.set(f,new Zm(m,a.get(f)??null))),u))}recalculateAndSaveOverlays(e,t){const r=zr();let s=new je((a,u)=>a-u),o=ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(h=>{const f=t.get(h);if(f===null)return;let m=r.get(h)||At.empty();m=u.applyToLocalView(f,m),r.set(h,m);const g=(s.get(u.batchId)||ge()).add(h);s=s.insert(u.batchId,g)})}).next(()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,m=h.value,g=Zc();m.forEach(E=>{if(!o.has(E)){const N=iu(t.get(E),r.get(E));N!==null&&g.set(E,N),o=o.add(E)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,g))}return D.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return em(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Bo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):D.resolve(jn());let u=Qr,h=o;return a.next(f=>D.forEach(f,(m,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),o.get(m)?D.resolve():this.remoteDocumentCache.getEntry(e,m).next(E=>{h=h.insert(m,E)}))).next(()=>this.populateOverlays(e,f,o)).next(()=>this.computeViews(e,h,f,ge())).next(m=>({batchId:u,changes:Xc(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new re(t)).next(r=>{let s=Lr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let a=Lr();return this.indexManager.getCollectionParents(e,o).next(u=>D.forEach(u,h=>{const f=function(g,E){return new Fn(E,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,s).next(m=>{m.forEach((g,E)=>{a=a.insert(g,E)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s))).next(a=>{o.forEach((h,f)=>{const m=f.getKey();a.get(m)===null&&(a=a.insert(m,rt.newInvalidDocument(m)))});let u=Lr();return a.forEach((h,f)=>{const m=o.get(h);m!==void 0&&Wr(m.mutation,f,At.empty(),Re.now()),yi(t,f)&&(u=u.insert(h,f))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return D.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:qt(s.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(s){return{name:s.name,query:zm(s.bundledQuery),readTime:qt(s.readTime)}}(t)),D.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(){this.overlays=new je(re.comparator),this.Lr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const r=jn();return D.forEach(t,s=>this.getOverlay(e,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,o)=>{this.bt(e,t,o)}),D.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Lr.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){const s=jn(),o=t.length+1,a=new re(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return D.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new je((f,m)=>f-m);const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=jn(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const u=jn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>u.set(f,m)),!(u.size()>=s)););return D.resolve(u)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new _m(t,r));let o=this.Lr.get(t);o===void 0&&(o=ge(),this.Lr.set(t,o)),this.Lr.set(t,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(){this.sessionToken=Ze.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(){this.kr=new qe(Ke.Kr),this.qr=new qe(Ke.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new Ke(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new Ke(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){const t=new re(new Ce([])),r=new Ke(t,e),s=new Ke(t,e+1),o=[];return this.qr.forEachInRange([r,s],a=>{this.Wr(a),o.push(a.key)}),o}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new re(new Ce([])),r=new Ke(t,e),s=new Ke(t,e+1);let o=ge();return this.qr.forEachInRange([r,s],a=>{o=o.add(a.key)}),o}containsKey(e){const t=new Ke(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Ke{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return re.comparator(e.key,t.key)||pe(e.Hr,t.Hr)}static Ur(e,t){return pe(e.Hr,t.Hr)||re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new qe(Ke.Kr)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new ym(o,t,r,s);this.mutationQueue.push(a);for(const u of s)this.Jr=this.Jr.add(new Ke(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),o=s<0?0:s;return D.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?Mo:this.Yn-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ke(t,0),s=new Ke(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,s],a=>{const u=this.Zr(a.Hr);o.push(u)}),D.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new qe(pe);return t.forEach(s=>{const o=new Ke(s,0),a=new Ke(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],u=>{r=r.add(u.Hr)})}),D.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;re.isDocumentKey(o)||(o=o.child(""));const a=new Ke(new re(o),0);let u=new qe(pe);return this.Jr.forEachWhile(h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.Hr)),!0)},a),D.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach(r=>{const s=this.Zr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ve(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return D.forEach(t.mutations,s=>{const o=new Ke(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){const r=new Ke(t,0),s=this.Jr.firstAfterOrEqual(r);return D.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e){this.ti=e,this.docs=function(){return new je(re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():rt.newInvalidDocument(t))}getEntries(e,t){let r=Xt();return t.forEach(s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():rt.newInvalidDocument(s))}),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=Xt();const a=t.path,u=new re(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:m}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||Rf(Nf(m),r)<=0||(s.has(m.key)||yi(t,m))&&(o=o.insert(m.key,m.mutableCopy()))}return D.resolve(o)}getAllFromCollectionGroup(e,t,r,s){ae(9500)}ni(e,t){return D.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new o0(this)}getSize(e){return D.resolve(this.size)}}class o0 extends Xm{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)}),D.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(e){this.persistence=e,this.ri=new Bn(t=>Oo(t),Fo),this.lastRemoteSnapshotVersion=ce.min(),this.highestTargetId=0,this.ii=0,this.si=new Ho,this.targetCount=0,this.oi=dr._r()}forEachTarget(e,t){return this.ri.forEach((r,s)=>t(s)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),D.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new dr(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.lr(t),D.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.ri.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),D.waitFor(o).next(()=>s)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),D.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach(a=>{o.push(s.markPotentiallyOrphaned(e,a))}),D.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this.si.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu{constructor(e,t){this._i={},this.overlays={},this.ai=new mi(0),this.ui=!1,this.ui=!0,this.ci=new r0,this.referenceDelegate=e(this),this.li=new a0(this),this.indexManager=new Wm,this.remoteDocumentCache=function(s){return new i0(s)}(r=>this.referenceDelegate.hi(r)),this.serializer=new qm(t),this.Pi=new t0(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new n0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new s0(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){Z("MemoryPersistence","Starting transaction:",e);const s=new l0(this.ai.next());return this.referenceDelegate.Ti(),r(s).next(o=>this.referenceDelegate.Ii(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ei(e,t){return D.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class l0 extends jf{constructor(e){super(),this.currentSequenceNumber=e}}class Go{constructor(e){this.persistence=e,this.Ri=new Ho,this.Ai=null}static Vi(e){return new Go(e)}get di(){if(this.Ai)return this.Ai;throw ae(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(s=>this.di.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.di.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.di,r=>{const s=re.fromPath(r);return this.mi(e,s).next(o=>{o||t.removeEntry(s,ce.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ai{constructor(e,t){this.persistence=e,this.fi=new Bn(r=>Df(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Jm(this,t)}static Vi(e,t){return new ai(e,t)}Ti(){}Ii(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return D.forEach(this.fi,(r,s)=>this.wr(e,r,s).next(o=>o?D.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ni(e,a=>this.wr(e,a,t).next(u=>{u||(r++,o.removeEntry(a,ce.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),D.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=$s(e.data.value)),t}wr(e,t,r){return D.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return D.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=ge(),s=ge();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Ko(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return Yd()?8:Pf(Kd())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.gs(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ps(e,t,s,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new c0;return this.ys(e,t,a).next(u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)})}).next(()=>o.result)}ws(e,t,r,s){return r.documentReadCount<this.Vs?(Yn()<=be.DEBUG&&Z("QueryEngine","SDK will not create cache indexes for query:",Jn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),D.resolve()):(Yn()<=be.DEBUG&&Z("QueryEngine","Query:",Jn(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(Yn()<=be.DEBUG&&Z("QueryEngine","The SDK decides to create cache indexes for query:",Jn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$t(t))):D.resolve())}gs(e,t){if(pl(t))return D.resolve(null);let r=$t(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ri(t,null,"F"),r=$t(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const a=ge(...o);return this.fs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{const f=this.bs(t,u);return this.Ss(t,f,a,h.readTime)?this.gs(e,ri(t,null,"F")):this.Ds(e,f,t,h)}))})))}ps(e,t,r,s){return pl(t)||s.isEqual(ce.min())?D.resolve(null):this.fs.getDocuments(e,r).next(o=>{const a=this.bs(t,o);return this.Ss(t,a,r,s)?D.resolve(null):(Yn()<=be.DEBUG&&Z("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Jn(t)),this.Ds(e,a,t,Cf(s,Qr)).next(u=>u))})}bs(e,t){let r=new qe(Yc(e));return t.forEach((s,o)=>{yi(e,o)&&(r=r.add(o))}),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ys(e,t,r){return Yn()<=be.DEBUG&&Z("QueryEngine","Using full collection scan to execute query:",Jn(t)),this.fs.getDocumentsMatchingQuery(e,t,bn.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qo="LocalStore",d0=3e8;class h0{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new je(pe),this.Fs=new Bn(o=>Oo(o),Fo),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new e0(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function f0(n,e,t,r){return new h0(n,e,t,r)}async function _u(n,e){const t=ue(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{const a=[],u=[];let h=ge();for(const f of s){a.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}for(const f of o){u.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}return t.localDocuments.getDocuments(r,h).next(f=>({Ns:f,removedBatchIds:a,addedBatchIds:u}))})})}function m0(n,e){const t=ue(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return function(u,h,f,m){const g=f.batch,E=g.keys();let N=D.resolve();return E.forEach(j=>{N=N.next(()=>m.getEntry(h,j)).next(L=>{const V=f.docVersions.get(j);ve(V!==null,48541),L.version.compareTo(V)<0&&(g.applyToRemoteDocument(L,f),L.isValidDocument()&&(L.setReadTime(f.commitVersion),m.addEntry(L)))})}),N.next(()=>u.mutationQueue.removeMutationBatch(h,g))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=ge();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function wu(n){const e=ue(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function p0(n,e){const t=ue(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const u=[];e.targetChanges.forEach((m,g)=>{const E=s.get(g);if(!E)return;u.push(t.li.removeMatchingKeys(o,m.removedDocuments,g).next(()=>t.li.addMatchingKeys(o,m.addedDocuments,g)));let N=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?N=N.withResumeToken(Ze.EMPTY_BYTE_STRING,ce.min()).withLastLimboFreeSnapshotVersion(ce.min()):m.resumeToken.approximateByteSize()>0&&(N=N.withResumeToken(m.resumeToken,r)),s=s.insert(g,N),function(L,V,O){return L.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=d0?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(E,N,m)&&u.push(t.li.updateTargetData(o,N))});let h=Xt(),f=ge();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,m))}),u.push(g0(o,a,e.documentUpdates).next(m=>{h=m.Bs,f=m.Ls})),!r.isEqual(ce.min())){const m=t.li.getLastRemoteSnapshotVersion(o).next(g=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(m)}return D.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(t.vs=s,o))}function g0(n,e,t){let r=ge(),s=ge();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=Xt();return t.forEach((u,h)=>{const f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(ce.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):Z(Qo,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)}),{Bs:a,Ls:s}})}function x0(n,e){const t=ue(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Mo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function b0(n,e){const t=ue(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.li.getTargetData(r,e).next(o=>o?(s=o,D.resolve(s)):t.li.allocateTargetId(r).next(a=>(s=new dn(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r})}async function ko(n,e,t){const r=ue(n),s=r.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!gr(a))throw a;Z(Qo,`Failed to update sequence numbers for target ${e}: ${a}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function Cl(n,e,t){const r=ue(n);let s=ce.min(),o=ge();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,m){const g=ue(h),E=g.Fs.get(m);return E!==void 0?D.resolve(g.vs.get(E)):g.li.getTargetData(f,m)}(r,a,$t(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?s:ce.min(),t?o:ge())).next(u=>(y0(r,sm(e),u),{documents:u,ks:o})))}function y0(n,e,t){let r=n.Ms.get(e)||ce.min();t.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ms.set(e,r)}class Nl{constructor(){this.activeTargetIds=um()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _0{constructor(){this.vo=new Nl,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Nl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl="ConnectivityMonitor";class Sl{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){Z(Rl,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){Z(Rl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ps=null;function Eo(){return Ps===null?Ps=function(){return 268435456+Math.round(2147483648*Math.random())}():Ps++,"0x"+Ps.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yi="RestConnection",v0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class k0{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===ei?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,o){const a=Eo(),u=this.Qo(e,t.toUriEncodedString());Z(Yi,`Sending RPC '${e}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,s,o);const{host:f}=new URL(u),m=jo(f);return this.zo(e,u,h,r,m).then(g=>(Z(Yi,`Received RPC '${e}' ${a}: `,g),g),g=>{throw Dn(Yi,`RPC '${e}' ${a} failed with error: `,g,"url: ",u,"request:",r),g})}jo(e,t,r,s,o,a){return this.Wo(e,t,r,s,o)}Go(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+mr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,o)=>e[o]=s),r&&r.headers.forEach((s,o)=>e[o]=s)}Qo(e,t){const r=v0[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tt="WebChannelConnection",Pr=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(s){setTimeout(()=>{throw s},0)}})};class nr extends k0{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!nr.c_){const e=Ic();Pr(e,Tc.STAT_EVENT,t=>{t.stat===ho.PROXY?Z(tt,"STAT_EVENT: detected buffering proxy"):t.stat===ho.NOPROXY&&Z(tt,"STAT_EVENT: detected no buffering proxy")}),nr.c_=!0}}zo(e,t,r,s,o){const a=Eo();return new Promise((u,h)=>{const f=new kc;f.setWithCredentials(!0),f.listenOnce(Ec.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case Bs.NO_ERROR:const g=f.getResponseJson();Z(tt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),u(g);break;case Bs.TIMEOUT:Z(tt,`RPC '${e}' ${a} timed out`),h(new W(P.DEADLINE_EXCEEDED,"Request time out"));break;case Bs.HTTP_ERROR:const E=f.getStatus();if(Z(tt,`RPC '${e}' ${a} failed with status:`,E,"response text:",f.getResponseText()),E>0){let N=f.getResponseJson();Array.isArray(N)&&(N=N[0]);const j=N==null?void 0:N.error;if(j&&j.status&&j.message){const L=function(O){const $=O.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf($)>=0?$:P.UNKNOWN}(j.status);h(new W(L,j.message))}else h(new W(P.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new W(P.UNAVAILABLE,"Connection failed."));break;default:ae(9055,{l_:e,streamId:a,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{Z(tt,`RPC '${e}' ${a} completed.`)}});const m=JSON.stringify(s);Z(tt,`RPC '${e}' ${a} sending request:`,s),f.send(t,"POST",m,r,15)})}T_(e,t,r){const s=Eo(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=o.join("");Z(tt,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let g=!1,E=!1;const N=new E0({Ho:j=>{E?Z(tt,`Not sending because RPC '${e}' stream ${s} is closed:`,j):(g||(Z(tt,`Opening RPC '${e}' stream ${s} transport.`),m.open(),g=!0),Z(tt,`RPC '${e}' stream ${s} sending:`,j),m.send(j))},Jo:()=>m.close()});return Pr(m,Mr.EventType.OPEN,()=>{E||(Z(tt,`RPC '${e}' stream ${s} transport opened.`),N.i_())}),Pr(m,Mr.EventType.CLOSE,()=>{E||(E=!0,Z(tt,`RPC '${e}' stream ${s} transport closed`),N.o_(),this.E_(m))}),Pr(m,Mr.EventType.ERROR,j=>{E||(E=!0,Dn(tt,`RPC '${e}' stream ${s} transport errored. Name:`,j.name,"Message:",j.message),N.o_(new W(P.UNAVAILABLE,"The operation could not be completed")))}),Pr(m,Mr.EventType.MESSAGE,j=>{var L;if(!E){const V=j.data[0];ve(!!V,16349);const O=V,$=(O==null?void 0:O.error)||((L=O[0])==null?void 0:L.error);if($){Z(tt,`RPC '${e}' stream ${s} received error:`,$);const H=$.status;let J=function(v){const x=Le[v];if(x!==void 0)return au(x)}(H),z=$.message;H==="NOT_FOUND"&&z.includes("database")&&z.includes("does not exist")&&z.includes(this.databaseId.database)&&Dn(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),J===void 0&&(J=P.INTERNAL,z="Unknown error status: "+H+" with message "+$.message),E=!0,N.o_(new W(J,z)),m.close()}else Z(tt,`RPC '${e}' stream ${s} received:`,V),N.__(V)}}),nr.u_(),setTimeout(()=>{N.s_()},0),N}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Ac()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T0(n){return new nr(n)}function Ji(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ki(n){return new Nm(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nr.c_=!1;class vu{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&Z("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jl="PersistentStream";class ku{constructor(e,t,r,s,o,a,u,h){this.Ci=e,this.b_=r,this.S_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new vu(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(Jt(t.toString()),Jt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new W(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.H_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Z(jl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(Z(jl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class I0 extends ku{constructor(e,t,r,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=jm(this.serializer,e),r=function(o){if(!("targetChange"in o))return ce.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?ce.min():a.readTime?qt(a.readTime):ce.min()}(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=vo(this.serializer),t.addTarget=function(o,a){let u;const h=a.target;if(u=xo(h)?{documents:Dm(o,h)}:{query:Mm(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=uu(o,a.resumeToken);const f=yo(o,a.expectedCount);f!==null&&(u.expectedCount=f)}else if(a.snapshotVersion.compareTo(ce.min())>0){u.readTime=oi(o,a.snapshotVersion.toTimestamp());const f=yo(o,a.expectedCount);f!==null&&(u.expectedCount=f)}return u}(this.serializer,e);const r=Om(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=vo(this.serializer),t.removeTarget=e,this.K_(t)}}class A0 extends ku{constructor(e,t,r,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return ve(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ve(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ve(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Vm(e.writeResults,e.commitTime),r=qt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=vo(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Pm(this.serializer,r))};this.K_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{}class N0 extends C0{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new W(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Wo(e,_o(t,r),s,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new W(P.UNKNOWN,o.toString())})}jo(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.jo(e,_o(t,r),s,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new W(P.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function R0(n,e,t,r){return new N0(n,e,t,r)}class S0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Jt(t),this.aa=!1):Z("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn="RemoteStore";class j0{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo(a=>{r.enqueueAndForget(async()=>{Un(this)&&(Z(Mn,"Restarting streams for network reachability change."),await async function(h){const f=ue(h);f.Ea.add(4),await os(f),f.Va.set("Unknown"),f.Ea.delete(4),await Ei(f)}(this))})}),this.Va=new S0(r,s)}}async function Ei(n){if(Un(n))for(const e of n.Ra)await e(!0)}async function os(n){for(const e of n.Ra)await e(!1)}function Eu(n,e){const t=ue(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Zo(t)?Xo(t):xr(t).O_()&&Jo(t,e))}function Yo(n,e){const t=ue(n),r=xr(t);t.Ia.delete(e),r.O_()&&Tu(t,e),t.Ia.size===0&&(r.O_()?r.L_():Un(t)&&t.Va.set("Unknown"))}function Jo(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ce.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}xr(n).Z_(e)}function Tu(n,e){n.da.$e(e),xr(n).X_(e)}function Xo(n){n.da=new Tm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),xr(n).start(),n.Va.ua()}function Zo(n){return Un(n)&&!xr(n).x_()&&n.Ia.size>0}function Un(n){return ue(n).Ea.size===0}function Iu(n){n.da=void 0}async function P0(n){n.Va.set("Online")}async function V0(n){n.Ia.forEach((e,t)=>{Jo(n,e)})}async function D0(n,e){Iu(n),Zo(n)?(n.Va.ha(e),Xo(n)):n.Va.set("Unknown")}async function M0(n,e,t){if(n.Va.set("Online"),e instanceof cu&&e.state===2&&e.cause)try{await async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.da.removeTarget(u))}(n,e)}catch(r){Z(Mn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await li(n,r)}else if(e instanceof zs?n.da.Xe(e):e instanceof lu?n.da.st(e):n.da.tt(e),!t.isEqual(ce.min()))try{const r=await wu(n.localStore);t.compareTo(r)>=0&&await function(o,a){const u=o.da.Tt(a);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=o.Ia.get(f);m&&o.Ia.set(f,m.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,f)=>{const m=o.Ia.get(h);if(!m)return;o.Ia.set(h,m.withResumeToken(Ze.EMPTY_BYTE_STRING,m.snapshotVersion)),Tu(o,h);const g=new dn(m.target,h,f,m.sequenceNumber);Jo(o,g)}),o.remoteSyncer.applyRemoteEvent(u)}(n,t)}catch(r){Z(Mn,"Failed to raise snapshot:",r),await li(n,r)}}async function li(n,e,t){if(!gr(e))throw e;n.Ea.add(1),await os(n),n.Va.set("Offline"),t||(t=()=>wu(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Z(Mn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ei(n)})}function Au(n,e){return e().catch(t=>li(n,t,e))}async function Ti(n){const e=ue(n),t=vn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Mo;for(;L0(e);)try{const s=await x0(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,O0(e,s)}catch(s){await li(e,s)}Cu(e)&&Nu(e)}function L0(n){return Un(n)&&n.Ta.length<10}function O0(n,e){n.Ta.push(e);const t=vn(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Cu(n){return Un(n)&&!vn(n).x_()&&n.Ta.length>0}function Nu(n){vn(n).start()}async function F0(n){vn(n).ra()}async function B0(n){const e=vn(n);for(const t of n.Ta)e.ea(t.mutations)}async function $0(n,e,t){const r=n.Ta.shift(),s=qo.from(r,e,t);await Au(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ti(n)}async function U0(n,e){e&&vn(n).Y_&&await async function(r,s){if(function(a){return vm(a)&&a!==P.ABORTED}(s.code)){const o=r.Ta.shift();vn(r).B_(),await Au(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),await Ti(r)}}(n,e),Cu(n)&&Nu(n)}async function Pl(n,e){const t=ue(n);t.asyncQueue.verifyOperationInProgress(),Z(Mn,"RemoteStore received new credentials");const r=Un(t);t.Ea.add(3),await os(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ei(t)}async function q0(n,e){const t=ue(n);e?(t.Ea.delete(2),await Ei(t)):e||(t.Ea.add(2),await os(t),t.Va.set("Unknown"))}function xr(n){return n.ma||(n.ma=function(t,r,s){const o=ue(t);return o.sa(),new I0(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:P0.bind(null,n),Yo:V0.bind(null,n),t_:D0.bind(null,n),J_:M0.bind(null,n)}),n.Ra.push(async e=>{e?(n.ma.B_(),Zo(n)?Xo(n):n.Va.set("Unknown")):(await n.ma.stop(),Iu(n))})),n.ma}function vn(n){return n.fa||(n.fa=function(t,r,s){const o=ue(t);return o.sa(),new A0(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:F0.bind(null,n),t_:U0.bind(null,n),ta:B0.bind(null,n),na:$0.bind(null,n)}),n.Ra.push(async e=>{e?(n.fa.B_(),await Ti(n)):(await n.fa.stop(),n.Ta.length>0&&(Z(Mn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new pn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const a=Date.now()+r,u=new ea(e,t,a,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new W(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ta(n,e){if(Jt("AsyncQueue",`${e}: ${n}`),gr(n))return new W(P.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{static emptySet(e){return new rr(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||re.comparator(t.key,r.key):(t,r)=>re.comparator(t.key,r.key),this.keyedMap=Lr(),this.sortedSet=new je(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof rr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new rr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(){this.ga=new je(re.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ae(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class hr{constructor(e,t,r,s,o,a,u,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,s,o){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new hr(e,t,rr.emptySet(t),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&bi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class W0{constructor(){this.queries=Dl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=ue(t),o=s.queries;s.queries=Dl(),o.forEach((a,u)=>{for(const h of u.ba)h.onError(r)})})(this,new W(P.ABORTED,"Firestore shutting down"))}}function Dl(){return new Bn(n=>Qc(n),bi)}async function H0(n,e){const t=ue(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.Sa()&&e.Da()&&(r=2):(o=new z0,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const u=ta(a,`Initialization of query '${Jn(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&na(t)}async function G0(n,e){const t=ue(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?s=e.Da()?0:1:!o.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function K0(n,e){const t=ue(n);let r=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const u of a.ba)u.Fa(s)&&(r=!0);a.wa=s}}r&&na(t)}function Q0(n,e,t){const r=ue(n),s=r.queries.get(e);if(s)for(const o of s.ba)o.onError(t);r.queries.delete(e)}function na(n){n.Ca.forEach(e=>{e.next()})}var To,Ml;(Ml=To||(To={})).Ma="default",Ml.Cache="cache";class Y0{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new hr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=hr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==To.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(e){this.key=e}}class Su{constructor(e){this.key=e}}class J0{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ge(),this.mutatedKeys=ge(),this.eu=Yc(e),this.tu=new rr(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new Vl,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((m,g)=>{const E=s.get(m),N=yi(this.query,g)?g:null,j=!!E&&this.mutatedKeys.has(E.key),L=!!N&&(N.hasLocalMutations||this.mutatedKeys.has(N.key)&&N.hasCommittedMutations);let V=!1;E&&N?E.data.isEqual(N.data)?j!==L&&(r.track({type:3,doc:N}),V=!0):this.su(E,N)||(r.track({type:2,doc:N}),V=!0,(h&&this.eu(N,h)>0||f&&this.eu(N,f)<0)&&(u=!0)):!E&&N?(r.track({type:0,doc:N}),V=!0):E&&!N&&(r.track({type:1,doc:E}),V=!0,(h||f)&&(u=!0)),V&&(N?(a=a.add(N),o=L?o.add(m):o.delete(m)):(a=a.delete(m),o=o.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{tu:a,iu:r,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((m,g)=>function(N,j){const L=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ae(20277,{Vt:V})}};return L(N)-L(j)}(m.type,g.type)||this.eu(m.doc,g.doc)),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Ya.size===0&&this.current&&!s?1:0,f=h!==this.Xa;return this.Xa=h,a.length!==0||f?{snapshot:new hr(this.query,e.tu,o,a,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Vl,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ge(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});const t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new Su(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new Ru(r))}),t}cu(e){this.Za=e.ks,this.Ya=ge();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return hr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ra="SyncEngine";class X0{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Z0{constructor(e){this.key=e,this.hu=!1}}class ep{constructor(e,t,r,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Bn(u=>Qc(u),bi),this.Iu=new Map,this.Eu=new Set,this.Ru=new je(re.comparator),this.Au=new Map,this.Vu=new Ho,this.du={},this.mu=new Map,this.fu=dr.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function tp(n,e,t=!0){const r=Lu(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await ju(r,e,t,!0),s}async function np(n,e){const t=Lu(n);await ju(t,e,!0,!1)}async function ju(n,e,t,r){const s=await b0(n.localStore,$t(e)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await rp(n,e,o,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&Eu(n.remoteStore,s),u}async function rp(n,e,t,r,s){n.pu=(g,E,N)=>async function(L,V,O,$){let H=V.view.ru(O);H.Ss&&(H=await Cl(L.localStore,V.query,!1).then(({documents:v})=>V.view.ru(v,H)));const J=$&&$.targetChanges.get(V.targetId),z=$&&$.targetMismatches.get(V.targetId)!=null,ne=V.view.applyChanges(H,L.isPrimaryClient,J,z);return Ol(L,V.targetId,ne.au),ne.snapshot}(n,g,E,N);const o=await Cl(n.localStore,e,!0),a=new J0(e,o.ks),u=a.ru(o.documents),h=is.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),f=a.applyChanges(u,n.isPrimaryClient,h);Ol(n,t,f.au);const m=new X0(e,t,a);return n.Tu.set(e,m),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),f.snapshot}async function sp(n,e,t){const r=ue(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter(a=>!bi(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ko(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Yo(r.remoteStore,s.targetId),Io(r,s.targetId)}).catch(pr)):(Io(r,s.targetId),await ko(r.localStore,s.targetId,!0))}async function ip(n,e){const t=ue(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Yo(t.remoteStore,r.targetId))}async function op(n,e,t){const r=fp(n);try{const s=await function(a,u){const h=ue(a),f=Re.now(),m=u.reduce((N,j)=>N.add(j.key),ge());let g,E;return h.persistence.runTransaction("Locally write mutations","readwrite",N=>{let j=Xt(),L=ge();return h.xs.getEntries(N,m).next(V=>{j=V,j.forEach((O,$)=>{$.isValidDocument()||(L=L.add(O))})}).next(()=>h.localDocuments.getOverlayedDocuments(N,j)).next(V=>{g=V;const O=[];for(const $ of u){const H=xm($,g.get($.key).overlayedDocument);H!=null&&O.push(new $n($.key,H,$c(H.value.mapValue),Ut.exists(!0)))}return h.mutationQueue.addMutationBatch(N,f,O,u)}).next(V=>{E=V;const O=V.applyToLocalDocumentSet(g,L);return h.documentOverlayCache.saveOverlays(N,V.batchId,O)})}).then(()=>({batchId:E.batchId,changes:Xc(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,u,h){let f=a.du[a.currentUser.toKey()];f||(f=new je(pe)),f=f.insert(u,h),a.du[a.currentUser.toKey()]=f}(r,s.batchId,t),await as(r,s.changes),await Ti(r.remoteStore)}catch(s){const o=ta(s,"Failed to persist write");t.reject(o)}}async function Pu(n,e){const t=ue(n);try{const r=await p0(t.localStore,e);e.targetChanges.forEach((s,o)=>{const a=t.Au.get(o);a&&(ve(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?ve(a.hu,14607):s.removedDocuments.size>0&&(ve(a.hu,42227),a.hu=!1))}),await as(t,r,e)}catch(r){await pr(r)}}function Ll(n,e,t){const r=ue(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)}),function(a,u){const h=ue(a);h.onlineState=u;let f=!1;h.queries.forEach((m,g)=>{for(const E of g.ba)E.va(u)&&(f=!0)}),f&&na(h)}(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ap(n,e,t){const r=ue(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let a=new je(re.comparator);a=a.insert(o,rt.newNoDocument(o,ce.min()));const u=ge().add(o),h=new vi(ce.min(),new Map,new je(pe),a,u);await Pu(r,h),r.Ru=r.Ru.remove(o),r.Au.delete(e),sa(r)}else await ko(r.localStore,e,!1).then(()=>Io(r,e,t)).catch(pr)}async function lp(n,e){const t=ue(n),r=e.batch.batchId;try{const s=await m0(t.localStore,e);Du(t,r,null),Vu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await as(t,s)}catch(s){await pr(s)}}async function cp(n,e,t){const r=ue(n);try{const s=await function(a,u){const h=ue(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,u).next(g=>(ve(g!==null,37113),m=g.keys(),h.mutationQueue.removeMutationBatch(f,g))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(r.localStore,e);Du(r,e,t),Vu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await as(r,s)}catch(s){await pr(s)}}function Vu(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Du(n,e,t){const r=ue(n);let s=r.du[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function Io(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(r=>{n.Vu.containsKey(r)||Mu(n,r)})}function Mu(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Yo(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),sa(n))}function Ol(n,e,t){for(const r of t)r instanceof Ru?(n.Vu.addReference(r.key,e),up(n,r)):r instanceof Su?(Z(ra,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Mu(n,r.key)):ae(19791,{wu:r})}function up(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(Z(ra,"New document in limbo: "+t),n.Eu.add(r),sa(n))}function sa(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new re(Ce.fromString(e)),r=n.fu.next();n.Au.set(r,new Z0(t)),n.Ru=n.Ru.insert(t,r),Eu(n.remoteStore,new dn($t(Kc(t.path)),r,"TargetPurposeLimboResolution",mi.ce))}}async function as(n,e,t){const r=ue(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((u,h)=>{a.push(r.pu(h,e,t).then(f=>{var m;if((f||t)&&r.isPrimaryClient){const g=f?!f.fromCache:(m=t==null?void 0:t.targetChanges.get(h.targetId))==null?void 0:m.current;r.sharedClientState.updateQueryState(h.targetId,g?"current":"not-current")}if(f){s.push(f);const g=Ko.Es(h.targetId,f);o.push(g)}}))}),await Promise.all(a),r.Pu.J_(s),await async function(h,f){const m=ue(h);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>D.forEach(f,E=>D.forEach(E.Ts,N=>m.persistence.referenceDelegate.addReference(g,E.targetId,N)).next(()=>D.forEach(E.Is,N=>m.persistence.referenceDelegate.removeReference(g,E.targetId,N)))))}catch(g){if(!gr(g))throw g;Z(Qo,"Failed to update sequence numbers: "+g)}for(const g of f){const E=g.targetId;if(!g.fromCache){const N=m.vs.get(E),j=N.snapshotVersion,L=N.withLastLimboFreeSnapshotVersion(j);m.vs=m.vs.insert(E,L)}}}(r.localStore,o))}async function dp(n,e){const t=ue(n);if(!t.currentUser.isEqual(e)){Z(ra,"User change. New user:",e.toKey());const r=await _u(t.localStore,e);t.currentUser=e,function(o,a){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new W(P.CANCELLED,a))})}),o.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await as(t,r.Ns)}}function hp(n,e){const t=ue(n),r=t.Au.get(e);if(r&&r.hu)return ge().add(r.key);{let s=ge();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function Lu(n){const e=ue(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Pu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ap.bind(null,e),e.Pu.J_=K0.bind(null,e.eventManager),e.Pu.yu=Q0.bind(null,e.eventManager),e}function fp(n){const e=ue(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=lp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cp.bind(null,e),e}class ci{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ki(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return f0(this.persistence,new u0,e.initialUser,this.serializer)}Cu(e){return new yu(Go.Vi,this.serializer)}Du(e){return new _0}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ci.provider={build:()=>new ci};class mp extends ci{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ve(this.persistence.referenceDelegate instanceof ai,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Qm(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?mt.withCacheSize(this.cacheSizeBytes):mt.DEFAULT;return new yu(r=>ai.Vi(r,t),this.serializer)}}class Ao{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ll(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=dp.bind(null,this.syncEngine),await q0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new W0}()}createDatastore(e){const t=ki(e.databaseInfo.databaseId),r=T0(e.databaseInfo);return R0(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,o,a,u){return new j0(r,s,o,a,u)}(this.localStore,this.datastore,e.asyncQueue,t=>Ll(this.syncEngine,t,0),function(){return Sl.v()?new Sl:new w0}())}createSyncEngine(e,t){return function(s,o,a,u,h,f,m){const g=new ep(s,o,a,u,h,f);return m&&(g.gu=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const o=ue(s);Z(Mn,"RemoteStore shutting down."),o.Ea.add(5),await os(o),o.Aa.shutdown(),o.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Ao.provider={build:()=>new Ao};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Jt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kn="FirestoreClient";class gp{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=nt.UNAUTHENTICATED,this.clientId=Do.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async a=>{Z(kn,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(Z(kn,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new pn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=ta(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Xi(n,e){n.asyncQueue.verifyOperationInProgress(),Z(kn,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await _u(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Fl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await xp(n);Z(kn,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Pl(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Pl(e.remoteStore,s)),n._onlineComponents=e}async function xp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Z(kn,"Using user provided OfflineComponentProvider");try{await Xi(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Dn("Error using user provided cache. Falling back to memory cache: "+t),await Xi(n,new ci)}}else Z(kn,"Using default OfflineComponentProvider"),await Xi(n,new mp(void 0));return n._offlineComponents}async function Ou(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Z(kn,"Using user provided OnlineComponentProvider"),await Fl(n,n._uninitializedComponentsProvider._online)):(Z(kn,"Using default OnlineComponentProvider"),await Fl(n,new Ao))),n._onlineComponents}function bp(n){return Ou(n).then(e=>e.syncEngine)}async function yp(n){const e=await Ou(n),t=e.eventManager;return t.onListen=tp.bind(null,e.syncEngine),t.onUnlisten=sp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=np.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=ip.bind(null,e.syncEngine),t}function _p(n,e,t={}){const r=new pn;return n.asyncQueue.enqueueAndForget(async()=>function(o,a,u,h,f){const m=new pp({next:E=>{m.Nu(),a.enqueueAndForget(()=>G0(o,g)),E.fromCache&&h.source==="server"?f.reject(new W(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(E)},error:E=>f.reject(E)}),g=new Y0(u,m,{includeMetadataChanges:!0,Ka:!0});return H0(o,g)}(await yp(n),n.asyncQueue,e,t,r)),r.promise}function wp(n,e){const t=new pn;return n.asyncQueue.enqueueAndForget(async()=>op(await bp(n),e,t)),t.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vp="ComponentProvider",Bl=new Map;function kp(n,e,t,r,s){return new Of(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Fu(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bu="firestore.googleapis.com",$l=!0;class Ul{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new W(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Bu,this.ssl=$l}else this.host=e.host,this.ssl=e.ssl??$l;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=bu;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Gm)throw new W(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}If("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Fu(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new W(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new W(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new W(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ii{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ul({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new W(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new W(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ul(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new gf;switch(r.type){case"firstParty":return new _f(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new W(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Bl.get(t);r&&(Z(vp,"Removing Datastore"),Bl.delete(t),r.terminate())}(this),Promise.resolve()}}function Ep(n,e,t,r={}){var f;n=ar(n,Ii);const s=jo(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(qd(`https://${u}`),Gd("Firestore",!0)),o.host!==Bu&&o.host!==u&&Dn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Ys(h,a)&&(n._setSettings(h),r.mockUserToken)){let m,g;if(typeof r.mockUserToken=="string")m=r.mockUserToken,g=nt.MOCK_USER;else{m=zd(r.mockUserToken,(f=n._app)==null?void 0:f.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new W(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new nt(E)}n._authCredentials=new xf(new Nc(m,g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Zt(this.firestore,e,this._query)}}class Ue{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ue(this.firestore,e,this._key)}toJSON(){return{type:Ue._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(rs(t,Ue._jsonSchema))return new Ue(e,r||null,new re(Ce.fromString(t.referencePath)))}}Ue._jsonSchemaVersion="firestore/documentReference/1.0",Ue._jsonSchema={type:Fe("string",Ue._jsonSchemaVersion),referencePath:Fe("string")};class gn extends Zt{constructor(e,t,r){super(e,t,Kc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ue(this.firestore,null,new re(e))}withConverter(e){return new gn(this.firestore,e,this._path)}}function Tp(n,e,...t){if(n=Pn(n),Rc("collection","path",e),n instanceof Ii){const r=Ce.fromString(e,...t);return nl(r),new gn(n,null,r)}{if(!(n instanceof Ue||n instanceof gn))throw new W(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ce.fromString(e,...t));return nl(r),new gn(n.firestore,null,r)}}function $u(n,e,...t){if(n=Pn(n),arguments.length===1&&(e=Do.newId()),Rc("doc","path",e),n instanceof Ii){const r=Ce.fromString(e,...t);return tl(r),new Ue(n,null,new re(r))}{if(!(n instanceof Ue||n instanceof gn))throw new W(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ce.fromString(e,...t));return tl(r),new Ue(n.firestore,n instanceof gn?n.converter:null,new re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ql="AsyncQueue";class zl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new vu(this,"async_queue_retry"),this._c=()=>{const r=Ji();r&&Z(ql,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Ji();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ji();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new pn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!gr(e))throw e;Z(ql,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Jt("INTERNAL UNHANDLED ERROR: ",Wl(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=ea.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(s),s}uc(){this.nc&&ae(47125,{Pc:Wl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Wl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Ai extends Ii{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new zl,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new zl(e),this._firestoreClient=void 0,await e}}}function Ip(n,e){const t=typeof n=="object"?n:rf(),r=typeof n=="string"?n:ei,s=Xh(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=$d("firestore");o&&Ep(s,...o)}return s}function Uu(n){if(n._terminated)throw new W(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Ap(n),n._firestoreClient}function Ap(n){var r,s,o,a;const e=n._freezeSettings(),t=kp(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,(s=n._app)==null?void 0:s.options.apiKey,e);n._componentsProvider||(o=e.localCache)!=null&&o._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new gp(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(h){const f=h==null?void 0:h._online.build();return{_offline:h==null?void 0:h._offline.build(f),_online:f}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vt(Ze.fromBase64String(e))}catch(t){throw new W(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new vt(Ze.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:vt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(rs(e,vt._jsonSchema))return vt.fromBase64String(e.bytes)}}vt._jsonSchemaVersion="firestore/bytes/1.0",vt._jsonSchema={type:Fe("string",vt._jsonSchemaVersion),bytes:Fe("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new W(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new W(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new W(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return pe(this._lat,e._lat)||pe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:zt._jsonSchemaVersion}}static fromJSON(e){if(rs(e,zt._jsonSchema))return new zt(e.latitude,e.longitude)}}zt._jsonSchemaVersion="firestore/geoPoint/1.0",zt._jsonSchema={type:Fe("string",zt._jsonSchemaVersion),latitude:Fe("number"),longitude:Fe("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ct._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(rs(e,Ct._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Ct(e.vectorValues);throw new W(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ct._jsonSchemaVersion="firestore/vectorValue/1.0",Ct._jsonSchema={type:Fe("string",Ct._jsonSchemaVersion),vectorValues:Fe("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cp=/^__.*__$/;class Np{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new $n(e,this.data,this.fieldMask,t,this.fieldTransforms):new ss(e,this.data,t,this.fieldTransforms)}}function Wu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ae(40011,{dataSource:n})}}class ia{constructor(e,t,r,s,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new ia({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return ui(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Wu(this.dataSource)&&Cp.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Rp{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ki(e)}createContext(e,t,r,s=!1){return new ia({dataSource:e,methodName:t,targetDoc:r,path:Xe.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function oa(n){const e=n._freezeSettings(),t=ki(n._databaseId);return new Rp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Sp(n,e,t,r,s,o={}){const a=n.createContext(o.merge||o.mergeFields?2:0,e,t,s);Qu("Data must be an object, but it was:",a,r);const u=Gu(r,a);let h,f;if(o.merge)h=new At(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){const m=[];for(const g of o.mergeFields){const E=Ci(e,g,t);if(!a.contains(E))throw new W(P.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Vp(m,E)||m.push(E)}h=new At(m),f=a.fieldTransforms.filter(g=>h.covers(g.field))}else h=null,f=a.fieldTransforms;return new Np(new wt(u),h,f)}function Hu(n,e,t,r=!1){return aa(t,n.createContext(r?4:3,e))}function aa(n,e){if(Ku(n=Pn(n)))return Qu("Unsupported field value:",e,n),Gu(n,e);if(n instanceof zu)return function(r,s){if(!Wu(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(r,s){const o=[];let a=0;for(const u of r){let h=aa(u,s.childContextForArray(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(n,e)}return function(r,s){if((r=Pn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return dm(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Re.fromDate(r);return{timestampValue:oi(s.serializer,o)}}if(r instanceof Re){const o=new Re(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:oi(s.serializer,o)}}if(r instanceof zt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof vt)return{bytesValue:uu(s.serializer,r._byteString)};if(r instanceof Ue){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Wo(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Ct)return function(a,u){const h=a instanceof Ct?a.toArray():a;return{mapValue:{fields:{[Fc]:{stringValue:Bc},[ti]:{arrayValue:{values:h.map(m=>{if(typeof m!="number")throw u.createError("VectorValues must only contain numeric values.");return $o(u.serializer,m)})}}}}}}(r,s);if(xu(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${fi(r)}`)}(n,e)}function Gu(n,e){const t={};return Pc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):On(n,(r,s)=>{const o=aa(s,e.childContextForField(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Ku(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Re||n instanceof zt||n instanceof vt||n instanceof Ue||n instanceof zu||n instanceof Ct||xu(n))}function Qu(n,e,t){if(!Ku(t)||!Sc(t)){const r=fi(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Ci(n,e,t){if((e=Pn(e))instanceof qu)return e._internalPath;if(typeof e=="string")return Pp(n,e);throw ui("Field path arguments must be of type string or ",n,!1,void 0,t)}const jp=new RegExp("[~\\*/\\[\\]]");function Pp(n,e,t){if(e.search(jp)>=0)throw ui(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qu(...e.split("."))._internalPath}catch{throw ui(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ui(n,e,t,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new W(P.INVALID_ARGUMENT,u+n+h)}function Vp(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{convertValue(e,t="none"){switch(wn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return De(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_n(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ae(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return On(e,(s,o)=>{r[s]=this.convertValue(o,t)}),r}convertVectorValue(e){var r,s,o;const t=(o=(s=(r=e.fields)==null?void 0:r[ti].arrayValue)==null?void 0:s.values)==null?void 0:o.map(a=>De(a.doubleValue));return new Ct(t)}convertGeoPoint(e){return new zt(De(e.latitude),De(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=xi(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Yr(e));default:return null}}convertTimestamp(e){const t=yn(e);return new Re(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ce.fromString(e);ve(gu(r),9688,{name:e});const s=new Jr(r.get(1),r.get(3)),o=new re(r.popFirst(5));return s.isEqual(t)||Jt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp extends Dp{constructor(e){super(),this.firestore=e}convertBytes(e){return new vt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}}const Hl="@firebase/firestore",Gl="4.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Lp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const t=this._document.data.field(Ci("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Lp extends la{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Op(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new W(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ca{}class Ni extends ca{}function Kl(n,e,...t){let r=[];e instanceof ca&&r.push(e),r=r.concat(t),function(o){const a=o.filter(h=>h instanceof da).length,u=o.filter(h=>h instanceof ua).length;if(a>1||a>0&&u>0)throw new W(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class ua extends Ni{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ua(e,t,r)}_apply(e){const t=this._parse(e);return Yu(e._query,t),new Zt(e.firestore,e.converter,bo(e._query,t))}_parse(e){const t=oa(e.firestore);return function(o,a,u,h,f,m,g){let E;if(f.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new W(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Xl(g,m);const j=[];for(const L of g)j.push(Jl(h,o,L));E={arrayValue:{values:j}}}else E=Jl(h,o,g)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Xl(g,m),E=Hu(u,a,g,m==="in"||m==="not-in");return Oe.create(f,m,E)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class da extends ca{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new da(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Nt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,o){let a=s;const u=o.getFlattenedFilters();for(const h of u)Yu(a,h),a=bo(a,h)}(e._query,t),new Zt(e.firestore,e.converter,bo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ha extends Ni{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ha(e,t)}_apply(e){const t=function(s,o,a){if(s.startAt!==null)throw new W(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new W(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Zr(o,a)}(e._query,this._field,this._direction);return new Zt(e.firestore,e.converter,nm(e._query,t))}}function Ql(n,e="asc"){const t=e,r=Ci("orderBy",n);return ha._create(r,t)}class fa extends Ni{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new fa(e,t,r)}_apply(e){return new Zt(e.firestore,e.converter,ri(e._query,this._limit,this._limitType))}}function Yl(n){return Af("limit",n),fa._create("limit",n,"F")}class ma extends Ni{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ma(e,t,r)}_apply(e){const t=Bp(e,this.type,this._docOrFields,this._inclusive);return new Zt(e.firestore,e.converter,rm(e._query,t))}}function Fp(...n){return ma._create("startAfter",n,!1)}function Bp(n,e,t,r){if(t[0]=Pn(t[0]),t[0]instanceof la)return function(o,a,u,h,f){if(!h)throw new W(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const g of tr(o))if(g.field.isKeyField())m.push(ni(a,h.key));else{const E=h.data.field(g.field);if(gi(E))throw new W(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(E===null){const N=g.field.canonicalString();throw new W(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${N}' (used as the orderBy) does not exist.`)}m.push(E)}return new ur(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=oa(n.firestore);return function(a,u,h,f,m,g){const E=a.explicitOrderBy;if(m.length>E.length)throw new W(P.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const N=[];for(let j=0;j<m.length;j++){const L=m[j];if(E[j].field.isKeyField()){if(typeof L!="string")throw new W(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof L}`);if(!Bo(a)&&L.indexOf("/")!==-1)throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${L}' contains a slash.`);const V=a.path.child(Ce.fromString(L));if(!re.isDocumentKey(V))throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const O=new re(V);N.push(ni(u,O))}else{const V=Hu(h,f,L);N.push(V)}}return new ur(N,g)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Jl(n,e,t){if(typeof(t=Pn(t))=="string"){if(t==="")throw new W(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bo(e)&&t.indexOf("/")!==-1)throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ce.fromString(t));if(!re.isDocumentKey(r))throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ni(n,new re(r))}if(t instanceof Ue)return ni(n,t._key);throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fi(t)}.`)}function Xl(n,e){if(!Array.isArray(n)||n.length===0)throw new W(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Yu(n,e){const t=function(s,o){for(const a of s)for(const u of a.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new W(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new W(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function $p(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class Vs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sr extends la{constructor(e,t,r,s,o,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ws(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ci("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new W(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=sr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}sr._jsonSchemaVersion="firestore/documentSnapshot/1.0",sr._jsonSchema={type:Fe("string",sr._jsonSchemaVersion),bundleSource:Fe("string","DocumentSnapshot"),bundleName:Fe("string"),bundle:Fe("string")};class Ws extends sr{data(e={}){return super.data(e)}}class ir{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Vs(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ws(this._firestore,this._userDataWriter,r.key,r,new Vs(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new W(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{const h=new Ws(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Vs(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{const h=new Ws(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Vs(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,m=-1;return u.type!==0&&(f=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),m=a.indexOf(u.doc.key)),{type:Up(u.type),doc:h,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new W(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ir._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Do.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Up(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ae(61501,{type:n})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ir._jsonSchemaVersion="firestore/querySnapshot/1.0",ir._jsonSchema={type:Fe("string",ir._jsonSchemaVersion),bundleSource:Fe("string","QuerySnapshot"),bundleName:Fe("string"),bundle:Fe("string")};function Ju(n){n=ar(n,Zt);const e=ar(n.firestore,Ai),t=Uu(e),r=new Mp(e);return Op(n._query),_p(t,n._query).then(s=>new ir(e,r,n,s))}function qp(n,e,t){n=ar(n,Ue);const r=ar(n.firestore,Ai),s=$p(n.converter,e),o=oa(r);return Xu(r,[Sp(o,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Ut.none())])}function zp(n){return Xu(ar(n.firestore,Ai),[new Uo(n._key,Ut.none())])}function Xu(n,e){const t=Uu(n);return wp(t,e)}(function(e,t=!0){pf(nf),Xs(new Gr("firestore",(r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new Ai(new bf(r.getProvider("auth-internal")),new wf(a,r.getProvider("app-check-internal")),Ff(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),er(Hl,Gl,e),er(Hl,Gl,"esm2020")})();var Wp="firebase",Hp="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */er(Wp,Hp,"app");const Gp={apiKey:"AIzaSyCXA8pqsLUjVKXr1ltz5gN7VaD-saqlF-g",authDomain:"box-elite.firebaseapp.com",projectId:"box-elite",storageBucket:"box-elite.firebasestorage.app",messagingSenderId:"133574833722",appId:"1:133574833722:web:310d172ecb6dc3a5bae703"},Kp=yc(Gp),pa=Ip(Kp);function Zu(n){return Tp(pa,"branches",n,"closedRows")}function Qp(n){return{id:n.id,employeeName:n.employeeName,cash:n.cash,sentToTreasury:n.sentToTreasury??0,expenseCompensation:n.expenseCompensation??0,expenses:n.expenses??0,carriedExpenseCount:n.carriedExpenseCount??0,expenseItems:n.expenseItems??[],mada:n.mada??0,visa:n.visa??0,mastercard:n.mastercard??0,bankTransfer:n.bankTransfer??0,programBalanceCash:n.programBalanceCash??0,programBalanceBank:n.programBalanceBank??0,variance:n.variance??0,status:"closed",notes:n.notes??"",closedAt:n.closedAt,createdAt:n.createdAt}}function ed(n){const e=Array.isArray(n.expenseItems)?n.expenseItems.filter(t=>typeof t.amount=="number"&&typeof t.description=="string"):[];return{id:String(n.id??""),employeeName:String(n.employeeName??""),cash:Number(n.cash??0),sentToTreasury:Number(n.sentToTreasury??0),expenseCompensation:Number(n.expenseCompensation??0),expenses:Number(n.expenses??0),carriedExpenseCount:Number(n.carriedExpenseCount??0),expenseItems:e,mada:Number(n.mada??0),visa:Number(n.visa??0),mastercard:Number(n.mastercard??0),bankTransfer:Number(n.bankTransfer??0),programBalanceCash:Number(n.programBalanceCash??0),programBalanceBank:Number(n.programBalanceBank??0),variance:Number(n.variance??0),status:"closed",notes:String(n.notes??""),closedAt:n.closedAt?String(n.closedAt):null,createdAt:String(n.createdAt??"")}}async function td(n,e){const t=$u(pa,"branches",n,"closedRows",e.id),r=Qp({...e,closedAt:e.closedAt??new Date().toISOString()});await qp(t,r)}async function nd(n,e=500){const t=Zu(n);return(await Ju(t)).docs.map(o=>ed(o.data())).sort((o,a)=>new Date((a.closedAt??"").toString()).getTime()-new Date((o.closedAt??"").toString()).getTime()).slice(0,e)}async function Hs(n,e,t){const r=Zu(n),s=t?Kl(r,Ql("closedAt","desc"),Yl(e+1),Fp(t)):Kl(r,Ql("closedAt","desc"),Yl(e+1)),a=(await Ju(s)).docs,u=a.length>e,h=u?a.slice(0,e):a,f=h.map(g=>ed(g.data())),m=h.length>0?h[h.length-1]:null;return{rows:f,lastDoc:m,hasMore:u}}async function rd(n,e){await zp($u(pa,"branches",n,"closedRows",e))}const Yp=Object.freeze(Object.defineProperty({__proto__:null,addClosedRowToFirebase:td,deleteClosedRowFromFirebase:rd,getClosedRowsFromFirebase:nd,getClosedRowsPaginated:Hs},Symbol.toStringTag,{value:"Module"}));function sd(n){return`cashbox_rows_${n}`}function Jp(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function Xp(n){const e=n,t=Array.isArray(e.expenseItems)?e.expenseItems.filter(r=>typeof r.amount=="number"&&typeof r.description=="string"):[];return{...n,sentToTreasury:typeof e.sentToTreasury=="number"?e.sentToTreasury:0,expenseCompensation:typeof e.expenseCompensation=="number"?e.expenseCompensation:0,expenses:typeof n.expenses=="number"?n.expenses:0,carriedExpenseCount:typeof e.carriedExpenseCount=="number"&&e.carriedExpenseCount>=0?e.carriedExpenseCount:0,expenseItems:t,mastercard:typeof n.mastercard=="number"?n.mastercard:0,programBalanceCash:typeof n.programBalanceCash=="number"?n.programBalanceCash:0,programBalanceBank:typeof n.programBalanceBank=="number"?n.programBalanceBank:0}}function br(n){try{const e=sd(n);let t=localStorage.getItem(e);if(!t&&n==="corniche"){const s=localStorage.getItem("cashbox_rows");s&&(localStorage.setItem(e,s),localStorage.removeItem("cashbox_rows"),t=s)}return t?JSON.parse(t).filter(s=>s.status!=="closed").map(Xp):[]}catch{return[]}}function Ri(n,e){try{localStorage.setItem(sd(n),JSON.stringify(e.filter(t=>t.status!=="closed")))}catch{}}function Ds(n){return br(n).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}function Zp(n,e){return br(n).find(r=>r.id===e)??null}function id(n,e,t){const r=br(n),s=new Date().toISOString(),o=(t==null?void 0:t.expenses)??0,a=(t==null?void 0:t.expenseItems)??[],u=(t==null?void 0:t.carriedExpenseCount)??0;r.push({id:Jp(),employeeName:e,cash:0,sentToTreasury:0,expenseCompensation:0,expenses:o,carriedExpenseCount:u,expenseItems:a,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0,status:"active",notes:"",closedAt:null,createdAt:s}),Ri(n,r)}function Ft(n,e,t){const r=br(n),s=r.findIndex(o=>o.id===e);s!==-1&&(r[s]={...r[s],...t},Ri(n,r))}async function eg(n,e,t){const r=new Date().toISOString(),s={...t,status:"closed",closedAt:r};await td(n,s);const o=br(n).filter(a=>a.id!==e);Ri(n,o)}async function tg(n,e,t){if(t)await rd(n,e);else{const r=br(n).filter(s=>s.id!==e);Ri(n,r)}}async function ng(n){const{getClosedRowsFromFirebase:e,deleteClosedRowFromFirebase:t}=await Rd(async()=>{const{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}=await Promise.resolve().then(()=>Yp);return{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}},void 0),r=await e(n);await Promise.all(r.map(s=>t(n,s.id)))}const rg="٠١٢٣٤٥٦٧٨٩",sg="0123456789";function od(n){let e="";for(let t=0;t<n.length;t++){const r=rg.indexOf(n[t]);e+=r>=0?sg[r]:n[t]}return e}function ig(n){return n.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a/g,"").replace(/\u202b/g,"").replace(/\u202c/g,"").replace(/[\u0640\u066a]/g,"").replace(/\/\s*/g,"/").trim()}function og(n){const e=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2})\s*([صم])/);if(!e)return null;const t=parseInt(e[2],10)-1,r=parseInt(e[3],10),s=parseInt(e[1],10);let o=parseInt(e[4],10);const a=parseInt(e[5],10),u=e[6];u==="م"&&o!==12&&(o+=12),u==="ص"&&o===12&&(o=0);const h=new Date(r,t,s,o,a,0,0);return isNaN(h.getTime())?null:h}function ag(n){let e=n.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(e){let t=parseInt(e[1],10);const r=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),a=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(o,a,u,t,r,0,0);return isNaN(h.getTime())?null:h}if(e=n.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{1,2})\/(\d{1,2})\/(\d{4})/),e){let t=parseInt(e[1],10);const r=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),a=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(u,a,o,t,r,0,0);return isNaN(h.getTime())?null:h}return null}function Zl(n){const e=ig((n||"").toString());if(!e)return null;const t=od(e);return ag(t)??og(t)}const lg=32874,cg=52100;function ug(n){if(n instanceof Date)return isNaN(n.getTime())?null:n;if(typeof n=="number"&&Number.isFinite(n)){if(n<lg||n>cg)return null;const t=(n-25569)*86400*1e3,r=new Date(t);return isNaN(r.getTime())?null:r}return null}const dg="٫";function Co(n){let e=(n||"").toString().trim();e=e.replace(/\s*SAR\s*/gi," ").replace(/\s*ر\.?\s*س\.?\s*/g," ").replace(/\s*ريال\s*(سعودي)?\s*/gi," ").trim();let r=od(e).replace(dg,".").replace(/[^\d.,\-]/g,"");if(!r)return 0;if(/^-?\d+,\d{1,3}$/.test(r)?r=r.replace(",","."):r=r.replace(/,/g,""),r.includes(".")){const a=r.split("."),u=a[a.length-1];u&&u.length===3&&/^\d+$/.test(u)&&(r=r.replace(/\./g,""))}const o=parseFloat(r);return Number.isFinite(o)?o:0}const ad={مدى:"mada",فيزا:"visa","ماستر كارد":"mastercard",ماستركارد:"mastercard","تحويل بنكي":"bankTransfer",تحويل:"bankTransfer"},hg=["شيك","أمريكان إكسبريس","امريكان اكسبريس","نقداً","نقدا","كاش"];function ld(n){const e=n.replace(/\s+/g," ").trim();return hg.some(t=>e===t||e.includes(t))}function fg(n,e,t){const r={...Fr},s={...Br},o={mada:[],visa:[],mastercard:[],bankTransfer:[]},a=Math.min(n.length,500);for(let u=t;u<a;u++){const h=n[u];if(!h||!Array.isArray(h))continue;const f=Math.min(Math.max(h.length,4),120);let m=null,g=-1;for(let j=0;j<f;j++){const L=e?ns(e,h,u,j):(h[j]??"").toString().trim(),V=qn(L);if(!V||ld(V))continue;const O=ad[V]??(V.includes("مدى")?"mada":null);if(O&&O!=="cash"){m=O,g=j;break}}if(m==null||m==="cash")continue;let E=0;for(let j=0;j<f;j++){if(j===g)continue;const L=e?ns(e,h,u,j):(h[j]??"").toString().trim(),V=Co(L);if(V>0&&V<=cd){E=V;break}}if(E<=0)continue;const N=(h[g]??"").toString().trim();N.includes("إجمالي")||N.includes("مجموع")||N.includes("المجموع")||(r[m]+=E,s[m]+=1,o[m].push({date:new Date(0),amount:E,employeeName:void 0,purpose:void 0}))}return{sums:r,counts:s,details:o}}const Fr={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},Br={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},Zi={mada:[],visa:[],mastercard:[],bankTransfer:[]};function qn(n){let e=(n??"").toString();return e=e.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a|\u202b|\u202c/g,"").replace(/\u200b|\u200c|\u200d|\ufeff/g,"").replace(/\s+/g," "),e=e.replace(/SAR/gi,"").replace(/ر\.?\s*س\.?/g,"").replace(/ريال\s*(سعودي)?/g,""),e.trim()}function ns(n,e,t,r){const s=un.encode_cell({r:t,c:r}),o=n[s];if(o!=null){if(typeof o.w=="string"&&o.w.trim())return o.w.trim();if(typeof o.v=="number"&&!Number.isNaN(o.v))return String(o.v);if(typeof o.v=="string")return o.v.trim()}return(e[r]??"").toString().trim()}function ga(n){const e=qn(n);return e.includes("طريقةالدفع")||e.includes("طريقة الدفع")||e.includes("الدفع")&&e.length<30||e.includes("طريقة")&&(e.includes("دفع")||e.includes("الدفع"))}function xa(n){const e=qn(n);return e.includes("المبلغ")||e.includes("قيمةالسند")||e.includes("قيمة السند")||e.includes("المقبوضات")||e.includes("مقبوضات")||e.includes("قبوضات")||e.includes("المصروفات")||e.includes("مصروفات")||e.includes("الصافي")||e.includes("صافي")||e.includes("مبلغ")||e.includes("قيمة")&&!e.includes("رقم")&&e.length<35}function Ms(n){const e=new Map;for(const s of Object.keys(n)){if(s.startsWith("!"))continue;const o=un.decode_cell(s);if(o==null||typeof o.r!="number")continue;const a=o.r,u=o.c,h=n[s],f=h&&typeof h.w=="string"&&h.w.trim()||h&&typeof h.v=="string"&&h.v.trim()||(h&&typeof h.v=="number"&&!Number.isNaN(h.v)?String(h.v):"");e.has(a)||e.set(a,new Map),e.get(a).set(u,f)}const t=e.size===0?0:Math.max(...e.keys()),r=[];for(let s=0;s<=t;s++){const o=e.get(s),a=o?Math.max(...o.keys()):0,u=[];for(let h=0;h<=a;h++)u.push((o==null?void 0:o.get(h))??"");r.push(u)}return r}function mg(n){const e=new Map;for(const r of Object.keys(n)){if(r.startsWith("!"))continue;const s=un.decode_cell(r);if(s==null||typeof s.r!="number")continue;const o=s.r,a=s.c,u=n[r],h=u&&typeof u.w=="string"&&u.w.trim()||u&&typeof u.v=="string"&&u.v.trim()||(u&&typeof u.v=="number"&&!Number.isNaN(u.v)?String(u.v):"");if(!h)continue;e.has(o)||e.set(o,[]);const f=e.get(o);for(;f.length<=a;)f.push("");f[a]=h}const t=Array.from(e.keys()).sort((r,s)=>r-s);for(const r of t){const s=e.get(r)||[];let o=!1,a=!1;for(const u of s){const h=qn(u);h&&(xa(h)&&(o=!0),ga(h)&&(a=!0))}if(o&&a)return r}return-1}const pg=["مدى","فيزا","ماستر كارد","ماستركارد","تحويل بنكي","تحويل","نقداً","نقدا","شيك","أمريكان إكسبريس"];function gg(n){const e=qn(n);return!e||e.length>50?!1:pg.some(t=>e===t||e.includes(t))}function xg(n,e){const t=Math.min(n.length,200);for(let r=1;r<t;r++){const s=n[r];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);for(let a=0;a<o;a++){const u=e?ns(e,s,r,a):(s[a]??"").toString().trim();if(gg(u))return r-1}}return-1}function ec(n,e){const t=Math.min(n.length,200);for(let r=0;r<t;r++){const s=n[r];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);let a=!1,u=!1;for(let h=0;h<o;h++){const f=e?ns(e,s,r,h):(s[h]??"").toString().trim(),m=qn(f);m&&(xa(m)&&(a=!0),ga(m)&&(u=!0))}if(a&&u)return r}return-1}const bg=["الموظف","اسم الموظف","الاسم","اسم","المستخدم","اسم المستخدم","الموظف المسؤول","المسؤول","كاشير","الكاشير","المحاسب","اسم المحاسب"];function yg(n){const e=n.replace(/\s+/g," ").replace(/\u200e|\u200f/g,"").trim();return e?e.includes("موظف")||e.includes("كاشير")||e.includes("محاسب")?!0:bg.some(t=>e===t||e.includes(t)):!1}const _g=["الغرض","الوصف","البيان","الغرض من العملية","تفاصيل","ملاحظات","وصف العملية"];function wg(n){const e=n.replace(/\s+/g," ").trim();return e?_g.some(t=>e.includes(t)):!1}function vg(n){let e=-1,t=-1,r=-1,s=-1,o=-1,a=-1;const u=Math.min(Math.max((n==null?void 0:n.length)??0,10),120);let h=-1;for(let f=0;f<u;f++){const m=n[f],g=qn(m);(g.includes("الوقت")||g.includes("التاريخ"))&&e<0&&(e=f),t<0&&ga(g)&&(t=f),(g.includes("الإتجاه")||g.includes("الاتجاه"))&&s<0&&(s=f),o<0&&yg(g)&&(o=f),a<0&&wg(g)&&(a=f),xa(g)&&((g.includes("المقبوضات")||g.includes("مقبوضات")||g.includes("قبوضات"))&&(h=f),r<0&&(r=f)),g.includes("رقم السند")&&g.includes("قيمة السند")}return h>=0&&(r=h),t>=0&&r>=0?{date:e,method:t,amount:r,direction:s,employeeName:o,purpose:a}:null}function kg(n){const e=(n??"").toString().trim();return typeof n=="string"||typeof n=="number"&&n<3e4?e?Zl(e):null:ug(n)??(e?Zl(e):null)}const cd=999999;function Eg(n,e){try{const t=xd(n,{type:"array"}),r=t.SheetNames||[];if(r.length===0)return{sums:Fr,counts:Br,details:Zi,employeeName:null,employeeNamesList:[],error:"الملف لا يحتوي على أي sheet"};let s=[],o={},a="",u=-1;for(let H=0;H<r.length;H++)if(a=r[H],o=t.Sheets[a],s=un.sheet_to_json(o,{header:1,defval:""}),u=ec(s,o),u<0&&(s=Ms(o),u=ec(s,o)),u<0&&(u=mg(o)),u>=0){s.length<=u&&(s=Ms(o));break}if(u>=0&&s.length<=u&&(s=Ms(o)),u<0&&(u=xg(s,o)),u>=0&&s.length<=u&&(s=Ms(o)),u<0)return{sums:Fr,counts:Br,details:Zi,employeeName:null,employeeNamesList:[],error:"لم يُعثر على صف العناوين (طريقة الدفع، المبلغ أو المقبوضات)"};const h=s[u],f=[];for(let H=0;H<Math.max((h==null?void 0:h.length)??0,80);H++)f.push(ns(o,h,u,H)||h[H]);let m=vg(f);if(!m){const H=fg(s,o,u+1);return{sums:H.sums,counts:H.counts,details:H.details,employeeName:null,employeeNamesList:[],error:null}}const E={...Fr},N={...Br},j={mada:[],visa:[],mastercard:[],bankTransfer:[]},L=new Set,V=e.getTime();for(let H=u+1;H<s.length;H++){const J=s[H],z=(J[m.method]??"").toString().trim();if(!z||ld(z))continue;const ne=m.date>=0?J[m.date]:void 0,v=m.date>=0?kg(ne):null;if(m.date>=0&&(!v||v.getTime()<V))continue;const x=v??new Date(0),w=(m.direction>=0?(J[m.direction]??"").toString().trim():"").replace(/\u200e/g,"").replace(/\u200f/g,"").trim();if(m.direction>=0&&w!=="داخل")continue;const k=J[m.amount];if(m.employeeName>=0){const oe=un.encode_cell({r:H,c:m.employeeName}),de=o[oe],fe=(de&&typeof de.w=="string"?de.w.trim():"")||(J[m.employeeName]??"").toString().trim();fe&&L.add(fe)}const T=un.encode_cell({r:H,c:m.amount}),y=o[T],F=y&&typeof y.w=="string"?y.w.trim():"";let ee;if(F)ee=Co(F);else if(typeof k=="number"&&Number.isFinite(k))ee=k;else{const oe=(k??"").toString().trim();ee=Co(oe)}if(ee<=0||ee>cd)continue;const B=z.replace(/\s+/g," ").trim();if(B.includes("إجمالي")||B.includes("مجموع")||B.includes("المجموع"))continue;const te=ad[z]??(z.toLowerCase().includes("مدى")?"mada":null);if(te&&(E[te]+=ee,N[te]+=1,te!=="cash")){const oe=m.employeeName>=0?(()=>{const me=un.encode_cell({r:H,c:m.employeeName}),fe=o[me];return(fe&&typeof fe.w=="string"?fe.w.trim():"")||(J[m.employeeName]??"").toString().trim()||void 0})():void 0;let de;if(m.purpose>=0){const me=un.encode_cell({r:H,c:m.purpose}),fe=o[me];de=(fe&&typeof fe.w=="string"?fe.w.trim():"")||(J[m.purpose]??"").toString().trim()||void 0}j[te].push({date:x,amount:ee,employeeName:oe,purpose:de})}}const O=[...L],$=L.size===0?null:L.size===1?O[0]:"أكثر من موظف";return{sums:E,counts:N,details:j,employeeName:$,employeeNamesList:O,error:null}}catch(t){const r=t instanceof Error?t.message:String(t);return{sums:Fr,counts:Br,details:Zi,employeeName:null,employeeNamesList:[],error:`خطأ في قراءة الملف: ${r}`}}}function Tg(n){const e=n.getHours();return e>=5&&e<12?{label:"صباح الخير",kind:"morning"}:e>=12&&e<17?{label:"مساء الخير",kind:"noon"}:e>=17&&e<21?{label:"أمسية سعيدة",kind:"evening"}:{label:"ليلة سعيدة",kind:"night"}}function Gs(n){const e=n.mada+n.visa+n.mastercard;return Math.round((e-n.programBalanceBank)*100)/100}function Ks(n){const e=n.cash??0,t=n.sentToTreasury??0,r=n.expenses??0,s=n.expenseCompensation??0,o=Math.max(0,r-s),a=e+t+o;return Math.round((a-n.programBalanceCash)*100)/100}function Ls(n){const e=n.cash+n.mada+n.visa+n.mastercard,t=n.programBalanceCash+n.programBalanceBank;return Math.round((e-t)*100)/100}function di(n){const e=typeof n=="string"?new Date(n):n,t={calendar:"gregory",numberingSystem:"latn"},r=e.toLocaleDateString("ar-SA",{...t,weekday:"long"}),s=e.getDate(),o=e.toLocaleDateString("ar-SA",{...t,month:"long"}),a=e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",numberingSystem:"latn"});return`${r} ${s} ${o} ${a}`}const Ig="٠١٢٣٤٥٦٧٨٩",Ag="0123456789";function Ln(n){if(typeof n!="string")return String(n);let e="";for(let t=0;t<n.length;t++){const r=Ig.indexOf(n[t]);e+=r>=0?Ag[r]:n[t]}return e}function G(n){return new Intl.NumberFormat("ar-SA",{minimumFractionDigits:0,maximumFractionDigits:2,numberingSystem:"latn"}).format(n)}function Cg(n){const e=new Date(n),t=new Date;return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Ng(n){const e=new Date(n),t=new Date;return t.setDate(t.getDate()-1),e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Rg(n){const e=new Date(n),t=new Date,r=new Date(t);return r.setDate(r.getDate()-7),e>=r&&e<=t}function tc(n,e){return e==="today"?n.filter(t=>t.closedAt&&Cg(t.closedAt)):e==="yesterday"?n.filter(t=>t.closedAt&&Ng(t.closedAt)):e==="lastWeek"?n.filter(t=>t.closedAt&&Rg(t.closedAt)):n}const nc=["cash","sentToTreasury","expenseCompensation","expenses","programBalanceCash","mada","visa","mastercard","bankTransfer","programBalanceBank"],ba="border-stone-200 dark:border-teal-500/20",rc=`border-t-2 border-b-2 border-r-2 ${ba} rounded-s-xl`,Vr=`border-t-2 border-b-2 ${ba}`,sc=`border-t-2 border-b-2 border-l-2 ${ba} rounded-e-xl`;function Sg({row:n,rowNumber:e,rowIndex:t=0,isFirstActive:r,liveNow:s,closingRowId:o,closingSecondsLeft:a,onUpdate:u,isSelected:h=!1,onToggleSelect:f,onDeleteRow:m,onPrintRow:g,onOpenExpenseDetails:E,onClearExpensesAndOpen:N,onLockedFieldClick:j,onExpenseCompensationExceeded:L,lastExcelDetails:V,onShowExcelDetails:O,onRequestConfirmBankEdit:$,onShowEmployeeNames:H,onShowVarianceExplanation:J,currentUserName:z,onClearRow:ne,isStickyRows:v=!1}){const x=r&&z?z:n.employeeName,b=I.useMemo(()=>Gs(n),[n.mada,n.visa,n.mastercard,n.bankTransfer,n.programBalanceBank]),w=I.useMemo(()=>Ks(n),[n.cash,n.sentToTreasury,n.programBalanceCash,n.expenses,n.expenseCompensation]),k=I.useMemo(()=>{const X=n.carriedExpenseCount??0;return(n.expenseItems??[]).slice(0,X).reduce((Se,ke)=>Se+ke.amount,0)},[n.carriedExpenseCount,n.expenseItems]),T=n.status==="closed",y=o===n.id,F=I.useCallback((X,bt)=>{const Se=Ln(bt);let ke=parseFloat(Se)||0;X==="expenses"&&k>0&&ke<k&&(ke=k);const pt=n.expenses??0;X==="expenseCompensation"&&ke>pt&&(L==null||L(pt),ke=pt),u(n.id,X,ke)},[n.id,n.expenses,u,k,L]),ee=I.useCallback(X=>{if(X.key==="Enter"||X.key==="Tab"){const bt=X.currentTarget.closest("tr");if(!bt)return;const Se=Array.from(bt.querySelectorAll("input:not([disabled])")),ke=Se.indexOf(X.currentTarget),pt=X.key==="Tab"&&X.shiftKey,gt=X.key==="Enter"||X.key==="Tab"&&!X.shiftKey;pt&&ke>0?(X.preventDefault(),Se[ke-1].focus()):gt&&ke>=0&&ke<Se.length-1&&(X.preventDefault(),Se[ke+1].focus())}},[]),B=w>0?"text-emerald-700 dark:text-emerald-400":w<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",te=b>0?"text-emerald-700 dark:text-emerald-400":b<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",oe=n.programBalanceCash>0,de=["programBalanceCash","expenses"],[me,fe]=I.useState(!1),[_e,st]=I.useState(null),[ye,ze]=I.useState(null),et=I.useCallback(X=>{j==null||j(),fe(!0),st(X)},[j]);I.useEffect(()=>{if(!me)return;const X=setTimeout(()=>fe(!1),3e3);return()=>clearTimeout(X)},[me]),I.useEffect(()=>{if(_e===null)return;const X=setTimeout(()=>st(null),1200);return()=>clearTimeout(X)},[_e]);const it=(X,bt)=>{var Ht;const Se=n[X]??0,ke=(X==="mada"||X==="visa"||X==="mastercard"||X==="bankTransfer")&&((Ht=V==null?void 0:V[X])==null?void 0:Ht.length)>0&&O;if(T||y)return X==="expenses"&&E?l.jsx("button",{type:"button",onClick:()=>E(n.id),className:"block w-full py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center hover:text-stone-900 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/[0.06] rounded-xl transition cursor-pointer",title:"عرض تفاصيل المصروفات",children:Se===0?"—":G(Se)}):ke&&O?l.jsxs("div",{className:"flex items-center gap-1 w-full",children:[l.jsx("span",{className:"flex-1 min-w-0 py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center tabular-nums",children:Se===0?"—":G(Se)}),l.jsx("button",{type:"button",onClick:()=>O(X,n.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-stone-800 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 8v4l2 2"}),l.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):l.jsx("span",{className:"block py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center",children:Se===0?"—":G(Se)});const pt=X==="expenses",gt=!de.includes(X)&&!oe,Me=X==="programBalanceCash"&&r?0:gt?-1:1,Pe=ke&&$&&["mada","visa","mastercard","bankTransfer"].includes(X),Rt=Pe&&(ye==null?void 0:ye.field)===X?ye.value===0?"":String(ye.value):Se===0?"":String(Se),En=l.jsx("input",{type:"text",inputMode:"decimal",value:Rt,onChange:He=>{const ut=Ln(He.target.value).replace(/[^\d.]/g,""),Tt=ut.indexOf("."),Gt=Tt===-1?ut:ut.slice(0,Tt+1)+ut.slice(Tt+1).replace(/\./g,""),Qe=parseFloat(Gt)||0;Pe?ze({field:X,value:Qe}):F(X,Gt)},onBlur:()=>{if(Pe&&(ye==null?void 0:ye.field)===X){const He=ye.value;ze(null),He!==Se&&$(n.id,X,Se,He)}},dir:"ltr","aria-label":X,onKeyDown:ee,onFocus:He=>{He.currentTarget.select(),pt&&E&&E(n.id)},placeholder:"—",tabIndex:Me,disabled:gt,title:gt?"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش":X==="expenseCompensation"?"يجب أن يكون مساوياً أو أقل من مبلغ المصروفات":void 0,className:"cashbox-input w-full min-h-[2.25rem] px-2 py-2 rounded-xl bg-white dark:bg-slate-900/70 border-2 border-stone-400 dark:border-white/[0.06] text-stone-900 dark:text-white text-sm font-cairo text-center focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 dark:focus:border-teal-500/40 dark:focus:ring-teal-500/20 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm"});return gt&&j?l.jsx("div",{role:"button",tabIndex:0,className:"locked-field-wrapper w-full cursor-not-allowed rounded-lg",onClick:He=>{He.preventDefault(),He.stopPropagation(),et(X)},onKeyDown:He=>{(He.key==="Enter"||He.key===" ")&&(He.preventDefault(),et(X))},title:"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش",children:En}):ke&&O?l.jsxs("div",{className:"flex items-center gap-1 w-full",children:[l.jsx("div",{className:"flex-1 min-w-0",children:En}),l.jsx("button",{type:"button",onClick:()=>O(X,n.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-stone-800 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 8v4l2 2"}),l.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):En},Ne=y&&a>0?a<=1?"0.35s":a<=2?"0.6s":a<=3?"1s":"1.5s":void 0,kt=T&&n.closedAt?di(n.closedAt):di(s),Et=v?"sticky top-[6.5rem] sm:top-[7rem] z-[9] bg-[#ebe6df]/98 dark:bg-slate-800/98 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b-2 border-stone-500 dark:border-teal-500/20":"",We=v?"sticky top-[8.75rem] sm:top-[9.25rem] z-[9] bg-white dark:bg-slate-800/95 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b-2 border-stone-500 dark:border-teal-500/20":"",ct=y?"bg-sky-100 dark:bg-sky-500/10":T?t%2===0?"bg-[#f2ede5] dark:bg-slate-800/40":"bg-[#ebe6df] dark:bg-slate-800/25":t%2===0?"bg-[#f8f4ee] dark:bg-slate-800/30 hover:bg-[#f2ede5] dark:hover:bg-slate-800/40":"bg-[#f2ede5] dark:bg-slate-800/20 hover:bg-[#ebe6df] dark:hover:bg-slate-800/35";return l.jsxs(l.Fragment,{children:[l.jsx("tr",{"data-row-id":n.id,className:`bg-transparent border-l-4 border-l-teal-500 dark:border-l-teal-500/40 border-b-2 border-stone-500 dark:border-teal-500/20 ${v?"sticky-label-row":""}`,children:l.jsx("td",{colSpan:16,className:`py-1 px-2 sm:px-3 align-middle text-[10px] sm:text-[11px] font-semibold font-cairo whitespace-nowrap ${Et}`,style:{lineHeight:1.2,verticalAlign:"middle",paddingInlineStart:"4%"},children:l.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap rounded-lg border-2 border-stone-400 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 px-2.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(20,184,166,0.08)]",children:[x==="أكثر من موظف"&&H?l.jsx("button",{type:"button",onClick:H,className:"text-stone-800 dark:text-teal-400 hover:text-stone-900 dark:hover:text-teal-300 underline underline-offset-1 cursor-pointer transition-colors font-semibold",title:"عرض أسماء الموظفين",children:"أكثر من موظف"}):l.jsx("span",{className:"font-semibold text-stone-900 dark:text-teal-300",children:x}),l.jsx("span",{className:"text-stone-500 dark:text-slate-400",children:"·"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-600 dark:text-slate-400",children:kt})]})})}),l.jsxs("tr",{"data-row-id":n.id,className:`bg-transparent ${y?"animate-pulse border-l-2 border-r-2 border-l-sky-400/50 border-r-sky-400/50 border-b-2 border-stone-500 dark:border-teal-500/20":"border-b-2 border-stone-500 dark:border-slate-600 transition-colors"} ${v?"sticky-data-row":""}`,style:Ne?{animationDuration:Ne}:void 0,children:[l.jsx("td",{className:`p-1 text-center align-middle bg-transparent ${We}`,children:f&&l.jsx("div",{className:"flex items-center justify-center",children:l.jsx("button",{type:"button",onClick:()=>f(n.id),"aria-label":h?"إلغاء تحديد الصف":"تحديد الصف للطباعة",className:`inline-flex items-center justify-center w-4 h-4 rounded-md border-2 transition-all ${h?"border-teal-500 bg-teal-100 text-teal-600 ring-2 ring-teal-500/30 ring-offset-2 ring-offset-stone-50 dark:border-teal-500/60 dark:bg-teal-500/20 dark:text-teal-400 dark:ring-teal-500/30 dark:ring-offset-slate-800":"border-2 border-stone-500 dark:border-white/20 bg-stone-300 dark:bg-slate-800/60 text-stone-800 dark:text-slate-400 hover:border-teal-400 dark:hover:border-teal-500/40 hover:text-teal-600 dark:hover:text-teal-400/90 shadow-sm"}`,children:h?l.jsx("svg",{className:"w-2 h-2 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M20 6L9 17l-5-5"})}):l.jsx("span",{className:"w-2 h-2 block shrink-0"})})})}),l.jsx("td",{className:`p-1 text-center text-stone-800 dark:text-slate-400 text-xs font-medium font-cairo align-middle tabular-nums bg-transparent ${We}`,children:e}),nc.slice(0,4).map(X=>l.jsx("td",{"data-transfer-target":!0,"data-field":X,"data-row-id":n.id,className:`p-1.5 text-center align-middle ${ct} ${_e===X?"locked-cell-pulse":""} ${We} ${X==="cash"?rc:Vr}`,children:it(X)},X)),l.jsx("td",{"data-transfer-target":!0,"data-field":"programBalanceCash","data-row-id":n.id,className:`p-1.5 text-center align-middle ${ct} ${me&&r?"program-balance-pulse-cell":""} ${We} ${Vr}`,title:!oe&&r?"لا يمكن الإدخال في الخانات الأخرى قبل إدخال رصيد البرنامج كاش هنا":void 0,children:it("programBalanceCash")}),l.jsx("td",{className:`p-1.5 text-center align-middle ${ct} ${We} ${sc}`,children:J?l.jsx("button",{type:"button",onClick:()=>J("cash",n),className:`block w-full min-h-[2.25rem] py-2 px-2 rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums transition cursor-pointer hover:bg-stone-50 dark:hover:bg-white/[0.06] focus:outline-none focus:ring-2 focus:ring-teal-500/20 ${w===0?"cursor-default text-stone-500 dark:text-slate-500":`${B}`}`,title:w===0?void 0:"شرح سبب انحراف الكاش",disabled:w===0,children:w===0?"—":G(w)}):l.jsx("span",{className:`block w-full min-h-[2.25rem] py-2 px-2 rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums ${w===0?"text-stone-500 dark:text-slate-500":B}`,children:w===0?"—":G(w)})}),nc.slice(5,9).map(X=>l.jsx("td",{"data-transfer-target":!0,"data-field":X,"data-row-id":n.id,className:`p-1.5 text-center align-middle ${ct} ${_e===X?"locked-cell-pulse":""} ${We} ${X==="mada"?rc:Vr}`,children:it(X)},X)),l.jsx("td",{className:`p-1.5 text-center align-middle ${ct} ${We} ${Vr}`,children:l.jsx("span",{className:"block w-full min-h-[2.25rem] py-2 px-2 rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums text-stone-800 dark:text-slate-200 font-medium",children:(()=>{const X=n.mada+n.visa+n.mastercard;return X===0?"—":G(X)})()})}),l.jsx("td",{"data-transfer-target":!0,"data-field":"programBalanceBank","data-row-id":n.id,className:`p-1.5 text-center align-middle ${ct} ${_e==="programBalanceBank"?"locked-cell-pulse":""} ${We} ${Vr}`,children:it("programBalanceBank")}),l.jsx("td",{className:`p-1.5 text-center align-middle ${ct} ${We} ${sc}`,children:J?l.jsx("button",{type:"button",onClick:()=>J("bank",n),className:`block w-full min-h-[2.25rem] py-2 px-2 rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums transition cursor-pointer hover:bg-stone-50 dark:hover:bg-white/[0.06] focus:outline-none focus:ring-2 focus:ring-teal-500/20 ${b===0?"cursor-default text-stone-500 dark:text-slate-500":`${te}`}`,title:b===0?void 0:"شرح سبب انحراف البنك",disabled:b===0,children:b===0?"—":G(b)}):l.jsx("span",{className:`block w-full min-h-[2.25rem] py-2 px-2 rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums ${b===0?"text-stone-500 dark:text-slate-500":te}`,children:b===0?"—":G(b)})}),l.jsx("td",{className:`px-0.5 py-0.5 text-center align-middle overflow-hidden min-w-0 bg-transparent ${We}`,children:T?l.jsxs("div",{className:"flex flex-row items-center justify-center gap-0.5 flex-wrap min-w-0 w-full",children:[l.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded-full px-1 py-0.5 bg-emerald-100 dark:bg-emerald-500/15 border border-emerald-300 dark:border-emerald-500/25 text-[8px] font-medium text-emerald-700 dark:text-emerald-400/95 font-cairo whitespace-nowrap shrink-0",children:[l.jsx("svg",{className:"w-2 h-2 text-emerald-600 dark:text-emerald-500 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M20 6L9 17l-5-5"})}),"تم الإغلاق"]}),(m||g)&&l.jsxs("div",{className:"inline-flex items-center justify-center gap-0.5 shrink-0",children:[m&&l.jsx("button",{type:"button",onClick:()=>m(n.id),"aria-label":"حذف الصف",className:"inline-flex items-center justify-center w-4 h-4 rounded border border-stone-400 dark:border-red-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 transition-all shrink-0",title:"حذف الصف",children:l.jsx("svg",{className:"w-2 h-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),g&&l.jsx("button",{type:"button",onClick:()=>g(n.id),"aria-label":"طباعة الصف",className:"inline-flex items-center justify-center w-4 h-4 rounded border border-stone-500 dark:border-teal-500/25 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-stone-300 dark:hover:bg-teal-500/15 hover:text-teal-400 transition-all shrink-0",title:"طباعة هذه التقفيلة",children:l.jsxs("svg",{className:"w-2 h-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M6 9V2h12v7"}),l.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),l.jsx("path",{d:"M6 14h12v8H6z"})]})})]})]}):ne?l.jsx("button",{type:"button",onClick:()=>ne(n.id),title:"افراغ كل المدخلات في الصف النشط",className:"inline-flex items-center justify-center rounded px-0.5 py-0.5 bg-stone-200 dark:bg-teal-500/15 border border-stone-400 dark:border-teal-500/30 text-[8px] font-medium text-stone-800 dark:text-teal-400 font-cairo whitespace-nowrap w-full min-w-0 truncate hover:bg-stone-300 dark:hover:bg-teal-500/25 transition",children:"افراغ"}):l.jsx("span",{className:"inline-flex items-center justify-center rounded px-0.5 py-0.5 bg-stone-200 dark:bg-teal-500/15 border border-stone-400 dark:border-teal-500/30 text-[8px] font-medium text-stone-800 dark:text-teal-400 font-cairo whitespace-nowrap w-full min-w-0 truncate",children:"الشفت الحالي"})})]})]})}const jg={Enter:"=","=":"=",Backspace:"⌫",Escape:"C",",":"."},Pg="programBalanceBank",eo="اجمالى الموازنه";function Vg({onTransfer:n,hasActiveRow:e}={}){const[t,r]=I.useState("0"),[s,o]=I.useState(""),[a,u]=I.useState([]),[h,f]=I.useState(!1),m=I.useRef(null),g=I.useRef(null),[E,N]=I.useState(null);I.useLayoutEffect(()=>{if(!h){N(null);return}const F=m.current;if(!F){N(null);return}const ee=F.getBoundingClientRect();N({right:window.innerWidth-ee.right,bottom:window.innerHeight-ee.top+8})},[h]);const j=I.useRef("0"),L=I.useRef(""),V=I.useRef(null),O=I.useRef(!1),$=I.useRef(()=>{}),H=I.useRef(null),J=I.useCallback(F=>{j.current=F,r(F)},[]),z=I.useCallback(F=>{r(F)},[]),ne=I.useCallback((F,ee,B)=>{const te=parseFloat(F)||0,oe=parseFloat(B)||0;return ee?ee==="+"?te+oe:ee==="-"?te-oe:ee==="*"?te*oe:ee==="/"?oe===0?0:te/oe:ee==="%"?oe===0?0:te*oe/100:oe:oe},[]),v=I.useCallback(()=>{const F=ne(L.current,V.current,j.current),ee=`${L.current} ${V.current} ${j.current} = ${F}`;u(B=>[ee,...B].slice(0,20)),J(String(F)),o(""),L.current="",V.current=null,O.current=!0},[J,ne]),x=I.useCallback(F=>{if(F==="C"){J("0"),o(""),u([]),f(!1),L.current="",V.current=null,O.current=!1;return}if(F==="⌫"){const ee=j.current;if(ee.length<=1){J("0");return}J(ee.slice(0,-1));return}if(F==="="){V.current&&v();return}if(["+","-","*","/","%"].includes(F)){V.current&&v(),L.current=j.current,V.current=F,o(ee=>ee+" "+F),O.current=!0;return}if(F==="."){if(O.current){J("0."),j.current="0.",O.current=!1;return}if(j.current.includes("."))return;const ee=j.current+".";j.current=ee,V.current?z(String(ne(L.current,V.current,ee))):J(ee),o(B=>B+F);return}if(/\d/.test(F)){if(O.current)j.current=F,V.current?z(String(ne(L.current,V.current,F))):J(F),O.current=!1;else{const ee=j.current==="0"?F:j.current+F;j.current=ee,V.current?z(String(ne(L.current,V.current,ee))):J(ee)}o(ee=>ee+F)}},[J,z,v,ne]);$.current=x,I.useEffect(()=>{const F=ee=>{var de;const B=ee.target;if(B.closest("input, textarea, select")||!((de=H.current)!=null&&de.contains(B)))return;const te=jg[ee.key]??(ee.key.length===1?ee.key:"");!te||!["C","⌫","%","/","*","-","+","=",".","0","1","2","3","4","5","6","7","8","9"].includes(te)&&!/^\d$/.test(te)||(ee.preventDefault(),$.current(te))};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[]);const b=[["C","⌫","%","/"],["7","8","9","*"],["4","5","6","-"],["1","2","3","+"],["0",".","="]],w=F=>["+","-","*","/","%"].includes(F),k=F=>F==="="?"col-span-2 bg-teal-500 hover:bg-teal-600 dark:bg-teal-500/20 dark:hover:bg-teal-500/30 text-white dark:text-teal-400 font-bold text-lg border-2 border-teal-400 dark:border-teal-500/40 shadow-sm":w(F)?"bg-teal-100 hover:bg-teal-200 dark:bg-teal-500/20 dark:hover:bg-teal-500/30 text-teal-700 dark:text-teal-400 font-bold border-2 border-teal-300 dark:border-teal-500/40 flex items-center justify-center shadow-sm":F==="C"?"bg-red-100 hover:bg-red-200 dark:bg-red-500/20 dark:hover:bg-red-500/30 text-red-600 dark:text-red-400 border-2 border-red-300 dark:border-red-500/40 text-base shadow-sm":F==="⌫"?"bg-stone-400 hover:bg-stone-500 dark:bg-slate-600/40 dark:hover:bg-slate-500/50 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 text-base shadow-sm":"bg-white dark:bg-slate-700/40 hover:bg-stone-100 dark:hover:bg-slate-600/50 text-stone-900 dark:text-slate-200 border-2 border-stone-400 dark:border-white/10 active:scale-[0.98] text-base shadow-sm",T={"+":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:l.jsx("path",{d:"M12 5v14M5 12h14"})}),"-":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:l.jsx("path",{d:"M5 12h14"})}),"*":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:l.jsx("path",{d:"M7 7l10 10M17 7L7 17"})}),"/":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:l.jsx("path",{d:"M5 4l14 16"})}),"%":l.jsxs("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"6",cy:"6",r:"2.5"}),l.jsx("circle",{cx:"18",cy:"18",r:"2.5"}),l.jsx("path",{d:"M6 18L18 6"})]})},y=F=>T[F]?T[F]:l.jsx("span",{className:"inline-block leading-none",children:F});return l.jsxs("div",{ref:H,className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",tabIndex:0,title:"انقر هنا ثم استخدم لوحة المفاتيح. النتيجة لا تتغير عند الكتابة في الجدول.",children:[l.jsxs("div",{className:"bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-3 sm:px-4 py-2 sm:py-3 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shadow-sm",children:[l.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide min-w-0",children:[l.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 shrink-0",children:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2"}),l.jsx("path",{d:"M6 6h12M6 10h12"}),l.jsx("rect",{x:"6.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"10.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"14.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"6.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"10.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"14.5",y:"17.5",width:"3",height:"3",rx:"0.5"})]})}),"الآلة الحاسبة"]}),l.jsx("button",{ref:m,type:"button",onClick:()=>f(F=>!F),className:`p-1.5 rounded-lg transition ${h?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:h?"إخفاء السجل":"سجل العمليات","aria-label":"سجل العمليات",children:l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]})})]}),l.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 space-y-2 sm:space-y-3 min-h-0",children:[l.jsxs("div",{className:"rounded-xl bg-stone-100 dark:bg-slate-900/80 border-2 border-stone-400 dark:border-slate-600 p-2 shadow-inner dark:ring-0",children:[l.jsx("div",{className:"text-right text-stone-700 text-xs min-h-[16px] font-cairo tabular-nums select-none","aria-hidden":"true",children:s||"​"}),l.jsx("div",{className:"w-full px-3 py-2.5 rounded-lg bg-stone-50 dark:bg-slate-900/50 border-2 border-stone-300 dark:border-transparent text-stone-900 dark:text-white text-right font-cairo text-2xl font-semibold tabular-nums min-h-[2.5rem] flex items-center justify-end","aria-live":"polite","aria-label":`النتيجة: ${t}`,children:t})]}),n&&l.jsxs("button",{ref:g,type:"button",onClick:()=>{const F=parseFloat(t)||0;if(!e||F<=0)return;let ee;if(g.current){const B=g.current.getBoundingClientRect();ee={x:B.x,y:B.y,width:B.width,height:B.height}}n(F,Pg,ee),u(B=>[`مرحّل → ${eo}: ${F}`,...B].slice(0,20)),J("0"),o("")},disabled:!e||!parseFloat(t),title:`ترحيل الرقم إلى ${eo}`,className:"w-full py-2 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition flex items-center justify-center gap-2 shadow-sm",children:[l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل إلى ",eo]}),l.jsx("div",{className:"grid grid-cols-4 gap-2",children:b.flat().map(F=>l.jsx("button",{type:"button",onClick:()=>x(F),className:`py-2.5 rounded-xl font-cairo transition-all duration-150 ${k(F)}`,"aria-label":F==="⌫"?"حذف":F,children:y(F)},F))}),h&&E&&xn.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>f(!1)}),l.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[180px] max-h-[280px] overflow-y-auto",style:{right:E.right,bottom:E.bottom},children:[l.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"سجل العمليات"}),a.length===0?l.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لا يوجد سجل بعد"}):l.jsx("ul",{className:"space-y-1 mb-1 max-h-48 overflow-y-auto scrollbar-thin",children:a.map((F,ee)=>l.jsx("li",{className:"tabular-nums px-2 py-1 rounded-md bg-stone-100 dark:bg-slate-800/40 text-stone-800 dark:text-slate-300 border border-stone-300 dark:border-transparent",children:F},ee))}),l.jsx("button",{type:"button",onClick:()=>f(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]})}const $r=[500,200,100,50,10,5,1],to=()=>Object.fromEntries($r.map(n=>[n,0]));function Dg({onApplyToCash:n,hasActiveRow:e}){const[t,r]=I.useState(to()),[s,o]=I.useState(to()),[a,u]=I.useState(!1),h=I.useRef(null),[f,m]=I.useState(null);I.useLayoutEffect(()=>{if(!a){m(null);return}const O=h.current;if(!O){m(null);return}const $=O.getBoundingClientRect();m({right:window.innerWidth-$.right,bottom:window.innerHeight-$.top+8})},[a]);const g=$r.reduce((O,$)=>O+(t[$]??0)*$,0),E=$r.reduce((O,$)=>O+(s[$]??0)*$,0),N=I.useCallback((O,$)=>{r(H=>({...H,[O]:$}))},[]),j=I.useCallback(()=>{r(to())},[]),L=I.useRef(null),V=I.useCallback(()=>{if(!e)return;let O;if(L.current){const $=L.current.getBoundingClientRect();O={x:$.x,y:$.y,width:$.width,height:$.height}}o({...t}),n(g,O),j()},[e,g,n,j,t]);return l.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[l.jsxs("div",{className:"relative bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-3 sm:px-4 py-2 sm:py-3 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide min-w-0",children:[l.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 shrink-0",children:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),l.jsx("path",{d:"M2 10h20M2 14h20M7 8v8M12 8v8M17 8v8"})]})}),"حاسبة الكاش"]}),l.jsx("button",{ref:h,type:"button",onClick:()=>u(O=>!O),className:`p-1.5 rounded-lg transition shrink-0 ${a?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:"آخر عمليات رُحّلت إلى الكاش","aria-label":"سجل العمليات",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]})})]}),l.jsx("span",{className:"text-xs font-semibold text-stone-800 dark:text-teal-300 font-cairo",children:"المجموع"}),l.jsx("span",{className:"text-sm font-semibold text-stone-800 dark:text-teal-400 font-cairo tabular-nums",children:g>0?`${g} ريال سعودي`:"— ريال سعودي"}),a&&f&&xn.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>u(!1)}),l.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[280px] overflow-y-auto",style:{right:f.right,bottom:f.bottom},children:[l.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"آخر عمليات رُحّلت إلى الكاش:"}),E===0?l.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):l.jsxs(l.Fragment,{children:[l.jsx("ul",{className:"space-y-0.5 mb-1",children:$r.map(O=>{const $=s[O]??0;return $===0?null:l.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:["فئة ",O,": ",$," × ",O," = ",$*O," ريال"]},O)})}),l.jsxs("p",{className:"border-t border-stone-300 dark:border-white/10 pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",E," ريال سعودي"]})]}),l.jsx("button",{type:"button",onClick:()=>u(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]}),l.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 min-h-0 overflow-hidden gap-3 sm:gap-4",children:[l.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 shrink-0",children:$r.map(O=>{const $=(t[O]??0)*O;return l.jsxs("div",{className:"flex flex-col items-center gap-2 rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-teal-500/20 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] px-2.5 py-2.5 sm:px-3 sm:py-3 overflow-hidden min-w-[120px]",children:[l.jsxs("span",{className:"text-stone-800 dark:text-teal-400/90 text-xs font-cairo font-semibold tabular-nums w-full text-center",children:["فئة النقد ",O]}),l.jsxs("div",{className:"flex items-center gap-1.5 w-full min-w-0 justify-center",children:[l.jsx("button",{type:"button","aria-label":"نقص واحد",onClick:()=>N(O,Math.max(0,(t[O]??0)-1)),disabled:(t[O]??0)<=0,className:"flex items-center justify-center w-8 h-8 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-red-100 dark:hover:bg-red-500/20 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 disabled:opacity-40 disabled:pointer-events-none transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:l.jsx("span",{className:"text-base font-bold leading-none",children:"−"})}),l.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",value:t[O]===0||t[O]==null?"":String(t[O]),onChange:H=>{const J=Ln(H.target.value).replace(/\D/g,"");N(O,Math.max(0,parseInt(J,10)||0))},onFocus:H=>{const J=H.target.value;(J===""||Number(J)===0)&&N(O,0)},className:"flex-1 min-w-[2.5rem] max-w-[3.5rem] px-1.5 py-1.5 rounded-md bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums cashbox-input focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-teal-500/50 dark:focus:ring-teal-500/25 focus:outline-none"}),l.jsx("button",{type:"button","aria-label":"زد واحد",onClick:()=>N(O,(t[O]??0)+1),className:"flex items-center justify-center w-8 h-8 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-stone-500 dark:hover:bg-emerald-500/20 hover:text-white dark:hover:text-emerald-400 hover:border-stone-600 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:l.jsx("span",{className:"text-base font-bold leading-none",children:"+"})})]}),$>0?l.jsxs("span",{className:"text-stone-800 dark:text-slate-300 text-xs font-semibold font-cairo tabular-nums w-full text-center",children:[$," ريال سعودي"]}):l.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-semibold font-cairo w-full text-center",children:"— ريال سعودي"})]},O)})}),l.jsxs("div",{className:"w-full py-3 px-4 rounded-xl text-sm font-cairo font-semibold bg-stone-200 dark:bg-slate-700/80 border-2 border-stone-400 dark:border-slate-600 text-stone-900 dark:text-slate-200 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[l.jsx("span",{children:"المجموع"}),l.jsx("span",{className:"text-base font-semibold tabular-nums",children:g>0?`${g} ريال سعودي`:"— ريال سعودي"})]}),l.jsxs("div",{className:"flex gap-2 shrink-0",children:[l.jsxs("button",{ref:L,type:"button",onClick:V,disabled:!e||g===0,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل للكاش"]}),l.jsxs("button",{type:"button",onClick:j,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),l.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح"]})]})]})]})}const Mg=[{field:"mada",label:"مدى"},{field:"visa",label:"فيزا"},{field:"mastercard",label:"ماستر كارد"}];function Lg({onTransfer:n,onTransferToBudget:e,hasActiveRow:t,disableTransferButtons:r=!1}){const[s,o]=I.useState({mada:[],visa:[],mastercard:[]}),[a,u]=I.useState({mada:"",visa:"",mastercard:""}),[h,f]=I.useState({mada:[],visa:[],mastercard:[]}),[m,g]=I.useState([]),[E,N]=I.useState(null),[j,L]=I.useState(!1),V=I.useRef(null),O=I.useRef(null),[$,H]=I.useState(null);I.useLayoutEffect(()=>{if(j){const oe=O.current;if(!oe){H(null);return}const de=oe.getBoundingClientRect();H({left:de.right+8,bottom:window.innerHeight-de.top+8});return}if(E===null){H(null);return}const B=V.current;if(!B){H(null);return}const te=B.getBoundingClientRect();H({left:te.right+8,bottom:window.innerHeight-te.top+8})},[E,j]);const J=I.useCallback(B=>B.reduce((te,oe)=>te+oe,0),[]),z=J(s.mada),ne=J(s.visa),v=J(s.mastercard),x=z+ne+v,b=I.useCallback(B=>{const te=Ln(a[B]).replace(",",".").replace(/[^\d.]/g,""),oe=parseFloat(te)||0;oe<=0||(o(de=>({...de,[B]:[...de[B],oe]})),u(de=>({...de,[B]:""})))},[a]),w=I.useCallback((B,te)=>{o(oe=>({...oe,[B]:oe[B].filter((de,me)=>me!==te)}))},[]),k=I.useCallback((B,te)=>{u(oe=>({...oe,[B]:te}))},[]),T=I.useCallback(()=>{o({mada:[],visa:[],mastercard:[]}),u({mada:"",visa:"",mastercard:""})},[]),y=I.useCallback((B,te)=>{if(!t)return;const oe=s[B],de=B==="mada"?z:B==="visa"?ne:v;if(de===0)return;f(_e=>({..._e,[B]:[..._e[B],...oe]}));const me=B==="mada"?[de,0,0]:B==="visa"?[0,de,0]:[0,0,de],fe=te?{sourceRect:te,targetField:B}:void 0;n(me[0],me[1],me[2],fe),o(_e=>({..._e,[B]:[]})),u(_e=>({..._e,[B]:""}))},[t,z,ne,v,n,s]),F=I.useRef(null),ee=I.useCallback(()=>{if(!(!t||x===0))if(e){g(te=>[...te,x]);let B;if(F.current){const te=F.current.getBoundingClientRect();B={x:te.x,y:te.y,width:te.width,height:te.height}}e(x,B),T()}else f(B=>({mada:[...B.mada,...s.mada],visa:[...B.visa,...s.visa],mastercard:[...B.mastercard,...s.mastercard]})),n(z,ne,v),T()},[t,x,z,ne,v,n,e,s,T]);return l.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[l.jsxs("div",{className:"bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-4 py-3 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[l.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide",children:[l.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200",children:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"1"}),l.jsx("path",{d:"M2 10h20M7 14h2"})]})}),"حاسبه العمليات البنكيه"]}),l.jsx("span",{className:"text-xs font-semibold text-slate-700 font-cairo tabular-nums",children:x>0?`${x} ريال`:"—"})]}),l.jsxs("div",{className:"flex-1 flex flex-col p-4 min-h-0 overflow-hidden gap-4",children:[l.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1 min-h-0",children:Mg.map(({field:B,label:te})=>{const oe=s[B],de=J(oe);return l.jsxs("div",{className:"relative flex flex-col rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-teal-500/20 px-3 py-3 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-h-0",children:[l.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1 shrink-0",children:[l.jsx("span",{className:"text-stone-800 dark:text-teal-400/90 text-xs font-cairo font-semibold",children:te}),l.jsxs("div",{className:"relative shrink-0",children:[l.jsx("button",{ref:E===B?V:void 0,type:"button",onClick:()=>{L(!1),N(me=>me===B?null:B)},className:`p-1.5 rounded-lg transition ${E===B?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:"كل العمليات المرحّلة لهذا النوع","aria-label":"سجل العمليات",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]})}),E===B&&$&&xn.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>{N(null),L(!1)}}),l.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[140px] max-h-[220px] overflow-y-auto",style:{left:$.left,bottom:$.bottom},children:[l.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"كل العمليات المرحّلة إلى الصف:"}),h[B].length===0?l.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):l.jsxs(l.Fragment,{children:[l.jsx("ul",{className:"space-y-0.5 mb-1",children:h[B].map((me,fe)=>l.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[me," ريال"]},fe))}),l.jsxs("p",{className:"border-t border-stone-200 dark:border-white/10 pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",J(h[B])," ريال"]})]}),l.jsx("button",{type:"button",onClick:()=>N(null),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]}),l.jsx("p",{className:"text-[9px] text-stone-500 dark:text-slate-500 font-cairo mb-1.5 shrink-0",children:"أدخل المبلغ ثم +"}),l.jsxs("div",{className:"flex items-center gap-1.5 mb-2 shrink-0",children:[l.jsx("input",{type:"text",inputMode:"decimal",dir:"ltr",placeholder:"مبلغ العملية",value:a[B],onChange:me=>{const _e=(Ln(me.target.value).replace(",",".").replace(/[^\d.]/g,"").match(/^\d*\.?\d*/)||[""])[0];k(B,_e)},onKeyDown:me=>{me.key==="Enter"&&(me.preventDefault(),b(B))},className:"flex-1 min-w-0 px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums placeholder:text-xs placeholder:text-stone-400 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-teal-500/50 dark:focus:ring-teal-500/25 focus:outline-none"}),l.jsx("button",{type:"button","aria-label":`إضافة لـ ${te}`,onClick:()=>b(B),className:"flex items-center justify-center w-8 h-8 rounded-lg bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-stone-500 dark:hover:bg-emerald-500/20 hover:text-white dark:hover:text-emerald-400 hover:border-stone-600 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm",children:l.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})]}),l.jsx("div",{className:"flex-1 min-h-0 overflow-auto space-y-1",children:oe.length===0?l.jsx("span",{className:"text-stone-600 dark:text-slate-500 text-[10px] font-cairo",children:"لا عمليات — أضف مبالغ بالزر +"}):oe.map((me,fe)=>l.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-lg bg-white dark:bg-slate-700/50 px-2 py-1 border-2 border-stone-400 dark:border-white/10 shadow-sm",children:[l.jsxs("span",{className:"text-xs font-cairo tabular-nums text-stone-800 dark:text-slate-200",children:[me," ريال"]}),l.jsx("button",{type:"button",onClick:()=>w(B,fe),"aria-label":"حذف",className:"w-5 h-5 rounded flex items-center justify-center text-stone-600 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-500/20 transition shrink-0",children:l.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},`${B}-${fe}`))}),l.jsxs("div",{className:"pt-2 mt-auto border-t-2 border-stone-400 dark:border-white/10 shrink-0 space-y-2",children:[l.jsxs("span",{className:"text-xs font-semibold font-cairo text-stone-800 dark:text-teal-400 tabular-nums block",children:["المجموع: ",de>0?`${de} ريال`:"—"]}),l.jsxs("button",{type:"button",onClick:me=>{const fe=me.currentTarget.getBoundingClientRect(),_e={x:fe.x,y:fe.y,width:fe.width,height:fe.height};y(B,_e)},disabled:r||!t||de===0,title:r?"معطّل — تم جلب القيم من إكسل":`ترحيل ${te} إلى الصف النشط`,className:"w-full py-2 rounded-lg text-xs font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-1.5",children:[l.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل ",te]})]})]},B)})}),l.jsxs("div",{className:"w-full py-2.5 px-4 rounded-xl text-xs font-cairo font-semibold bg-stone-200 dark:bg-slate-700/80 border-2 border-stone-400 dark:border-slate-600 text-stone-900 dark:text-slate-200 flex items-center justify-between gap-6 shrink-0 flex-wrap shadow-sm",children:[l.jsxs("span",{className:"tabular-nums",children:["مدى ",l.jsx("span",{className:"font-bold",children:z})]}),l.jsxs("span",{className:"tabular-nums",children:["فيزا ",l.jsx("span",{className:"font-bold",children:ne})]}),l.jsxs("span",{className:"tabular-nums",children:["ماستر ",l.jsx("span",{className:"font-bold",children:v})]}),l.jsxs("span",{className:"tabular-nums font-bold text-stone-900 dark:text-slate-200 px-2 py-0.5 rounded-md bg-white/60 dark:bg-slate-600/60 border border-stone-300 dark:border-slate-500",children:["المجموع = ",l.jsx("span",{className:"font-bold",children:x})]})]}),l.jsxs("div",{className:"flex gap-2 shrink-0 items-center",children:[e?l.jsxs("div",{ref:F,className:"flex flex-1 min-w-0 min-h-[56px] rounded-xl overflow-hidden border-2 border-teal-400 dark:border-emerald-500/40 bg-teal-500 dark:bg-emerald-500/20 hover:bg-teal-600 dark:hover:bg-emerald-500/30 disabled:opacity-50 disabled:pointer-events-none transition-all shadow-sm",children:[l.jsxs("button",{type:"button",onClick:ee,disabled:!t||x===0,title:"ترحيل المجموع إلى خانة اجمالى الموازنه في الصف النشط",className:"flex-1 min-w-0 min-h-[52px] py-3 px-3 flex items-center justify-center gap-2 text-sm font-cairo font-medium text-white dark:text-emerald-400 whitespace-nowrap",children:[l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الى اجمالى الموازنه"]}),l.jsxs("button",{ref:O,type:"button",onClick:B=>{B.stopPropagation(),N(null),L(te=>!te)},title:"سجل ترحيلات اجمالى الموازنه","aria-label":"سجل ترحيلات اجمالى الموازنه",className:`relative shrink-0 w-10 min-h-[52px] h-full flex items-center justify-center border-s-2 border-teal-400/50 dark:border-emerald-500/40 transition-colors ${j?"bg-teal-600/90 dark:bg-emerald-500/40 text-white":"hover:bg-teal-600/70 dark:hover:bg-emerald-500/30 text-white/90 hover:text-white"}`,children:[l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]}),m.length>0&&l.jsx("span",{className:"absolute top-0.5 end-0.5 min-w-[14px] h-3.5 px-0.5 rounded-full bg-white/90 dark:bg-black/40 text-teal-700 dark:text-emerald-300 text-[9px] font-bold flex items-center justify-center leading-none shadow-sm",children:m.length})]})]}):l.jsxs("button",{ref:F,type:"button",onClick:ee,disabled:!t||x===0,title:"ترحيل مدى + فيزا + ماستر كارد معاً إلى الصف النشط",className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الكل"]}),j&&$&&xn.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>L(!1)}),l.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[220px] overflow-y-auto",style:{left:$.left,bottom:$.bottom},children:[l.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"ترحيلات إلى اجمالى الموازنه:"}),m.length===0?l.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):l.jsxs(l.Fragment,{children:[l.jsx("ul",{className:"space-y-0.5 mb-1",children:m.map((B,te)=>l.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[B.toLocaleString("ar-SA",{minimumFractionDigits:2})," ريال"]},te))}),l.jsxs("p",{className:"border-t border-stone-200 dark:border-white/10 pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",m.reduce((B,te)=>B+te,0).toLocaleString("ar-SA",{minimumFractionDigits:2})," ريال"]})]}),l.jsx("button",{type:"button",onClick:()=>L(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body),l.jsxs("button",{type:"button",onClick:T,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),l.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح الكل"]})]})]})]})}const Og={success:{bg:"bg-emerald-100 dark:bg-emerald-500/15",border:"border-emerald-400 dark:border-emerald-500/40",icon:"text-emerald-700 dark:text-emerald-400"},error:{bg:"bg-red-100 dark:bg-red-500/15",border:"border-red-400 dark:border-red-500/40",icon:"text-red-700 dark:text-red-400"},warning:{bg:"bg-amber-100 dark:bg-amber-500/15",border:"border-amber-400 dark:border-amber-500/40",icon:"text-amber-700 dark:text-amber-400"},info:{bg:"bg-sky-100 dark:bg-sky-500/15",border:"border-sky-400 dark:border-sky-500/40",icon:"text-sky-700 dark:text-sky-400"}},Fg={success:l.jsx("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M20 6L9 17l-5-5"})}),error:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),warning:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 9v4M12 17h.01"}),l.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})]}),info:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 16v-4M12 8h.01"})]})},ic=3e3;function Bg({message:n,type:e,onClose:t,position:r="bottom",autoHideMs:s=ic}){const o=I.useRef(t);o.current=t,I.useEffect(()=>{const h=s>0?s:ic,f=setTimeout(()=>o.current(),h);return()=>clearTimeout(f)},[n,s]);const a=Og[e],u=r==="center"?"fixed top-1/2 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2":"fixed bottom-6 left-1/2 z-50 -translate-x-1/2";return l.jsxs("div",{role:"alert",className:`${u} flex items-center gap-3 px-4 py-3 rounded-2xl border ${a.bg} ${a.border} shadow-xl shadow-black/10 dark:shadow-black/20 backdrop-blur-md min-w-[200px] max-w-[90vw]`,children:[l.jsx("span",{className:a.icon,"aria-hidden":"true",children:Fg[e]}),l.jsx("span",{className:"font-cairo text-sm text-stone-800 dark:text-slate-200 flex-1",children:n}),l.jsx("button",{type:"button",onClick:t,className:"p-1 rounded-lg text-stone-600 dark:text-slate-400 hover:text-stone-900 dark:hover:text-slate-200 hover:bg-stone-300 dark:hover:bg-white/10 transition focus-visible:ring-2 focus-visible:ring-teal-400 dark:focus-visible:ring-amber-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none","aria-label":"إغلاق",children:l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})}const $g=550;function Ug({sourceRect:n,targetRect:e,amount:t,formatCurrency:r,rowId:s,field:o,onEnd:a,onLanded:u}){const[h,f]=I.useState("start"),m=I.useRef(e);m.current=e;const g=I.useRef(u);g.current=u,I.useEffect(()=>{if(h!=="start")return;const V=requestAnimationFrame(()=>f("fly"));return()=>cancelAnimationFrame(V)},[h]),I.useEffect(()=>{var O;if(h!=="done")return;(O=g.current)==null||O.call(g,s,o);const V=setTimeout(a,120);return()=>clearTimeout(V)},[h,a,s,o]);const E=()=>{f("done")},N=h==="start"?n.x:m.current.x,j=h==="start"?n.y:m.current.y,L=l.jsx("div",{role:"presentation","aria-hidden":!0,className:"transfer-fly-badge pointer-events-none fixed z-[9999] flex items-center justify-center rounded-xl border-2 border-teal-500 dark:border-teal-500/80 bg-teal-500/95 dark:bg-teal-500/90 text-white font-cairo font-bold text-sm tabular-nums shadow-lg px-3 py-2 min-w-[72px]",style:{left:n.x,top:n.y,width:Math.max(72,n.width),height:n.height,transform:`translate(${N-n.x}px, ${j-n.y}px)`,transition:h==="fly"?`transform ${$g}ms cubic-bezier(0.25, 0.1, 0.25, 1)`:"none"},onTransitionEnd:E,children:l.jsx("span",{className:"opacity-95",children:r(t)})});return xn.createPortal(L,document.body)}const no=4,oc=5;function qg(n,e){const[t,r]=I.useState([]),[s,o]=I.useState([]),[a,u]=I.useState(1),[h,f]=I.useState(!0),[m,g]=I.useState(!1),E=I.useRef({}),N=I.useRef({}),j=I.useRef(new Map),L=t.length>0||s.length>0?[...t.sort((z,ne)=>new Date(ne.createdAt).getTime()-new Date(z.createdAt).getTime()),...s].sort((z,ne)=>z.status!=="closed"&&ne.status==="closed"?-1:z.status==="closed"&&ne.status!=="closed"?1:z.status==="closed"&&ne.status==="closed"?new Date((ne.closedAt??"").toString()).getTime()-new Date((z.closedAt??"").toString()).getTime():new Date(ne.createdAt).getTime()-new Date(z.createdAt).getTime()):[],V=I.useCallback(async(z,ne=!1)=>{const v=j.current.get(z);if(v&&!ne)return o(v.rows),g(v.hasMore),v;const x=z===1?no:oc;let b=null;if(z>1){const k=j.current.get(z-1);b=(k==null?void 0:k.lastDoc)??null}const w=await Hs(e,x,b);return j.current.set(z,w),o(w.rows),g(w.hasMore),w},[e]),O=I.useCallback(async z=>{var x;if(z<1)return;f(!0);const ne=j.current.get(z-1);if(z>1&&!ne)for(let b=1;b<z;b++){const w=b===1?no:oc,k=b===1?null:((x=j.current.get(b-1))==null?void 0:x.lastDoc)??null,T=await Hs(e,w,k);if(j.current.set(b,T),!T.hasMore&&b<z-1)break}await V(z),u(z),f(!1)},[e,V]),$=I.useCallback(async()=>{f(!0);const z=Ds(e);r(z),j.current.clear(),u(1);const ne=await V(1,!0);[...z,...(ne==null?void 0:ne.rows)??[]].forEach(x=>{N.current[x.id]=x}),f(!1)},[e,V]),H=I.useRef([]);H.current=L;const J=I.useCallback(z=>{const ne=typeof z=="function"?z(H.current):z,v=ne.filter(b=>b.status!=="closed"),x=ne.filter(b=>b.status==="closed");r(v),o(x),ne.forEach(b=>{N.current[b.id]=b})},[]);return I.useEffect(()=>{let z=!1;return(async()=>{if(Ds(e).length===0&&id(e,n),z)return;f(!0),r(Ds(e)),j.current.clear(),u(1);const v=await Hs(e,no);if(z)return;j.current.set(1,v),o(v.rows),g(v.hasMore),[...Ds(e),...v.rows].forEach(b=>{N.current[b.id]=b}),f(!1)})(),()=>{z=!0,Object.values(E.current).forEach(clearTimeout),E.current={}}},[n,e]),{rows:L,setRows:J,loadRows:$,loading:h,debounceRef:E,rowDataRef:N,currentClosedPage:a,setCurrentClosedPage:u,goToClosedPage:O,hasMoreClosedPages:m,closedPagesCache:j.current}}function zg(){const[n,e]=I.useState(()=>new Date),[t,r]=I.useState(null),[s,o]=I.useState(null),[a,u]=I.useState(0);return I.useEffect(()=>{const h=setInterval(()=>{const f=Date.now();e(new Date(f)),s!==null&&u(Math.max(0,Math.ceil((s-f)/1e3)))},1e3);return()=>clearInterval(h)},[s]),{liveNow:n,closingRowId:t,setClosingRowId:r,closingEndsAt:s,setClosingEndsAt:o,closingSecondsLeft:a,setClosingSecondsLeft:u}}function Wg(n,e){const[t,r]=I.useState(null),[s,o]=I.useState(null),a=I.useRef({}),u=I.useRef(null),h=I.useRef(null);h.current=(t==null?void 0:t.rowId)??null;const f=I.useCallback(m=>{var H;if(h.current===m)return;a.current={},o(null);const g=n.find(J=>J.id===m)??e.current[m],E=(g==null?void 0:g.expenses)??0;let N=(H=g==null?void 0:g.expenseItems)!=null&&H.length?g.expenseItems.map(J=>({amount:String(J.amount),description:J.description||""})):[{amount:E?String(E):"",description:""}];const j=J=>(Number(J.amount)||0)!==0||String(J.description||"").trim()!=="",L=(g==null?void 0:g.carriedExpenseCount)??0,V=N.slice(0,L).filter(j).length;N=N.filter(j);let O=V;const $=(g==null?void 0:g.status)==="closed";if(!$&&N.length>0){const J=N[N.length-1];if(String(J.amount||"").trim()!==""||String(J.description||"").trim()!==""){const z=N.reduce((x,b)=>x+(Number(b.amount)||0),0),ne=E-z,v=ne>0?String(ne):"";N=[...N,{amount:v,description:""}]}}!$&&N.length===0&&(N=[{amount:E?String(E):"",description:""}]),r({rowId:m,items:N,readOnly:$,carriedCount:O})},[n,e]);return I.useEffect(()=>{t||(u.current=null)},[t]),I.useEffect(()=>{if(s===null)return;const m=setTimeout(()=>o(null),3e3);return()=>clearTimeout(m)},[s]),{expenseModal:t,setExpenseModal:r,pulseExpenseDescriptionIndex:s,setPulseExpenseDescriptionIndex:o,openExpenseDetails:f,expenseAmountRef:a,expenseModalFocusedRowIdRef:u}}const ud="cashbox_theme",Hr=typeof document<"u"?document.documentElement:null,ac=typeof document<"u"?document.body:null;function Hg(){try{if(typeof localStorage>"u")return"dark";const n=localStorage.getItem(ud);return n==="light"||n==="dark"?n:"dark"}catch{return"dark"}}function No(n){if(!Hr)return;const e=n==="dark";Hr.classList.toggle("dark",e),ac&&ac.classList.toggle("dark",e);try{localStorage.setItem(ud,n)}catch{}Hr.offsetHeight}function Gg(n){try{window.dispatchEvent(new CustomEvent("cashbox-theme-change",{detail:n}))}catch{}}function dd(){if(!Hr)return;const e=Hr.classList.contains("dark")?"light":"dark";No(e),Gg(e)}const Os=10,Kg=2;function ro(){return"ayman5255"}const Qg=[{id:"today",label:"اليوم"},{id:"yesterday",label:"أمس"},{id:"lastWeek",label:"الأسبوع الماضي"}],Dr={corniche:"الكورنيش",andalusia:"الأندلس"};function lc(){dd()}function Yg({name:n,branch:e,onExit:t,onSwitchBranch:r,theme:s,onToggleTheme:o}){const a=I.useRef(null),[u,h]=I.useState(null),{rows:f,setRows:m,loadRows:g,debounceRef:E,rowDataRef:N,currentClosedPage:j,goToClosedPage:L,hasMoreClosedPages:V}=qg(n,e),{liveNow:O,closingRowId:$,setClosingRowId:H,setClosingEndsAt:J,closingSecondsLeft:z,setClosingSecondsLeft:ne}=zg(),[v,x]=I.useState("today"),[b,w]=I.useState(null),[k,T]=I.useState(null),[y,F]=I.useState(null),[ee,B]=I.useState(new Set),[te,oe]=I.useState(null),[de,me]=I.useState(null),[fe,_e]=I.useState(null),[st,ye]=I.useState(""),[ze,et]=I.useState(!1),[it,Ne]=I.useState(!1),[kt,Et]=I.useState(null),[We,ct]=I.useState(null),[X,bt]=I.useState(0),Se=I.useRef(null),[ke,pt]=I.useState(null),[gt,Me]=I.useState([]),[Pe,Rt]=I.useState(null),[En,Ht]=I.useState(!1),[He,ut]=I.useState(null),[Tt,Gt]=I.useState(null),[Qe,yr]=I.useState(null);I.useEffect(()=>{const _=a.current;if(!_)return;const A=C=>{C.preventDefault(),C.stopPropagation(),C.stopImmediatePropagation(),lc()};return _.addEventListener("click",A,!0),()=>_.removeEventListener("click",A,!0)},[]);const{expenseModal:Ee,setExpenseModal:St,pulseExpenseDescriptionIndex:_r,setPulseExpenseDescriptionIndex:en,openExpenseDetails:wr,expenseAmountRef:ot,expenseModalFocusedRowIdRef:jt}=Wg(f,N);I.useEffect(()=>{if($===null||z>0)return;const _=$,A=f.find(C=>C.id===_);if(!A||A.status==="closed"){H(null),J(null);return}H(null),J(null),(async()=>{try{const C=E.current[_];C&&(clearTimeout(C),delete E.current[_],Ft(e,_,A));const M=Zp(e,_),U=M?{...M,...A,id:_,status:"active"}:A,Y=Ls(U);await eg(e,_,{...U,employeeName:n,variance:Y});const Q=U.expenses??0,se=U.expenseCompensation??0,le=Math.max(0,Q-se),K=U.expenseItems??[],Be=se>0?le>0?[{amount:le,description:"مرحّل (صافي بعد التعويض)"}]:[]:K.map(Ie=>({amount:Ie.amount,description:Ie.description||""}));id(e,n,{expenses:le,expenseItems:Be,carriedExpenseCount:Be.length}),await g(),w({msg:"تم إغلاق الشفت وإضافة صف جديد",type:"success"}),bt(Ie=>Ie+1)}catch{w({msg:"فشل ترحيل الصف المغلَق إلى السحابة — تحقق من الاتصال",type:"error"})}})()},[z,$,f,n,g,e]);const It=I.useMemo(()=>{const _=f.filter(C=>C.status!=="closed").sort((C,M)=>new Date(M.createdAt).getTime()-new Date(C.createdAt).getTime()),A=tc(f.filter(C=>C.status==="closed"),v).sort((C,M)=>new Date((M.closedAt??"").toString()).getTime()-new Date((C.closedAt??"").toString()).getTime());return v==="today"?[..._,...A]:A},[f,v]),zn=It,ie=I.useMemo(()=>{var _;return((_=It.find(A=>A.status!=="closed"))==null?void 0:_.id)??null},[It]);I.useMemo(()=>{const _=f.filter(A=>A.status==="closed"&&A.closedAt);return _.length===0?null:_.sort((A,C)=>new Date((C.closedAt??"").toString()).getTime()-new Date((A.closedAt??"").toString()).getTime())[0]??null},[f]);const dt=I.useMemo(()=>f.find(_=>_.status!=="closed")??null,[f]),Tn=I.useMemo(()=>{if(!dt)return!1;const _=dt.cash??0,A=dt.programBalanceCash??0,C=dt.programBalanceBank??0;return _>0&&A>0&&C>0},[dt]),Ye=I.useCallback(async _=>{var ft;const A=(ft=_.target.files)==null?void 0:ft[0];if(_.target.value="",!A)return;const C=dt;if(!C){w({msg:"لا يوجد صف نشط لملء البيانات",type:"warning"});return}let M;try{M=await A.arrayBuffer()}catch{w({msg:"تعذر قراءة الملف",type:"error"});return}const U=new Date(0),{sums:Y,counts:Q,details:se,employeeName:le,employeeNamesList:K,error:we}=Eg(M,U);if(we){w({msg:we,type:"error"});return}pt(se),Me(K??[]);const Be=E.current[C.id];Be&&(clearTimeout(Be),delete E.current[C.id],Ft(e,C.id,N.current[C.id]??C));const Ie=N.current[C.id]??C,lt={mada:Y.mada,visa:Y.visa,mastercard:Y.mastercard,bankTransfer:Y.bankTransfer},_t=Y.mada+Y.visa+Y.mastercard,Dt=le&&le.trim()!==""?le.trim():Ie.employeeName,Mt={...Ie,...lt,employeeName:Dt,variance:Ls({...Ie,...lt})};Ft(e,C.id,Mt),N.current[C.id]=Mt,m(Cr=>Cr.map(Gn=>Gn.id===C.id?Mt:Gn)),g();const ht=[];Q.mada>0&&ht.push(`مدى ${G(Y.mada)}`),Q.visa>0&&ht.push(`فيزا ${G(Y.visa)}`),Q.mastercard>0&&ht.push(`ماستر كارد ${G(Y.mastercard)}`),Q.bankTransfer>0&&ht.push(`تحويل بنكي ${G(Y.bankTransfer)}`);const on=ht.length>0?ht.join(" — ")+` — المجموع: ${G(_t)}`:"";w({msg:_t>0?`تم استخراج: ${on}`:"لم يُعثر على مدى/فيزا/ماستر كارد/تحويل بنكي في الملف",type:_t>0?"success":"info"})},[dt,g]),ls=I.useCallback(()=>{var _;(_=Se.current)==null||_.click()},[]),In=I.useCallback(_=>{const A=E.current[_];A&&(clearTimeout(A),delete E.current[_]);const C=f.find(Q=>Q.id===_),M=(C==null?void 0:C.carriedExpenseCount)??0,U=((C==null?void 0:C.expenseItems)??[]).slice(0,M),Y=U.reduce((Q,se)=>Q+se.amount,0);if(Ft(e,_,{expenses:Y,expenseItems:U}),C){const Q={...C,expenses:Y,expenseItems:U,variance:Ls({...C})};N.current[_]=Q,m(se=>se.map(le=>le.id!==_?le:Q))}g(),ot.current={}},[f,g]),tn=I.useCallback((_,A,C)=>{St(M=>M?{...M,items:M.items.map((U,Y)=>Y===_?{...U,[A]:String(C)}:U)}:null)},[]),Si=I.useCallback(()=>{ot.current={},St(_=>_?{..._,items:[..._.items,{amount:"",description:""}]}:null)},[]),ji=I.useCallback(_=>{St(A=>{if(!A)return A;const C=A.carriedCount??0;return _<C||A.items.length<=1?A:(ot.current={},{...A,items:A.items.filter((M,U)=>U!==_)})})},[]),nn=I.useCallback((_,A)=>{ye(""),Ne(!1),_e({rowId:_,itemIndex:A,step:"confirm"})},[]),Pi=I.useCallback(()=>{fe&&_e(_=>_?{..._,step:"code"}:null)},[fe]),cs=I.useCallback(()=>{if(!fe)return;if(st.trim()!==ro()){Ne(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ne(!1);const{rowId:_,itemIndex:A}=fe,C=f.find(le=>le.id===_)??N.current[_];if(!C){_e(null),ye("");return}const M=(C.expenseItems??[]).slice(),U=C.carriedExpenseCount??0;if(A>=M.length||A>=U){_e(null),ye("");return}M.splice(A,1);const Y=Math.max(0,U-1),Q=M.reduce((le,K)=>le+K.amount,0);Ft(e,_,{expenseItems:M,expenses:Q,carriedExpenseCount:Y});const se={...C,expenseItems:M,expenses:Q,carriedExpenseCount:Y};N.current[_]=se,m(le=>le.map(K=>K.id===_?se:K)),St(le=>{if(!le||le.rowId!==_)return le;const K=le.items.filter((we,Be)=>Be!==A);return{...le,items:K,carriedCount:Y}}),ot.current={},g(),_e(null),ye(""),et(!1),w({msg:"تم حذف البند المرحّل",type:"success"})},[fe,st,f,g,Ft]),Pt=I.useCallback(()=>{if(!Ee)return;const _=Ee.rowId,A=Ee.carriedCount??0,C=Ee.items.map((Q,se)=>{const le=ot.current[se]!==void 0?ot.current[se]:String(Q.amount??"");return{amount:Number(String(le).replace(/,/g,""))||0,description:String(Q.description||"").trim(),index:se}}),M=C.find(Q=>Q.index>=A&&Q.amount>0&&!Q.description);if(M){w({msg:"يجب إدخال وصف لكل بند فيه مبلغ",type:"warning"}),en(M.index);return}const U=C.map(({amount:Q,description:se})=>({amount:Q,description:se})),Y=U.reduce((Q,se)=>Q+se.amount,0);Ft(e,_,{expenseItems:U,expenses:Y}),St(null),g(),requestAnimationFrame(()=>{setTimeout(()=>{const Q=document.querySelectorAll(`tr[data-row-id="${_}"] input.cashbox-input`);let se=Q[5]??Q[0];for(let le=5;le<Q.length;le++)if(!Q[le].disabled){se=Q[le];break}se==null||se.focus()},0)})},[Ee,g,Ft]),us=I.useCallback(()=>{w({msg:"يجب إدخال رصيد البرنامج كاش أولاً",type:"warning"})},[]),ds=I.useCallback(_=>{w({msg:`تعويض المصروفات يجب ألا يتخطى مبلغ المصروفات (المصروفات: ${G(_)})`,type:"warning"})},[]),Wn=I.useCallback(_=>{const A=f.find(M=>M.id===_);if(!A||A.status==="closed")return;const C={cash:0,sentToTreasury:0,expenseCompensation:0,expenses:0,expenseItems:[],carriedExpenseCount:0,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0};Ft(e,_,C),xn.flushSync(()=>{m(M=>{const U=M.map(Q=>Q.id!==_?Q:{...Q,...C}),Y=U.find(Q=>Q.id===_);return Y&&(N.current[_]=Y),U})}),g(),Gt(null),bt(M=>M+1),w({msg:"تم إفراغ كل المدخلات في الصف النشط ومسح سجلات الحاسبات",type:"success"})},[f,g]),An=I.useCallback(()=>{Tt&&Wn(Tt)},[Tt,Wn]),Vi=I.useCallback(()=>{Gt(null)},[]),Te=I.useCallback((_,A,C)=>{const M=f.find(se=>se.id===_);if(!M||M.status==="closed")return;const U={[A]:C};if(A==="expenses"&&typeof C=="number"){const se=M.expenseCompensation??0;C<se&&(U.expenseCompensation=C)}if(Jg.includes(A)){const se={...M,...U};U.variance=Ls(se)}const Q=E.current[_];Q&&clearTimeout(Q),E.current[_]=setTimeout(()=>{const se=N.current[_];se&&Ft(e,_,se),g()},400),xn.flushSync(()=>{m(se=>{const le=se.map(we=>we.id!==_?we:{...we,...U}),K=le.find(we=>we.id===_);return K&&(N.current[_]=K),le})})},[f,g]),hs=I.useCallback(_=>{const A=f.find(U=>U.id===_);if(!A||A.status!=="active")return;const C=Ks(A),M=Gs(A);if(C!==0||M!==0){ct({rowId:_,cashVar:C,bankVar:M});return}w({msg:"الصندوق مظبوط — تم عمل جيد ✓",type:"success"}),H(_),J(Date.now()+Os*1e3),ne(Os)},[f]),fs=I.useCallback(()=>{if(!We)return;const{rowId:_}=We;ct(null),H(_),J(Date.now()+Os*1e3),ne(Os)},[We]),vr=I.useCallback(()=>{ct(null)},[]),kr=I.useCallback(()=>{H(null),J(null),ne(0),w({msg:"تم التراجع — يمكنك تعديل الصف",type:"info"})},[]),Kt=I.useCallback((_,A,C)=>{if(_.length===0){w({msg:"لا توجد تقفيلات للطباعة",type:"warning"});return}const M=window.open("","_blank","width=800,height=900");if(!M){w({msg:"السماح بالنوافذ المنبثقة للطباعة",type:"warning"});return}const{firstActiveId:U,currentUserName:Y,branchLabel:Q}=C??{},se=Q?`<p class="page-branch">فرع ${Q.replace(/&/g,"&amp;").replace(/</g,"&lt;")}</p>`:"",le=_.map((K,we)=>{const Ie=((K.status==="closed"?K.employeeName:U&&K.id===U&&Y?Y:K.employeeName)??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),lt=K.mada+K.visa+K.mastercard,_t=Gs(K),Dt=Ks(K),Mt=K.expenses??0,ht=K.expenseCompensation??0,on=K.sentToTreasury??0,ft=K.expenseItems??[],Cr=Dt>0?"variance pos":Dt<0?"variance neg":"variance",Gn=_t>0?"variance pos":_t<0?"variance neg":"variance",Oi=ft.length>0?`<div class="block expenses-detail">
                  <div class="block-title">تفاصيل المصروفات</div>
                  <div class="block-body">${ft.map(Kn=>`<div class="expense-item">${G(Kn.amount)} — ${(Kn.description||"—").replace(/</g,"&lt;")}</div>`).join("")}</div>
                </div>`:"",Lt=(K.notes||"").trim()?`<div class="block notes-block"><div class="block-title">ملاحظات</div><div class="block-body">${(K.notes||"").replace(/</g,"&lt;")}</div></div>`:"",ws=(we>0?"page-break-before: always;":"")+(we<_.length-1?"page-break-after: always;":"");return`
            <div class="page" ${ws?`style="${ws}"`:""}>
              <header class="page-header">
                <h1 class="page-title">تقرير تقفيلة</h1>
                ${se}
                <p class="page-sub">${Ie}</p>
                <p class="page-time">${K.closedAt?di(K.closedAt):"—"}</p>
              </header>
              <div class="page-main">
              <div class="grid">
                <div class="block cash-block">
                  <div class="block-title">الكاش</div>
                  <div class="block-body">
                    <div class="row"><span class="label">كاش</span><span class="val">${G(K.cash)}</span></div>
                    <div class="row"><span class="label">مرسل للخزنة</span><span class="val">${G(on)}</span></div>
                    <div class="row"><span class="label">المصروفات</span><span class="val">${G(Mt)}</span></div>
                    <div class="row"><span class="label">تعويض مصروفات</span><span class="val">${G(ht)}</span></div>
                    <div class="row"><span class="label">رصيد البرنامج كاش</span><span class="val">${G(K.programBalanceCash)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف الكاش</span><span class="val ${Cr}">${G(Dt)}</span></div>
                  </div>
                </div>
                <div class="block bank-block">
                  <div class="block-title">البنك</div>
                  <div class="block-body">
                    <div class="row"><span class="label">مدى</span><span class="val">${G(K.mada)}</span></div>
                    <div class="row"><span class="label">فيزا</span><span class="val">${G(K.visa)}</span></div>
                    <div class="row"><span class="label">ماستر كارد</span><span class="val">${G(K.mastercard)}</span></div>
                    <div class="row"><span class="label">تحويل بنكي</span><span class="val">${G(K.bankTransfer)}</span></div>
                    <div class="row"><span class="label">بنك نزيل (مدى+فيزا+ماستر)</span><span class="val total">${G(lt)}</span></div>
                    <div class="row"><span class="label">اجمالى الموازنه</span><span class="val">${G(K.programBalanceBank??0)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف البنك</span><span class="val ${Gn}">${G(_t)}</span></div>
                  </div>
                </div>
              </div>
              ${Oi}
              ${Lt}
              </div>
              <footer class="page-footer">
                <p class="footer-formulas">بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط) — انحراف البنك = بنك نزيل − اجمالى الموازنه — انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش</p>
                <p>${Q?`فرع ${Q} — `:""}تاريخ الطباعة: ${di(new Date)} ${_.length>1?` — تقفيلة ${we+1} من ${_.length}`:""}</p>
              </footer>
            </div>`}).join("");M.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
          <head>
            <meta charset="utf-8">
            <title>${Q?`${A} — فرع ${Q}`:A}</title>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
            <style>
              * { box-sizing: border-box; margin: 0; padding: 0; }
              @page { size: A4 portrait; margin: 12mm; }
              html, body {
                font-family: 'Cairo', sans-serif;
                background: #fff;
                color: #1e293b;
                font-size: 13px;
                line-height: 1.4;
                padding: 0;
                margin: 0;
                height: auto;
              }
              @media print {
                html, body {
                  padding: 0 !important;
                  margin: 0 !important;
                  height: auto !important;
                  min-height: unset !important;
                  overflow: visible !important;
                  background: #fff;
                  font-size: 12px !important;
                  line-height: 1.45 !important;
                }
                .page {
                  box-shadow: none !important;
                  margin: 0 auto !important;
                  min-height: 273mm !important;
                  height: 273mm !important;
                  max-height: 273mm !important;
                  page-break-inside: avoid;
                  display: flex !important;
                  flex-direction: column !important;
                  justify-content: space-between !important;
                }
                .page:last-child { page-break-after: avoid !important; }
                .page-main { flex: 1 1 auto; display: flex; flex-direction: column; justify-content: flex-start; min-height: 0; }
              }
              .page {
                width: 100%;
                max-width: 186mm;
                margin: 0 auto 12px;
                padding: 10px 12px 14px;
                background: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                min-height: 273mm;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
              }
              .page-main { flex: 1 1 auto; min-height: 0; }
              .page-header {
                text-align: center;
                padding: 14px 0 12px;
                border-bottom: 2px solid #0f172a;
                margin-bottom: 14px;
              }
              .page-title {
                font-size: 1.5rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 4px;
              }
              .page-sub {
                font-size: 1.15rem;
                font-weight: 600;
                color: #334155;
                margin-bottom: 3px;
              }
              .page-time {
                font-size: 1rem;
                color: #64748b;
              }
              .page-branch {
                font-size: 1.05rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 4px;
              }
              .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
                margin-bottom: 14px;
              }
              .block {
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                overflow: hidden;
              }
              .block-title {
                background: #f1f5f9;
                padding: 10px 12px;
                font-weight: 700;
                font-size: 1rem;
                color: #334155;
                border-bottom: 1px solid #e2e8f0;
              }
              .block-body {
                padding: 10px 12px;
                background: #fff;
              }
              .block .row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid #f1f5f9;
                font-size: 0.95rem;
              }
              .block .row:last-child { border-bottom: none; }
              .block .row.highlight { font-weight: 700; background: #f8fafc; margin: 4px -12px -4px; padding: 8px 12px; }
              .block .row.variance-row {
                margin: 8px -12px -4px;
                padding: 10px 12px;
                background: #f1f5f9;
                border-top: 1px solid #cbd5e1;
                font-size: 1.05rem;
              }
              .block .row.variance-row .label {
                font-size: 1.05rem;
                font-weight: 800;
                color: #0f172a;
              }
              .block .row.variance-row .val { font-size: 1.05rem; font-weight: 800; }
              .block .label { color: #475569; font-size: 0.95rem; }
              .block .val {
                font-variant-numeric: tabular-nums;
                font-weight: 500;
                color: #0f172a;
                font-size: 0.95rem;
              }
              .block .val.total { font-weight: 700; }
              .block .val.variance.pos { color: #059669; }
              .block .val.variance.neg { color: #dc2626; }
              .expenses-detail, .notes-block {
                margin-top: 12px;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                overflow: hidden;
              }
              .expenses-detail .block-title, .notes-block .block-title {
                padding: 8px 12px;
                font-size: 0.95rem;
              }
              .expenses-detail .block-body, .notes-block .block-body {
                padding: 8px 12px;
              }
              .expense-item {
                padding: 6px 12px;
                font-size: 0.9rem;
                border-bottom: 1px solid #f1f5f9;
              }
              .expense-item:last-child { border-bottom: none; }
              .page-footer {
                margin-top: 14px;
                padding-top: 12px;
                border-top: 1px solid #e2e8f0;
                font-size: 0.85rem;
                color: #64748b;
                text-align: center;
                flex-shrink: 0;
              }
              .page-footer .footer-formulas {
                font-size: 0.75rem;
                color: #94a3b8;
                margin-bottom: 6px;
                line-height: 1.4;
              }
            </style>
          </head>
          <body>
            ${le}
            <script>setTimeout(function(){ window.print(); window.close(); }, 350);<\/script>
          </body>
        </html>
      `),M.document.close()},[]),Di=I.useCallback(async()=>{const A=await nd(e,v==="today"?50:v==="yesterday"?100:200),C=tc(A,v);Kt(C,`تقرير التقفيلات — ${v==="today"?"اليوم":v==="yesterday"?"أمس":"الأسبوع الماضي"}`,{firstActiveId:ie,currentUserName:n,branchLabel:Dr[e]})},[v,Kt,ie,n,e]),ms=I.useCallback(_=>{B(A=>{const C=new Set(A);return C.has(_)?C.delete(_):C.add(_),C})},[]),Mi=I.useCallback(()=>{if(ee.size===0){w({msg:"لم تحدد أي صفوف للطباعة",type:"warning"});return}const _=It.filter(A=>ee.has(A.id));Kt(_,"طباعة الصفوف المحددة",{firstActiveId:ie,currentUserName:n,branchLabel:Dr[e]})},[ee,It,Kt,ie,n,e]),Hn=I.useCallback(_=>{const A=It.find(C=>C.id===_);A&&Kt([A],"طباعة تقفيلة",{firstActiveId:ie,currentUserName:n,branchLabel:Dr[e]})},[It,Kt,ie,n,e]),ps=I.useCallback(_=>{ye(""),Ne(!1),oe({rowId:_,step:"confirm"})},[]),Er=I.useCallback(()=>{te&&oe(_=>_?{..._,step:"code"}:null)},[te]),rn=I.useCallback(async()=>{if(!te)return;if(st.trim()!==ro()){Ne(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ne(!1);const _=f.find(C=>C.id===te.rowId),A=(_==null?void 0:_.status)==="closed";await tg(e,te.rowId,A),B(C=>{const M=new Set(C);return M.delete(te.rowId),M}),await g(),oe(null),ye(""),et(!1),w({msg:"تم حذف الصف",type:"success"})},[te,st,g,e,f]),Qt=I.useCallback(()=>{ye(""),Ne(!1),me({step:"confirm"})},[]),Tr=I.useCallback(()=>{de&&me(_=>_?{..._,step:"code"}:null)},[de]),gs=I.useCallback(async()=>{if(de){if(st.trim()!==ro()){Ne(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ne(!1),await ng(e),B(new Set),await g(),me(null),ye(""),et(!1),w({msg:"تم حذف كل التقفيلات المغلقة",type:"success"})}},[de,st,g,e]),sn=_=>_==="cash"?"الكاش":_==="programBalanceBank"?"اجمالى الموازنه":_==="mada"?"مدى":_==="visa"?"فيزا":_==="mastercard"?"ماستر كارد":"تحويل بنكي",at=I.useCallback((_,A)=>{const C=document.querySelector(`[data-transfer-target][data-field="${A}"][data-row-id="${_}"]`);if(!C)return null;const M=C.getBoundingClientRect();return{x:M.x,y:M.y,width:M.width,height:M.height}},[]),xs=I.useCallback((_,A)=>{if(!ie){w({msg:"لا يوجد صف نشط لترحيل الكاش إليه",type:"warning"});return}const C=f.find(U=>U.id===ie),M=(C==null?void 0:C.cash)??0;if(M>0){T({amount:_,currentValue:M,field:"cash"});return}if(A){const U=at(ie,"cash");U&&Et({sourceRect:{...A},targetRect:{...U},amount:_,rowId:ie,field:"cash"})}Te(ie,"cash",_),w({msg:`تم ترحيل ${G(_)} إلى خانة الكاش`,type:"success"})},[ie,f,Te,at]),Ir=I.useCallback((_,A)=>{if(!ie){w({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const C=f.find(U=>U.id===ie);if(!C)return;const M=C.programBalanceBank??0;if(A){const U=at(ie,"programBalanceBank");U&&Et({sourceRect:{...A},targetRect:{...U},amount:_,rowId:ie,field:"programBalanceBank"})}Te(ie,"programBalanceBank",M+_),w({msg:`تم ترحيل ${G(_)} إلى اجمالى الموازنه`,type:"success"})},[ie,f,Te,at]),Ar=I.useCallback((_,A,C,M)=>{if(!ie){w({msg:"لا يوجد صف نشط لترحيل العمليات البنكية إليه",type:"warning"});return}const U=f.find(Be=>Be.id===ie);if(!U)return;const Y=U.mada??0,Q=U.visa??0,se=U.mastercard??0;if(Y>0&&_>0||Q>0&&A>0||se>0&&C>0){F({mada:_,visa:A,mastercard:C,currentMada:Y,currentVisa:Q,currentMaster:se});return}const K=_>0?_:A>0?A:C;if(M!=null&&M.sourceRect&&(M!=null&&M.targetField)&&K>0){const Be=at(ie,M.targetField);Be&&Et({sourceRect:{...M.sourceRect},targetRect:{...Be},amount:K,rowId:ie,field:M.targetField})}Te(ie,"mada",Y+_),Te(ie,"visa",Q+A),Te(ie,"mastercard",se+C);const we=[];_>0&&we.push(`مدى ${G(_)}`),A>0&&we.push(`فيزا ${G(A)}`),C>0&&we.push(`ماستر ${G(C)}`),w({msg:`تم ترحيل العمليات البنكية: ${we.join("، ")||"—"}`,type:"success"})},[ie,f,Te,at]),bs=I.useCallback(_=>{if(!y||!ie)return;const{mada:A,visa:C,mastercard:M,currentMada:U,currentVisa:Y,currentMaster:Q}=y;if(_){const le=_.currentTarget.getBoundingClientRect(),K={x:le.x,y:le.y,width:le.width,height:le.height},we=A>0?"mada":C>0?"visa":"mastercard",Be=A>0?A:C>0?C:M,Ie=at(ie,we);Ie&&Et({sourceRect:{...K},targetRect:{...Ie},amount:Be,rowId:ie,field:we})}Te(ie,"mada",U+A),Te(ie,"visa",Y+C),Te(ie,"mastercard",Q+M);const se=[];A>0&&se.push(`مدى ${G(A)}`),C>0&&se.push(`فيزا ${G(C)}`),M>0&&se.push(`ماستر ${G(M)}`),w({msg:`تم ترحيل العمليات البنكية: ${se.join("، ")||"—"}`,type:"success"}),F(null)},[y,ie,Te,at]),ys=I.useCallback(()=>{F(null)},[]),_s=I.useCallback(()=>{if(!Qe)return;Te(Qe.rowId,Qe.field,Qe.newValue);const _=sn(Qe.field);w({msg:`تم تعديل ${_} إلى ${G(Qe.newValue)}`,type:"success"}),yr(null)},[Qe,Te]),Li=I.useCallback(()=>{yr(null)},[]),Vt=I.useCallback(_=>{if(!(!k||!ie)){if(_){const A=_.currentTarget.getBoundingClientRect(),C={x:A.x,y:A.y,width:A.width,height:A.height},M=at(ie,k.field);M&&Et({sourceRect:{...C},targetRect:{...M},amount:k.amount,rowId:ie,field:k.field})}Te(ie,k.field,k.amount),w({msg:`تم ترحيل ${G(k.amount)} إلى ${sn(k.field)}`,type:"success"}),T(null)}},[k,ie,Te,at]),yt=I.useCallback(()=>{T(null)},[]),Cn=I.useCallback((_,A,C)=>{if(!ie){w({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const M=f.find(Y=>Y.id===ie),U=M?M[A]??0:0;if(U>0){T({amount:_,currentValue:U,field:A});return}if(C){const Y=at(ie,A);Y&&Et({sourceRect:{...C},targetRect:{...Y},amount:_,rowId:ie,field:A})}Te(ie,A,_),w({msg:`تم ترحيل ${G(_)} إلى ${sn(A)}`,type:"success"})},[ie,f,Te,at]);return l.jsxs("div",{className:"min-h-screen min-h-[100dvh] page-bg-warm dark:bg-slate-900 text-stone-900 dark:text-slate-200 font-cairo page-bg-pattern flex flex-col",children:[l.jsx("header",{className:"header-glass sticky top-0 z-40 border-b-2 border-stone-300 dark:border-white/10 shadow-sm dark:shadow-none safe-top",children:l.jsxs("div",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-2 flex flex-wrap items-center justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const{label:_,kind:A}=Tg(O),C="w-4 h-4 shrink-0",M={morning:l.jsxs("svg",{className:C,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),l.jsx("path",{d:"M12 2v1.5M12 20.5V22M4.22 4.22l1.06 1.06M18.72 18.72l1.06 1.06M2 12h1.5M20.5 12H22M4.22 19.78l1.06-1.06M18.72 5.28l1.06-1.06"})]}),noon:l.jsxs("svg",{className:C,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),l.jsx("path",{d:"M12 2.5v2M12 19.5V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2.5 12H5M19 12h2.5M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"}),l.jsx("path",{d:"M12 7.5v4l2.5 2.5",strokeWidth:"1.8"})]}),evening:l.jsxs("svg",{className:C,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}),l.jsx("path",{d:"M12 2v3M12 19v3M3.5 12H6.5M17.5 12h3M4.93 4.93l2.12 2.12M16.95 16.95l2.12 2.12M4.93 19.07l2.12-2.12M16.95 7.05l2.12-2.12",strokeWidth:"1.2",opacity:"0.7"})]}),night:l.jsx("svg",{className:C,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:l.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})},U=A==="night";return l.jsxs("h1",{className:"flex items-center gap-1.5 sm:gap-2 py-1.5 px-2 sm:px-3 rounded-lg sm:rounded-xl border-2 border-stone-300 dark:border-white/10 bg-[#f0ebe3] dark:bg-slate-800/50 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)]",children:[l.jsx("span",{className:`flex items-center justify-center w-7 h-7 sm:w-8 sm:h-8 rounded-lg shrink-0 ${U?"bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300":"bg-stone-200 text-stone-700 dark:bg-teal-500/15 dark:text-teal-400"}`,children:M[A]}),l.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-stone-800 dark:text-slate-200 tracking-tight flex items-center gap-1 min-w-0 truncate max-w-[120px] sm:max-w-none",children:[l.jsx("span",{className:U?"text-indigo-700 dark:text-indigo-300/90":"text-stone-800 dark:text-teal-400/95",children:_}),l.jsx("span",{className:"text-stone-600 dark:text-slate-400 font-normal",children:"،"}),l.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-cairo text-right",children:n})]})]})})(),l.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-stone-200 dark:bg-teal-500/15 text-stone-800 dark:text-teal-300 text-xs font-cairo font-semibold border-2 border-stone-400 dark:border-teal-500/30 shadow-sm dark:shadow-none",children:["فرع ",Dr[e]]}),l.jsx("div",{className:"relative z-[50] rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsx("button",{ref:a,type:"button",onClick:_=>{_.preventDefault(),_.stopPropagation(),lc()},className:"flex items-center justify-center w-9 h-9 rounded-lg text-stone-700 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 transition cursor-pointer select-none touch-manipulation",title:s==="dark"?"الوضع الفاتح":"الوضع الداكن","aria-label":s==="dark"?"الوضع الفاتح":"الوضع الداكن",children:s==="dark"?l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"4"}),l.jsx("path",{d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"})]}):l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})}),l.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsxs("button",{type:"button",onClick:()=>h(e==="corniche"?"andalusia":"corniche"),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 text-xs font-cairo transition",title:"تغيير الفرع",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),l.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),l.jsx("span",{children:"تغيير الفرع"})]})}),l.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-red-600 hover:text-red-700 hover:bg-red-500/15 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-500/10 text-xs font-cairo font-semibold transition border border-red-200 dark:border-red-500/30",title:"خروج — العودة لتسجيل الاسم والفرع",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"}),l.jsx("polyline",{points:"16 17 21 12 16 7"}),l.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),l.jsx("span",{children:"خروج"})]})}),l.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 text-xs font-cairo transition",title:"تغيير المستخدم",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"8",r:"4"}),l.jsx("path",{d:"M4 20c0-3.3 2.7-6 6-6s6 2.7 6 6"}),l.jsx("path",{d:"M16 11l3 3-3 3"}),l.jsx("path",{d:"M19 14h-5"})]}),l.jsx("span",{children:"تغيير المستخدم"})]})})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.jsx("input",{ref:Se,type:"file",accept:".xlsx,.xls",className:"hidden","aria-hidden":!0,onChange:Ye}),l.jsx("div",{className:"rounded-xl border border-violet-300 dark:border-violet-500/25 bg-violet-100 dark:bg-violet-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_8px_rgba(139,92,246,0.12)]",children:l.jsxs("button",{type:"button",onClick:ls,className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg text-sm font-cairo font-bold bg-teal-500 hover:bg-teal-600 dark:bg-gradient-to-r dark:from-violet-600 dark:to-indigo-600 dark:hover:from-violet-500 dark:hover:to-indigo-500 text-white border border-teal-400/50 dark:border-violet-400/30 shadow-md transition-all hover:scale-[1.02] active:scale-[0.98]",title:"استخراج قيم مدى، فيزا، ماستر كارد، تحويل بنكي من تقرير إكسل",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),l.jsx("path",{d:"M17 8l-5-5-5 5"}),l.jsx("path",{d:"M12 3v12"})]}),l.jsx("span",{children:"استخراج قيم"})]})}),l.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),l.jsxs("div",{className:"flex items-center gap-1 rounded-xl border-2 border-stone-400 dark:border-teal-500/30 page-surface-warm dark:bg-teal-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(20,184,166,0.12)]",children:[l.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-200 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400 shrink-0","aria-hidden":"true",children:l.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),l.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})}),Qg.map(_=>l.jsx("button",{type:"button",onClick:()=>x(_.id),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition ${v===_.id?"bg-teal-500/30 text-teal-900 border-2 border-teal-600 dark:bg-teal-500/25 dark:text-teal-300 dark:border-teal-500/40 shadow-sm":"text-stone-700 border border-transparent hover:bg-stone-300 hover:text-stone-900 dark:text-slate-400 dark:hover:bg-white/5 dark:hover:text-slate-300"}`,children:_.label},_.id))]}),l.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),l.jsxs("div",{className:"flex items-center gap-1.5 rounded-xl border border-stone-300 dark:border-sky-500/25 bg-stone-200 dark:bg-sky-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(14,165,233,0.08)]",children:[l.jsxs("button",{type:"button",onClick:Di,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-500 hover:bg-teal-600 dark:bg-sky-600 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:"طباعة كل الصفوف المعروضة",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M6 9V2h12v7"}),l.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),l.jsx("path",{d:"M6 14h12v8H6z"})]}),l.jsx("span",{children:"الكل"})]}),ee.size>0&&l.jsxs("button",{type:"button",onClick:Mi,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-400 hover:bg-teal-500 dark:bg-sky-500/90 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:`طباعة ${ee.size} صف محدد`,children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M6 9V2h12v7"}),l.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),l.jsx("path",{d:"M6 14h12v8H6z"})]}),l.jsxs("span",{children:["المحددة (",ee.size,")"]})]})]})]})]})}),l.jsxs("main",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-1 sm:py-2 flex flex-col gap-2 sm:gap-3 flex-1 min-h-0",children:[l.jsxs("div",{className:"rounded-2xl sm:rounded-3xl flex flex-col border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/30 backdrop-blur-sm shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] min-h-[200px] sm:min-h-[240px] min-w-0 overflow-hidden",children:[l.jsx("div",{className:"cashbox-table-scroll min-w-0 w-full overflow-x-auto overflow-y-hidden rounded-t-2xl sm:rounded-t-3xl scrollbar-thin",style:{scrollbarGutter:"stable"},children:l.jsxs("table",{className:"text-xs sm:text-sm border-separate w-full min-w-[1380px]",style:{tableLayout:"fixed",width:"100%",borderSpacing:0},children:[l.jsxs("colgroup",{children:[l.jsx("col",{style:{width:"2.2%"}}),l.jsx("col",{style:{width:"1.8%"}}),l.jsx("col",{style:{width:"7%"}}),l.jsx("col",{style:{width:"7%"}}),l.jsx("col",{style:{width:"7%"}}),l.jsx("col",{style:{width:"6%"}}),l.jsx("col",{style:{width:"8%"}}),l.jsx("col",{style:{width:"7%"}}),l.jsx("col",{style:{width:"5%"}}),l.jsx("col",{style:{width:"5%"}}),l.jsx("col",{style:{width:"6%"}}),l.jsx("col",{style:{width:"6%"}}),l.jsx("col",{style:{width:"6%"}}),l.jsx("col",{style:{width:"7%"}}),l.jsx("col",{style:{width:"7%"}}),l.jsx("col",{style:{width:"5%"}})]}),l.jsx("thead",{className:"border-b-2 border-stone-400 dark:border-slate-600",children:l.jsxs("tr",{children:[l.jsx("th",{className:"px-0.5 sm:px-1 py-3 sm:py-4 text-center text-xs font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[36px] rounded-t-2xl rounded-s-2xl sm:rounded-t-3xl sm:rounded-s-3xl bg-transparent",children:"تحديد"}),l.jsx("th",{className:"px-0.5 sm:px-1 py-3 sm:py-4 text-center text-xs font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[28px] bg-transparent",children:"م"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-r-2 border-stone-200 dark:border-teal-500/20 rounded-s-xl bg-stone-300/90 dark:bg-slate-700/90",children:"كاش"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"مرسل للخزنة — يدخل في معادلة انحراف الكاش",children:"مرسل للخزنة"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"يُخصم من المصروفات في انحراف الكاش",children:"تعويض م"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[76px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"المصروفات"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[110px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"كاش نزيل"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-rose-700 dark:text-rose-400 align-middle font-cairo whitespace-nowrap min-w-[92px] border-t-2 border-b-2 border-l-2 border-stone-200 dark:border-teal-500/20 rounded-e-xl bg-stone-300/90 dark:bg-slate-700/90",title:"الفرق بين المتوقع والفعلي للكاش",children:"انحراف الكاش"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-r-2 border-stone-200 dark:border-teal-500/20 rounded-s-xl bg-stone-300/90 dark:bg-slate-700/90",children:"مدى"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"فيزا"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[82px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"ماستر كارد"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-sky-600 dark:text-sky-400 align-middle font-cairo whitespace-nowrap min-w-[82px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"للعرض فقط — لا يدخل في بنك نزيل ولا انحراف البنك",children:"تحويل بنكي"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[76px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"بنك نزيل = مدى + فيزا + ماستر كارد",children:"بنك نزيل"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"اجمالى الموازنه"}),l.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-rose-700 dark:text-rose-400 align-middle font-cairo whitespace-nowrap min-w-[92px] border-t-2 border-b-2 border-l-2 border-stone-200 dark:border-teal-500/20 rounded-e-xl bg-stone-300/90 dark:bg-slate-700/90",title:"الفرق بين بنك نزيل واجمالى الموازنه",children:"انحراف البنك"}),l.jsx("th",{className:"px-0.5 py-1.5 sm:py-2 text-center align-middle font-cairo min-w-[44px] rounded-t-2xl rounded-e-2xl sm:rounded-t-3xl sm:rounded-e-3xl bg-transparent",children:l.jsxs("div",{className:"flex flex-col items-center justify-center gap-0.5 min-w-0",children:[l.jsx("span",{className:"text-[9px] sm:text-[10px] font-medium text-stone-700 dark:text-slate-300 whitespace-nowrap leading-none",children:"إجراءات"}),l.jsx("button",{type:"button",onClick:Qt,"aria-label":"حذف كل التقفيلات المغلقة",className:"inline-flex items-center justify-center w-5 h-5 rounded border border-stone-300 dark:border-white/10 bg-white dark:bg-slate-700/50 text-stone-600 dark:text-slate-400 hover:bg-rose-50 dark:hover:bg-red-500/10 hover:text-rose-600 dark:hover:text-rose-400 hover:border-rose-200 dark:hover:border-red-500/20 transition-all shrink-0",title:"حذف كل التقفيلات المغلقة",children:l.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),l.jsx("path",{d:"M10 11v6M14 11v6"})]})})]})})]})}),l.jsx("tbody",{children:zn.map((_,A)=>l.jsx(Sg,{row:_,rowNumber:A+1,rowIndex:A,isFirstActive:_.id===ie,liveNow:O,closingRowId:$,closingSecondsLeft:$===_.id?z:0,onUpdate:Te,isSelected:ee.has(_.id),onToggleSelect:ms,onDeleteRow:ps,onPrintRow:Hn,onOpenExpenseDetails:wr,onClearExpensesAndOpen:In,onLockedFieldClick:us,onExpenseCompensationExceeded:ds,lastExcelDetails:ke,onShowExcelDetails:(C,M)=>Rt({field:C,rowId:M}),onRequestConfirmBankEdit:ke?(C,M,U,Y)=>yr({rowId:C,field:M,oldValue:U,newValue:Y}):void 0,onShowEmployeeNames:gt.length>0?()=>Ht(!0):void 0,onShowVarianceExplanation:(C,M)=>ut({type:C,row:M}),currentUserName:n,onClearRow:C=>Gt(C),isStickyRows:!1},_.id))})]})}),(j>1||V)&&l.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-t-2 border-stone-400 dark:border-white/10 flex items-center justify-center gap-2 flex-wrap rounded-b-2xl sm:rounded-b-3xl page-surface-warm dark:bg-slate-800/50 backdrop-blur-sm",children:[l.jsxs("button",{type:"button",onClick:()=>L(j-1),disabled:j<=1,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-stone-300 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 hover:border-stone-400 dark:hover:bg-teal-500/20 dark:hover:border-teal-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة السابقة",children:[l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M15 18l-6-6 6-6"})}),"السابق"]}),l.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.max(j,1)},(_,A)=>A+1).map(_=>l.jsx("button",{type:"button",onClick:()=>L(_),className:`inline-flex items-center justify-center min-w-[2.25rem] px-2 py-2 rounded-xl text-sm font-cairo font-medium transition-all ${_===j?"bg-teal-500 dark:bg-teal-500/40 text-white border border-teal-500 dark:border-teal-500/50":"border border-stone-300 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 dark:hover:bg-teal-500/20"}`,"aria-label":_===1?"الرئيسية":`صفحة ${_}`,children:_===1?"١":_},_))}),l.jsxs("button",{type:"button",onClick:()=>L(j+1),disabled:!V,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-stone-300 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 hover:border-stone-400 dark:hover:bg-teal-500/20 dark:hover:border-teal-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة التالية",children:["التالي",l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M9 18l6-6-6-6"})})]})]}),It.length===0&&l.jsxs("div",{className:"py-16 px-4 text-center rounded-b-3xl page-surface-warm dark:bg-slate-800/20",children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-500 font-cairo mb-1",children:"لا توجد تقفيلات"}),l.jsx("p",{className:"text-stone-700 dark:text-slate-600 text-sm font-cairo",children:"اختر فلتراً مختلفاً أو ابدأ شفتاً جديداً"})]})]}),l.jsx("div",{className:"flex flex-col items-center justify-center gap-1.5 py-2 px-3 rounded-xl border-2 border-stone-400 dark:border-slate-600 page-surface-warm dark:bg-slate-800/90 min-h-0 shadow-sm dark:shadow-none",children:$?l.jsx("div",{className:"flex flex-wrap items-center justify-center w-full",dir:"ltr",children:z>0?l.jsxs("button",{type:"button",onClick:kr,className:"btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 border-teal-400 bg-teal-500 hover:bg-teal-600 text-white shadow-md dark:border-emerald-500/60 dark:bg-gradient-to-b dark:from-emerald-500/30 dark:to-emerald-600/20 dark:text-emerald-50 dark:shadow-[0_4px_24px_rgba(16,185,129,0.25)] dark:hover:from-emerald-500/40 dark:hover:to-emerald-600/30 dark:hover:shadow-[0_6px_28px_rgba(16,185,129,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all select-none touch-manipulation min-h-[36px]",children:[l.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 10h10a5 5 0 015 5v2"}),l.jsx("path",{d:"M7 15l-4-4 4-4"})]}),l.jsx("span",{className:"tracking-wide",children:"تراجع"}),l.jsxs("span",{className:"tabular-nums font-cairo",children:["(",z," ثانية)"]})]}):l.jsx("span",{className:"text-sm font-cairo font-medium text-stone-900 dark:text-teal-400 tabular-nums",children:"جاري الإغلاق..."})}):ie&&dt?l.jsxs("button",{type:"button",onClick:()=>hs(ie),disabled:!Tn,className:`btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 w-full sm:w-auto sm:min-w-[180px] rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 select-none transition-all touch-manipulation min-h-[36px]
                ${Tn?"bg-teal-500 hover:bg-teal-600 text-white border-teal-400 shadow-md dark:bg-gradient-to-b dark:from-teal-500/50 dark:to-teal-600/40 dark:text-white dark:border-teal-400 dark:shadow-[0_4px_24px_rgba(20,184,166,0.25)] dark:hover:from-teal-500/60 dark:hover:to-teal-600/50 dark:hover:shadow-[0_6px_28px_rgba(20,184,166,0.3)] hover:scale-[1.02] active:scale-[0.98]":"opacity-60 bg-stone-200 text-stone-500 border-stone-300 dark:opacity-50 dark:bg-slate-800/40 dark:text-slate-500 dark:border-slate-600/50 cursor-not-allowed"}`,title:Tn?"إغلاق الشفت وحفظ التقفيلة":"أدخل رصيد البرنامج كاش وإجمالي الموازنة (البنك) أولاً",children:[l.jsxs("svg",{className:`btn-close-shift-icon w-5 h-5 shrink-0 ${Tn?"text-white dark:text-teal-200":"text-stone-500 dark:text-slate-500"}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),l.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]}),l.jsx("span",{className:"tracking-wide",children:n?`إغلاق شفت ${n}`:"إغلاق الشفت الحالي"})]}):null}),l.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-[minmax(260px,320px)_1fr_1fr] gap-2 sm:gap-3 w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] items-stretch min-h-[180px] sm:min-h-[218px] xl:min-h-[244px] [&>div]:min-h-[154px] sm:[&>div]:min-h-[192px] xl:[&>div]:min-h-[218px]",children:[l.jsx("div",{className:"min-h-0 flex flex-col",children:l.jsx(Vg,{onTransfer:Cn,hasActiveRow:!!ie},`calculator-${X}`)}),l.jsx("div",{className:"min-h-0 flex flex-col",children:l.jsx(Dg,{onApplyToCash:xs,hasActiveRow:!!ie},`cashCalculator-${X}`)}),l.jsx("div",{className:"min-h-0 flex flex-col",children:l.jsx(Lg,{onTransfer:Ar,onTransferToBudget:Ir,hasActiveRow:!!ie,disableTransferButtons:!!ke},`bankOps-${X}`)})]})]}),b&&l.jsx(Bg,{message:b.msg,type:b.type,onClose:()=>w(null),position:"center",autoHideMs:b.autoHideMs}),kt&&l.jsx(Ug,{sourceRect:kt.sourceRect,targetRect:kt.targetRect,amount:kt.amount,formatCurrency:G,rowId:kt.rowId,field:kt.field,onEnd:()=>Et(null),onLanded:(_,A)=>{const C=document.querySelector(`[data-transfer-target][data-field="${A}"][data-row-id="${_}"]`);C&&(C.classList.add("transfer-land-pulse"),setTimeout(()=>C.classList.remove("transfer-land-pulse"),450))}}),Pe&&ke&&(()=>{const{field:_,rowId:A}=Pe,C=ke[_]??[],M=C.reduce((K,we)=>K+we.amount,0),U=f.find(K=>K.id===A),Y=U?U[_]??0:0,Q=Y-M,le=`سجل التغيير — ${{mada:"مدى",visa:"فيزا",mastercard:"ماستر كارد",bankTransfer:"تحويل بنكي"}[_]}`;return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"excel-detail-title",onClick:()=>Rt(null),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-sm w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:K=>K.stopPropagation(),children:[l.jsx("h2",{id:"excel-detail-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:le}),l.jsxs("div",{className:"p-3 space-y-2 border-b border-stone-200 dark:border-white/10",children:[l.jsxs("div",{className:"flex justify-between items-center text-sm",children:[l.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"من إكسل (مرفوع):"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-200",children:G(M)})]}),l.jsxs("div",{className:"flex justify-between items-center text-sm",children:[l.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الحالي في الخانة:"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-slate-200",children:G(Y)})]}),l.jsxs("div",{className:"flex justify-between items-center text-sm",children:[l.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الفرق (ترحيل أو تعديل يدوي):"}),l.jsx("span",{className:`tabular-nums font-medium ${Q>=0?"text-stone-800 dark:text-teal-400":"text-rose-600 dark:text-rose-400"}`,children:G(Q)})]})]}),C.length>0&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-2",children:[l.jsxs("p",{className:"text-xs font-cairo text-stone-500 dark:text-slate-400 mb-1",children:[C.length," عملية من الإكسل"]}),C.map((K,we)=>l.jsxs("div",{className:"py-2 border-b border-stone-200 dark:border-white/5",children:[l.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm text-stone-800 dark:text-slate-300",children:[l.jsx("div",{className:"flex flex-col items-start gap-0.5 min-w-0",children:K.employeeName?l.jsx("span",{className:"text-xs text-stone-500 font-cairo",children:K.employeeName}):null}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-200 shrink-0",children:G(K.amount)})]}),K.purpose&&l.jsx("p",{className:"text-xs font-cairo text-stone-600 dark:text-slate-300 mt-1 pr-0 border-t border-stone-300 dark:border-teal-500/25 pt-1",children:K.purpose})]},we))]}),l.jsxs("div",{className:"p-4 pt-2 border-t border-stone-300 dark:border-teal-500/30 flex justify-between items-center bg-stone-100 dark:bg-slate-900/50",children:[l.jsx("span",{className:"font-bold text-stone-800 dark:text-slate-200",children:"إجمالي الإكسل"}),l.jsx("span",{className:"tabular-nums font-bold text-stone-800 dark:text-teal-400",children:G(M)})]})]}),l.jsx("div",{className:"p-3",children:l.jsx("button",{type:"button",onClick:()=>Rt(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-500 hover:bg-teal-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white dark:text-slate-200 transition",children:"إغلاق"})})]})})})(),En&&gt.length>0&&(()=>{const _=gt.map(A=>{let C=0,M=0;if(ke)for(const U of["mada","visa","mastercard","bankTransfer"]){const Y=ke[U]??[];for(const Q of Y)(Q.employeeName??"").trim()===A&&(C+=1,M+=Q.amount)}return{name:A,count:C,total:M}});return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"employee-names-title",onClick:()=>Ht(!1),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:A=>A.stopPropagation(),children:[l.jsx("h2",{id:"employee-names-title",className:"text-base font-bold text-stone-800 dark:text-teal-400 p-4 pb-2 border-b border-white/10",children:"أسماء الموظفين في العمليات المستوردة"}),l.jsx("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-1.5",children:_.map((A,C)=>l.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm text-slate-300 py-2 px-3 rounded-lg bg-slate-900/50 border border-white/5 font-cairo",children:[l.jsx("span",{className:"font-medium text-slate-200",children:A.name}),l.jsxs("span",{className:"tabular-nums text-stone-800 dark:text-slate-200 text-xs",children:[A.count," عملية — الإجمالي: ",G(A.total)]})]},C))}),l.jsx("div",{className:"p-3 border-t border-white/10",children:l.jsx("button",{type:"button",onClick:()=>Ht(!1),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إغلاق"})})]})})})(),He&&(()=>{const{type:_,row:A}=He,C=A.cash??0,M=A.sentToTreasury??0,U=A.expenses??0,Y=A.expenseCompensation??0,Q=Math.max(0,U-Y),se=A.programBalanceCash??0,le=C+M+Q,K=Ks(A),we=A.mada+A.visa+A.mastercard,Be=A.programBalanceBank??0,Ie=Gs(A),lt=_==="cash",_t=lt?"شرح انحراف الكاش":"شرح انحراف البنك",Dt=K!==0&&Ie!==0&&K>0!=Ie>0,Mt=Math.abs(Math.abs(K)-Math.abs(Ie))<=Kg,ht=Dt&&Mt,on=ht?Math.abs(K):0;return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"variance-explanation-title",onClick:()=>ut(null),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:ft=>ft.stopPropagation(),children:[l.jsx("h2",{id:"variance-explanation-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:_t}),l.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-4 space-y-3 text-sm text-stone-800 dark:text-slate-300",children:[lt?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"font-semibold text-stone-900 dark:text-teal-300",children:"انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش"}),l.jsxs("ul",{className:"space-y-1.5 list-none",children:[l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"كاش"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(C)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مرسل للخزنة"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(M)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مصروفات"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(U)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"تعويض مصروفات"}),l.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",G(Y)]})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5",children:[l.jsx("span",{children:"مصروفات فعّالة (صافي)"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(Q)})]}),l.jsxs("li",{className:"flex justify-between gap-2 font-medium",children:[l.jsx("span",{children:"كاش + مرسل للخزنة + مصروفات فعّالة"}),l.jsx("span",{className:"tabular-nums font-bold text-stone-900 dark:text-teal-300",children:G(le)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"رصيد البرنامج كاش"}),l.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",G(se)]})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-stone-400 dark:border-teal-500/30 pt-2 font-bold text-stone-900 dark:text-teal-300",children:[l.jsx("span",{children:"انحراف الكاش"}),l.jsxs("span",{className:"tabular-nums",children:[K>0?"+":"",G(K)]})]})]}),l.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:K>0?"زيادة: الكاش الفعلي (أو المرسل + المصروف الفعلي) أكبر من رصيد البرنامج.":K<0?"عجز: رصيد البرنامج كاش أكبر من المتوقّع من الكاش والمرسل والمصروف.":"لا يوجد انحراف."})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"font-semibold text-stone-900 dark:text-teal-300",children:"انحراف البنك = بنك نزيل − اجمالى الموازنه"}),l.jsxs("ul",{className:"space-y-1.5 list-none",children:[l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مدى"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(A.mada)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"فيزا"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(A.visa)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"ماستر كارد"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(A.mastercard)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsxs("span",{children:["تحويل بنكي ",l.jsx("span",{className:"text-stone-500 dark:text-slate-500 text-[10px]",children:"(للعرض فقط)"})]}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(A.bankTransfer)})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5 font-medium",children:[l.jsx("span",{children:"بنك نزيل (مدى+فيزا+ماستر)"}),l.jsx("span",{className:"tabular-nums font-bold text-stone-900 dark:text-teal-300",children:G(we)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"اجمالى الموازنه"}),l.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",G(Be)]})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-stone-400 dark:border-teal-500/30 pt-2 font-bold text-stone-900 dark:text-teal-300",children:[l.jsx("span",{children:"انحراف البنك"}),l.jsxs("span",{className:"tabular-nums",children:[Ie>0?"+":"",G(Ie)]})]})]}),l.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:Ie>0?"زيادة: بنك نزيل أكبر من اجمالى الموازنه المدخل.":Ie<0?"عجز: اجمالى الموازنه أكبر من بنك نزيل.":"لا يوجد انحراف."})]}),ht&&l.jsxs("div",{className:"mt-3 p-3 rounded-xl border-2 border-stone-400 dark:border-teal-500/30 bg-stone-100 dark:bg-teal-900/20 text-stone-800 dark:text-teal-200 text-sm font-medium",children:["تنبيه: قد تكون سندات بقيمة ",l.jsx("strong",{children:on.toLocaleString("ar-SA",{minimumFractionDigits:2})})," ريال دخلت في خانة خاطئة (نقداً ↔ شبكة). راجع تحويل المبلغ بين الكاش وبنك نزيل."]})]}),l.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/10",children:l.jsx("button",{type:"button",onClick:()=>ut(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),We&&(()=>{const{cashVar:_,bankVar:A}=We,C=_!==0?_>0?"زيادة في صندوق الكاش — راجع الرصيد الفعلي":"عجز في صندوق الكاش — راجع الكاش والرصيد والمصروف":"",M=A!==0?A>0?"زيادة في البنك — راجع إدخالات مدى/فيزا/ماستر أو اجمالى الموازنه":"عجز في البنك — راجع بنك نزيل أو اجمالى الموازنه":"";return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"close-variance-title",children:l.jsxs("div",{className:"rounded-2xl border-2 border-teal-300 dark:border-teal-500/30 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"close-variance-title",className:"text-lg font-bold text-stone-900 dark:text-teal-400 mb-3",children:"تنبيه: يوجد انحراف"}),l.jsxs("div",{className:"text-stone-800 dark:text-slate-300 text-sm leading-relaxed mb-4 space-y-2",children:[_!==0&&l.jsxs("p",{className:"block",children:[l.jsx("span",{className:"font-medium",children:"انحراف الكاش: "}),l.jsxs("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:[_>0?"+":"",G(_)]}),C&&l.jsx("span",{className:"block text-stone-600 dark:text-slate-200 text-xs mt-0.5",children:C})]}),A!==0&&l.jsxs("p",{className:"block",children:[l.jsx("span",{className:"font-medium",children:"انحراف البنك: "}),l.jsxs("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:[A>0?"+":"",G(A)]}),M&&l.jsx("span",{className:"block text-stone-600 dark:text-slate-200 text-xs mt-0.5",children:M})]}),l.jsx("p",{className:"pt-2 text-stone-700 dark:text-slate-200",children:"هل تريد الإغلاق مع هذا الانحراف؟"})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:fs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، إغلاق الشفت"}),l.jsx("button",{type:"button",onClick:vr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا، متابعة التعديل"})]})]})})})(),k&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"transfer-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsxs("h2",{id:"transfer-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:["ترحيل إلى ",sn(k.field)]}),l.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد ترحيل الرقم الجديد وهو ",l.jsx("span",{className:"font-bold text-white tabular-nums",children:G(k.amount)}),"؟ يوجد رقم في الخانة وهو ",l.jsx("span",{className:"font-bold text-white tabular-nums",children:G(k.currentValue)}),"."]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:_=>Vt(_),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:yt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),y&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-transfer-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"bank-transfer-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"ترحيل العمليات البنكية"}),l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"هل تريد ترحيل الأرقام الجديدة؟ توجد قيم في الخانات:"}),l.jsxs("ul",{className:"text-sm text-stone-700 dark:text-slate-300 space-y-1.5 mb-4",children:[y.mada>0&&l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مدى:"}),l.jsxs("span",{className:"tabular-nums",children:["مرحّل ",l.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:G(y.mada)})," — في الخانة ",l.jsx("strong",{children:G(y.currentMada)})]})]}),y.visa>0&&l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"فيزا:"}),l.jsxs("span",{className:"tabular-nums",children:["مرحّل ",l.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:G(y.visa)})," — في الخانة ",l.jsx("strong",{children:G(y.currentVisa)})]})]}),y.mastercard>0&&l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"ماستر:"}),l.jsxs("span",{className:"tabular-nums",children:["مرحّل ",l.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:G(y.mastercard)})," — في الخانة ",l.jsx("strong",{children:G(y.currentMaster)})]})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:_=>bs(_),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:ys,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),Qe&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-edit-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsxs("h2",{id:"bank-edit-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:["تعديل خانة ",sn(Qe.field)]}),l.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد تعديل الرقم من ",l.jsx("span",{className:"font-bold tabular-nums",children:G(Qe.oldValue)})," إلى ",l.jsx("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:G(Qe.newValue)}),"؟"]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:_s,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:Li,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),Tt&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"clear-row-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"clear-row-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"إفراغ الصف"}),l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد إفراغ كل المدخلات في هذا الصف؟ (كاش، مدى، فيزا، ماستر، اجمالى الموازنه، مصروفات، وغيرها)"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:An,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:Vi,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),Ee&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"expense-modal-title",onClick:()=>St(null),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-lg w-full max-h-[85vh] flex flex-col font-cairo cursor-auto",onClick:_=>_.stopPropagation(),onKeyDown:_=>{_.key==="Enter"&&!Ee.readOnly&&(_.preventDefault(),Pt())},children:[l.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[l.jsx("h2",{id:"expense-modal-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400",children:Ee.readOnly?"تفاصيل المصروفات":"تصنيف المبلغ المصروف"}),l.jsx("button",{type:"button",onClick:()=>St(null),className:"p-2 rounded-lg text-stone-500 hover:text-white hover:bg-white/10 transition","aria-label":"إغلاق",children:l.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),!Ee.readOnly&&l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-500 text-sm px-4 pt-2",children:"أدخل تفاصيل المصروف (مثال: 10 ريال كتب، 10 ريال مسطرة)"}),(Ee.carriedCount??0)>0&&l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-xs px-4 pt-0.5 font-cairo",children:"البنود المرحّلة للعرض فقط — يمكنك إضافة تصنيف ومبلغ جديد فقط، ويُحدَّث المجموع وخانة المصروفات تلقائياً."})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[!Ee.readOnly&&Ee.items.length>0&&l.jsxs("div",{className:"flex gap-2 items-center pb-0.5",children:[l.jsx("span",{className:"flex-1 text-xs font-medium text-stone-700 font-cairo",children:"بند المصروف"}),l.jsx("span",{className:"w-24 text-xs font-medium text-stone-700 font-cairo text-center",children:"مبلغ المصروف"}),l.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}),Ee.items.map((_,A)=>{const C=Ee.carriedCount??0,M=!Ee.readOnly&&A<C;return l.jsx("div",{className:"flex gap-2 items-center",children:Ee.readOnly||M?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"w-24 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm text-center tabular-nums",children:G(Number(_.amount)||0)}),l.jsxs("span",{className:"flex-1 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm font-cairo",children:[_.description||"—",M&&l.jsx("span",{className:"mr-1 text-[10px] text-stone-600 font-cairo",title:"من الشفت السابق",children:" (مرحّل)"})]}),!Ee.readOnly&&M?l.jsx("button",{type:"button",onClick:()=>nn(Ee.rowId,A),className:"shrink-0 w-8 h-8 flex items-center justify-center rounded-lg border border-red-500/20 text-slate-400 hover:text-red-400 hover:border-red-500/40",title:"حذف البند المرحّل (يتطلب كود أدمن)","aria-label":"حذف بند مرحّل",children:l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}):l.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}):l.jsxs(l.Fragment,{children:[(()=>{const U=ot.current[A]!==void 0?ot.current[A]:String(_.amount??""),Y=(Number(String(U).replace(/,/g,""))||0)>0,Q=!String(_.description||"").trim(),se=Y&&Q,le=_r===A;return l.jsx("input",{ref:K=>{!K||A!==C||Ee.readOnly||jt.current===Ee.rowId||(jt.current=Ee.rowId,K.focus())},type:"text",tabIndex:A===C?0:-1,value:_.description,onChange:K=>{tn(A,"description",K.target.value),_r===A&&en(null)},onKeyDown:K=>{K.key==="Enter"&&(K.preventDefault(),Pt())},placeholder:Y?"الوصف إلزامي":"الوصف",title:Y?"الوصف إلزامي عند وجود مبلغ":void 0,"aria-required":Y,className:`flex-1 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 dark:focus:border-teal-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-teal-500/25 ${se?"border-teal-500 dark:border-teal-500/50 ring-1 ring-teal-500/25":"border-stone-300 dark:border-teal-500/30"} ${le?"expense-description-pulse":""}`})})(),l.jsx("input",{type:"text",inputMode:"decimal",tabIndex:-1,dir:"ltr",value:Ln(ot.current[A]!==void 0?ot.current[A]:String(_.amount??"")),onChange:U=>{let Y=Ln(U.target.value).replace(/[^\d.]/g,"");const Q=Y.indexOf(".");Q>=0&&(Y=Y.slice(0,Q+1)+Y.slice(Q+1).replace(/\./g,"")),ot.current[A]=Y,tn(A,"amount",Y)},onKeyDown:U=>{U.key==="Enter"&&(U.preventDefault(),Pt())},placeholder:"مبلغ",className:"cashbox-input w-24 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border border-stone-300 dark:border-teal-500/30 text-stone-900 dark:text-white text-sm text-center focus:border-teal-500/50 dark:focus:border-teal-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-teal-500/25"}),l.jsx("button",{type:"button",tabIndex:-1,onClick:()=>ji(A),disabled:Ee.items.length<=1,className:"p-2 rounded-lg text-stone-500 hover:text-red-400 hover:bg-red-500/20 disabled:opacity-40 disabled:pointer-events-none transition","aria-label":"حذف السطر",title:"حذف",children:l.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})},A)})]}),l.jsxs("div",{className:"p-4 border-t border-white/10 flex flex-wrap items-center gap-3",children:[!Ee.readOnly&&l.jsxs("button",{type:"button",tabIndex:-1,onClick:Si,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium bg-stone-200 text-stone-800 border-2 border-stone-400 hover:bg-stone-300 transition",children:[l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 5v14M5 12h14"})}),"إضافة سطر"]}),l.jsx("div",{className:"flex-1"}),Ee.readOnly?l.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",l.jsx("span",{className:"font-bold text-stone-800 dark:text-teal-400 tabular-nums",children:G(Ee.items.reduce((_,A)=>_+(Number(A.amount)||0),0))})]}):l.jsxs("div",{className:"flex flex-col items-end gap-2",children:[l.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",l.jsx("span",{className:"font-bold text-stone-800 dark:text-teal-400 tabular-nums",children:G(Ee.items.reduce((_,A)=>_+(Number(A.amount)||0),0))})]}),l.jsx("button",{type:"button",onClick:Pt,onKeyDown:_=>{(_.key==="Enter"||_.key===" "||_.key==="Tab")&&(_.preventDefault(),Pt())},className:"px-4 py-2 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-slate-800 focus:shadow-[0_0_16px_rgba(16,185,129,0.4)]",children:"تعديل مبلغ المصروفات"})]})]})]})}),fe&&l.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-carried-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"delete-carried-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:fe.step==="confirm"?"حذف بند مرحّل":"كود الأدمن"}),fe.step==="confirm"?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف هذا البند المرحّل؟ يتطلب إدخال كود الأدمن في الخطوة التالية."}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:Pi,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:()=>{_e(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),it&&l.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),l.jsxs("div",{className:"relative mb-4",children:[l.jsx("input",{type:ze?"text":"password",value:st,onChange:_=>{ye(_.target.value),Ne(!1)},onKeyDown:_=>{_.key==="Enter"&&cs(),_.key==="Escape"&&(_e(null),ye(""),Ne(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${it?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/10"}`,autoFocus:!0}),l.jsx("button",{type:"button",onClick:()=>et(_=>!_),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":ze?"إخفاء الكود":"إظهار الكود",children:ze?l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),l.jsx("path",{d:"M1 1l22 22"})]}):l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:cs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),l.jsx("button",{type:"button",onClick:()=>{_e(null),ye(""),et(!1),Ne(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),te&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"delete-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:te.step==="confirm"?"حذف الصف":"كود الأدمن"}),te.step==="confirm"?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف الصف؟"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:Er,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:()=>oe(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),it&&l.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),l.jsxs("div",{className:"relative mb-4",children:[l.jsx("input",{type:ze?"text":"password",value:st,onChange:_=>{ye(_.target.value),Ne(!1)},onKeyDown:_=>{_.key==="Enter"&&rn(),_.key==="Escape"&&(oe(null),ye(""),Ne(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${it?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/10"}`,autoFocus:!0}),l.jsx("button",{type:"button",onClick:()=>et(_=>!_),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":ze?"إخفاء الكود":"إظهار الكود",title:ze?"إخفاء":"إظهار",children:ze?l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),l.jsx("path",{d:"M1 1l22 22"})]}):l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:rn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),l.jsx("button",{type:"button",onClick:()=>{oe(null),ye(""),et(!1),Ne(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),de&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-all-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"delete-all-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:de.step==="confirm"?"حذف كل التقفيلات المغلقة":"كود الأدمن"}),de.step==="confirm"?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف كل التقفيلات المغلقة؟"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:Tr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:()=>me(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),it&&l.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),l.jsxs("div",{className:"relative mb-4",children:[l.jsx("input",{type:ze?"text":"password",value:st,onChange:_=>{ye(_.target.value),Ne(!1)},onKeyDown:_=>{_.key==="Enter"&&gs(),_.key==="Escape"&&(me(null),ye(""),Ne(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${it?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/10"}`,autoFocus:!0}),l.jsx("button",{type:"button",onClick:()=>et(_=>!_),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":ze?"إخفاء الكود":"إظهار الكود",title:ze?"إخفاء":"إظهار",children:ze?l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),l.jsx("path",{d:"M1 1l22 22"})]}):l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:gs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),l.jsx("button",{type:"button",onClick:()=>{me(null),ye(""),et(!1),Ne(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),u&&l.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"switch-branch-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"switch-branch-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"تغيير الفرع"}),l.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد الانتقال إلى فرع ",Dr[u],"؟"]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:()=>{r(u),h(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، الانتقال"}),l.jsx("button",{type:"button",onClick:()=>h(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})})]})}const Jg=["cash","sentToTreasury","expenseCompensation","expenses","mada","visa","mastercard","bankTransfer","programBalanceCash","programBalanceBank"],so="cashbox_name",Fs="cashbox_branch",Ro="cashbox_session_start",Xg=6*60*60*1e3;function Zg(n){return n==="corniche"||n==="andalusia"}function cc(){const n=sessionStorage.getItem(Ro);if(!n)return!0;const e=parseInt(n,10);return Number.isNaN(e)?!0:Date.now()-e>=Xg}function ex(){const[n,e]=I.useState(null),[t,r]=I.useState("corniche"),[s,o]=I.useState(!1),[a,u]=I.useState("dark");I.useEffect(()=>{const E=sessionStorage.getItem(so),N=sessionStorage.getItem(Fs);E!=null&&E.trim()&&Zg(N)&&!cc()&&(e(E.trim()),r(N));const j=Hg();u(j),No(j),o(!0)},[]),I.useEffect(()=>{const E=N=>u(N.detail);return window.addEventListener("cashbox-theme-change",E),()=>window.removeEventListener("cashbox-theme-change",E)},[]),I.useEffect(()=>{No(a)},[a]);const h=I.useCallback(()=>{sessionStorage.removeItem(so),sessionStorage.removeItem(Fs),sessionStorage.removeItem(Ro),e(null),r("corniche")},[]),f=(E,N)=>{sessionStorage.setItem(so,E),sessionStorage.setItem(Fs,N),sessionStorage.setItem(Ro,Date.now().toString()),e(E),r(N)},m=E=>{sessionStorage.setItem(Fs,E),r(E)};if(I.useEffect(()=>{if(!n)return;const N=setInterval(()=>{cc()&&h()},6e4);return()=>clearInterval(N)},[n,h]),!s)return l.jsx("div",{className:"min-h-screen page-bg-warm dark:bg-slate-900 flex items-center justify-center",children:l.jsx("div",{className:"text-slate-700 dark:text-slate-500 font-cairo",children:"جاري التحميل..."})});const g=()=>dd();return n?l.jsx(Yg,{name:n,branch:t,onExit:h,onSwitchBranch:m,theme:a,onToggleTheme:g},t):l.jsx(Ad,{onEnter:f})}io.createRoot(document.getElementById("root")).render(l.jsx(gd.StrictMode,{children:l.jsx(ex,{})}));
