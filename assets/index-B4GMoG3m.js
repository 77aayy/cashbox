import{r as I,a as _n,R as _d}from"./vendor-react-wGySg1uH.js";import{r as wd,u as fn}from"./vendor-xlsx-DLNWaC59.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var hc={exports:{}},pi={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vd=I,kd=Symbol.for("react.element"),Ed=Symbol.for("react.fragment"),Td=Object.prototype.hasOwnProperty,Id=vd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ad={key:!0,ref:!0,__self:!0,__source:!0};function fc(n,e,t){var r,s={},o=null,l=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)Td.call(e,r)&&!Ad.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:kd,type:n,key:o,ref:l,props:s,_owner:Id.current}}pi.Fragment=Ed;pi.jsx=fc;pi.jsxs=fc;hc.exports=pi;var a=hc.exports,lo={},Ba=_n;lo.createRoot=Ba.createRoot,lo.hydrateRoot=Ba.hydrateRoot;const Cd=/^[\p{L}\s]*$/u;function Nd(n){return Cd.test(n)&&n.length>0&&new RegExp("\\p{L}","u").test(n)}const Rd=[{id:"corniche",label:"الكورنيش"},{id:"andalusia",label:"الأندلس"}];function Sd({onEnter:n}){const[e,t]=I.useState(""),[r,s]=I.useState("corniche"),[o,l]=I.useState(""),u=Nd(e.trim());function h(m){const g=m.target.value;/\d/.test(g)||(t(g),l(""))}function f(m){m.preventDefault();const g=e.trim();if(/\d/.test(g)){l("الاسم حروف فقط — بدون أرقام");return}if(!new RegExp("\\p{L}","u").test(g)){l("أدخل اسمك (حروف فقط)");return}l(""),n(g,r)}return a.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-br from-[#f4ebe0] via-[#f8f3ed] to-[#efe6dc] dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex flex-col items-center justify-center p-4 sm:p-6 safe-top safe-bottom",children:a.jsxs("div",{className:"w-full max-w-[95vw] sm:max-w-md bg-stone-50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl sm:rounded-3xl border border-stone-300 dark:border-white/20 shadow-xl dark:shadow-2xl p-5 sm:p-8",children:[a.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-primary-500 font-cairo mb-2",children:"أهلاً بك"}),a.jsx("p",{className:"text-sm sm:text-base text-stone-700 dark:text-slate-400 font-cairo",children:"اكتب اسمك للدخول"})]}),a.jsxs("form",{onSubmit:f,className:"space-y-4 sm:space-y-5",children:[o&&a.jsx("div",{className:"p-3 rounded-xl bg-red-50 dark:bg-red-500/20 border border-red-200 dark:border-red-500/40 text-red-700 dark:text-red-300 text-sm font-cairo",children:o}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الاسم (حروف فقط)"}),a.jsx("input",{id:"name",type:"text",value:e,onChange:h,placeholder:"أدخل اسمك",className:"w-full px-4 py-3 rounded-xl bg-stone-100 dark:bg-slate-900/80 border border-stone-300 dark:border-white/20 text-stone-900 dark:text-white placeholder-stone-500 dark:placeholder-slate-500 focus:border-primary-500/50 focus:ring-1 focus:ring-primary-500/25 focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-900 font-cairo",autoComplete:"off",autoFocus:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الفرع"}),a.jsx("div",{className:"flex gap-2",children:Rd.map(m=>a.jsx("button",{type:"button",onClick:()=>s(m.id),className:`flex-1 py-3 rounded-xl font-cairo font-semibold text-sm border-2 transition ${r===m.id?"bg-primary-500 border-primary-600 text-white dark:bg-amber-500/30 dark:border-amber-500/50 dark:text-amber-200":"bg-stone-100 dark:bg-slate-900/80 border-stone-300 dark:border-white/20 text-stone-700 dark:text-slate-300 hover:border-primary-400 dark:hover:border-amber-500/40"}`,children:m.label},m.id))})]}),a.jsx("button",{type:"submit",disabled:!u,className:"w-full py-3 sm:py-3.5 rounded-xl font-bold font-cairo text-sm sm:text-base bg-primary-500 hover:bg-primary-600 text-white disabled:opacity-40 disabled:cursor-not-allowed transition focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none min-h-[44px] touch-manipulation",children:"دخول"})]})]})})}const jd="modulepreload",Pd=function(n){return"/cashbox/"+n},$a={},Vd=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(t.map(h=>{if(h=Pd(h),h in $a)return;$a[h]=!0;const f=h.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":jd,f||(g.as="script"),g.crossOrigin="",g.href=h,u&&g.setAttribute("nonce",u),document.head.appendChild(g),f)return new Promise((E,C)=>{g.addEventListener("load",E),g.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return s.then(l=>{for(const u of l||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})},Dd=()=>{};var Ua={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Md=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],l=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(l&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],l=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|l&63)}}return e.join("")},pc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],l=s+1<n.length,u=l?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,m=o>>2,g=(o&3)<<4|u>>4;let E=(u&15)<<2|f>>6,C=f&63;h||(C=64,l||(E=64)),r.push(t[m],t[g],t[E],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(mc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Md(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const f=s<n.length?t[n.charAt(s)]:64;++s;const g=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||f==null||g==null)throw new Ld;const E=o<<2|u>>4;if(r.push(E),f!==64){const C=u<<4&240|f>>2;if(r.push(C),g!==64){const j=f<<6&192|g;r.push(j)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Ld extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Od=function(n){const e=mc(n);return pc.encodeByteArray(e,!0)},Xs=function(n){return Od(n).replace(/\./g,"")},Fd=function(n){try{return pc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $d=()=>Bd().__FIREBASE_DEFAULTS__,Ud=()=>{if(typeof process>"u"||typeof Ua>"u")return;const n=Ua.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},qd=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Fd(n[1]);return e&&JSON.parse(e)},Vo=()=>{try{return Dd()||$d()||Ud()||qd()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},zd=n=>{var e,t;return(t=(e=Vo())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Wd=n=>{const e=zd(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},gc=()=>{var n;return(n=Vo())==null?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Gd(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Xs(JSON.stringify(t)),Xs(JSON.stringify(l)),""].join(".")}const Qr={};function Qd(){const n={prod:[],emulator:[]};for(const e of Object.keys(Qr))Qr[e]?n.emulator.push(e):n.prod.push(e);return n}function Yd(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let qa=!1;function Jd(n,e){if(typeof window>"u"||typeof document>"u"||!Do(window.location.host)||Qr[n]===e||Qr[n]||qa)return;Qr[n]=e;function t(E){return`__firebase__banner__${E}`}const r="__firebase__banner",o=Qd().prod.length>0;function l(){const E=document.getElementById(r);E&&E.remove()}function u(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,C){E.setAttribute("width","24"),E.setAttribute("id",C),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function f(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{qa=!0,l()},E}function m(E,C){E.setAttribute("id",C),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function g(){const E=Yd(r),C=t("text"),j=document.getElementById(C)||document.createElement("span"),L=t("learnmore"),V=document.getElementById(L)||document.createElement("a"),O=t("preprendIcon"),U=document.getElementById(O)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const G=E.element;u(G),m(V,L);const Y=f();h(U,O),G.append(U,j,V,Y),document.body.appendChild(G)}o?(j.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,j.innerText="Preview backend running in this workspace."),j.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Zd(){var e;const n=(e=Vo())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function eh(){return!Zd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function th(){try{return typeof indexedDB=="object"}catch{return!1}}function nh(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)==null?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rh="FirebaseError";class Er extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=rh,Object.setPrototypeOf(this,Er.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xc.prototype.create)}}class xc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],l=o?sh(o,r):"Error",u=`${this.serviceName}: ${l} (${s}).`;return new Er(s,u,r)}}function sh(n,e){return n.replace(ih,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const ih=/\{\$([^}]+)}/g;function Zs(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],l=e[s];if(za(o)&&za(l)){if(!Zs(o,l))return!1}else if(o!==l)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function za(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function On(n){return n&&n._delegate?n._delegate:n}class Zr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Hd;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(lh(e))try{this.getOrInitializeService({instanceIdentifier:Mn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=Mn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mn){return this.instances.has(e)}getOptions(e=Mn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&l.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ah(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Mn){return this.component?this.component.multipleInstances?e:Mn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ah(n){return n===Mn?void 0:n}function lh(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new oh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var be;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(be||(be={}));const uh={debug:be.DEBUG,verbose:be.VERBOSE,info:be.INFO,warn:be.WARN,error:be.ERROR,silent:be.SILENT},dh=be.INFO,hh={[be.DEBUG]:"log",[be.VERBOSE]:"log",[be.INFO]:"info",[be.WARN]:"warn",[be.ERROR]:"error"},fh=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=hh[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bc{constructor(e){this.name=e,this._logLevel=dh,this._logHandler=fh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in be))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?uh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,be.DEBUG,...e),this._logHandler(this,be.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,be.VERBOSE,...e),this._logHandler(this,be.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,be.INFO,...e),this._logHandler(this,be.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,be.WARN,...e),this._logHandler(this,be.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,be.ERROR,...e),this._logHandler(this,be.ERROR,...e)}}const mh=(n,e)=>e.some(t=>n instanceof t);let Wa,Ha;function ph(){return Wa||(Wa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gh(){return Ha||(Ha=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yc=new WeakMap,co=new WeakMap,_c=new WeakMap,Hi=new WeakMap,Mo=new WeakMap;function xh(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",l)},o=()=>{t(pn(n.result)),s()},l=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",l)});return e.then(t=>{t instanceof IDBCursor&&yc.set(t,n)}).catch(()=>{}),Mo.set(e,n),e}function bh(n){if(co.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",l),n.removeEventListener("abort",l)},o=()=>{t(),s()},l=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",l),n.addEventListener("abort",l)});co.set(n,e)}let uo={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return co.get(n);if(e==="objectStoreNames")return n.objectStoreNames||_c.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return pn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function yh(n){uo=n(uo)}function _h(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Gi(this),e,...t);return _c.set(r,e.sort?e.sort():[e]),pn(r)}:gh().includes(n)?function(...e){return n.apply(Gi(this),e),pn(yc.get(this))}:function(...e){return pn(n.apply(Gi(this),e))}}function wh(n){return typeof n=="function"?_h(n):(n instanceof IDBTransaction&&bh(n),mh(n,ph())?new Proxy(n,uo):n)}function pn(n){if(n instanceof IDBRequest)return xh(n);if(Hi.has(n))return Hi.get(n);const e=wh(n);return e!==n&&(Hi.set(n,e),Mo.set(e,n)),e}const Gi=n=>Mo.get(n);function vh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const l=indexedDB.open(n,e),u=pn(l);return r&&l.addEventListener("upgradeneeded",h=>{r(pn(l.result),h.oldVersion,h.newVersion,pn(l.transaction),h)}),t&&l.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const kh=["get","getKey","getAll","getAllKeys","count"],Eh=["put","add","delete","clear"],Ki=new Map;function Ga(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ki.get(e))return Ki.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Eh.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||kh.includes(t)))return;const o=async function(l,...u){const h=this.transaction(l,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),s&&h.done]))[0]};return Ki.set(e,o),o}yh(n=>({...n,get:(e,t,r)=>Ga(e,t)||n.get(e,t,r),has:(e,t)=>!!Ga(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ih(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Ih(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ho="@firebase/app",Ka="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zt=new bc("@firebase/app"),Ah="@firebase/app-compat",Ch="@firebase/analytics-compat",Nh="@firebase/analytics",Rh="@firebase/app-check-compat",Sh="@firebase/app-check",jh="@firebase/auth",Ph="@firebase/auth-compat",Vh="@firebase/database",Dh="@firebase/data-connect",Mh="@firebase/database-compat",Lh="@firebase/functions",Oh="@firebase/functions-compat",Fh="@firebase/installations",Bh="@firebase/installations-compat",$h="@firebase/messaging",Uh="@firebase/messaging-compat",qh="@firebase/performance",zh="@firebase/performance-compat",Wh="@firebase/remote-config",Hh="@firebase/remote-config-compat",Gh="@firebase/storage",Kh="@firebase/storage-compat",Qh="@firebase/firestore",Yh="@firebase/ai",Jh="@firebase/firestore-compat",Xh="firebase",Zh="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fo="[DEFAULT]",ef={[ho]:"fire-core",[Ah]:"fire-core-compat",[Nh]:"fire-analytics",[Ch]:"fire-analytics-compat",[Sh]:"fire-app-check",[Rh]:"fire-app-check-compat",[jh]:"fire-auth",[Ph]:"fire-auth-compat",[Vh]:"fire-rtdb",[Dh]:"fire-data-connect",[Mh]:"fire-rtdb-compat",[Lh]:"fire-fn",[Oh]:"fire-fn-compat",[Fh]:"fire-iid",[Bh]:"fire-iid-compat",[$h]:"fire-fcm",[Uh]:"fire-fcm-compat",[qh]:"fire-perf",[zh]:"fire-perf-compat",[Wh]:"fire-rc",[Hh]:"fire-rc-compat",[Gh]:"fire-gcs",[Kh]:"fire-gcs-compat",[Qh]:"fire-fst",[Jh]:"fire-fst-compat",[Yh]:"fire-vertex","fire-js":"fire-js",[Xh]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ei=new Map,tf=new Map,mo=new Map;function Qa(n,e){try{n.container.addComponent(e)}catch(t){Zt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ti(n){const e=n.name;if(mo.has(e))return Zt.debug(`There were multiple attempts to register component ${e}.`),!1;mo.set(e,n);for(const t of ei.values())Qa(t,n);for(const t of tf.values())Qa(t,n);return!0}function nf(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function rf(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},gn=new xc("app","Firebase",sf);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class of{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Zr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw gn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const af=Zh;function wc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:fo,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw gn.create("bad-app-name",{appName:String(s)});if(t||(t=gc()),!t)throw gn.create("no-options");const o=ei.get(s);if(o){if(Zs(t,o.options)&&Zs(r,o.config))return o;throw gn.create("duplicate-app",{appName:s})}const l=new ch(s);for(const h of mo.values())l.addComponent(h);const u=new of(t,r,l);return ei.set(s,u),u}function lf(n=fo){const e=ei.get(n);if(!e&&n===fo&&gc())return wc();if(!e)throw gn.create("no-app",{appName:n});return e}function dr(n,e,t){let r=ef[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const l=[`Unable to register library "${r}" with version "${e}":`];s&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Zt.warn(l.join(" "));return}ti(new Zr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cf="firebase-heartbeat-database",uf=1,es="firebase-heartbeat-store";let Qi=null;function vc(){return Qi||(Qi=vh(cf,uf,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(es)}catch(t){console.warn(t)}}}}).catch(n=>{throw gn.create("idb-open",{originalErrorMessage:n.message})})),Qi}async function df(n){try{const t=(await vc()).transaction(es),r=await t.objectStore(es).get(kc(n));return await t.done,r}catch(e){if(e instanceof Er)Zt.warn(e.message);else{const t=gn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Zt.warn(t.message)}}}async function Ya(n,e){try{const r=(await vc()).transaction(es,"readwrite");await r.objectStore(es).put(e,kc(n)),await r.done}catch(t){if(t instanceof Er)Zt.warn(t.message);else{const r=gn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Zt.warn(r.message)}}}function kc(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hf=1024,ff=30;class mf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new gf(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ja();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(l=>l.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>ff){const l=xf(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Zt.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ja(),{heartbeatsToSend:r,unsentEntries:s}=pf(this._heartbeatsCache.heartbeats),o=Xs(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Zt.warn(t),""}}}function Ja(){return new Date().toISOString().substring(0,10)}function pf(n,e=hf){const t=[];let r=n.slice();for(const s of n){const o=t.find(l=>l.agent===s.agent);if(o){if(o.dates.push(s.date),Xa(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Xa(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class gf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return th()?nh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await df(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ya(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ya(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Xa(n){return Xs(JSON.stringify({version:2,heartbeats:n})).length}function xf(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bf(n){ti(new Zr("platform-logger",e=>new Th(e),"PRIVATE")),ti(new Zr("heartbeat",e=>new mf(e),"PRIVATE")),dr(ho,Ka,n),dr(ho,Ka,"esm2020"),dr("fire-js","")}bf("");var Za=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xn,Ec;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,b){function y(){}y.prototype=b.prototype,v.F=b.prototype,v.prototype=new y,v.prototype.constructor=v,v.D=function(w,k,A){for(var x=Array(arguments.length-2),$=2;$<arguments.length;$++)x[$-2]=arguments[$];return b.prototype[k].apply(w,x)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,b,y){y||(y=0);const w=Array(16);if(typeof b=="string")for(var k=0;k<16;++k)w[k]=b.charCodeAt(y++)|b.charCodeAt(y++)<<8|b.charCodeAt(y++)<<16|b.charCodeAt(y++)<<24;else for(k=0;k<16;++k)w[k]=b[y++]|b[y++]<<8|b[y++]<<16|b[y++]<<24;b=v.g[0],y=v.g[1],k=v.g[2];let A=v.g[3],x;x=b+(A^y&(k^A))+w[0]+3614090360&4294967295,b=y+(x<<7&4294967295|x>>>25),x=A+(k^b&(y^k))+w[1]+3905402710&4294967295,A=b+(x<<12&4294967295|x>>>20),x=k+(y^A&(b^y))+w[2]+606105819&4294967295,k=A+(x<<17&4294967295|x>>>15),x=y+(b^k&(A^b))+w[3]+3250441966&4294967295,y=k+(x<<22&4294967295|x>>>10),x=b+(A^y&(k^A))+w[4]+4118548399&4294967295,b=y+(x<<7&4294967295|x>>>25),x=A+(k^b&(y^k))+w[5]+1200080426&4294967295,A=b+(x<<12&4294967295|x>>>20),x=k+(y^A&(b^y))+w[6]+2821735955&4294967295,k=A+(x<<17&4294967295|x>>>15),x=y+(b^k&(A^b))+w[7]+4249261313&4294967295,y=k+(x<<22&4294967295|x>>>10),x=b+(A^y&(k^A))+w[8]+1770035416&4294967295,b=y+(x<<7&4294967295|x>>>25),x=A+(k^b&(y^k))+w[9]+2336552879&4294967295,A=b+(x<<12&4294967295|x>>>20),x=k+(y^A&(b^y))+w[10]+4294925233&4294967295,k=A+(x<<17&4294967295|x>>>15),x=y+(b^k&(A^b))+w[11]+2304563134&4294967295,y=k+(x<<22&4294967295|x>>>10),x=b+(A^y&(k^A))+w[12]+1804603682&4294967295,b=y+(x<<7&4294967295|x>>>25),x=A+(k^b&(y^k))+w[13]+4254626195&4294967295,A=b+(x<<12&4294967295|x>>>20),x=k+(y^A&(b^y))+w[14]+2792965006&4294967295,k=A+(x<<17&4294967295|x>>>15),x=y+(b^k&(A^b))+w[15]+1236535329&4294967295,y=k+(x<<22&4294967295|x>>>10),x=b+(k^A&(y^k))+w[1]+4129170786&4294967295,b=y+(x<<5&4294967295|x>>>27),x=A+(y^k&(b^y))+w[6]+3225465664&4294967295,A=b+(x<<9&4294967295|x>>>23),x=k+(b^y&(A^b))+w[11]+643717713&4294967295,k=A+(x<<14&4294967295|x>>>18),x=y+(A^b&(k^A))+w[0]+3921069994&4294967295,y=k+(x<<20&4294967295|x>>>12),x=b+(k^A&(y^k))+w[5]+3593408605&4294967295,b=y+(x<<5&4294967295|x>>>27),x=A+(y^k&(b^y))+w[10]+38016083&4294967295,A=b+(x<<9&4294967295|x>>>23),x=k+(b^y&(A^b))+w[15]+3634488961&4294967295,k=A+(x<<14&4294967295|x>>>18),x=y+(A^b&(k^A))+w[4]+3889429448&4294967295,y=k+(x<<20&4294967295|x>>>12),x=b+(k^A&(y^k))+w[9]+568446438&4294967295,b=y+(x<<5&4294967295|x>>>27),x=A+(y^k&(b^y))+w[14]+3275163606&4294967295,A=b+(x<<9&4294967295|x>>>23),x=k+(b^y&(A^b))+w[3]+4107603335&4294967295,k=A+(x<<14&4294967295|x>>>18),x=y+(A^b&(k^A))+w[8]+1163531501&4294967295,y=k+(x<<20&4294967295|x>>>12),x=b+(k^A&(y^k))+w[13]+2850285829&4294967295,b=y+(x<<5&4294967295|x>>>27),x=A+(y^k&(b^y))+w[2]+4243563512&4294967295,A=b+(x<<9&4294967295|x>>>23),x=k+(b^y&(A^b))+w[7]+1735328473&4294967295,k=A+(x<<14&4294967295|x>>>18),x=y+(A^b&(k^A))+w[12]+2368359562&4294967295,y=k+(x<<20&4294967295|x>>>12),x=b+(y^k^A)+w[5]+4294588738&4294967295,b=y+(x<<4&4294967295|x>>>28),x=A+(b^y^k)+w[8]+2272392833&4294967295,A=b+(x<<11&4294967295|x>>>21),x=k+(A^b^y)+w[11]+1839030562&4294967295,k=A+(x<<16&4294967295|x>>>16),x=y+(k^A^b)+w[14]+4259657740&4294967295,y=k+(x<<23&4294967295|x>>>9),x=b+(y^k^A)+w[1]+2763975236&4294967295,b=y+(x<<4&4294967295|x>>>28),x=A+(b^y^k)+w[4]+1272893353&4294967295,A=b+(x<<11&4294967295|x>>>21),x=k+(A^b^y)+w[7]+4139469664&4294967295,k=A+(x<<16&4294967295|x>>>16),x=y+(k^A^b)+w[10]+3200236656&4294967295,y=k+(x<<23&4294967295|x>>>9),x=b+(y^k^A)+w[13]+681279174&4294967295,b=y+(x<<4&4294967295|x>>>28),x=A+(b^y^k)+w[0]+3936430074&4294967295,A=b+(x<<11&4294967295|x>>>21),x=k+(A^b^y)+w[3]+3572445317&4294967295,k=A+(x<<16&4294967295|x>>>16),x=y+(k^A^b)+w[6]+76029189&4294967295,y=k+(x<<23&4294967295|x>>>9),x=b+(y^k^A)+w[9]+3654602809&4294967295,b=y+(x<<4&4294967295|x>>>28),x=A+(b^y^k)+w[12]+3873151461&4294967295,A=b+(x<<11&4294967295|x>>>21),x=k+(A^b^y)+w[15]+530742520&4294967295,k=A+(x<<16&4294967295|x>>>16),x=y+(k^A^b)+w[2]+3299628645&4294967295,y=k+(x<<23&4294967295|x>>>9),x=b+(k^(y|~A))+w[0]+4096336452&4294967295,b=y+(x<<6&4294967295|x>>>26),x=A+(y^(b|~k))+w[7]+1126891415&4294967295,A=b+(x<<10&4294967295|x>>>22),x=k+(b^(A|~y))+w[14]+2878612391&4294967295,k=A+(x<<15&4294967295|x>>>17),x=y+(A^(k|~b))+w[5]+4237533241&4294967295,y=k+(x<<21&4294967295|x>>>11),x=b+(k^(y|~A))+w[12]+1700485571&4294967295,b=y+(x<<6&4294967295|x>>>26),x=A+(y^(b|~k))+w[3]+2399980690&4294967295,A=b+(x<<10&4294967295|x>>>22),x=k+(b^(A|~y))+w[10]+4293915773&4294967295,k=A+(x<<15&4294967295|x>>>17),x=y+(A^(k|~b))+w[1]+2240044497&4294967295,y=k+(x<<21&4294967295|x>>>11),x=b+(k^(y|~A))+w[8]+1873313359&4294967295,b=y+(x<<6&4294967295|x>>>26),x=A+(y^(b|~k))+w[15]+4264355552&4294967295,A=b+(x<<10&4294967295|x>>>22),x=k+(b^(A|~y))+w[6]+2734768916&4294967295,k=A+(x<<15&4294967295|x>>>17),x=y+(A^(k|~b))+w[13]+1309151649&4294967295,y=k+(x<<21&4294967295|x>>>11),x=b+(k^(y|~A))+w[4]+4149444226&4294967295,b=y+(x<<6&4294967295|x>>>26),x=A+(y^(b|~k))+w[11]+3174756917&4294967295,A=b+(x<<10&4294967295|x>>>22),x=k+(b^(A|~y))+w[2]+718787259&4294967295,k=A+(x<<15&4294967295|x>>>17),x=y+(A^(k|~b))+w[9]+3951481745&4294967295,v.g[0]=v.g[0]+b&4294967295,v.g[1]=v.g[1]+(k+(x<<21&4294967295|x>>>11))&4294967295,v.g[2]=v.g[2]+k&4294967295,v.g[3]=v.g[3]+A&4294967295}r.prototype.v=function(v,b){b===void 0&&(b=v.length);const y=b-this.blockSize,w=this.C;let k=this.h,A=0;for(;A<b;){if(k==0)for(;A<=y;)s(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<b;)if(w[k++]=v.charCodeAt(A++),k==this.blockSize){s(this,w),k=0;break}}else for(;A<b;)if(w[k++]=v[A++],k==this.blockSize){s(this,w),k=0;break}}this.h=k,this.o+=b},r.prototype.A=function(){var v=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);v[0]=128;for(var b=1;b<v.length-8;++b)v[b]=0;b=this.o*8;for(var y=v.length-8;y<v.length;++y)v[y]=b&255,b/=256;for(this.v(v),v=Array(16),b=0,y=0;y<4;++y)for(let w=0;w<32;w+=8)v[b++]=this.g[y]>>>w&255;return v};function o(v,b){var y=u;return Object.prototype.hasOwnProperty.call(y,v)?y[v]:y[v]=b(v)}function l(v,b){this.h=b;const y=[];let w=!0;for(let k=v.length-1;k>=0;k--){const A=v[k]|0;w&&A==b||(y[k]=A,w=!1)}this.g=y}var u={};function h(v){return-128<=v&&v<128?o(v,function(b){return new l([b|0],b<0?-1:0)}):new l([v|0],v<0?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return g;if(v<0)return V(f(-v));const b=[];let y=1;for(let w=0;v>=y;w++)b[w]=v/y|0,y*=4294967296;return new l(b,0)}function m(v,b){if(v.length==0)throw Error("number format error: empty string");if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(v.charAt(0)=="-")return V(m(v.substring(1),b));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=f(Math.pow(b,8));let w=g;for(let A=0;A<v.length;A+=8){var k=Math.min(8,v.length-A);const x=parseInt(v.substring(A,A+k),b);k<8?(k=f(Math.pow(b,k)),w=w.j(k).add(f(x))):(w=w.j(y),w=w.add(f(x)))}return w}var g=h(0),E=h(1),C=h(16777216);n=l.prototype,n.m=function(){if(L(this))return-V(this).m();let v=0,b=1;for(let y=0;y<this.g.length;y++){const w=this.i(y);v+=(w>=0?w:4294967296+w)*b,b*=4294967296}return v},n.toString=function(v){if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(j(this))return"0";if(L(this))return"-"+V(this).toString(v);const b=f(Math.pow(v,6));var y=this;let w="";for(;;){const k=Y(y,b).g;y=O(y,k.j(b));let A=((y.g.length>0?y.g[0]:y.h)>>>0).toString(v);if(y=k,j(y))return A+w;for(;A.length<6;)A="0"+A;w=A+w}},n.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h};function j(v){if(v.h!=0)return!1;for(let b=0;b<v.g.length;b++)if(v.g[b]!=0)return!1;return!0}function L(v){return v.h==-1}n.l=function(v){return v=O(this,v),L(v)?-1:j(v)?0:1};function V(v){const b=v.g.length,y=[];for(let w=0;w<b;w++)y[w]=~v.g[w];return new l(y,~v.h).add(E)}n.abs=function(){return L(this)?V(this):this},n.add=function(v){const b=Math.max(this.g.length,v.g.length),y=[];let w=0;for(let k=0;k<=b;k++){let A=w+(this.i(k)&65535)+(v.i(k)&65535),x=(A>>>16)+(this.i(k)>>>16)+(v.i(k)>>>16);w=x>>>16,A&=65535,x&=65535,y[k]=x<<16|A}return new l(y,y[y.length-1]&-2147483648?-1:0)};function O(v,b){return v.add(V(b))}n.j=function(v){if(j(this)||j(v))return g;if(L(this))return L(v)?V(this).j(V(v)):V(V(this).j(v));if(L(v))return V(this.j(V(v)));if(this.l(C)<0&&v.l(C)<0)return f(this.m()*v.m());const b=this.g.length+v.g.length,y=[];for(var w=0;w<2*b;w++)y[w]=0;for(w=0;w<this.g.length;w++)for(let k=0;k<v.g.length;k++){const A=this.i(w)>>>16,x=this.i(w)&65535,$=v.i(k)>>>16,J=v.i(k)&65535;y[2*w+2*k]+=x*J,U(y,2*w+2*k),y[2*w+2*k+1]+=A*J,U(y,2*w+2*k+1),y[2*w+2*k+1]+=x*$,U(y,2*w+2*k+1),y[2*w+2*k+2]+=A*$,U(y,2*w+2*k+2)}for(v=0;v<b;v++)y[v]=y[2*v+1]<<16|y[2*v];for(v=b;v<2*b;v++)y[v]=0;return new l(y,0)};function U(v,b){for(;(v[b]&65535)!=v[b];)v[b+1]+=v[b]>>>16,v[b]&=65535,b++}function G(v,b){this.g=v,this.h=b}function Y(v,b){if(j(b))throw Error("division by zero");if(j(v))return new G(g,g);if(L(v))return b=Y(V(v),b),new G(V(b.g),V(b.h));if(L(b))return b=Y(v,V(b)),new G(V(b.g),b.h);if(v.g.length>30){if(L(v)||L(b))throw Error("slowDivide_ only works with positive integers.");for(var y=E,w=b;w.l(v)<=0;)y=W(y),w=W(w);var k=ee(y,1),A=ee(w,1);for(w=ee(w,2),y=ee(y,2);!j(w);){var x=A.add(w);x.l(v)<=0&&(k=k.add(y),A=x),w=ee(w,1),y=ee(y,1)}return b=O(v,k.j(b)),new G(k,b)}for(k=g;v.l(b)>=0;){for(y=Math.max(1,Math.floor(v.m()/b.m())),w=Math.ceil(Math.log(y)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),A=f(y),x=A.j(b);L(x)||x.l(v)>0;)y-=w,A=f(y),x=A.j(b);j(A)&&(A=E),k=k.add(A),v=O(v,x)}return new G(k,v)}n.B=function(v){return Y(this,v).h},n.and=function(v){const b=Math.max(this.g.length,v.g.length),y=[];for(let w=0;w<b;w++)y[w]=this.i(w)&v.i(w);return new l(y,this.h&v.h)},n.or=function(v){const b=Math.max(this.g.length,v.g.length),y=[];for(let w=0;w<b;w++)y[w]=this.i(w)|v.i(w);return new l(y,this.h|v.h)},n.xor=function(v){const b=Math.max(this.g.length,v.g.length),y=[];for(let w=0;w<b;w++)y[w]=this.i(w)^v.i(w);return new l(y,this.h^v.h)};function W(v){const b=v.g.length+1,y=[];for(let w=0;w<b;w++)y[w]=v.i(w)<<1|v.i(w-1)>>>31;return new l(y,v.h)}function ee(v,b){const y=b>>5;b%=32;const w=v.g.length-y,k=[];for(let A=0;A<w;A++)k[A]=b>0?v.i(A+y)>>>b|v.i(A+y+1)<<32-b:v.i(A+y);return new l(k,v.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Ec=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=m,xn=l}).apply(typeof Za<"u"?Za:typeof self<"u"?self:typeof window<"u"?window:{});var js=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Tc,qr,Ic,qs,po,Ac,Cc,Nc;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof js=="object"&&js];for(var c=0;c<i.length;++c){var d=i[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var d=r;i=i.split(".");for(var p=0;p<i.length-1;p++){var N=i[p];if(!(N in d))break e;d=d[N]}i=i[i.length-1],p=d[i],c=c(p),c!=p&&c!=null&&e(d,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var d=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push([p,c[p]]);return d}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,d){return i.call.apply(i.bind,arguments)}function f(i,c,d){return f=h,f.apply(null,arguments)}function m(i,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),i.apply(this,p)}}function g(i,c){function d(){}d.prototype=c.prototype,i.Z=c.prototype,i.prototype=new d,i.prototype.constructor=i,i.Ob=function(p,N,S){for(var z=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)z[fe-2]=arguments[fe];return c.prototype[N].apply(p,z)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function C(i){const c=i.length;if(c>0){const d=Array(c);for(let p=0;p<c;p++)d[p]=i[p];return d}return[]}function j(i,c){for(let p=1;p<arguments.length;p++){const N=arguments[p];var d=typeof N;if(d=d!="object"?d:N?Array.isArray(N)?"array":d:"null",d=="array"||d=="object"&&typeof N.length=="number"){d=i.length||0;const S=N.length||0;i.length=d+S;for(let z=0;z<S;z++)i[d+z]=N[z]}else i.push(N)}}class L{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function V(i){l.setTimeout(()=>{throw i},0)}function O(){var i=v;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class U{constructor(){this.h=this.g=null}add(c,d){const p=G.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var G=new L(()=>new Y,i=>i.reset());class Y{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let W,ee=!1,v=new U,b=()=>{const i=Promise.resolve(void 0);W=()=>{i.then(y)}};function y(){for(var i;i=O();){try{i.h.call(i.g)}catch(d){V(d)}var c=G;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ee=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function k(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}k.prototype.h=function(){this.defaultPrevented=!0};var A=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const d=()=>{};l.addEventListener("test",d,c),l.removeEventListener("test",d,c)}catch{}return i}();function x(i){return/^[\s\xa0]*$/.test(i)}function $(i,c){k.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}g($,k),$.prototype.init=function(i,c){const d=this.type=i.type,p=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(d=="mouseover"?c=i.fromElement:d=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&$.Z.h.call(this)},$.prototype.h=function(){$.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var J="closure_listenable_"+(Math.random()*1e6|0),ye=0;function F(i,c,d,p,N){this.listener=i,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=N,this.key=++ye,this.da=this.fa=!1}function te(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function de(i,c,d){for(const p in i)c.call(d,i[p],p,i)}function ge(i,c){for(const d in i)c.call(void 0,i[d],d,i)}function ce(i){const c={};for(const d in i)c[d]=i[d];return c}const ve="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ke(i,c){let d,p;for(let N=1;N<arguments.length;N++){p=arguments[N];for(d in p)i[d]=p[d];for(let S=0;S<ve.length;S++)d=ve[S],Object.prototype.hasOwnProperty.call(p,d)&&(i[d]=p[d])}}function Se(i){this.src=i,this.g={},this.h=0}Se.prototype.add=function(i,c,d,p,N){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const z=rt(i,c,p,N);return z>-1?(c=i[z],d||(c.fa=!1)):(c=new F(c,this.src,S,!!p,N),c.fa=d,i.push(c)),c};function je(i,c){const d=c.type;if(d in i.g){var p=i.g[d],N=Array.prototype.indexOf.call(p,c,void 0),S;(S=N>=0)&&Array.prototype.splice.call(p,N,1),S&&(te(c),i.g[d].length==0&&(delete i.g[d],i.h--))}}function rt(i,c,d,p){for(let N=0;N<i.length;++N){const S=i[N];if(!S.da&&S.listener==c&&S.capture==!!d&&S.ha==p)return N}return-1}var pt="closure_lm_"+(Math.random()*1e6|0),Ie={};function wt(i,c,d,p,N){if(Array.isArray(c)){for(let S=0;S<c.length;S++)wt(i,c[S],d,p,N);return null}return d=Le(d),i&&i[J]?i.J(c,d,u(p)?!!p.capture:!1,N):It(i,c,d,!1,p,N)}function It(i,c,d,p,N,S){if(!c)throw Error("Invalid event type");const z=u(N)?!!N.capture:!!N;let fe=We(i);if(fe||(i[pt]=fe=new Se(i)),d=fe.add(c,d,p,z,S),d.proxy)return d;if(p=Qt(),d.proxy=p,p.src=i,p.listener=d,i.addEventListener)A||(N=z),N===void 0&&(N=!1),i.addEventListener(c.toString(),p,N);else if(i.attachEvent)i.attachEvent(xt(c.toString()),p);else if(i.addListener&&i.removeListener)i.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Qt(){function i(d){return c.call(i.src,i.listener,d)}const c=Z;return i}function Xe(i,c,d,p,N){if(Array.isArray(c))for(var S=0;S<c.length;S++)Xe(i,c[S],d,p,N);else p=u(p)?!!p.capture:!!p,d=Le(d),i&&i[J]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],d=rt(c,d,p,N),d>-1&&(te(c[d]),Array.prototype.splice.call(c,d,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=We(i))&&(c=i.g[c.toString()],i=-1,c&&(i=rt(c,d,p,N)),(d=i>-1?c[i]:null)&&gt(d))}function gt(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[J])je(c.i,i);else{var d=i.type,p=i.proxy;c.removeEventListener?c.removeEventListener(d,p,i.capture):c.detachEvent?c.detachEvent(xt(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=We(c))?(je(d,i),d.h==0&&(d.src=null,c[pt]=null)):te(i)}}}function xt(i){return i in Ie?Ie[i]:Ie[i]="on"+i}function Z(i,c){if(i.da)i=!0;else{c=new $(c,this);const d=i.listener,p=i.ha||i.src;i.fa&&gt(i),i=d.call(p,c)}return i}function We(i){return i=i[pt],i instanceof Se?i:null}var Pe="__closure_events_fn_"+(Math.random()*1e9>>>0);function Le(i){return typeof i=="function"?i:(i[Pe]||(i[Pe]=function(c){return i.handleEvent(c)}),i[Pe])}function Re(){w.call(this),this.i=new Se(this),this.M=this,this.G=null}g(Re,w),Re.prototype[J]=!0,Re.prototype.removeEventListener=function(i,c,d,p){Xe(this,i,c,d,p)};function Ve(i,c){var d,p=i.G;if(p)for(d=[];p;p=p.G)d.push(p);if(i=i.M,p=c.type||c,typeof c=="string")c=new k(c,i);else if(c instanceof k)c.target=c.target||i;else{var N=c;c=new k(p,i),ke(c,N)}N=!0;let S,z;if(d)for(z=d.length-1;z>=0;z--)S=c.g=d[z],N=Lt(S,p,!0,c)&&N;if(S=c.g=i,N=Lt(S,p,!0,c)&&N,N=Lt(S,p,!1,c)&&N,d)for(z=0;z<d.length;z++)S=c.g=d[z],N=Lt(S,p,!1,c)&&N}Re.prototype.N=function(){if(Re.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const d=i.g[c];for(let p=0;p<d.length;p++)te(d[p]);delete i.g[c],i.h--}}this.G=null},Re.prototype.J=function(i,c,d,p){return this.i.add(String(i),c,!1,d,p)},Re.prototype.K=function(i,c,d,p){return this.i.add(String(i),c,!0,d,p)};function Lt(i,c,d,p){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let N=!0;for(let S=0;S<c.length;++S){const z=c[S];if(z&&!z.da&&z.capture==d){const fe=z.listener,Ge=z.ha||z.src;z.fa&&je(i.i,z),N=fe.call(Ge,p)!==!1&&N}}return N&&!p.defaultPrevented}function An(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:l.setTimeout(i,c||0)}function rn(i){i.g=An(()=>{i.g=null,i.i&&(i.i=!1,rn(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class sn extends w{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:rn(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function vt(i){w.call(this),this.h=i,this.g={}}g(vt,w);var Ee=[];function bt(i){de(i.g,function(c,d){this.g.hasOwnProperty(d)&&gt(c)},i),i.g={}}vt.prototype.N=function(){vt.Z.N.call(this),bt(this)},vt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var At=l.JSON.stringify,Cn=l.JSON.parse,on=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Qn(){}function ct(){}var Yt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function _e(){k.call(this,"d")}g(_e,k);function Ct(){k.call(this,"c")}g(Ct,k);var Ot={},Rr=null;function Yn(){return Rr=Rr||new Re}Ot.Ia="serverreachability";function ut(i){k.call(this,Ot.Ia,i)}g(ut,k);function an(i){const c=Yn();Ve(c,new ut(c))}Ot.STAT_EVENT="statevent";function Nt(i,c){k.call(this,Ot.STAT_EVENT,i),this.stat=c}g(Nt,k);function He(i){const c=Yn();Ve(c,new Nt(c,i))}Ot.Ja="timingevent";function se(i,c){k.call(this,Ot.Ja,i),this.size=c}g(se,k);function dt(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},c)}function Ft(){this.g=!0}Ft.prototype.ua=function(){this.g=!1};function Vi(i,c,d,p,N,S){i.info(function(){if(i.g)if(S){var z="",fe=S.split("&");for(let Ce=0;Ce<fe.length;Ce++){var Ge=fe[Ce].split("=");if(Ge.length>1){const Ye=Ge[0];Ge=Ge[1];const Ut=Ye.split("_");z=Ut.length>=2&&Ut[1]=="type"?z+(Ye+"="+Ge+"&"):z+(Ye+"=redacted&")}}}else z=null;else z=S;return"XMLHTTP REQ ("+p+") [attempt "+N+"]: "+c+`
`+d+`
`+z})}function Di(i,c,d,p,N,S,z){i.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+N+"]: "+c+`
`+d+`
`+S+" "+z})}function ln(i,c,d,p){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Mi(i,d)+(p?" "+p:"")})}function ms(i,c){i.info(function(){return"TIMEOUT: "+c})}Ft.prototype.info=function(){};function Mi(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var d=S[i];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var N=p[0];if(N!="noop"&&N!="stop"&&N!="close")for(let z=1;z<p.length;z++)p[z]=""}}}}return At(S)}catch{return c}}var Jn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ps={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},gs;function Xn(){}g(Xn,Qn),Xn.prototype.g=function(){return new XMLHttpRequest},gs=new Xn;function Rt(i){return encodeURIComponent(String(i))}function Li(i){var c=1;i=i.split(":");const d=[];for(;c>0&&i.length;)d.push(i.shift()),c--;return i.length&&d.push(i.join(":")),d}function Bt(i,c,d,p){this.j=i,this.i=c,this.l=d,this.S=p||1,this.V=new vt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Sr}function Sr(){this.i=null,this.g="",this.h=!1}var xs={},jr={};function De(i,c,d){i.M=1,i.A=er(kt(c)),i.u=d,i.R=!0,bs(i,null)}function bs(i,c){i.F=Date.now(),St(i),i.B=kt(i.A);var d=i.B,p=i.S;Array.isArray(p)||(p=[String(p)]),Ze(d.i,"t",p),i.C=0,d=i.j.L,i.h=new Sr,i.g=Ma(i.j,d?c:null,!i.u),i.P>0&&(i.O=new sn(f(i.Y,i,i.g),i.P)),c=i.V,d=i.g,p=i.ba;var N="readystatechange";Array.isArray(N)||(N&&(Ee[0]=N.toString()),N=Ee);for(let S=0;S<N.length;S++){const z=wt(d,N[S],p||c.handleEvent,!1,c.h||c);if(!z)break;c.g[z.key]=z}c=i.J?ce(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),an(),Vi(i.i,i.v,i.B,i.l,i.S,i.u)}Bt.prototype.ba=function(i){i=i.target;const c=this.O;c&&un(i)==3?c.j():this.Y(i)},Bt.prototype.Y=function(i){try{if(i==this.g)e:{const fe=un(this.g),Ge=this.g.ya(),Ce=this.g.ca();if(!(fe<3)&&(fe!=3||this.g&&(this.h.h||this.g.la()||Ta(this.g)))){this.K||fe!=4||Ge==7||(Ge==8||Ce<=0?an(3):an(2)),Pr(this);var c=this.g.ca();this.X=c;var d=Oi(this);if(this.o=c==200,Di(this.i,this.v,this.B,this.l,this.S,fe,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,N=this.g;if((p=N.g?N.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(p)){var S=p;break t}}S=null}if(i=S)ln(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Vr(this,i);else{this.o=!1,this.m=3,He(12),Jt(this),Nn(this);break e}}if(this.R){i=!0;let Ye;for(;!this.K&&this.C<d.length;)if(Ye=Fi(this,d),Ye==jr){fe==4&&(this.m=4,He(14),i=!1),ln(this.i,this.l,null,"[Incomplete Response]");break}else if(Ye==xs){this.m=4,He(15),ln(this.i,this.l,d,"[Invalid Chunk]"),i=!1;break}else ln(this.i,this.l,Ye,null),Vr(this,Ye);if(ys(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),fe!=4||d.length!=0||this.h.h||(this.m=1,He(16),i=!1),this.o=this.o&&i,!i)ln(this.i,this.l,d,"[Invalid Chunked Response]"),Jt(this),Nn(this);else if(d.length>0&&!this.W){this.W=!0;var z=this.j;z.g==this&&z.aa&&!z.P&&(z.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),zi(z),z.P=!0,He(11))}}else ln(this.i,this.l,d,null),Vr(this,d);fe==4&&Jt(this),this.o&&!this.K&&(fe==4?ja(this.j,this):(this.o=!1,St(this)))}else bd(this.g),c==400&&d.indexOf("Unknown SID")>0?(this.m=3,He(12)):(this.m=0,He(13)),Jt(this),Nn(this)}}}catch{}finally{}};function Oi(i){if(!ys(i))return i.g.la();const c=Ta(i.g);if(c==="")return"";let d="";const p=c.length,N=un(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Jt(i),Nn(i),"";i.h.i=new l.TextDecoder}for(let S=0;S<p;S++)i.h.h=!0,d+=i.h.i.decode(c[S],{stream:!(N&&S==p-1)});return c.length=0,i.h.g+=d,i.C=0,i.h.g}function ys(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Fi(i,c){var d=i.C,p=c.indexOf(`
`,d);return p==-1?jr:(d=Number(c.substring(d,p)),isNaN(d)?xs:(p+=1,p+d>c.length?jr:(c=c.slice(p,p+d),i.C=p+d,c)))}Bt.prototype.cancel=function(){this.K=!0,Jt(this)};function St(i){i.T=Date.now()+i.H,_s(i,i.H)}function _s(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=dt(f(i.aa,i),c)}function Pr(i){i.D&&(l.clearTimeout(i.D),i.D=null)}Bt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(ms(this.i,this.B),this.M!=2&&(an(),He(17)),Jt(this),this.m=2,Nn(this)):_s(this,this.T-i)};function Nn(i){i.j.I==0||i.K||ja(i.j,i)}function Jt(i){Pr(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,bt(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Vr(i,c){try{var d=i.j;if(d.I!=0&&(d.g==i||Zn(d.h,i))){if(!i.L&&Zn(d.h,i)&&d.I==3){try{var p=d.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var N=p;if(N[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<i.F)Ns(d),As(d);else break e;qi(d),He(18)}}else d.xa=N[1],0<d.xa-d.K&&N[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=dt(f(d.Va,d),6e3));vs(d.h)<=1&&d.ta&&(d.ta=void 0)}else Vn(d,11)}else if((i.L||d.g==i)&&Ns(d),!x(c))for(N=d.Ba.g.parse(c),c=0;c<N.length;c++){let Ce=N[c];const Ye=Ce[0];if(!(Ye<=d.K))if(d.K=Ye,Ce=Ce[1],d.I==2)if(Ce[0]=="c"){d.M=Ce[1],d.ba=Ce[2];const Ut=Ce[3];Ut!=null&&(d.ka=Ut,d.j.info("VER="+d.ka));const Dn=Ce[4];Dn!=null&&(d.za=Dn,d.j.info("SVER="+d.za));const dn=Ce[5];dn!=null&&typeof dn=="number"&&dn>0&&(p=1.5*dn,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const hn=i.g;if(hn){const Ss=hn.g?hn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ss){var S=p.h;S.g||Ss.indexOf("spdy")==-1&&Ss.indexOf("quic")==-1&&Ss.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Xt(S,S.h),S.h=null))}if(p.G){const Wi=hn.g?hn.g.getResponseHeader("X-HTTP-Session-Id"):null;Wi&&(p.wa=Wi,Ae(p.J,p.G,Wi))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-i.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var z=i;if(p.na=Da(p,p.L?p.ba:null,p.W),z.L){at(p.h,z);var fe=z,Ge=p.O;Ge&&(fe.H=Ge),fe.D&&(Pr(fe),St(fe)),p.g=z}else Ra(p);d.i.length>0&&Cs(d)}else Ce[0]!="stop"&&Ce[0]!="close"||Vn(d,7);else d.I==3&&(Ce[0]=="stop"||Ce[0]=="close"?Ce[0]=="stop"?Vn(d,7):Ui(d):Ce[0]!="noop"&&d.l&&d.l.qa(Ce),d.A=0)}}an(4)}catch{}}var Bi=class{constructor(i,c){this.g=i,this.map=c}};function Dr(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ws(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function vs(i){return i.h?1:i.g?i.g.size:0}function Zn(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Xt(i,c){i.g?i.g.add(c):i.h=c}function at(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Dr.prototype.cancel=function(){if(this.i=ks(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function ks(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const d of i.g.values())c=c.concat(d.G);return c}return C(i.i)}var Es=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $i(i,c){if(i){i=i.split("&");for(let d=0;d<i.length;d++){const p=i[d].indexOf("=");let N,S=null;p>=0?(N=i[d].substring(0,p),S=i[d].substring(p+1)):N=i[d],c(N,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function $t(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof $t?(this.l=i.l,Rn(this,i.j),this.o=i.o,this.g=i.g,Sn(this,i.u),this.h=i.h,Mr(this,yt(i.i)),this.m=i.m):i&&(c=String(i).match(Es))?(this.l=!1,Rn(this,c[1]||"",!0),this.o=_(c[2]||""),this.g=_(c[3]||"",!0),Sn(this,c[4]),this.h=_(c[5]||"",!0),Mr(this,c[6]||"",!0),this.m=_(c[7]||"")):(this.l=!1,this.i=new ie(null,this.l))}$t.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(T(c,M,!0),":");var d=this.g;return(d||c=="file")&&(i.push("//"),(c=this.o)&&i.push(T(c,M,!0),"@"),i.push(Rt(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&i.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&i.push("/"),i.push(T(d,d.charAt(0)=="/"?K:B,!0))),(d=this.i.toString())&&i.push("?",d),(d=this.m)&&i.push("#",T(d,ae)),i.join("")},$t.prototype.resolve=function(i){const c=kt(this);let d=!!i.j;d?Rn(c,i.j):d=!!i.o,d?c.o=i.o:d=!!i.g,d?c.g=i.g:d=i.u!=null;var p=i.h;if(d)Sn(c,i.u);else if(d=!!i.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var N=c.h.lastIndexOf("/");N!=-1&&(p=c.h.slice(0,N+1)+p)}if(N=p,N==".."||N==".")p="";else if(N.indexOf("./")!=-1||N.indexOf("/.")!=-1){p=N.lastIndexOf("/",0)==0,N=N.split("/");const S=[];for(let z=0;z<N.length;){const fe=N[z++];fe=="."?p&&z==N.length&&S.push(""):fe==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),p&&z==N.length&&S.push("")):(S.push(fe),p=!0)}p=S.join("/")}else p=N}return d?c.h=p:d=i.i.toString()!=="",d?Mr(c,yt(i.i)):d=!!i.m,d&&(c.m=i.m),c};function kt(i){return new $t(i)}function Rn(i,c,d){i.j=d?_(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function Sn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Mr(i,c,d){c instanceof ie?(i.i=c,jt(i.i,i.l)):(d||(c=T(c,Q)),i.i=new ie(c,i.l))}function Ae(i,c,d){i.i.set(c,d)}function er(i){return Ae(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function _(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function T(i,c,d){return typeof i=="string"?(i=encodeURI(i).replace(c,R),d&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function R(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var M=/[#\/\?@]/g,B=/[#\?:]/g,K=/[#\?]/g,Q=/[#\?@]/g,ae=/#/g;function ie(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function ne(i){i.g||(i.g=new Map,i.h=0,i.i&&$i(i.i,function(c,d){i.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}n=ie.prototype,n.add=function(i,c){ne(this),this.i=null,i=ht(this,i);let d=this.g.get(i);return d||this.g.set(i,d=[]),d.push(c),this.h+=1,this};function oe(i,c){ne(i),c=ht(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Be(i,c){return ne(i),c=ht(i,c),i.g.has(c)}n.forEach=function(i,c){ne(this),this.g.forEach(function(d,p){d.forEach(function(N){i.call(c,N,p,this)},this)},this)};function Te(i,c){ne(i);let d=[];if(typeof c=="string")Be(i,c)&&(d=d.concat(i.g.get(ht(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)d=d.concat(i[c]);return d}n.set=function(i,c){return ne(this),this.i=null,i=ht(this,i),Be(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Te(this,i),i.length>0?String(i[0]):c):c};function Ze(i,c,d){oe(i,c),d.length>0&&(i.i=null,i.g.set(ht(i,c),C(d)),i.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var d=c[p];const N=Rt(d);d=Te(this,d);for(let S=0;S<d.length;S++){let z=N;d[S]!==""&&(z+="="+Rt(d[S])),i.push(z)}}return this.i=i.join("&")};function yt(i){const c=new ie;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function ht(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function jt(i,c){c&&!i.j&&(ne(i),i.i=null,i.g.forEach(function(d,p){const N=p.toLowerCase();p!=N&&(oe(this,p),Ze(this,N,d))},i)),i.j=c}function ft(i,c){const d=new Ft;if(l.Image){const p=new Image;p.onload=m(lt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=m(lt,d,"TestLoadImage: error",!1,c,p),p.onabort=m(lt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=m(lt,d,"TestLoadImage: timeout",!1,c,p),l.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=i}else c(!1)}function jn(i,c){const d=new Ft,p=new AbortController,N=setTimeout(()=>{p.abort(),lt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:p.signal}).then(S=>{clearTimeout(N),S.ok?lt(d,"TestPingServer: ok",!0,c):lt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(N),lt(d,"TestPingServer: error",!1,c)})}function lt(i,c,d,p,N){try{N&&(N.onload=null,N.onerror=null,N.onabort=null,N.ontimeout=null),p(d)}catch{}}function tr(){this.g=new on}function cn(i){this.i=i.Sb||null,this.h=i.ab||!1}g(cn,Qn),cn.prototype.g=function(){return new nr(this.i,this.h)};function nr(i,c){Re.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(nr,Re),n=nr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Pn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||l).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,rr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Pn(this)),this.g&&(this.readyState=3,Pn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ts(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ts(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?rr(this):Pn(this),this.readyState==3&&Ts(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,rr(this))},n.Na=function(i){this.g&&(this.response=i,rr(this))},n.ga=function(){this.g&&rr(this)};function rr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Pn(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,i.push(d[0]+": "+d[1]),d=c.next();return i.join(`\r
`)};function Pn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(nr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Lr(i){let c="";return de(i,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function sr(i,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=Lr(d),typeof i=="string"?d!=null&&Rt(d):Ae(i,c,d))}function Fe(i){Re.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Fe,Re);var gd=/^https?$/i,xd=["POST","PUT"];n=Fe.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():gs.g(),this.g.onreadystatechange=E(f(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){va(this,S);return}if(i=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var N in p)d.set(N,p[N]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const S of p.keys())d.set(S,p.get(S));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),N=l.FormData&&i instanceof l.FormData,!(Array.prototype.indexOf.call(xd,c,void 0)>=0)||p||N||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,z]of d)this.g.setRequestHeader(S,z);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){va(this,S)}};function va(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,ka(i),Is(i)}function ka(i){i.A||(i.A=!0,Ve(i,"complete"),Ve(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Ve(this,"complete"),Ve(this,"abort"),Is(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Is(this,!0)),Fe.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Ea(this):this.Xa())},n.Xa=function(){Ea(this)};function Ea(i){if(i.h&&typeof o<"u"){if(i.v&&un(i)==4)setTimeout(i.Ca.bind(i),0);else if(Ve(i,"readystatechange"),un(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=S===0){let z=String(i.D).match(Es)[1]||null;!z&&l.self&&l.self.location&&(z=l.self.location.protocol.slice(0,-1)),p=!gd.test(z?z.toLowerCase():"")}d=p}if(d)Ve(i,"complete"),Ve(i,"success");else{i.o=6;try{var N=un(i)>2?i.g.statusText:""}catch{N=""}i.l=N+" ["+i.ca()+"]",ka(i)}}finally{Is(i)}}}}function Is(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const d=i.g;i.g=null,c||Ve(i,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function un(i){return i.g?i.g.readyState:0}n.ca=function(){try{return un(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Cn(c)}};function Ta(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function bd(i){const c={};i=(i.g&&un(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<i.length;p++){if(x(i[p]))continue;var d=Li(i[p]);const N=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const S=c[N]||[];c[N]=S,S.push(d)}ge(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Or(i,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[i]||c}function Ia(i){this.za=0,this.i=[],this.j=new Ft,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Or("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Or("baseRetryDelayMs",5e3,i),this.Za=Or("retryDelaySeedMs",1e4,i),this.Ta=Or("forwardChannelMaxRetries",2,i),this.va=Or("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Dr(i&&i.concurrentRequestLimit),this.Ba=new tr,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ia.prototype,n.ka=8,n.I=1,n.connect=function(i,c,d,p){He(0),this.W=i,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=Da(this,null,this.W),Cs(this)};function Ui(i){if(Aa(i),i.I==3){var c=i.V++,d=kt(i.J);if(Ae(d,"SID",i.M),Ae(d,"RID",c),Ae(d,"TYPE","terminate"),Fr(i,d),c=new Bt(i,i.j,c),c.M=2,c.A=er(kt(d)),d=!1,l.navigator&&l.navigator.sendBeacon)try{d=l.navigator.sendBeacon(c.A.toString(),"")}catch{}!d&&l.Image&&(new Image().src=c.A,d=!0),d||(c.g=Ma(c.j,null),c.g.ea(c.A)),c.F=Date.now(),St(c)}Va(i)}function As(i){i.g&&(zi(i),i.g.cancel(),i.g=null)}function Aa(i){As(i),i.v&&(l.clearTimeout(i.v),i.v=null),Ns(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&l.clearTimeout(i.m),i.m=null)}function Cs(i){if(!ws(i.h)&&!i.m){i.m=!0;var c=i.Ea;W||b(),ee||(W(),ee=!0),v.add(c,i),i.D=0}}function yd(i,c){return vs(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=dt(f(i.Ea,i,c),Pa(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const N=new Bt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=ce(S),ke(S,this.U)):S=this.U),this.u!==null||this.R||(N.J=S,S=null),this.S)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=Na(this,N,c),d=kt(this.J),Ae(d,"RID",i),Ae(d,"CVER",22),this.G&&Ae(d,"X-HTTP-Session-Id",this.G),Fr(this,d),S&&(this.R?c="headers="+Rt(Lr(S))+"&"+c:this.u&&sr(d,this.u,S)),Xt(this.h,N),this.Ra&&Ae(d,"TYPE","init"),this.S?(Ae(d,"$req",c),Ae(d,"SID","null"),N.U=!0,De(N,d,null)):De(N,d,c),this.I=2}}else this.I==3&&(i?Ca(this,i):this.i.length==0||ws(this.h)||Ca(this))};function Ca(i,c){var d;c?d=c.l:d=i.V++;const p=kt(i.J);Ae(p,"SID",i.M),Ae(p,"RID",d),Ae(p,"AID",i.K),Fr(i,p),i.u&&i.o&&sr(p,i.u,i.o),d=new Bt(i,i.j,d,i.D+1),i.u===null&&(d.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Na(i,d,1e3),d.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Xt(i.h,d),De(d,p,c)}function Fr(i,c){i.H&&de(i.H,function(d,p){Ae(c,p,d)}),i.l&&de({},function(d,p){Ae(c,p,d)})}function Na(i,c,d){d=Math.min(i.i.length,d);const p=i.l?f(i.l.Ka,i.l,i):null;e:{var N=i.i;let fe=-1;for(;;){const Ge=["count="+d];fe==-1?d>0?(fe=N[0].g,Ge.push("ofs="+fe)):fe=0:Ge.push("ofs="+fe);let Ce=!0;for(let Ye=0;Ye<d;Ye++){var S=N[Ye].g;const Ut=N[Ye].map;if(S-=fe,S<0)fe=Math.max(0,N[Ye].g-100),Ce=!1;else try{S="req"+S+"_"||"";try{var z=Ut instanceof Map?Ut:Object.entries(Ut);for(const[Dn,dn]of z){let hn=dn;u(dn)&&(hn=At(dn)),Ge.push(S+Dn+"="+encodeURIComponent(hn))}}catch(Dn){throw Ge.push(S+"type="+encodeURIComponent("_badmap")),Dn}}catch{p&&p(Ut)}}if(Ce){z=Ge.join("&");break e}}z=void 0}return i=i.i.splice(0,d),c.G=i,z}function Ra(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;W||b(),ee||(W(),ee=!0),v.add(c,i),i.A=0}}function qi(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=dt(f(i.Da,i),Pa(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Sa(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=dt(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,He(10),As(this),Sa(this))};function zi(i){i.B!=null&&(l.clearTimeout(i.B),i.B=null)}function Sa(i){i.g=new Bt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=kt(i.na);Ae(c,"RID","rpc"),Ae(c,"SID",i.M),Ae(c,"AID",i.K),Ae(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&Ae(c,"TO",i.ia),Ae(c,"TYPE","xmlhttp"),Fr(i,c),i.u&&i.o&&sr(c,i.u,i.o),i.O&&(i.g.H=i.O);var d=i.g;i=i.ba,d.M=1,d.A=er(kt(c)),d.u=null,d.R=!0,bs(d,i)}n.Va=function(){this.C!=null&&(this.C=null,As(this),qi(this),He(19))};function Ns(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function ja(i,c){var d=null;if(i.g==c){Ns(i),zi(i),i.g=null;var p=2}else if(Zn(i.h,c))d=c.G,at(i.h,c),p=1;else return;if(i.I!=0){if(c.o)if(p==1){d=c.u?c.u.length:0,c=Date.now()-c.F;var N=i.D;p=Yn(),Ve(p,new se(p,d)),Cs(i)}else Ra(i);else if(N=c.m,N==3||N==0&&c.X>0||!(p==1&&yd(i,c)||p==2&&qi(i)))switch(d&&d.length>0&&(c=i.h,c.i=c.i.concat(d)),N){case 1:Vn(i,5);break;case 4:Vn(i,10);break;case 3:Vn(i,6);break;default:Vn(i,2)}}}function Pa(i,c){let d=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(d*=2),d*c}function Vn(i,c){if(i.j.info("Error code "+c),c==2){var d=f(i.bb,i),p=i.Ua;const N=!p;p=new $t(p||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||Rn(p,"https"),er(p),N?ft(p.toString(),d):jn(p.toString(),d)}else He(2);i.I=0,i.l&&i.l.pa(c),Va(i),Aa(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),He(2)):(this.j.info("Failed to ping google.com"),He(1))};function Va(i){if(i.I=0,i.ja=[],i.l){const c=ks(i.h);(c.length!=0||i.i.length!=0)&&(j(i.ja,c),j(i.ja,i.i),i.h.i.length=0,C(i.i),i.i.length=0),i.l.oa()}}function Da(i,c,d){var p=d instanceof $t?kt(d):new $t(d);if(p.g!="")c&&(p.g=c+"."+p.g),Sn(p,p.u);else{var N=l.location;p=N.protocol,c=c?c+"."+N.hostname:N.hostname,N=+N.port;const S=new $t(null);p&&Rn(S,p),c&&(S.g=c),N&&Sn(S,N),d&&(S.h=d),p=S}return d=i.G,c=i.wa,d&&c&&Ae(p,d,c),Ae(p,"VER",i.ka),Fr(i,p),p}function Ma(i,c,d){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Fe(new cn({ab:d})):new Fe(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function La(){}n=La.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Rs(){}Rs.prototype.g=function(i,c){return new _t(i,c)};function _t(i,c){Re.call(this),this.g=new Ia(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!x(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!x(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new ir(this)}g(_t,Re),_t.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},_t.prototype.close=function(){Ui(this.g)},_t.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var d={};d.__data__=i,i=d}else this.v&&(d={},d.__data__=At(i),i=d);c.i.push(new Bi(c.Ya++,i)),c.I==3&&Cs(c)},_t.prototype.N=function(){this.g.l=null,delete this.j,Ui(this.g),delete this.g,_t.Z.N.call(this)};function Oa(i){_e.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const d in c){i=d;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}g(Oa,_e);function Fa(){Ct.call(this),this.status=1}g(Fa,Ct);function ir(i){this.g=i}g(ir,La),ir.prototype.ra=function(){Ve(this.g,"a")},ir.prototype.qa=function(i){Ve(this.g,new Oa(i))},ir.prototype.pa=function(i){Ve(this.g,new Fa)},ir.prototype.oa=function(){Ve(this.g,"b")},Rs.prototype.createWebChannel=Rs.prototype.g,_t.prototype.send=_t.prototype.o,_t.prototype.open=_t.prototype.m,_t.prototype.close=_t.prototype.close,Nc=function(){return new Rs},Cc=function(){return Yn()},Ac=Ot,po={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Jn.NO_ERROR=0,Jn.TIMEOUT=8,Jn.HTTP_ERROR=6,qs=Jn,ps.COMPLETE="complete",Ic=ps,ct.EventType=Yt,Yt.OPEN="a",Yt.CLOSE="b",Yt.ERROR="c",Yt.MESSAGE="d",Re.prototype.listen=Re.prototype.J,qr=ct,Fe.prototype.listenOnce=Fe.prototype.K,Fe.prototype.getLastError=Fe.prototype.Ha,Fe.prototype.getLastErrorCode=Fe.prototype.ya,Fe.prototype.getStatus=Fe.prototype.ca,Fe.prototype.getResponseJson=Fe.prototype.La,Fe.prototype.getResponseText=Fe.prototype.la,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Fa,Tc=Fe}).apply(typeof js<"u"?js:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}it.UNAUTHENTICATED=new it(null),it.GOOGLE_CREDENTIALS=new it("google-credentials-uid"),it.FIRST_PARTY=new it("first-party-uid"),it.MOCK_USER=new it("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tr="12.9.0";function yf(n){Tr=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fn=new bc("@firebase/firestore");function or(){return Fn.logLevel}function X(n,...e){if(Fn.logLevel<=be.DEBUG){const t=e.map(Lo);Fn.debug(`Firestore (${Tr}): ${n}`,...t)}}function en(n,...e){if(Fn.logLevel<=be.ERROR){const t=e.map(Lo);Fn.error(`Firestore (${Tr}): ${n}`,...t)}}function Bn(n,...e){if(Fn.logLevel<=be.WARN){const t=e.map(Lo);Fn.warn(`Firestore (${Tr}): ${n}`,...t)}}function Lo(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function le(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Rc(n,r,t)}function Rc(n,e,t){let r=`FIRESTORE (${Tr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw en(r),new Error(r)}function we(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Rc(e,s,r)}function he(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class H extends Er{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _f{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(it.UNAUTHENTICATED))}shutdown(){}}class wf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vf{constructor(e){this.t=e,this.currentUser=it.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){we(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new bn;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new bn,e.enqueueRetryable(()=>s(this.currentUser))};const l=()=>{const h=o;e.enqueueRetryable(async()=>{await h.promise,await s(this.currentUser)})},u=h=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new bn)}},0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(we(typeof r.accessToken=="string",31837,{l:r}),new Sc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return we(e===null||typeof e=="string",2055,{h:e}),new it(e)}}class kf{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=it.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Ef{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new kf(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(it.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class el{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Tf{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,rf(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){we(this.o===void 0,3512);const r=o=>{o.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,X("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const s=o=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new el(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(we(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new el(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=If(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function me(n,e){return n<e?-1:n>e?1:0}function go(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Yi(s)===Yi(o)?me(s,o):Yi(s)?1:-1}return me(n.length,e.length)}const Af=55296,Cf=57343;function Yi(n){const e=n.charCodeAt(0);return e>=Af&&e<=Cf}function xr(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl="__name__";class qt{constructor(e,t,r){t===void 0?t=0:t>e.length&&le(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&le(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return qt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qt?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=qt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return me(e.length,t.length)}static compareSegments(e,t){const r=qt.isNumericId(e),s=qt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?qt.extractNumericId(e).compare(qt.extractNumericId(t)):go(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return xn.fromString(e.substring(4,e.length-2))}}class Ne extends qt{construct(e,t,r){return new Ne(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new H(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ne(t)}static emptyPath(){return new Ne([])}}const Nf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tt extends qt{construct(e,t,r){return new tt(e,t,r)}static isValidIdentifier(e){return Nf.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===tl}static keyField(){return new tt([tl])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new H(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let l=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new H(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new H(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(l=!l,s++):u!=="."||l?(r+=u,s++):(o(),s++)}if(o(),l)throw new H(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tt(t)}static emptyPath(){return new tt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.path=e}static fromPath(e){return new re(Ne.fromString(e))}static fromName(e){return new re(Ne.fromString(e).popFirst(5))}static empty(){return new re(Ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new Ne(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jc(n,e,t){if(!t)throw new H(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Rf(n,e,t,r){if(e===!0&&r===!0)throw new H(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function nl(n){if(!re.isDocumentKey(n))throw new H(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function rl(n){if(re.isDocumentKey(n))throw new H(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Pc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function gi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":le(12329,{type:typeof n})}function br(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new H(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=gi(n);throw new H(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Sf(n,e){if(e<=0)throw new H(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ze(n,e){const t={typeString:n};return e&&(t.value=e),t}function cs(n,e){if(!Pc(n))throw new H(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const l=n[r];if(s&&typeof l!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&l!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new H(P.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl=-62135596800,il=1e6;class Me{static now(){return Me.fromMillis(Date.now())}static fromDate(e){return Me.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*il);return new Me(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new H(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new H(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<sl)throw new H(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new H(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/il}_compareTo(e){return this.seconds===e.seconds?me(this.nanoseconds,e.nanoseconds):me(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Me._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cs(e,Me._jsonSchema))return new Me(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-sl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Me._jsonSchemaVersion="firestore/timestamp/1.0",Me._jsonSchema={type:ze("string",Me._jsonSchemaVersion),seconds:ze("number"),nanoseconds:ze("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{static fromTimestamp(e){return new ue(e)}static min(){return new ue(new Me(0,0))}static max(){return new ue(new Me(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts=-1;function jf(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ue.fromTimestamp(r===1e9?new Me(t+1,0):new Me(t,r));return new wn(s,re.empty(),e)}function Pf(n){return new wn(n.readTime,n.key,ts)}class wn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new wn(ue.min(),re.empty(),ts)}static max(){return new wn(ue.max(),re.empty(),ts)}}function Vf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=re.comparator(n.documentKey,e.documentKey),t!==0?t:me(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Df="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Mf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ir(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==Df)throw n;X("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&le(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):D.reject(t)}static resolve(e){return new D((t,r)=>{t(e)})}static reject(e){return new D((t,r)=>{r(e)})}static waitFor(e){return new D((t,r)=>{let s=0,o=0,l=!1;e.forEach(u=>{++s,u.next(()=>{++o,l&&o===s&&t()},h=>r(h))}),l=!0,o===s&&t()})}static or(e){let t=D.resolve(!1);for(const r of e)t=t.next(s=>s?D.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,o)=>{r.push(t.call(this,s,o))}),this.waitFor(r)}static mapArray(e,t){return new D((r,s)=>{const o=e.length,l=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;t(e[f]).next(m=>{l[f]=m,++u,u===o&&r(l)},m=>s(m))}})}static doWhile(e,t){return new D((r,s)=>{const o=()=>{e()===!0?t().next(()=>{o()},s):r()};o()})}}function Lf(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Ar(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}xi.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fo=-1;function bi(n){return n==null}function ni(n){return n===0&&1/n==-1/0}function Of(n){return typeof n=="number"&&Number.isInteger(n)&&!ni(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vc="";function Ff(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ol(e)),e=Bf(n.get(t),e);return ol(e)}function Bf(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case Vc:t+="";break;default:t+=o}}return t}function ol(n){return n+Vc+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function al(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function qn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Dc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oe{constructor(e,t){this.comparator=e,this.root=t||et.EMPTY}insert(e,t){return new Oe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,et.BLACK,null,null))}remove(e){return new Oe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,et.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ps(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ps(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ps(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ps(this.root,e,this.comparator,!0)}}class Ps{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class et{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??et.RED,this.left=s??et.EMPTY,this.right=o??et.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new et(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return et.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return et.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,et.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw le(43730,{key:this.key,value:this.value});if(this.right.isRed())throw le(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw le(27949);return e+(this.isRed()?0:1)}}et.EMPTY=null,et.RED=!0,et.BLACK=!1;et.EMPTY=new class{constructor(){this.size=0}get key(){throw le(57766)}get value(){throw le(16141)}get color(){throw le(16727)}get left(){throw le(29726)}get right(){throw le(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new et(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.comparator=e,this.data=new Oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ll(this.data.getIterator())}getIteratorFrom(e){return new ll(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Qe)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Qe(this.comparator);return t.data=e,t}}class ll{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.fields=e,e.sort(tt.comparator)}static empty(){return new Vt([])}unionWith(e){let t=new Qe(tt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Vt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Mc("Invalid base64 string: "+o):o}}(e);return new nt(t)}static fromUint8Array(e){const t=function(s){let o="";for(let l=0;l<s.length;++l)o+=String.fromCharCode(s[l]);return o}(e);return new nt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return me(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nt.EMPTY_BYTE_STRING=new nt("");const $f=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vn(n){if(we(!!n,39018),typeof n=="string"){let e=0;const t=$f.exec(n);if(we(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:$e(n.seconds),nanos:$e(n.nanos)}}function $e(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function kn(n){return typeof n=="string"?nt.fromBase64String(n):nt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lc="server_timestamp",Oc="__type__",Fc="__previous_value__",Bc="__local_write_time__";function yi(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Oc])==null?void 0:r.stringValue)===Lc}function _i(n){const e=n.mapValue.fields[Fc];return yi(e)?_i(e):e}function ns(n){const e=vn(n.mapValue.fields[Bc].timestampValue);return new Me(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(e,t,r,s,o,l,u,h,f,m,g){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=m,this.apiKey=g}}const ri="(default)";class rs{constructor(e,t){this.projectId=e,this.database=t||ri}static empty(){return new rs("","")}get isDefaultDatabase(){return this.database===ri}isEqual(e){return e instanceof rs&&e.projectId===this.projectId&&e.database===this.database}}function qf(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new H(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rs(n.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $c="__type__",zf="__max__",Vs={mapValue:{}},Uc="__vector__",si="value";function En(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?yi(n)?4:Hf(n)?9007199254740991:Wf(n)?10:11:le(28295,{value:n})}function Kt(n,e){if(n===e)return!0;const t=En(n);if(t!==En(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ns(n).isEqual(ns(e));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const l=vn(s.timestampValue),u=vn(o.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,o){return kn(s.bytesValue).isEqual(kn(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,o){return $e(s.geoPointValue.latitude)===$e(o.geoPointValue.latitude)&&$e(s.geoPointValue.longitude)===$e(o.geoPointValue.longitude)}(n,e);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return $e(s.integerValue)===$e(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const l=$e(s.doubleValue),u=$e(o.doubleValue);return l===u?ni(l)===ni(u):isNaN(l)&&isNaN(u)}return!1}(n,e);case 9:return xr(n.arrayValue.values||[],e.arrayValue.values||[],Kt);case 10:case 11:return function(s,o){const l=s.mapValue.fields||{},u=o.mapValue.fields||{};if(al(l)!==al(u))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(u[h]===void 0||!Kt(l[h],u[h])))return!1;return!0}(n,e);default:return le(52216,{left:n})}}function ss(n,e){return(n.values||[]).find(t=>Kt(t,e))!==void 0}function yr(n,e){if(n===e)return 0;const t=En(n),r=En(e);if(t!==r)return me(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return me(n.booleanValue,e.booleanValue);case 2:return function(o,l){const u=$e(o.integerValue||o.doubleValue),h=$e(l.integerValue||l.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return cl(n.timestampValue,e.timestampValue);case 4:return cl(ns(n),ns(e));case 5:return go(n.stringValue,e.stringValue);case 6:return function(o,l){const u=kn(o),h=kn(l);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,l){const u=o.split("/"),h=l.split("/");for(let f=0;f<u.length&&f<h.length;f++){const m=me(u[f],h[f]);if(m!==0)return m}return me(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,l){const u=me($e(o.latitude),$e(l.latitude));return u!==0?u:me($e(o.longitude),$e(l.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return ul(n.arrayValue,e.arrayValue);case 10:return function(o,l){var E,C,j,L;const u=o.fields||{},h=l.fields||{},f=(E=u[si])==null?void 0:E.arrayValue,m=(C=h[si])==null?void 0:C.arrayValue,g=me(((j=f==null?void 0:f.values)==null?void 0:j.length)||0,((L=m==null?void 0:m.values)==null?void 0:L.length)||0);return g!==0?g:ul(f,m)}(n.mapValue,e.mapValue);case 11:return function(o,l){if(o===Vs.mapValue&&l===Vs.mapValue)return 0;if(o===Vs.mapValue)return 1;if(l===Vs.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=l.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let g=0;g<h.length&&g<m.length;++g){const E=go(h[g],m[g]);if(E!==0)return E;const C=yr(u[h[g]],f[m[g]]);if(C!==0)return C}return me(h.length,m.length)}(n.mapValue,e.mapValue);default:throw le(23264,{he:t})}}function cl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return me(n,e);const t=vn(n),r=vn(e),s=me(t.seconds,r.seconds);return s!==0?s:me(t.nanos,r.nanos)}function ul(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=yr(t[s],r[s]);if(o)return o}return me(t.length,r.length)}function _r(n){return xo(n)}function xo(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=vn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return kn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=xo(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const l of r)o?o=!1:s+=",",s+=`${l}:${xo(t.fields[l])}`;return s+"}"}(n.mapValue):le(61005,{value:n})}function zs(n){switch(En(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_i(n);return e?16+zs(e):16;case 5:return 2*n.stringValue.length;case 6:return kn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+zs(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return qn(r.fields,(o,l)=>{s+=o.length+zs(l)}),s}(n.mapValue);default:throw le(13486,{value:n})}}function ii(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function bo(n){return!!n&&"integerValue"in n}function Bo(n){return!!n&&"arrayValue"in n}function dl(n){return!!n&&"nullValue"in n}function hl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ws(n){return!!n&&"mapValue"in n}function Wf(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[$c])==null?void 0:r.stringValue)===Uc}function Yr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return qn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Yr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Yr(n.arrayValue.values[t]);return e}return{...n}}function Hf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===zf}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et{constructor(e){this.value=e}static empty(){return new Et({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Yr(t)}setAll(e){let t=tt.emptyPath(),r={},s=[];e.forEach((l,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}l?r[u.lastSegment()]=Yr(l):s.push(u.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ws(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){qn(t,(s,o)=>e[s]=o);for(const s of r)delete e[s]}clone(){return new Et(Yr(this.value))}}function qc(n){const e=[];return qn(n.fields,(t,r)=>{const s=new tt([t]);if(Ws(r)){const o=qc(r.mapValue).fields;if(o.length===0)e.push(s);else for(const l of o)e.push(s.child(l))}else e.push(s)}),new Vt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e,t,r,s,o,l,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=l,this.documentState=u}static newInvalidDocument(e){return new ot(e,0,ue.min(),ue.min(),ue.min(),Et.empty(),0)}static newFoundDocument(e,t,r,s){return new ot(e,1,t,ue.min(),r,s,0)}static newNoDocument(e,t){return new ot(e,2,t,ue.min(),ue.min(),Et.empty(),0)}static newUnknownDocument(e,t){return new ot(e,3,t,ue.min(),ue.min(),Et.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ue.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Et.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Et.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e,t){this.position=e,this.inclusive=t}}function fl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],l=n.position[s];if(o.field.isKeyField()?r=re.comparator(re.fromName(l.referenceValue),t.key):r=yr(l,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function ml(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Kt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e,t="asc"){this.field=e,this.dir=t}}function Gf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc{}class qe extends zc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Qf(e,t,r):t==="array-contains"?new Xf(e,r):t==="in"?new Zf(e,r):t==="not-in"?new em(e,r):t==="array-contains-any"?new tm(e,r):new qe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Yf(e,r):new Jf(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(yr(t,this.value)):t!==null&&En(this.value)===En(t)&&this.matchesComparison(yr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return le(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Mt extends zc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Mt(e,t)}matches(e){return Wc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Wc(n){return n.op==="and"}function Hc(n){return Kf(n)&&Wc(n)}function Kf(n){for(const e of n.filters)if(e instanceof Mt)return!1;return!0}function yo(n){if(n instanceof qe)return n.field.canonicalString()+n.op.toString()+_r(n.value);if(Hc(n))return n.filters.map(e=>yo(e)).join(",");{const e=n.filters.map(t=>yo(t)).join(",");return`${n.op}(${e})`}}function Gc(n,e){return n instanceof qe?function(r,s){return s instanceof qe&&r.op===s.op&&r.field.isEqual(s.field)&&Kt(r.value,s.value)}(n,e):n instanceof Mt?function(r,s){return s instanceof Mt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,l,u)=>o&&Gc(l,s.filters[u]),!0):!1}(n,e):void le(19439)}function Kc(n){return n instanceof qe?function(t){return`${t.field.canonicalString()} ${t.op} ${_r(t.value)}`}(n):n instanceof Mt?function(t){return t.op.toString()+" {"+t.getFilters().map(Kc).join(" ,")+"}"}(n):"Filter"}class Qf extends qe{constructor(e,t,r){super(e,t,r),this.key=re.fromName(r.referenceValue)}matches(e){const t=re.comparator(e.key,this.key);return this.matchesComparison(t)}}class Yf extends qe{constructor(e,t){super(e,"in",t),this.keys=Qc("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Jf extends qe{constructor(e,t){super(e,"not-in",t),this.keys=Qc("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Qc(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>re.fromName(r.referenceValue))}class Xf extends qe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Bo(t)&&ss(t.arrayValue,this.value)}}class Zf extends qe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ss(this.value.arrayValue,t)}}class em extends qe{constructor(e,t){super(e,"not-in",t)}matches(e){if(ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ss(this.value.arrayValue,t)}}class tm extends qe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Bo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ss(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,t=null,r=[],s=[],o=null,l=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=l,this.endAt=u,this.Te=null}}function pl(n,e=null,t=[],r=[],s=null,o=null,l=null){return new nm(n,e,t,r,s,o,l)}function $o(n){const e=he(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>yo(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),bi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>_r(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>_r(r)).join(",")),e.Te=t}return e.Te}function Uo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Gf(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Gc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!ml(n.startAt,e.startAt)&&ml(n.endAt,e.endAt)}function _o(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e,t=null,r=[],s=[],o=null,l="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=l,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function rm(n,e,t,r,s,o,l,u){return new zn(n,e,t,r,s,o,l,u)}function Yc(n){return new zn(n)}function gl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function sm(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function qo(n){return n.collectionGroup!==null}function hr(n){const e=he(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new Qe(tt.comparator);return l.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new is(o,r))}),t.has(tt.keyField().canonicalString())||e.Ie.push(new is(tt.keyField(),r))}return e.Ie}function zt(n){const e=he(n);return e.Ee||(e.Ee=im(e,hr(n))),e.Ee}function im(n,e){if(n.limitType==="F")return pl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const o=s.dir==="desc"?"asc":"desc";return new is(s.field,o)});const t=n.endAt?new wr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new wr(n.startAt.position,n.startAt.inclusive):null;return pl(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function wo(n,e){const t=n.filters.concat([e]);return new zn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function om(n,e){const t=n.explicitOrderBy.concat([e]);return new zn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function oi(n,e,t){return new zn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function am(n,e){return new zn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function wi(n,e){return Uo(zt(n),zt(e))&&n.limitType===e.limitType}function Jc(n){return`${$o(zt(n))}|lt:${n.limitType}`}function ar(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Kc(s)).join(", ")}]`),bi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(l){return`${l.field.canonicalString()} (${l.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>_r(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>_r(s)).join(",")),`Target(${r})`}(zt(n))}; limitType=${n.limitType})`}function vi(n,e){return e.isFoundDocument()&&function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):re.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,s){for(const o of hr(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(l,u,h){const f=fl(l,u,h);return l.inclusive?f<=0:f<0}(r.startAt,hr(r),s)||r.endAt&&!function(l,u,h){const f=fl(l,u,h);return l.inclusive?f>=0:f>0}(r.endAt,hr(r),s))}(n,e)}function lm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Xc(n){return(e,t)=>{let r=!1;for(const s of hr(n)){const o=cm(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function cm(n,e,t){const r=n.field.isKeyField()?re.comparator(e.key,t.key):function(o,l,u){const h=l.data.field(o),f=u.data.field(o);return h!==null&&f!==null?yr(h,f):le(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return le(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){qn(this.inner,(t,r)=>{for(const[s,o]of r)e(s,o)})}isEmpty(){return Dc(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const um=new Oe(re.comparator);function tn(){return um}const Zc=new Oe(re.comparator);function zr(...n){let e=Zc;for(const t of n)e=e.insert(t.key,t);return e}function eu(n){let e=Zc;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ln(){return Jr()}function tu(){return Jr()}function Jr(){return new Wn(n=>n.toString(),(n,e)=>n.isEqual(e))}const dm=new Oe(re.comparator),hm=new Qe(re.comparator);function pe(...n){let e=hm;for(const t of n)e=e.add(t);return e}const fm=new Qe(me);function mm(){return fm}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ni(e)?"-0":e}}function nu(n){return{integerValue:""+n}}function pm(n,e){return Of(e)?nu(e):zo(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(){this._=void 0}}function gm(n,e,t){return n instanceof ai?function(s,o){const l={fields:{[Oc]:{stringValue:Lc},[Bc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&yi(o)&&(o=_i(o)),o&&(l.fields[Fc]=o),{mapValue:l}}(t,e):n instanceof os?su(n,e):n instanceof as?iu(n,e):function(s,o){const l=ru(s,o),u=xl(l)+xl(s.Ae);return bo(l)&&bo(s.Ae)?nu(u):zo(s.serializer,u)}(n,e)}function xm(n,e,t){return n instanceof os?su(n,e):n instanceof as?iu(n,e):t}function ru(n,e){return n instanceof li?function(r){return bo(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class ai extends ki{}class os extends ki{constructor(e){super(),this.elements=e}}function su(n,e){const t=ou(e);for(const r of n.elements)t.some(s=>Kt(s,r))||t.push(r);return{arrayValue:{values:t}}}class as extends ki{constructor(e){super(),this.elements=e}}function iu(n,e){let t=ou(e);for(const r of n.elements)t=t.filter(s=>!Kt(s,r));return{arrayValue:{values:t}}}class li extends ki{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function xl(n){return $e(n.integerValue||n.doubleValue)}function ou(n){return Bo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function bm(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof os&&s instanceof os||r instanceof as&&s instanceof as?xr(r.elements,s.elements,Kt):r instanceof li&&s instanceof li?Kt(r.Ae,s.Ae):r instanceof ai&&s instanceof ai}(n.transform,e.transform)}class ym{constructor(e,t){this.version=e,this.transformResults=t}}class Wt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Wt}static exists(e){return new Wt(void 0,e)}static updateTime(e){return new Wt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ei{}function au(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Wo(n.key,Wt.none()):new us(n.key,n.data,Wt.none());{const t=n.data,r=Et.empty();let s=new Qe(tt.comparator);for(let o of e.fields)if(!s.has(o)){let l=t.field(o);l===null&&o.length>1&&(o=o.popLast(),l=t.field(o)),l===null?r.delete(o):r.set(o,l),s=s.add(o)}return new Hn(n.key,r,new Vt(s.toArray()),Wt.none())}}function _m(n,e,t){n instanceof us?function(s,o,l){const u=s.value.clone(),h=yl(s.fieldTransforms,o,l.transformResults);u.setAll(h),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()}(n,e,t):n instanceof Hn?function(s,o,l){if(!Hs(s.precondition,o))return void o.convertToUnknownDocument(l.version);const u=yl(s.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(lu(s)),h.setAll(u),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()}(n,e,t):function(s,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()}(0,e,t)}function Xr(n,e,t,r){return n instanceof us?function(o,l,u,h){if(!Hs(o.precondition,l))return u;const f=o.value.clone(),m=_l(o.fieldTransforms,h,l);return f.setAll(m),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof Hn?function(o,l,u,h){if(!Hs(o.precondition,l))return u;const f=_l(o.fieldTransforms,h,l),m=l.data;return m.setAll(lu(o)),m.setAll(f),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(g=>g.field))}(n,e,t,r):function(o,l,u){return Hs(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u}(n,e,t)}function wm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=ru(r.transform,s||null);o!=null&&(t===null&&(t=Et.empty()),t.set(r.field,o))}return t||null}function bl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&xr(r,s,(o,l)=>bm(o,l))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class us extends Ei{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Hn extends Ei{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function lu(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function yl(n,e,t){const r=new Map;we(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const o=n[s],l=o.transform,u=e.data.field(o.field);r.set(o.field,xm(l,u,t[s]))}return r}function _l(n,e,t){const r=new Map;for(const s of n){const o=s.transform,l=t.data.field(s.field);r.set(s.field,gm(o,l,e))}return r}class Wo extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vm extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&_m(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Xr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Xr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=tu();return this.mutations.forEach(s=>{const o=e.get(s.key),l=o.overlayedDocument;let u=this.applyToLocalView(l,o.mutatedFields);u=t.has(s.key)?null:u;const h=au(l,u);h!==null&&r.set(s.key,h),l.isValidDocument()||l.convertToNoDocument(ue.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),pe())}isEqual(e){return this.batchId===e.batchId&&xr(this.mutations,e.mutations,(t,r)=>bl(t,r))&&xr(this.baseMutations,e.baseMutations,(t,r)=>bl(t,r))}}class Ho{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){we(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return dm}();const o=e.mutations;for(let l=0;l<o.length;l++)s=s.insert(o[l].key,r[l].version);return new Ho(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Em{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tm{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ue,xe;function Im(n){switch(n){case P.OK:return le(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return le(15467,{code:n})}}function cu(n){if(n===void 0)return en("GRPC error has no .code"),P.UNKNOWN;switch(n){case Ue.OK:return P.OK;case Ue.CANCELLED:return P.CANCELLED;case Ue.UNKNOWN:return P.UNKNOWN;case Ue.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Ue.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Ue.INTERNAL:return P.INTERNAL;case Ue.UNAVAILABLE:return P.UNAVAILABLE;case Ue.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Ue.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Ue.NOT_FOUND:return P.NOT_FOUND;case Ue.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Ue.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Ue.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Ue.ABORTED:return P.ABORTED;case Ue.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Ue.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Ue.DATA_LOSS:return P.DATA_LOSS;default:return le(39323,{code:n})}}(xe=Ue||(Ue={}))[xe.OK=0]="OK",xe[xe.CANCELLED=1]="CANCELLED",xe[xe.UNKNOWN=2]="UNKNOWN",xe[xe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",xe[xe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",xe[xe.NOT_FOUND=5]="NOT_FOUND",xe[xe.ALREADY_EXISTS=6]="ALREADY_EXISTS",xe[xe.PERMISSION_DENIED=7]="PERMISSION_DENIED",xe[xe.UNAUTHENTICATED=16]="UNAUTHENTICATED",xe[xe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",xe[xe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",xe[xe.ABORTED=10]="ABORTED",xe[xe.OUT_OF_RANGE=11]="OUT_OF_RANGE",xe[xe.UNIMPLEMENTED=12]="UNIMPLEMENTED",xe[xe.INTERNAL=13]="INTERNAL",xe[xe.UNAVAILABLE=14]="UNAVAILABLE",xe[xe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cm=new xn([4294967295,4294967295],0);function wl(n){const e=Am().encode(n),t=new Ec;return t.update(e),new Uint8Array(t.digest())}function vl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new xn([t,r],0),new xn([s,o],0)]}class Go{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Wr(`Invalid padding: ${t}`);if(r<0)throw new Wr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Wr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Wr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=xn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(xn.fromNumber(r)));return s.compare(Cm)===1&&(s=new xn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=wl(e),[r,s]=vl(t);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);if(!this.we(l))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new Go(o,s,t);return r.forEach(u=>l.insert(u)),l}insert(e){if(this.ge===0)return;const t=wl(e),[r,s]=vl(t);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);this.be(l)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Wr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,ds.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ti(ue.min(),s,new Oe(me),tn(),pe())}}class ds{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ds(r,t,pe(),pe(),pe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class uu{constructor(e,t){this.targetId=e,this.Ce=t}}class du{constructor(e,t,r=nt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class kl{constructor(){this.ve=0,this.Fe=El(),this.Me=nt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=pe(),t=pe(),r=pe();return this.Fe.forEach((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:le(38017,{changeType:o})}}),new ds(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=El()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,we(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Nm{constructor(e){this.Ge=e,this.ze=new Map,this.je=tn(),this.He=Ds(),this.Je=Ds(),this.Ze=new Oe(me)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:le(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(_o(o))if(r===0){const l=new re(o.path);this.et(t,l,ot.newNoDocument(l,ue.min()))}else we(r===1,20013,{expectedCount:r});else{const l=this._t(t);if(l!==r){const u=this.ut(e),h=u?this.ct(u,e,l):1;if(h!==0){this.it(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let l,u;try{l=kn(r).toUint8Array()}catch(h){if(h instanceof Mc)return Bn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Go(l,s,o)}catch(h){return Bn(h instanceof Wr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(o=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((o,l)=>{const u=this.ot(l);if(u){if(o.current&&_o(u.target)){const h=new re(u.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,ot.newNoDocument(h,e))}o.Be&&(t.set(l,o.ke()),o.Ke())}});let r=pe();this.Je.forEach((o,l)=>{let u=!0;l.forEachWhile(h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.je.forEach((o,l)=>l.setReadTime(e));const s=new Ti(e,t,this.Ze,this.je,r);return this.je=tn(),this.He=Ds(),this.Je=Ds(),this.Ze=new Oe(me),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new kl,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Qe(me),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Qe(me),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||X("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new kl),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ds(){return new Oe(re.comparator)}function El(){return new Oe(re.comparator)}const Rm={asc:"ASCENDING",desc:"DESCENDING"},Sm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jm={and:"AND",or:"OR"};class Pm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function vo(n,e){return n.useProto3Json||bi(e)?e:{value:e}}function ci(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hu(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Vm(n,e){return ci(n,e.toTimestamp())}function Ht(n){return we(!!n,49232),ue.fromTimestamp(function(t){const r=vn(t);return new Me(r.seconds,r.nanos)}(n))}function Ko(n,e){return ko(n,e).canonicalString()}function ko(n,e){const t=function(s){return new Ne(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function fu(n){const e=Ne.fromString(n);return we(bu(e),10190,{key:e.toString()}),e}function Eo(n,e){return Ko(n.databaseId,e.path)}function Ji(n,e){const t=fu(e);if(t.get(1)!==n.databaseId.projectId)throw new H(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new H(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new re(pu(t))}function mu(n,e){return Ko(n.databaseId,e)}function Dm(n){const e=fu(n);return e.length===4?Ne.emptyPath():pu(e)}function To(n){return new Ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function pu(n){return we(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Tl(n,e,t){return{name:Eo(n,e),fields:t.value.mapValue.fields}}function Mm(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:le(39313,{state:f})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=function(f,m){return f.useProto3Json?(we(m===void 0||typeof m=="string",58123),nt.fromBase64String(m||"")):(we(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),nt.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),l=e.targetChange.cause,u=l&&function(f){const m=f.code===void 0?P.UNKNOWN:cu(f.code);return new H(m,f.message||"")}(l);t=new du(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ji(n,r.document.name),o=Ht(r.document.updateTime),l=r.document.createTime?Ht(r.document.createTime):ue.min(),u=new Et({mapValue:{fields:r.document.fields}}),h=ot.newFoundDocument(s,o,l,u),f=r.targetIds||[],m=r.removedTargetIds||[];t=new Gs(f,m,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ji(n,r.document),o=r.readTime?Ht(r.readTime):ue.min(),l=ot.newNoDocument(s,o),u=r.removedTargetIds||[];t=new Gs([],u,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ji(n,r.document),o=r.removedTargetIds||[];t=new Gs([],o,s,null)}else{if(!("filter"in e))return le(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,l=new Tm(s,o),u=r.targetId;t=new uu(u,l)}}return t}function Lm(n,e){let t;if(e instanceof us)t={update:Tl(n,e.key,e.value)};else if(e instanceof Wo)t={delete:Eo(n,e.key)};else if(e instanceof Hn)t={update:Tl(n,e.key,e.data),updateMask:Hm(e.fieldMask)};else{if(!(e instanceof vm))return le(16599,{dt:e.type});t={verify:Eo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,l){const u=l.transform;if(u instanceof ai)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof os)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof as)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof li)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw le(20930,{transform:l.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Vm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:le(27497)}(n,e.precondition)),t}function Om(n,e){return n&&n.length>0?(we(e!==void 0,14353),n.map(t=>function(s,o){let l=s.updateTime?Ht(s.updateTime):Ht(o);return l.isEqual(ue.min())&&(l=Ht(o)),new ym(l,s.transformResults||[])}(t,e))):[]}function Fm(n,e){return{documents:[mu(n,e.path)]}}function Bm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=mu(n,s);const o=function(f){if(f.length!==0)return xu(Mt.create(f,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const l=function(f){if(f.length!==0)return f.map(m=>function(E){return{field:lr(E.field),direction:qm(E.dir)}}(m))}(e.orderBy);l&&(t.structuredQuery.orderBy=l);const u=vo(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{ft:t,parent:s}}function $m(n){let e=Dm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){we(r===1,65062);const m=t.from[0];m.allDescendants?s=m.collectionId:e=e.child(m.collectionId)}let o=[];t.where&&(o=function(g){const E=gu(g);return E instanceof Mt&&Hc(E)?E.getFilters():[E]}(t.where));let l=[];t.orderBy&&(l=function(g){return g.map(E=>function(j){return new is(cr(j.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(E))}(t.orderBy));let u=null;t.limit&&(u=function(g){let E;return E=typeof g=="object"?g.value:g,bi(E)?null:E}(t.limit));let h=null;t.startAt&&(h=function(g){const E=!!g.before,C=g.values||[];return new wr(C,E)}(t.startAt));let f=null;return t.endAt&&(f=function(g){const E=!g.before,C=g.values||[];return new wr(C,E)}(t.endAt)),rm(e,s,l,o,u,"F",h,f)}function Um(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return le(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function gu(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=cr(t.unaryFilter.field);return qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=cr(t.unaryFilter.field);return qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=cr(t.unaryFilter.field);return qe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=cr(t.unaryFilter.field);return qe.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return le(61313);default:return le(60726)}}(n):n.fieldFilter!==void 0?function(t){return qe.create(cr(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return le(58110);default:return le(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Mt.create(t.compositeFilter.filters.map(r=>gu(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return le(1026)}}(t.compositeFilter.op))}(n):le(30097,{filter:n})}function qm(n){return Rm[n]}function zm(n){return Sm[n]}function Wm(n){return jm[n]}function lr(n){return{fieldPath:n.canonicalString()}}function cr(n){return tt.fromServerFormat(n.fieldPath)}function xu(n){return n instanceof qe?function(t){if(t.op==="=="){if(hl(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NAN"}};if(dl(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(hl(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NOT_NAN"}};if(dl(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:lr(t.field),op:zm(t.op),value:t.value}}}(n):n instanceof Mt?function(t){const r=t.getFilters().map(s=>xu(s));return r.length===1?r[0]:{compositeFilter:{op:Wm(t.op),filters:r}}}(n):le(54877,{filter:n})}function Hm(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function bu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function yu(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e,t,r,s,o=ue.min(),l=ue.min(),u=nt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new mn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new mn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new mn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new mn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(e){this.yt=e}}function Km(n){const e=$m({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?oi(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(){this.Sn=new Ym}addToCollectionParentIndex(e,t){return this.Sn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(wn.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(wn.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class Ym{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Qe(Ne.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Qe(Ne.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},_u=41943040;class mt{static withCacheSize(e){return new mt(e,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mt.DEFAULT_COLLECTION_PERCENTILE=10,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mt.DEFAULT=new mt(_u,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mt.DISABLED=new mt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new vr(0)}static ar(){return new vr(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Al="LruGarbageCollector",Jm=1048576;function Cl([n,e],[t,r]){const s=me(n,t);return s===0?me(e,r):s}class Xm{constructor(e){this.Pr=e,this.buffer=new Qe(Cl),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Cl(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Zm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){X(Al,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ar(t)?X(Al,"Ignoring IndexedDB error during garbage collection: ",t):await Ir(t)}await this.Ar(3e5)})}}class e0{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return D.resolve(xi.ce);const r=new Xm(t);return this.Vr.forEachTarget(e,s=>r.Er(s.sequenceNumber)).next(()=>this.Vr.mr(e,s=>r.Er(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(Il)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Il):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,o,l,u,h,f;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,l=Date.now(),this.nthSequenceNumber(e,s))).next(g=>(r=g,u=Date.now(),this.removeTargets(e,r,t))).next(g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(g=>(f=Date.now(),or()<=be.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-m}ms
	Determined least recently used ${s} in `+(u-l)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:g})))}}function t0(n,e){return new e0(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(){this.changes=new Wn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Xr(r.mutation,s,Vt.empty(),Me.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,pe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=pe()){const s=Ln();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(o=>{let l=zr();return o.forEach((u,h)=>{l=l.insert(u,h.overlayedDocument)}),l}))}getOverlayedDocuments(e,t){const r=Ln();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,pe()))}populateOverlays(e,t,r){const s=[];return r.forEach(o=>{t.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(e,s).next(o=>{o.forEach((l,u)=>{t.set(l,u)})})}computeViews(e,t,r,s){let o=tn();const l=Jr(),u=function(){return Jr()}();return t.forEach((h,f)=>{const m=r.get(f.key);s.has(f.key)&&(m===void 0||m.mutation instanceof Hn)?o=o.insert(f.key,f):m!==void 0?(l.set(f.key,m.mutation.getFieldMask()),Xr(m.mutation,f,m.mutation.getFieldMask(),Me.now())):l.set(f.key,Vt.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((f,m)=>l.set(f,m)),t.forEach((f,m)=>u.set(f,new r0(m,l.get(f)??null))),u))}recalculateAndSaveOverlays(e,t){const r=Jr();let s=new Oe((l,u)=>l-u),o=pe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(l=>{for(const u of l)u.keys().forEach(h=>{const f=t.get(h);if(f===null)return;let m=r.get(h)||Vt.empty();m=u.applyToLocalView(f,m),r.set(h,m);const g=(s.get(u.batchId)||pe()).add(h);s=s.insert(u.batchId,g)})}).next(()=>{const l=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,m=h.value,g=tu();m.forEach(E=>{if(!o.has(E)){const C=au(t.get(E),r.get(E));C!==null&&g.set(E,C),o=o.add(E)}}),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return D.waitFor(l)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return sm(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):qo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(o=>{const l=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):D.resolve(Ln());let u=ts,h=o;return l.next(f=>D.forEach(f,(m,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),o.get(m)?D.resolve():this.remoteDocumentCache.getEntry(e,m).next(E=>{h=h.insert(m,E)}))).next(()=>this.populateOverlays(e,f,o)).next(()=>this.computeViews(e,h,f,pe())).next(m=>({batchId:u,changes:eu(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new re(t)).next(r=>{let s=zr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let l=zr();return this.indexManager.getCollectionParents(e,o).next(u=>D.forEach(u,h=>{const f=function(g,E){return new zn(E,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,s).next(m=>{m.forEach((g,E)=>{l=l.insert(g,E)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s))).next(l=>{o.forEach((h,f)=>{const m=f.getKey();l.get(m)===null&&(l=l.insert(m,ot.newInvalidDocument(m)))});let u=zr();return l.forEach((h,f)=>{const m=o.get(h);m!==void 0&&Xr(m.mutation,f,Vt.empty(),Me.now()),vi(t,f)&&(u=u.insert(h,f))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return D.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Ht(s.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(s){return{name:s.name,query:Km(s.bundledQuery),readTime:Ht(s.readTime)}}(t)),D.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(){this.overlays=new Oe(re.comparator),this.Lr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ln();return D.forEach(t,s=>this.getOverlay(e,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,o)=>{this.bt(e,t,o)}),D.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Lr.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){const s=Ln(),o=t.length+1,l=new re(t.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return D.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new Oe((f,m)=>f-m);const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=Ln(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const u=Ln(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>u.set(f,m)),!(u.size()>=s)););return D.resolve(u)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const l=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new Em(t,r));let o=this.Lr.get(t);o===void 0&&(o=pe(),this.Lr.set(t,o)),this.Lr.set(t,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(){this.sessionToken=nt.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qo{constructor(){this.kr=new Qe(Je.Kr),this.qr=new Qe(Je.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new Je(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new Je(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){const t=new re(new Ne([])),r=new Je(t,e),s=new Je(t,e+1),o=[];return this.qr.forEachInRange([r,s],l=>{this.Wr(l),o.push(l.key)}),o}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new re(new Ne([])),r=new Je(t,e),s=new Je(t,e+1);let o=pe();return this.qr.forEachInRange([r,s],l=>{o=o.add(l.key)}),o}containsKey(e){const t=new Je(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Je{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return re.comparator(e.key,t.key)||me(e.Hr,t.Hr)}static Ur(e,t){return me(e.Hr,t.Hr)||re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Qe(Je.Kr)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new km(o,t,r,s);this.mutationQueue.push(l);for(const u of s)this.Jr=this.Jr.add(new Je(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return D.resolve(l)}lookupMutationBatch(e,t){return D.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),o=s<0?0:s;return D.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?Fo:this.Yn-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Je(t,0),s=new Je(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,s],l=>{const u=this.Zr(l.Hr);o.push(u)}),D.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Qe(me);return t.forEach(s=>{const o=new Je(s,0),l=new Je(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,l],u=>{r=r.add(u.Hr)})}),D.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;re.isDocumentKey(o)||(o=o.child(""));const l=new Je(new re(o),0);let u=new Qe(me);return this.Jr.forEachWhile(h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.Hr)),!0)},l),D.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach(r=>{const s=this.Zr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){we(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return D.forEach(t.mutations,s=>{const o=new Je(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){const r=new Je(t,0),s=this.Jr.firstAfterOrEqual(r);return D.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e){this.ti=e,this.docs=function(){return new Oe(re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,l=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():ot.newInvalidDocument(t))}getEntries(e,t){let r=tn();return t.forEach(s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():ot.newInvalidDocument(s))}),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=tn();const l=t.path,u=new re(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:m}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||Vf(Pf(m),r)<=0||(s.has(m.key)||vi(t,m))&&(o=o.insert(m.key,m.mutableCopy()))}return D.resolve(o)}getAllFromCollectionGroup(e,t,r,s){le(9500)}ni(e,t){return D.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new u0(this)}getSize(e){return D.resolve(this.size)}}class u0 extends n0{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)}),D.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(e){this.persistence=e,this.ri=new Wn(t=>$o(t),Uo),this.lastRemoteSnapshotVersion=ue.min(),this.highestTargetId=0,this.ii=0,this.si=new Qo,this.targetCount=0,this.oi=vr._r()}forEachTarget(e,t){return this.ri.forEach((r,s)=>t(s)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),D.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new vr(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.lr(t),D.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.ri.forEach((l,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ri.delete(l),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),D.waitFor(o).next(()=>s)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),D.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach(l=>{o.push(s.markPotentiallyOrphaned(e,l))}),D.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this.si.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e,t){this._i={},this.overlays={},this.ai=new xi(0),this.ui=!1,this.ui=!0,this.ci=new a0,this.referenceDelegate=e(this),this.li=new d0(this),this.indexManager=new Qm,this.remoteDocumentCache=function(s){return new c0(s)}(r=>this.referenceDelegate.hi(r)),this.serializer=new Gm(t),this.Pi=new i0(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new o0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new l0(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){X("MemoryPersistence","Starting transaction:",e);const s=new h0(this.ai.next());return this.referenceDelegate.Ti(),r(s).next(o=>this.referenceDelegate.Ii(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ei(e,t){return D.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class h0 extends Mf{constructor(e){super(),this.currentSequenceNumber=e}}class Yo{constructor(e){this.persistence=e,this.Ri=new Qo,this.Ai=null}static Vi(e){return new Yo(e)}get di(){if(this.Ai)return this.Ai;throw le(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(s=>this.di.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.di.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.di,r=>{const s=re.fromPath(r);return this.mi(e,s).next(o=>{o||t.removeEntry(s,ue.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ui{constructor(e,t){this.persistence=e,this.fi=new Wn(r=>Ff(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=t0(this,t)}static Vi(e,t){return new ui(e,t)}Ti(){}Ii(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return D.forEach(this.fi,(r,s)=>this.wr(e,r,s).next(o=>o?D.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ni(e,l=>this.wr(e,l,t).next(u=>{u||(r++,o.removeEntry(l,ue.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),D.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=zs(e.data.value)),t}wr(e,t,r){return D.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return D.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=pe(),s=pe();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Jo(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return eh()?8:Lf(Xd())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.gs(e,t).next(l=>{o.result=l}).next(()=>{if(!o.result)return this.ps(e,t,s,r).next(l=>{o.result=l})}).next(()=>{if(o.result)return;const l=new f0;return this.ys(e,t,l).next(u=>{if(o.result=u,this.As)return this.ws(e,t,l,u.size)})}).next(()=>o.result)}ws(e,t,r,s){return r.documentReadCount<this.Vs?(or()<=be.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",ar(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),D.resolve()):(or()<=be.DEBUG&&X("QueryEngine","Query:",ar(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(or()<=be.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",ar(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,zt(t))):D.resolve())}gs(e,t){if(gl(t))return D.resolve(null);let r=zt(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=oi(t,null,"F"),r=zt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const l=pe(...o);return this.fs.getDocuments(e,l).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{const f=this.bs(t,u);return this.Ss(t,f,l,h.readTime)?this.gs(e,oi(t,null,"F")):this.Ds(e,f,t,h)}))})))}ps(e,t,r,s){return gl(t)||s.isEqual(ue.min())?D.resolve(null):this.fs.getDocuments(e,r).next(o=>{const l=this.bs(t,o);return this.Ss(t,l,r,s)?D.resolve(null):(or()<=be.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ar(t)),this.Ds(e,l,t,jf(s,ts)).next(u=>u))})}bs(e,t){let r=new Qe(Xc(e));return t.forEach((s,o)=>{vi(e,o)&&(r=r.add(o))}),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ys(e,t,r){return or()<=be.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",ar(t)),this.fs.getDocumentsMatchingQuery(e,t,wn.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next(o=>(t.forEach(l=>{o=o.insert(l.key,l)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="LocalStore",p0=3e8;class g0{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new Oe(me),this.Fs=new Wn(o=>$o(o),Uo),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new s0(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function x0(n,e,t,r){return new g0(n,e,t,r)}async function vu(n,e){const t=he(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{const l=[],u=[];let h=pe();for(const f of s){l.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}for(const f of o){u.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}return t.localDocuments.getDocuments(r,h).next(f=>({Ns:f,removedBatchIds:l,addedBatchIds:u}))})})}function b0(n,e){const t=he(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return function(u,h,f,m){const g=f.batch,E=g.keys();let C=D.resolve();return E.forEach(j=>{C=C.next(()=>m.getEntry(h,j)).next(L=>{const V=f.docVersions.get(j);we(V!==null,48541),L.version.compareTo(V)<0&&(g.applyToRemoteDocument(L,f),L.isValidDocument()&&(L.setReadTime(f.commitVersion),m.addEntry(L)))})}),C.next(()=>u.mutationQueue.removeMutationBatch(h,g))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=pe();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function ku(n){const e=he(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function y0(n,e){const t=he(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const l=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const u=[];e.targetChanges.forEach((m,g)=>{const E=s.get(g);if(!E)return;u.push(t.li.removeMatchingKeys(o,m.removedDocuments,g).next(()=>t.li.addMatchingKeys(o,m.addedDocuments,g)));let C=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?C=C.withResumeToken(nt.EMPTY_BYTE_STRING,ue.min()).withLastLimboFreeSnapshotVersion(ue.min()):m.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(m.resumeToken,r)),s=s.insert(g,C),function(L,V,O){return L.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=p0?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(E,C,m)&&u.push(t.li.updateTargetData(o,C))});let h=tn(),f=pe();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,m))}),u.push(_0(o,l,e.documentUpdates).next(m=>{h=m.Bs,f=m.Ls})),!r.isEqual(ue.min())){const m=t.li.getLastRemoteSnapshotVersion(o).next(g=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(m)}return D.waitFor(u).next(()=>l.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(t.vs=s,o))}function _0(n,e,t){let r=pe(),s=pe();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let l=tn();return t.forEach((u,h)=>{const f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(ue.min())?(e.removeEntry(u,h.readTime),l=l.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(u,h)):X(Xo,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)}),{Bs:l,Ls:s}})}function w0(n,e){const t=he(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Fo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function v0(n,e){const t=he(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.li.getTargetData(r,e).next(o=>o?(s=o,D.resolve(s)):t.li.allocateTargetId(r).next(l=>(s=new mn(e,l,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r})}async function Io(n,e,t){const r=he(n),s=r.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,l=>r.persistence.referenceDelegate.removeTarget(l,s))}catch(l){if(!Ar(l))throw l;X(Xo,`Failed to update sequence numbers for target ${e}: ${l}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function Nl(n,e,t){const r=he(n);let s=ue.min(),o=pe();return r.persistence.runTransaction("Execute query","readwrite",l=>function(h,f,m){const g=he(h),E=g.Fs.get(m);return E!==void 0?D.resolve(g.vs.get(E)):g.li.getTargetData(f,m)}(r,l,zt(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(l,u.targetId).next(h=>{o=h})}).next(()=>r.Cs.getDocumentsMatchingQuery(l,e,t?s:ue.min(),t?o:pe())).next(u=>(k0(r,lm(e),u),{documents:u,ks:o})))}function k0(n,e,t){let r=n.Ms.get(e)||ue.min();t.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ms.set(e,r)}class Rl{constructor(){this.activeTargetIds=mm()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class E0{constructor(){this.vo=new Rl,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Rl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sl="ConnectivityMonitor";class jl{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){X(Sl,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){X(Sl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ms=null;function Ao(){return Ms===null?Ms=function(){return 268435456+Math.round(2147483648*Math.random())}():Ms++,"0x"+Ms.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xi="RestConnection",I0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class A0{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===ri?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,o){const l=Ao(),u=this.Qo(e,t.toUriEncodedString());X(Xi,`Sending RPC '${e}' ${l}:`,u,r);const h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,s,o);const{host:f}=new URL(u),m=Do(f);return this.zo(e,u,h,r,m).then(g=>(X(Xi,`Received RPC '${e}' ${l}: `,g),g),g=>{throw Bn(Xi,`RPC '${e}' ${l} failed with error: `,g,"url: ",u,"request:",r),g})}jo(e,t,r,s,o,l){return this.Wo(e,t,r,s,o)}Go(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Tr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,o)=>e[o]=s),r&&r.headers.forEach((s,o)=>e[o]=s)}Qo(e,t){const r=I0[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C0{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const st="WebChannelConnection",Br=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(s){setTimeout(()=>{throw s},0)}})};class fr extends A0{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!fr.c_){const e=Cc();Br(e,Ac.STAT_EVENT,t=>{t.stat===po.PROXY?X(st,"STAT_EVENT: detected buffering proxy"):t.stat===po.NOPROXY&&X(st,"STAT_EVENT: detected no buffering proxy")}),fr.c_=!0}}zo(e,t,r,s,o){const l=Ao();return new Promise((u,h)=>{const f=new Tc;f.setWithCredentials(!0),f.listenOnce(Ic.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case qs.NO_ERROR:const g=f.getResponseJson();X(st,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),u(g);break;case qs.TIMEOUT:X(st,`RPC '${e}' ${l} timed out`),h(new H(P.DEADLINE_EXCEEDED,"Request time out"));break;case qs.HTTP_ERROR:const E=f.getStatus();if(X(st,`RPC '${e}' ${l} failed with status:`,E,"response text:",f.getResponseText()),E>0){let C=f.getResponseJson();Array.isArray(C)&&(C=C[0]);const j=C==null?void 0:C.error;if(j&&j.status&&j.message){const L=function(O){const U=O.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN}(j.status);h(new H(L,j.message))}else h(new H(P.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new H(P.UNAVAILABLE,"Connection failed."));break;default:le(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{X(st,`RPC '${e}' ${l} completed.`)}});const m=JSON.stringify(s);X(st,`RPC '${e}' ${l} sending request:`,s),f.send(t,"POST",m,r,15)})}T_(e,t,r){const s=Ao(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=o.join("");X(st,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=l.createWebChannel(f,u);this.I_(m);let g=!1,E=!1;const C=new C0({Ho:j=>{E?X(st,`Not sending because RPC '${e}' stream ${s} is closed:`,j):(g||(X(st,`Opening RPC '${e}' stream ${s} transport.`),m.open(),g=!0),X(st,`RPC '${e}' stream ${s} sending:`,j),m.send(j))},Jo:()=>m.close()});return Br(m,qr.EventType.OPEN,()=>{E||(X(st,`RPC '${e}' stream ${s} transport opened.`),C.i_())}),Br(m,qr.EventType.CLOSE,()=>{E||(E=!0,X(st,`RPC '${e}' stream ${s} transport closed`),C.o_(),this.E_(m))}),Br(m,qr.EventType.ERROR,j=>{E||(E=!0,Bn(st,`RPC '${e}' stream ${s} transport errored. Name:`,j.name,"Message:",j.message),C.o_(new H(P.UNAVAILABLE,"The operation could not be completed")))}),Br(m,qr.EventType.MESSAGE,j=>{var L;if(!E){const V=j.data[0];we(!!V,16349);const O=V,U=(O==null?void 0:O.error)||((L=O[0])==null?void 0:L.error);if(U){X(st,`RPC '${e}' stream ${s} received error:`,U);const G=U.status;let Y=function(v){const b=Ue[v];if(b!==void 0)return cu(b)}(G),W=U.message;G==="NOT_FOUND"&&W.includes("database")&&W.includes("does not exist")&&W.includes(this.databaseId.database)&&Bn(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),Y===void 0&&(Y=P.INTERNAL,W="Unknown error status: "+G+" with message "+U.message),E=!0,C.o_(new H(Y,W)),m.close()}else X(st,`RPC '${e}' stream ${s} received:`,V),C.__(V)}}),fr.u_(),setTimeout(()=>{C.s_()},0),C}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Nc()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N0(n){return new fr(n)}function Zi(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(n){return new Pm(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fr.c_=!1;class Eu{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&X("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pl="PersistentStream";class Tu{constructor(e,t,r,s,o,l,u,h){this.Ci=e,this.b_=r,this.S_=s,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Eu(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(en(t.toString()),en("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new H(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.H_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return X(Pl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(X(Pl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class R0 extends Tu{constructor(e,t,r,s,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,l),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Mm(this.serializer,e),r=function(o){if(!("targetChange"in o))return ue.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?ue.min():l.readTime?Ht(l.readTime):ue.min()}(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=To(this.serializer),t.addTarget=function(o,l){let u;const h=l.target;if(u=_o(h)?{documents:Fm(o,h)}:{query:Bm(o,h).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=hu(o,l.resumeToken);const f=vo(o,l.expectedCount);f!==null&&(u.expectedCount=f)}else if(l.snapshotVersion.compareTo(ue.min())>0){u.readTime=ci(o,l.snapshotVersion.toTimestamp());const f=vo(o,l.expectedCount);f!==null&&(u.expectedCount=f)}return u}(this.serializer,e);const r=Um(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=To(this.serializer),t.removeTarget=e,this.K_(t)}}class S0 extends Tu{constructor(e,t,r,s,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,l),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return we(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,we(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){we(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Om(e.writeResults,e.commitTime),r=Ht(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=To(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Lm(this.serializer,r))};this.K_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0{}class P0 extends j0{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new H(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Wo(e,ko(t,r),s,o,l)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new H(P.UNKNOWN,o.toString())})}jo(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,u])=>this.connection.jo(e,ko(t,r),s,l,u,o)).catch(l=>{throw l.name==="FirebaseError"?(l.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new H(P.UNKNOWN,l.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function V0(n,e,t,r){return new P0(n,e,t,r)}class D0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(en(t),this.aa=!1):X("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $n="RemoteStore";class M0{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo(l=>{r.enqueueAndForget(async()=>{Gn(this)&&(X($n,"Restarting streams for network reachability change."),await async function(h){const f=he(h);f.Ea.add(4),await hs(f),f.Va.set("Unknown"),f.Ea.delete(4),await Ai(f)}(this))})}),this.Va=new D0(r,s)}}async function Ai(n){if(Gn(n))for(const e of n.Ra)await e(!0)}async function hs(n){for(const e of n.Ra)await e(!1)}function Iu(n,e){const t=he(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),na(t)?ta(t):Cr(t).O_()&&ea(t,e))}function Zo(n,e){const t=he(n),r=Cr(t);t.Ia.delete(e),r.O_()&&Au(t,e),t.Ia.size===0&&(r.O_()?r.L_():Gn(t)&&t.Va.set("Unknown"))}function ea(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ue.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Cr(n).Z_(e)}function Au(n,e){n.da.$e(e),Cr(n).X_(e)}function ta(n){n.da=new Nm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Cr(n).start(),n.Va.ua()}function na(n){return Gn(n)&&!Cr(n).x_()&&n.Ia.size>0}function Gn(n){return he(n).Ea.size===0}function Cu(n){n.da=void 0}async function L0(n){n.Va.set("Online")}async function O0(n){n.Ia.forEach((e,t)=>{ea(n,e)})}async function F0(n,e){Cu(n),na(n)?(n.Va.ha(e),ta(n)):n.Va.set("Unknown")}async function B0(n,e,t){if(n.Va.set("Online"),e instanceof du&&e.state===2&&e.cause)try{await async function(s,o){const l=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,l),s.Ia.delete(u),s.da.removeTarget(u))}(n,e)}catch(r){X($n,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await di(n,r)}else if(e instanceof Gs?n.da.Xe(e):e instanceof uu?n.da.st(e):n.da.tt(e),!t.isEqual(ue.min()))try{const r=await ku(n.localStore);t.compareTo(r)>=0&&await function(o,l){const u=o.da.Tt(l);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=o.Ia.get(f);m&&o.Ia.set(f,m.withResumeToken(h.resumeToken,l))}}),u.targetMismatches.forEach((h,f)=>{const m=o.Ia.get(h);if(!m)return;o.Ia.set(h,m.withResumeToken(nt.EMPTY_BYTE_STRING,m.snapshotVersion)),Au(o,h);const g=new mn(m.target,h,f,m.sequenceNumber);ea(o,g)}),o.remoteSyncer.applyRemoteEvent(u)}(n,t)}catch(r){X($n,"Failed to raise snapshot:",r),await di(n,r)}}async function di(n,e,t){if(!Ar(e))throw e;n.Ea.add(1),await hs(n),n.Va.set("Offline"),t||(t=()=>ku(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{X($n,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ai(n)})}function Nu(n,e){return e().catch(t=>di(n,t,e))}async function Ci(n){const e=he(n),t=Tn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Fo;for(;$0(e);)try{const s=await w0(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,U0(e,s)}catch(s){await di(e,s)}Ru(e)&&Su(e)}function $0(n){return Gn(n)&&n.Ta.length<10}function U0(n,e){n.Ta.push(e);const t=Tn(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Ru(n){return Gn(n)&&!Tn(n).x_()&&n.Ta.length>0}function Su(n){Tn(n).start()}async function q0(n){Tn(n).ra()}async function z0(n){const e=Tn(n);for(const t of n.Ta)e.ea(t.mutations)}async function W0(n,e,t){const r=n.Ta.shift(),s=Ho.from(r,e,t);await Nu(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ci(n)}async function H0(n,e){e&&Tn(n).Y_&&await async function(r,s){if(function(l){return Im(l)&&l!==P.ABORTED}(s.code)){const o=r.Ta.shift();Tn(r).B_(),await Nu(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),await Ci(r)}}(n,e),Ru(n)&&Su(n)}async function Vl(n,e){const t=he(n);t.asyncQueue.verifyOperationInProgress(),X($n,"RemoteStore received new credentials");const r=Gn(t);t.Ea.add(3),await hs(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ai(t)}async function G0(n,e){const t=he(n);e?(t.Ea.delete(2),await Ai(t)):e||(t.Ea.add(2),await hs(t),t.Va.set("Unknown"))}function Cr(n){return n.ma||(n.ma=function(t,r,s){const o=he(t);return o.sa(),new R0(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:L0.bind(null,n),Yo:O0.bind(null,n),t_:F0.bind(null,n),J_:B0.bind(null,n)}),n.Ra.push(async e=>{e?(n.ma.B_(),na(n)?ta(n):n.Va.set("Unknown")):(await n.ma.stop(),Cu(n))})),n.ma}function Tn(n){return n.fa||(n.fa=function(t,r,s){const o=he(t);return o.sa(),new S0(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:q0.bind(null,n),t_:H0.bind(null,n),ta:z0.bind(null,n),na:W0.bind(null,n)}),n.Ra.push(async e=>{e?(n.fa.B_(),await Ci(n)):(await n.fa.stop(),n.Ta.length>0&&(X($n,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ra{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new bn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(l=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const l=Date.now()+r,u=new ra(e,t,l,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new H(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sa(n,e){if(en("AsyncQueue",`${e}: ${n}`),Ar(n))return new H(P.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{static emptySet(e){return new mr(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||re.comparator(t.key,r.key):(t,r)=>re.comparator(t.key,r.key),this.keyedMap=zr(),this.sortedSet=new Oe(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof mr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new mr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(){this.ga=new Oe(re.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):le(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class kr{constructor(e,t,r,s,o,l,u,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,s,o){const l=[];return t.forEach(u=>{l.push({type:0,doc:u})}),new kr(e,t,mr.emptySet(t),l,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class Q0{constructor(){this.queries=Ml(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=he(t),o=s.queries;s.queries=Ml(),o.forEach((l,u)=>{for(const h of u.ba)h.onError(r)})})(this,new H(P.ABORTED,"Firestore shutting down"))}}function Ml(){return new Wn(n=>Jc(n),wi)}async function Y0(n,e){const t=he(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.Sa()&&e.Da()&&(r=2):(o=new K0,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(l){const u=sa(l,`Initialization of query '${ar(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&ia(t)}async function J0(n,e){const t=he(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const l=o.ba.indexOf(e);l>=0&&(o.ba.splice(l,1),o.ba.length===0?s=e.Da()?0:1:!o.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function X0(n,e){const t=he(n);let r=!1;for(const s of e){const o=s.query,l=t.queries.get(o);if(l){for(const u of l.ba)u.Fa(s)&&(r=!0);l.wa=s}}r&&ia(t)}function Z0(n,e,t){const r=he(n),s=r.queries.get(e);if(s)for(const o of s.ba)o.onError(t);r.queries.delete(e)}function ia(n){n.Ca.forEach(e=>{e.next()})}var Co,Ll;(Ll=Co||(Co={})).Ma="default",Ll.Cache="cache";class ep{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new kr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=kr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Co.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ju{constructor(e){this.key=e}}class Pu{constructor(e){this.key=e}}class tp{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=pe(),this.mutatedKeys=pe(),this.eu=Xc(e),this.tu=new mr(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new Dl,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,l=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((m,g)=>{const E=s.get(m),C=vi(this.query,g)?g:null,j=!!E&&this.mutatedKeys.has(E.key),L=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let V=!1;E&&C?E.data.isEqual(C.data)?j!==L&&(r.track({type:3,doc:C}),V=!0):this.su(E,C)||(r.track({type:2,doc:C}),V=!0,(h&&this.eu(C,h)>0||f&&this.eu(C,f)<0)&&(u=!0)):!E&&C?(r.track({type:0,doc:C}),V=!0):E&&!C&&(r.track({type:1,doc:E}),V=!0,(h||f)&&(u=!0)),V&&(C?(l=l.add(C),o=L?o.add(m):o.delete(m)):(l=l.delete(m),o=o.delete(m)))}),this.query.limit!==null)for(;l.size>this.query.limit;){const m=this.query.limitType==="F"?l.last():l.first();l=l.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{tu:l,iu:r,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort((m,g)=>function(C,j){const L=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return le(20277,{Vt:V})}};return L(C)-L(j)}(m.type,g.type)||this.eu(m.doc,g.doc)),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Ya.size===0&&this.current&&!s?1:0,f=h!==this.Xa;return this.Xa=h,l.length!==0||f?{snapshot:new kr(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Dl,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=pe(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});const t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new Pu(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new ju(r))}),t}cu(e){this.Za=e.ks,this.Ya=pe();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return kr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const oa="SyncEngine";class np{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class rp{constructor(e){this.key=e,this.hu=!1}}class sp{constructor(e,t,r,s,o,l){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Wn(u=>Jc(u),wi),this.Iu=new Map,this.Eu=new Set,this.Ru=new Oe(re.comparator),this.Au=new Map,this.Vu=new Qo,this.du={},this.mu=new Map,this.fu=vr.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function ip(n,e,t=!0){const r=Fu(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Vu(r,e,t,!0),s}async function op(n,e){const t=Fu(n);await Vu(t,e,!0,!1)}async function Vu(n,e,t,r){const s=await v0(n.localStore,zt(e)),o=s.targetId,l=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await ap(n,e,o,l==="current",s.resumeToken)),n.isPrimaryClient&&t&&Iu(n.remoteStore,s),u}async function ap(n,e,t,r,s){n.pu=(g,E,C)=>async function(L,V,O,U){let G=V.view.ru(O);G.Ss&&(G=await Nl(L.localStore,V.query,!1).then(({documents:v})=>V.view.ru(v,G)));const Y=U&&U.targetChanges.get(V.targetId),W=U&&U.targetMismatches.get(V.targetId)!=null,ee=V.view.applyChanges(G,L.isPrimaryClient,Y,W);return Fl(L,V.targetId,ee.au),ee.snapshot}(n,g,E,C);const o=await Nl(n.localStore,e,!0),l=new tp(e,o.ks),u=l.ru(o.documents),h=ds.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),f=l.applyChanges(u,n.isPrimaryClient,h);Fl(n,t,f.au);const m=new np(e,t,l);return n.Tu.set(e,m),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),f.snapshot}async function lp(n,e,t){const r=he(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter(l=>!wi(l,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Io(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Zo(r.remoteStore,s.targetId),No(r,s.targetId)}).catch(Ir)):(No(r,s.targetId),await Io(r.localStore,s.targetId,!0))}async function cp(n,e){const t=he(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Zo(t.remoteStore,r.targetId))}async function up(n,e,t){const r=xp(n);try{const s=await function(l,u){const h=he(l),f=Me.now(),m=u.reduce((C,j)=>C.add(j.key),pe());let g,E;return h.persistence.runTransaction("Locally write mutations","readwrite",C=>{let j=tn(),L=pe();return h.xs.getEntries(C,m).next(V=>{j=V,j.forEach((O,U)=>{U.isValidDocument()||(L=L.add(O))})}).next(()=>h.localDocuments.getOverlayedDocuments(C,j)).next(V=>{g=V;const O=[];for(const U of u){const G=wm(U,g.get(U.key).overlayedDocument);G!=null&&O.push(new Hn(U.key,G,qc(G.value.mapValue),Wt.exists(!0)))}return h.mutationQueue.addMutationBatch(C,f,O,u)}).next(V=>{E=V;const O=V.applyToLocalDocumentSet(g,L);return h.documentOverlayCache.saveOverlays(C,V.batchId,O)})}).then(()=>({batchId:E.batchId,changes:eu(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(l,u,h){let f=l.du[l.currentUser.toKey()];f||(f=new Oe(me)),f=f.insert(u,h),l.du[l.currentUser.toKey()]=f}(r,s.batchId,t),await fs(r,s.changes),await Ci(r.remoteStore)}catch(s){const o=sa(s,"Failed to persist write");t.reject(o)}}async function Du(n,e){const t=he(n);try{const r=await y0(t.localStore,e);e.targetChanges.forEach((s,o)=>{const l=t.Au.get(o);l&&(we(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?l.hu=!0:s.modifiedDocuments.size>0?we(l.hu,14607):s.removedDocuments.size>0&&(we(l.hu,42227),l.hu=!1))}),await fs(t,r,e)}catch(r){await Ir(r)}}function Ol(n,e,t){const r=he(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((o,l)=>{const u=l.view.va(e);u.snapshot&&s.push(u.snapshot)}),function(l,u){const h=he(l);h.onlineState=u;let f=!1;h.queries.forEach((m,g)=>{for(const E of g.ba)E.va(u)&&(f=!0)}),f&&ia(h)}(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function dp(n,e,t){const r=he(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let l=new Oe(re.comparator);l=l.insert(o,ot.newNoDocument(o,ue.min()));const u=pe().add(o),h=new Ti(ue.min(),new Map,new Oe(me),l,u);await Du(r,h),r.Ru=r.Ru.remove(o),r.Au.delete(e),aa(r)}else await Io(r.localStore,e,!1).then(()=>No(r,e,t)).catch(Ir)}async function hp(n,e){const t=he(n),r=e.batch.batchId;try{const s=await b0(t.localStore,e);Lu(t,r,null),Mu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await fs(t,s)}catch(s){await Ir(s)}}async function fp(n,e,t){const r=he(n);try{const s=await function(l,u){const h=he(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,u).next(g=>(we(g!==null,37113),m=g.keys(),h.mutationQueue.removeMutationBatch(f,g))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(r.localStore,e);Lu(r,e,t),Mu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await fs(r,s)}catch(s){await Ir(s)}}function Mu(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Lu(n,e,t){const r=he(n);let s=r.du[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function No(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(r=>{n.Vu.containsKey(r)||Ou(n,r)})}function Ou(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Zo(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),aa(n))}function Fl(n,e,t){for(const r of t)r instanceof ju?(n.Vu.addReference(r.key,e),mp(n,r)):r instanceof Pu?(X(oa,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Ou(n,r.key)):le(19791,{wu:r})}function mp(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(X(oa,"New document in limbo: "+t),n.Eu.add(r),aa(n))}function aa(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new re(Ne.fromString(e)),r=n.fu.next();n.Au.set(r,new rp(t)),n.Ru=n.Ru.insert(t,r),Iu(n.remoteStore,new mn(zt(Yc(t.path)),r,"TargetPurposeLimboResolution",xi.ce))}}async function fs(n,e,t){const r=he(n),s=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach((u,h)=>{l.push(r.pu(h,e,t).then(f=>{var m;if((f||t)&&r.isPrimaryClient){const g=f?!f.fromCache:(m=t==null?void 0:t.targetChanges.get(h.targetId))==null?void 0:m.current;r.sharedClientState.updateQueryState(h.targetId,g?"current":"not-current")}if(f){s.push(f);const g=Jo.Es(h.targetId,f);o.push(g)}}))}),await Promise.all(l),r.Pu.J_(s),await async function(h,f){const m=he(h);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>D.forEach(f,E=>D.forEach(E.Ts,C=>m.persistence.referenceDelegate.addReference(g,E.targetId,C)).next(()=>D.forEach(E.Is,C=>m.persistence.referenceDelegate.removeReference(g,E.targetId,C)))))}catch(g){if(!Ar(g))throw g;X(Xo,"Failed to update sequence numbers: "+g)}for(const g of f){const E=g.targetId;if(!g.fromCache){const C=m.vs.get(E),j=C.snapshotVersion,L=C.withLastLimboFreeSnapshotVersion(j);m.vs=m.vs.insert(E,L)}}}(r.localStore,o))}async function pp(n,e){const t=he(n);if(!t.currentUser.isEqual(e)){X(oa,"User change. New user:",e.toKey());const r=await vu(t.localStore,e);t.currentUser=e,function(o,l){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new H(P.CANCELLED,l))})}),o.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await fs(t,r.Ns)}}function gp(n,e){const t=he(n),r=t.Au.get(e);if(r&&r.hu)return pe().add(r.key);{let s=pe();const o=t.Iu.get(e);if(!o)return s;for(const l of o){const u=t.Tu.get(l);s=s.unionWith(u.view.nu)}return s}}function Fu(n){const e=he(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Du.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dp.bind(null,e),e.Pu.J_=X0.bind(null,e.eventManager),e.Pu.yu=Z0.bind(null,e.eventManager),e}function xp(n){const e=he(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=hp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=fp.bind(null,e),e}class hi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ii(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return x0(this.persistence,new m0,e.initialUser,this.serializer)}Cu(e){return new wu(Yo.Vi,this.serializer)}Du(e){return new E0}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hi.provider={build:()=>new hi};class bp extends hi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){we(this.persistence.referenceDelegate instanceof ui,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Zm(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?mt.withCacheSize(this.cacheSizeBytes):mt.DEFAULT;return new wu(r=>ui.Vi(r,t),this.serializer)}}class Ro{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ol(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=pp.bind(null,this.syncEngine),await G0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Q0}()}createDatastore(e){const t=Ii(e.databaseInfo.databaseId),r=N0(e.databaseInfo);return V0(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,o,l,u){return new M0(r,s,o,l,u)}(this.localStore,this.datastore,e.asyncQueue,t=>Ol(this.syncEngine,t,0),function(){return jl.v()?new jl:new T0}())}createSyncEngine(e,t){return function(s,o,l,u,h,f,m){const g=new sp(s,o,l,u,h,f);return m&&(g.gu=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const o=he(s);X($n,"RemoteStore shutting down."),o.Ea.add(5),await hs(o),o.Aa.shutdown(),o.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Ro.provider={build:()=>new Ro};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):en("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const In="FirestoreClient";class _p{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=it.UNAUTHENTICATED,this.clientId=Oo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async l=>{X(In,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l}),this.appCheckCredentials.start(r,l=>(X(In,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new bn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=sa(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function eo(n,e){n.asyncQueue.verifyOperationInProgress(),X(In,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await vu(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Bl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await wp(n);X(In,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Vl(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Vl(e.remoteStore,s)),n._onlineComponents=e}async function wp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){X(In,"Using user provided OfflineComponentProvider");try{await eo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Bn("Error using user provided cache. Falling back to memory cache: "+t),await eo(n,new hi)}}else X(In,"Using default OfflineComponentProvider"),await eo(n,new bp(void 0));return n._offlineComponents}async function Bu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(X(In,"Using user provided OnlineComponentProvider"),await Bl(n,n._uninitializedComponentsProvider._online)):(X(In,"Using default OnlineComponentProvider"),await Bl(n,new Ro))),n._onlineComponents}function vp(n){return Bu(n).then(e=>e.syncEngine)}async function kp(n){const e=await Bu(n),t=e.eventManager;return t.onListen=ip.bind(null,e.syncEngine),t.onUnlisten=lp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=op.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=cp.bind(null,e.syncEngine),t}function Ep(n,e,t={}){const r=new bn;return n.asyncQueue.enqueueAndForget(async()=>function(o,l,u,h,f){const m=new yp({next:E=>{m.Nu(),l.enqueueAndForget(()=>J0(o,g)),E.fromCache&&h.source==="server"?f.reject(new H(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(E)},error:E=>f.reject(E)}),g=new ep(u,m,{includeMetadataChanges:!0,Ka:!0});return Y0(o,g)}(await kp(n),n.asyncQueue,e,t,r)),r.promise}function Tp(n,e){const t=new bn;return n.asyncQueue.enqueueAndForget(async()=>up(await vp(n),e,t)),t.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $u(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip="ComponentProvider",$l=new Map;function Ap(n,e,t,r,s){return new Uf(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,$u(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uu="firestore.googleapis.com",Ul=!0;class ql{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new H(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Uu,this.ssl=Ul}else this.host=e.host,this.ssl=e.ssl??Ul;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=_u;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Jm)throw new H(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Rf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$u(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new H(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new H(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new H(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ni{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ql({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new H(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new H(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ql(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new _f;switch(r.type){case"firstParty":return new Ef(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new H(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=$l.get(t);r&&(X(Ip,"Removing Datastore"),$l.delete(t),r.terminate())}(this),Promise.resolve()}}function Cp(n,e,t,r={}){var f;n=br(n,Ni);const s=Do(e),o=n._getSettings(),l={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(Gd(`https://${u}`),Jd("Firestore",!0)),o.host!==Uu&&o.host!==u&&Bn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Zs(h,l)&&(n._setSettings(h),r.mockUserToken)){let m,g;if(typeof r.mockUserToken=="string")m=r.mockUserToken,g=it.MOCK_USER;else{m=Kd(r.mockUserToken,(f=n._app)==null?void 0:f.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new H(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new it(E)}n._authCredentials=new wf(new Sc(m,g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new nn(this.firestore,e,this._query)}}class Ke{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ke(this.firestore,e,this._key)}toJSON(){return{type:Ke._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(cs(t,Ke._jsonSchema))return new Ke(e,r||null,new re(Ne.fromString(t.referencePath)))}}Ke._jsonSchemaVersion="firestore/documentReference/1.0",Ke._jsonSchema={type:ze("string",Ke._jsonSchemaVersion),referencePath:ze("string")};class yn extends nn{constructor(e,t,r){super(e,t,Yc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ke(this.firestore,null,new re(e))}withConverter(e){return new yn(this.firestore,e,this._path)}}function Np(n,e,...t){if(n=On(n),jc("collection","path",e),n instanceof Ni){const r=Ne.fromString(e,...t);return rl(r),new yn(n,null,r)}{if(!(n instanceof Ke||n instanceof yn))throw new H(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ne.fromString(e,...t));return rl(r),new yn(n.firestore,null,r)}}function qu(n,e,...t){if(n=On(n),arguments.length===1&&(e=Oo.newId()),jc("doc","path",e),n instanceof Ni){const r=Ne.fromString(e,...t);return nl(r),new Ke(n,null,new re(r))}{if(!(n instanceof Ke||n instanceof yn))throw new H(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ne.fromString(e,...t));return nl(r),new Ke(n.firestore,n instanceof yn?n.converter:null,new re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zl="AsyncQueue";class Wl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Eu(this,"async_queue_retry"),this._c=()=>{const r=Zi();r&&X(zl,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Zi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Zi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new bn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Ar(e))throw e;X(zl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,en("INTERNAL UNHANDLED ERROR: ",Hl(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=ra.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(s),s}uc(){this.nc&&le(47125,{Pc:Hl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Hl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Ri extends Ni{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Wl,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Wl(e),this._firestoreClient=void 0,await e}}}function Rp(n,e){const t=typeof n=="object"?n:lf(),r=typeof n=="string"?n:ri,s=nf(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Wd("firestore");o&&Cp(s,...o)}return s}function zu(n){if(n._terminated)throw new H(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Sp(n),n._firestoreClient}function Sp(n){var r,s,o,l;const e=n._freezeSettings(),t=Ap(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,(s=n._app)==null?void 0:s.options.apiKey,e);n._componentsProvider||(o=e.localCache)!=null&&o._offlineComponentProvider&&((l=e.localCache)!=null&&l._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new _p(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(h){const f=h==null?void 0:h._online.build();return{_offline:h==null?void 0:h._offline.build(f),_online:f}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Tt(nt.fromBase64String(e))}catch(t){throw new H(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Tt(nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Tt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cs(e,Tt._jsonSchema))return Tt.fromBase64String(e.bytes)}}Tt._jsonSchemaVersion="firestore/bytes/1.0",Tt._jsonSchema={type:ze("string",Tt._jsonSchemaVersion),bytes:ze("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new H(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new H(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new H(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return me(this._lat,e._lat)||me(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Gt._jsonSchemaVersion}}static fromJSON(e){if(cs(e,Gt._jsonSchema))return new Gt(e.latitude,e.longitude)}}Gt._jsonSchemaVersion="firestore/geoPoint/1.0",Gt._jsonSchema={type:ze("string",Gt._jsonSchemaVersion),latitude:ze("number"),longitude:ze("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Dt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cs(e,Dt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Dt(e.vectorValues);throw new H(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Dt._jsonSchemaVersion="firestore/vectorValue/1.0",Dt._jsonSchema={type:ze("string",Dt._jsonSchemaVersion),vectorValues:ze("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jp=/^__.*__$/;class Pp{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Hn(e,this.data,this.fieldMask,t,this.fieldTransforms):new us(e,this.data,t,this.fieldTransforms)}}function Gu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw le(40011,{dataSource:n})}}class la{constructor(e,t,r,s,o,l){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new la({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return fi(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Gu(this.dataSource)&&jp.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Vp{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ii(e)}createContext(e,t,r,s=!1){return new la({dataSource:e,methodName:t,targetDoc:r,path:tt.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ca(n){const e=n._freezeSettings(),t=Ii(n._databaseId);return new Vp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Dp(n,e,t,r,s,o={}){const l=n.createContext(o.merge||o.mergeFields?2:0,e,t,s);Ju("Data must be an object, but it was:",l,r);const u=Qu(r,l);let h,f;if(o.merge)h=new Vt(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const m=[];for(const g of o.mergeFields){const E=Si(e,g,t);if(!l.contains(E))throw new H(P.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Op(m,E)||m.push(E)}h=new Vt(m),f=l.fieldTransforms.filter(g=>h.covers(g.field))}else h=null,f=l.fieldTransforms;return new Pp(new Et(u),h,f)}function Ku(n,e,t,r=!1){return ua(t,n.createContext(r?4:3,e))}function ua(n,e){if(Yu(n=On(n)))return Ju("Unsupported field value:",e,n),Qu(n,e);if(n instanceof Hu)return function(r,s){if(!Gu(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(r,s){const o=[];let l=0;for(const u of r){let h=ua(u,s.childContextForArray(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}}(n,e)}return function(r,s){if((r=On(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return pm(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Me.fromDate(r);return{timestampValue:ci(s.serializer,o)}}if(r instanceof Me){const o=new Me(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ci(s.serializer,o)}}if(r instanceof Gt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Tt)return{bytesValue:hu(s.serializer,r._byteString)};if(r instanceof Ke){const o=s.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw s.createError(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ko(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Dt)return function(l,u){const h=l instanceof Dt?l.toArray():l;return{mapValue:{fields:{[$c]:{stringValue:Uc},[si]:{arrayValue:{values:h.map(m=>{if(typeof m!="number")throw u.createError("VectorValues must only contain numeric values.");return zo(u.serializer,m)})}}}}}}(r,s);if(yu(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${gi(r)}`)}(n,e)}function Qu(n,e){const t={};return Dc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qn(n,(r,s)=>{const o=ua(s,e.childContextForField(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Yu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Me||n instanceof Gt||n instanceof Tt||n instanceof Ke||n instanceof Hu||n instanceof Dt||yu(n))}function Ju(n,e,t){if(!Yu(t)||!Pc(t)){const r=gi(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Si(n,e,t){if((e=On(e))instanceof Wu)return e._internalPath;if(typeof e=="string")return Lp(n,e);throw fi("Field path arguments must be of type string or ",n,!1,void 0,t)}const Mp=new RegExp("[~\\*/\\[\\]]");function Lp(n,e,t){if(e.search(Mp)>=0)throw fi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Wu(...e.split("."))._internalPath}catch{throw fi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function fi(n,e,t,r,s){const o=r&&!r.isEmpty(),l=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${s}`),h+=")"),new H(P.INVALID_ARGUMENT,u+n+h)}function Op(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{convertValue(e,t="none"){switch(En(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw le(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return qn(e,(s,o)=>{r[s]=this.convertValue(o,t)}),r}convertVectorValue(e){var r,s,o;const t=(o=(s=(r=e.fields)==null?void 0:r[si].arrayValue)==null?void 0:s.values)==null?void 0:o.map(l=>$e(l.doubleValue));return new Dt(t)}convertGeoPoint(e){return new Gt($e(e.latitude),$e(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=_i(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ns(e));default:return null}}convertTimestamp(e){const t=vn(e);return new Me(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ne.fromString(e);we(bu(r),9688,{name:e});const s=new rs(r.get(1),r.get(3)),o=new re(r.popFirst(5));return s.isEqual(t)||en(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp extends Fp{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ke(this.firestore,null,t)}}const Gl="@firebase/firestore",Kl="4.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ke(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new $p(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const t=this._document.data.field(Si("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class $p extends da{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Up(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new H(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ha{}class ji extends ha{}function Ql(n,e,...t){let r=[];e instanceof ha&&r.push(e),r=r.concat(t),function(o){const l=o.filter(h=>h instanceof ma).length,u=o.filter(h=>h instanceof fa).length;if(l>1||l>0&&u>0)throw new H(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class fa extends ji{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new fa(e,t,r)}_apply(e){const t=this._parse(e);return Xu(e._query,t),new nn(e.firestore,e.converter,wo(e._query,t))}_parse(e){const t=ca(e.firestore);return function(o,l,u,h,f,m,g){let E;if(f.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new H(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Zl(g,m);const j=[];for(const L of g)j.push(Xl(h,o,L));E={arrayValue:{values:j}}}else E=Xl(h,o,g)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Zl(g,m),E=Ku(u,l,g,m==="in"||m==="not-in");return qe.create(f,m,E)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class ma extends ha{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ma(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Mt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,o){let l=s;const u=o.getFlattenedFilters();for(const h of u)Xu(l,h),l=wo(l,h)}(e._query,t),new nn(e.firestore,e.converter,wo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class pa extends ji{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new pa(e,t)}_apply(e){const t=function(s,o,l){if(s.startAt!==null)throw new H(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new H(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new is(o,l)}(e._query,this._field,this._direction);return new nn(e.firestore,e.converter,om(e._query,t))}}function Yl(n,e="asc"){const t=e,r=Si("orderBy",n);return pa._create(r,t)}class ga extends ji{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new ga(e,t,r)}_apply(e){return new nn(e.firestore,e.converter,oi(e._query,this._limit,this._limitType))}}function Jl(n){return Sf("limit",n),ga._create("limit",n,"F")}class xa extends ji{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new xa(e,t,r)}_apply(e){const t=zp(e,this.type,this._docOrFields,this._inclusive);return new nn(e.firestore,e.converter,am(e._query,t))}}function qp(...n){return xa._create("startAfter",n,!1)}function zp(n,e,t,r){if(t[0]=On(t[0]),t[0]instanceof da)return function(o,l,u,h,f){if(!h)throw new H(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const g of hr(o))if(g.field.isKeyField())m.push(ii(l,h.key));else{const E=h.data.field(g.field);if(yi(E))throw new H(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(E===null){const C=g.field.canonicalString();throw new H(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${C}' (used as the orderBy) does not exist.`)}m.push(E)}return new wr(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=ca(n.firestore);return function(l,u,h,f,m,g){const E=l.explicitOrderBy;if(m.length>E.length)throw new H(P.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const C=[];for(let j=0;j<m.length;j++){const L=m[j];if(E[j].field.isKeyField()){if(typeof L!="string")throw new H(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof L}`);if(!qo(l)&&L.indexOf("/")!==-1)throw new H(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${L}' contains a slash.`);const V=l.path.child(Ne.fromString(L));if(!re.isDocumentKey(V))throw new H(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const O=new re(V);C.push(ii(u,O))}else{const V=Ku(h,f,L);C.push(V)}}return new wr(C,g)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Xl(n,e,t){if(typeof(t=On(t))=="string"){if(t==="")throw new H(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!qo(e)&&t.indexOf("/")!==-1)throw new H(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ne.fromString(t));if(!re.isDocumentKey(r))throw new H(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ii(n,new re(r))}if(t instanceof Ke)return ii(n,t._key);throw new H(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gi(t)}.`)}function Zl(n,e){if(!Array.isArray(n)||n.length===0)throw new H(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Xu(n,e){const t=function(s,o){for(const l of s)for(const u of l.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new H(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new H(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Wp(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class Ls{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pr extends da{constructor(e,t,r,s,o,l){super(e,t,r,s,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ks(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Si("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new H(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=pr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}pr._jsonSchemaVersion="firestore/documentSnapshot/1.0",pr._jsonSchema={type:ze("string",pr._jsonSchemaVersion),bundleSource:ze("string","DocumentSnapshot"),bundleName:ze("string"),bundle:ze("string")};class Ks extends pr{data(e={}){return super.data(e)}}class gr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ls(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ks(this._firestore,this._userDataWriter,r.key,r,new Ls(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new H(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let l=0;return s._snapshot.docChanges.map(u=>{const h=new Ks(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ls(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}})}{let l=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{const h=new Ks(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ls(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,m=-1;return u.type!==0&&(f=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),m=l.indexOf(u.doc.key)),{type:Hp(u.type),doc:h,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new H(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=gr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Oo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Hp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return le(61501,{type:n})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gr._jsonSchemaVersion="firestore/querySnapshot/1.0",gr._jsonSchema={type:ze("string",gr._jsonSchemaVersion),bundleSource:ze("string","QuerySnapshot"),bundleName:ze("string"),bundle:ze("string")};function Zu(n){n=br(n,nn);const e=br(n.firestore,Ri),t=zu(e),r=new Bp(e);return Up(n._query),Ep(t,n._query).then(s=>new gr(e,r,n,s))}function Gp(n,e,t){n=br(n,Ke);const r=br(n.firestore,Ri),s=Wp(n.converter,e),o=ca(r);return ed(r,[Dp(o,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Wt.none())])}function Kp(n){return ed(br(n.firestore,Ri),[new Wo(n._key,Wt.none())])}function ed(n,e){const t=zu(n);return Tp(t,e)}(function(e,t=!0){yf(af),ti(new Zr("firestore",(r,{instanceIdentifier:s,options:o})=>{const l=r.getProvider("app").getImmediate(),u=new Ri(new vf(r.getProvider("auth-internal")),new Tf(l,r.getProvider("app-check-internal")),qf(l,s),l);return o={useFetchStreams:t,...o},u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),dr(Gl,Kl,e),dr(Gl,Kl,"esm2020")})();var Qp="firebase",Yp="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */dr(Qp,Yp,"app");const Jp={apiKey:"AIzaSyCXA8pqsLUjVKXr1ltz5gN7VaD-saqlF-g",authDomain:"box-elite.firebaseapp.com",projectId:"box-elite",storageBucket:"box-elite.firebasestorage.app",messagingSenderId:"133574833722",appId:"1:133574833722:web:310d172ecb6dc3a5bae703"},Xp=wc(Jp),ba=Rp(Xp);function td(n){return Np(ba,"branches",n,"closedRows")}function Zp(n){return{id:n.id,employeeName:n.employeeName,cash:n.cash,sentToTreasury:n.sentToTreasury??0,expenseCompensation:n.expenseCompensation??0,expenses:n.expenses??0,carriedExpenseCount:n.carriedExpenseCount??0,expenseItems:n.expenseItems??[],mada:n.mada??0,visa:n.visa??0,mastercard:n.mastercard??0,amex:n.amex??0,bankTransfer:n.bankTransfer??0,programBalanceCash:n.programBalanceCash??0,programBalanceBank:n.programBalanceBank??0,variance:n.variance??0,status:"closed",notes:n.notes??"",closedAt:n.closedAt,createdAt:n.createdAt}}function nd(n){const e=Array.isArray(n.expenseItems)?n.expenseItems.filter(t=>typeof t.amount=="number"&&typeof t.description=="string"):[];return{id:String(n.id??""),employeeName:String(n.employeeName??""),cash:Number(n.cash??0),sentToTreasury:Number(n.sentToTreasury??0),expenseCompensation:Number(n.expenseCompensation??0),expenses:Number(n.expenses??0),carriedExpenseCount:Number(n.carriedExpenseCount??0),expenseItems:e,mada:Number(n.mada??0),visa:Number(n.visa??0),mastercard:Number(n.mastercard??0),amex:Number(n.amex??0),bankTransfer:Number(n.bankTransfer??0),programBalanceCash:Number(n.programBalanceCash??0),programBalanceBank:Number(n.programBalanceBank??0),variance:Number(n.variance??0),status:"closed",notes:String(n.notes??""),closedAt:n.closedAt?String(n.closedAt):null,createdAt:String(n.createdAt??"")}}async function rd(n,e){const t=qu(ba,"branches",n,"closedRows",e.id),r=Zp({...e,closedAt:e.closedAt??new Date().toISOString()});await Gp(t,r)}async function sd(n,e=500){const t=td(n);return(await Zu(t)).docs.map(o=>nd(o.data())).sort((o,l)=>new Date((l.closedAt??"").toString()).getTime()-new Date((o.closedAt??"").toString()).getTime()).slice(0,e)}async function Qs(n,e,t){const r=td(n),s=t?Ql(r,Yl("closedAt","desc"),Jl(e+1),qp(t)):Ql(r,Yl("closedAt","desc"),Jl(e+1)),l=(await Zu(s)).docs,u=l.length>e,h=u?l.slice(0,e):l,f=h.map(g=>nd(g.data())),m=h.length>0?h[h.length-1]:null;return{rows:f,lastDoc:m,hasMore:u}}async function id(n,e){await Kp(qu(ba,"branches",n,"closedRows",e))}const eg=Object.freeze(Object.defineProperty({__proto__:null,addClosedRowToFirebase:rd,deleteClosedRowFromFirebase:id,getClosedRowsFromFirebase:sd,getClosedRowsPaginated:Qs},Symbol.toStringTag,{value:"Module"}));function od(n){return`cashbox_rows_${n}`}function tg(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function ng(n){const e=n,t=Array.isArray(e.expenseItems)?e.expenseItems.filter(r=>typeof r.amount=="number"&&typeof r.description=="string"):[];return{...n,sentToTreasury:typeof e.sentToTreasury=="number"?e.sentToTreasury:0,expenseCompensation:typeof e.expenseCompensation=="number"?e.expenseCompensation:0,expenses:typeof n.expenses=="number"?n.expenses:0,carriedExpenseCount:typeof e.carriedExpenseCount=="number"&&e.carriedExpenseCount>=0?e.carriedExpenseCount:0,expenseItems:t,mastercard:typeof n.mastercard=="number"?n.mastercard:0,amex:typeof n.amex=="number"?n.amex:0,bankTransfer:typeof n.bankTransfer=="number"?n.bankTransfer:0,programBalanceCash:typeof n.programBalanceCash=="number"?n.programBalanceCash:0,programBalanceBank:typeof n.programBalanceBank=="number"?n.programBalanceBank:0}}function Nr(n){try{const e=od(n);let t=localStorage.getItem(e);if(!t&&n==="corniche"){const s=localStorage.getItem("cashbox_rows");s&&(localStorage.setItem(e,s),localStorage.removeItem("cashbox_rows"),t=s)}return t?JSON.parse(t).filter(s=>s.status!=="closed").map(ng):[]}catch{return[]}}function Pi(n,e){try{localStorage.setItem(od(n),JSON.stringify(e.filter(t=>t.status!=="closed")))}catch{}}function Os(n){return Nr(n).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}function rg(n,e){return Nr(n).find(r=>r.id===e)??null}function ad(n,e,t){const r=Nr(n),s=new Date().toISOString(),o=(t==null?void 0:t.expenses)??0,l=(t==null?void 0:t.expenseItems)??[],u=(t==null?void 0:t.carriedExpenseCount)??0;r.push({id:tg(),employeeName:e,cash:0,sentToTreasury:0,expenseCompensation:0,expenses:o,carriedExpenseCount:u,expenseItems:l,mada:0,visa:0,mastercard:0,amex:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0,status:"active",notes:"",closedAt:null,createdAt:s}),Pi(n,r)}function Pt(n,e,t){const r=Nr(n),s=r.findIndex(o=>o.id===e);s!==-1&&(r[s]={...r[s],...t},Pi(n,r))}async function sg(n,e,t){const r=new Date().toISOString(),s={...t,status:"closed",closedAt:r};await rd(n,s);const o=Nr(n).filter(l=>l.id!==e);Pi(n,o)}async function ig(n,e,t){if(t)await id(n,e);else{const r=Nr(n).filter(s=>s.id!==e);Pi(n,r)}}async function og(n){const{getClosedRowsFromFirebase:e,deleteClosedRowFromFirebase:t}=await Vd(async()=>{const{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}=await Promise.resolve().then(()=>eg);return{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}},void 0),r=await e(n);await Promise.all(r.map(s=>t(n,s.id)))}const ag="٠١٢٣٤٥٦٧٨٩",lg="0123456789";function ld(n){let e="";for(let t=0;t<n.length;t++){const r=ag.indexOf(n[t]);e+=r>=0?lg[r]:n[t]}return e}function cg(n){return n.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a/g,"").replace(/\u202b/g,"").replace(/\u202c/g,"").replace(/[\u0640\u066a]/g,"").replace(/\/\s*/g,"/").trim()}function ug(n){const e=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2})\s*([صم])/);if(!e)return null;const t=parseInt(e[2],10)-1,r=parseInt(e[3],10),s=parseInt(e[1],10);let o=parseInt(e[4],10);const l=parseInt(e[5],10),u=e[6];u==="م"&&o!==12&&(o+=12),u==="ص"&&o===12&&(o=0);const h=new Date(r,t,s,o,l,0,0);return isNaN(h.getTime())?null:h}function dg(n){let e=n.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(e){let t=parseInt(e[1],10);const r=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),l=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(o,l,u,t,r,0,0);return isNaN(h.getTime())?null:h}if(e=n.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{1,2})\/(\d{1,2})\/(\d{4})/),e){let t=parseInt(e[1],10);const r=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),l=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(u,l,o,t,r,0,0);return isNaN(h.getTime())?null:h}return null}function ec(n){const e=cg((n||"").toString());if(!e)return null;const t=ld(e);return dg(t)??ug(t)}const hg=32874,fg=52100;function mg(n){if(n instanceof Date)return isNaN(n.getTime())?null:n;if(typeof n=="number"&&Number.isFinite(n)){if(n<hg||n>fg)return null;const t=(n-25569)*86400*1e3,r=new Date(t);return isNaN(r.getTime())?null:r}return null}const pg="٫";function So(n){let e=(n||"").toString().trim();e=e.replace(/\s*SAR\s*/gi," ").replace(/\s*ر\.?\s*س\.?\s*/g," ").replace(/\s*ريال\s*(سعودي)?\s*/gi," ").trim();let r=ld(e).replace(pg,".").replace(/[^\d.,\-]/g,"");if(!r)return 0;if(/^-?\d+,\d{1,3}$/.test(r)?r=r.replace(",","."):r=r.replace(/,/g,""),r.includes(".")){const l=r.split("."),u=l[l.length-1];u&&u.length===3&&/^\d+$/.test(u)&&(r=r.replace(/\./g,""))}const o=parseFloat(r);return Number.isFinite(o)?o:0}const cd={مدى:"mada",فيزا:"visa","ماستر كارد":"mastercard",ماستركارد:"mastercard","أمريكان إكسبريس":"amex","امريكان اكسبريس":"amex","تحويل بنكي":"bankTransfer",تحويل:"bankTransfer"},gg=["شيك","نقداً","نقدا","كاش"];function ud(n){const e=n.replace(/\s+/g," ").trim();return gg.some(t=>e===t||e.includes(t))}function xg(n,e,t){const r={...Hr},s={...Gr},o={mada:[],visa:[],mastercard:[],amex:[],bankTransfer:[]},l=Math.min(n.length,500);for(let u=t;u<l;u++){const h=n[u];if(!h||!Array.isArray(h))continue;const f=Math.min(Math.max(h.length,4),120);let m=null,g=-1;for(let j=0;j<f;j++){const L=e?ls(e,h,u,j):(h[j]??"").toString().trim(),V=Kn(L);if(!V||ud(V))continue;const O=cd[V]??(V.includes("مدى")?"mada":V.includes("أمريكان")||V.includes("اكسبريس")?"amex":null);if(O&&O!=="cash"){m=O,g=j;break}}if(m==null||m==="cash")continue;let E=0;for(let j=0;j<f;j++){if(j===g)continue;const L=e?ls(e,h,u,j):(h[j]??"").toString().trim(),V=So(L);if(V>0&&V<=dd){E=V;break}}if(E<=0)continue;const C=(h[g]??"").toString().trim();C.includes("إجمالي")||C.includes("مجموع")||C.includes("المجموع")||(r[m]+=E,s[m]+=1,o[m].push({date:new Date(0),amount:E,employeeName:void 0,purpose:void 0}))}return{sums:r,counts:s,details:o}}const Hr={cash:0,mada:0,visa:0,mastercard:0,amex:0,bankTransfer:0},Gr={cash:0,mada:0,visa:0,mastercard:0,amex:0,bankTransfer:0},to={mada:[],visa:[],mastercard:[],amex:[],bankTransfer:[]};function Kn(n){let e=(n??"").toString();return e=e.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a|\u202b|\u202c/g,"").replace(/\u200b|\u200c|\u200d|\ufeff/g,"").replace(/\s+/g," "),e=e.replace(/SAR/gi,"").replace(/ر\.?\s*س\.?/g,"").replace(/ريال\s*(سعودي)?/g,""),e.trim()}function ls(n,e,t,r){const s=fn.encode_cell({r:t,c:r}),o=n[s];if(o!=null){if(typeof o.w=="string"&&o.w.trim())return o.w.trim();if(typeof o.v=="number"&&!Number.isNaN(o.v))return String(o.v);if(typeof o.v=="string")return o.v.trim()}return(e[r]??"").toString().trim()}function ya(n){const e=Kn(n);return e.includes("طريقةالدفع")||e.includes("طريقة الدفع")||e.includes("الدفع")&&e.length<30||e.includes("طريقة")&&(e.includes("دفع")||e.includes("الدفع"))}function _a(n){const e=Kn(n);return e.includes("المبلغ")||e.includes("قيمةالسند")||e.includes("قيمة السند")||e.includes("المقبوضات")||e.includes("مقبوضات")||e.includes("قبوضات")||e.includes("المصروفات")||e.includes("مصروفات")||e.includes("الصافي")||e.includes("صافي")||e.includes("مبلغ")||e.includes("قيمة")&&!e.includes("رقم")&&e.length<35}function Fs(n){const e=new Map;for(const s of Object.keys(n)){if(s.startsWith("!"))continue;const o=fn.decode_cell(s);if(o==null||typeof o.r!="number")continue;const l=o.r,u=o.c,h=n[s],f=h&&typeof h.w=="string"&&h.w.trim()||h&&typeof h.v=="string"&&h.v.trim()||(h&&typeof h.v=="number"&&!Number.isNaN(h.v)?String(h.v):"");e.has(l)||e.set(l,new Map),e.get(l).set(u,f)}const t=e.size===0?0:Math.max(...e.keys()),r=[];for(let s=0;s<=t;s++){const o=e.get(s),l=o?Math.max(...o.keys()):0,u=[];for(let h=0;h<=l;h++)u.push((o==null?void 0:o.get(h))??"");r.push(u)}return r}function bg(n){const e=new Map;for(const r of Object.keys(n)){if(r.startsWith("!"))continue;const s=fn.decode_cell(r);if(s==null||typeof s.r!="number")continue;const o=s.r,l=s.c,u=n[r],h=u&&typeof u.w=="string"&&u.w.trim()||u&&typeof u.v=="string"&&u.v.trim()||(u&&typeof u.v=="number"&&!Number.isNaN(u.v)?String(u.v):"");if(!h)continue;e.has(o)||e.set(o,[]);const f=e.get(o);for(;f.length<=l;)f.push("");f[l]=h}const t=Array.from(e.keys()).sort((r,s)=>r-s);for(const r of t){const s=e.get(r)||[];let o=!1,l=!1;for(const u of s){const h=Kn(u);h&&(_a(h)&&(o=!0),ya(h)&&(l=!0))}if(o&&l)return r}return-1}const yg=["مدى","فيزا","ماستر كارد","ماستركارد","تحويل بنكي","تحويل","نقداً","نقدا","شيك","أمريكان إكسبريس"];function _g(n){const e=Kn(n);return!e||e.length>50?!1:yg.some(t=>e===t||e.includes(t))}function wg(n,e){const t=Math.min(n.length,200);for(let r=1;r<t;r++){const s=n[r];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);for(let l=0;l<o;l++){const u=e?ls(e,s,r,l):(s[l]??"").toString().trim();if(_g(u))return r-1}}return-1}function tc(n,e){const t=Math.min(n.length,200);for(let r=0;r<t;r++){const s=n[r];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);let l=!1,u=!1;for(let h=0;h<o;h++){const f=e?ls(e,s,r,h):(s[h]??"").toString().trim(),m=Kn(f);m&&(_a(m)&&(l=!0),ya(m)&&(u=!0))}if(l&&u)return r}return-1}const vg=["الموظف","اسم الموظف","الاسم","اسم","المستخدم","اسم المستخدم","الموظف المسؤول","المسؤول","كاشير","الكاشير","المحاسب","اسم المحاسب"];function kg(n){const e=n.replace(/\s+/g," ").replace(/\u200e|\u200f/g,"").trim();return e?e.includes("موظف")||e.includes("كاشير")||e.includes("محاسب")?!0:vg.some(t=>e===t||e.includes(t)):!1}const Eg=["الغرض","الوصف","البيان","الغرض من العملية","تفاصيل","ملاحظات","وصف العملية"];function Tg(n){const e=n.replace(/\s+/g," ").trim();return e?Eg.some(t=>e.includes(t)):!1}function Ig(n){let e=-1,t=-1,r=-1,s=-1,o=-1,l=-1;const u=Math.min(Math.max((n==null?void 0:n.length)??0,10),120);let h=-1;for(let f=0;f<u;f++){const m=n[f],g=Kn(m);(g.includes("الوقت")||g.includes("التاريخ"))&&e<0&&(e=f),t<0&&ya(g)&&(t=f),(g.includes("الإتجاه")||g.includes("الاتجاه"))&&s<0&&(s=f),o<0&&kg(g)&&(o=f),l<0&&Tg(g)&&(l=f),_a(g)&&((g.includes("المقبوضات")||g.includes("مقبوضات")||g.includes("قبوضات"))&&(h=f),r<0&&(r=f)),g.includes("رقم السند")&&g.includes("قيمة السند")}return h>=0&&(r=h),t>=0&&r>=0?{date:e,method:t,amount:r,direction:s,employeeName:o,purpose:l}:null}function Ag(n){const e=(n??"").toString().trim();return typeof n=="string"||typeof n=="number"&&n<3e4?e?ec(e):null:mg(n)??(e?ec(e):null)}const dd=999999;function Cg(n,e){try{const t=wd(n,{type:"array"}),r=t.SheetNames||[];if(r.length===0)return{sums:Hr,counts:Gr,details:to,employeeName:null,employeeNamesList:[],error:"الملف لا يحتوي على أي sheet"};let s=[],o={},l="",u=-1;for(let G=0;G<r.length;G++)if(l=r[G],o=t.Sheets[l],s=fn.sheet_to_json(o,{header:1,defval:""}),u=tc(s,o),u<0&&(s=Fs(o),u=tc(s,o)),u<0&&(u=bg(o)),u>=0){s.length<=u&&(s=Fs(o));break}if(u>=0&&s.length<=u&&(s=Fs(o)),u<0&&(u=wg(s,o)),u>=0&&s.length<=u&&(s=Fs(o)),u<0)return{sums:Hr,counts:Gr,details:to,employeeName:null,employeeNamesList:[],error:"لم يُعثر على صف العناوين (طريقة الدفع، المبلغ أو المقبوضات)"};const h=s[u],f=[];for(let G=0;G<Math.max((h==null?void 0:h.length)??0,80);G++)f.push(ls(o,h,u,G)||h[G]);let m=Ig(f);if(!m){const G=xg(s,o,u+1);return{sums:G.sums,counts:G.counts,details:G.details,employeeName:null,employeeNamesList:[],error:null}}const E={...Hr},C={...Gr},j={mada:[],visa:[],mastercard:[],amex:[],bankTransfer:[]},L=new Set,V=e.getTime();for(let G=u+1;G<s.length;G++){const Y=s[G],W=(Y[m.method]??"").toString().trim();if(!W||ud(W))continue;const ee=m.date>=0?Y[m.date]:void 0,v=m.date>=0?Ag(ee):null;if(m.date>=0&&(!v||v.getTime()<V))continue;const b=v??new Date(0),w=(m.direction>=0?(Y[m.direction]??"").toString().trim():"").replace(/\u200e/g,"").replace(/\u200f/g,"").trim();if(m.direction>=0&&w!=="داخل")continue;const k=Y[m.amount];if(m.employeeName>=0){const te=fn.encode_cell({r:G,c:m.employeeName}),de=o[te],ce=(de&&typeof de.w=="string"?de.w.trim():"")||(Y[m.employeeName]??"").toString().trim();ce&&L.add(ce)}const A=fn.encode_cell({r:G,c:m.amount}),x=o[A],$=x&&typeof x.w=="string"?x.w.trim():"";let J;if($)J=So($);else if(typeof k=="number"&&Number.isFinite(k))J=k;else{const te=(k??"").toString().trim();J=So(te)}if(J<=0||J>dd)continue;const ye=W.replace(/\s+/g," ").trim();if(ye.includes("إجمالي")||ye.includes("مجموع")||ye.includes("المجموع"))continue;const F=cd[W]??(W.toLowerCase().includes("مدى")?"mada":/أمريكان|اكسبريس|امريكان/.test(W)?"amex":null);if(F&&(E[F]+=J,C[F]+=1,F!=="cash")){const te=m.employeeName>=0?(()=>{const ge=fn.encode_cell({r:G,c:m.employeeName}),ce=o[ge];return(ce&&typeof ce.w=="string"?ce.w.trim():"")||(Y[m.employeeName]??"").toString().trim()||void 0})():void 0;let de;if(m.purpose>=0){const ge=fn.encode_cell({r:G,c:m.purpose}),ce=o[ge];de=(ce&&typeof ce.w=="string"?ce.w.trim():"")||(Y[m.purpose]??"").toString().trim()||void 0}j[F].push({date:b,amount:J,employeeName:te,purpose:de})}}const O=[...L],U=L.size===0?null:L.size===1?O[0]:"أكثر من موظف";return{sums:E,counts:C,details:j,employeeName:U,employeeNamesList:O,error:null}}catch(t){const r=t instanceof Error?t.message:String(t);return{sums:Hr,counts:Gr,details:to,employeeName:null,employeeNamesList:[],error:`خطأ في قراءة الملف: ${r}`}}}const hd=[500,200,100,50,20,10,5,1];function Ng(n){const e=n.getHours();return e>=5&&e<12?{label:"صباح الخير",kind:"morning"}:e>=12&&e<17?{label:"مساء الخير",kind:"noon"}:e>=17&&e<21?{label:"أمسية سعيدة",kind:"evening"}:{label:"ليلة سعيدة",kind:"night"}}function Ys(n){const e=n.mada??0,t=n.visa??0,r=n.mastercard??0,s=n.amex??0,o=n.programBalanceBank??0,l=e+t+r+s;return Math.round((l-o)*100)/100}function Js(n){const e=n.cash??0,t=n.sentToTreasury??0,r=n.expenses??0,s=n.expenseCompensation??0,o=Math.max(0,r-s),l=e+t+o;return Math.round((l-n.programBalanceCash)*100)/100}function Bs(n){const e=n.cash??0,t=n.mada??0,r=n.visa??0,s=n.mastercard??0,o=n.amex??0,l=n.programBalanceCash??0,u=n.programBalanceBank??0,h=e+t+r+s+o,f=l+u;return Math.round((h-f)*100)/100}function mi(n){const e=typeof n=="string"?new Date(n):n,t={calendar:"gregory",numberingSystem:"latn"},r=e.toLocaleDateString("ar-SA",{...t,weekday:"long"}),s=e.getDate(),o=e.toLocaleDateString("ar-SA",{...t,month:"long"}),l=e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",numberingSystem:"latn"});return`${r} ${s} ${o} ${l}`}const Rg="٠١٢٣٤٥٦٧٨٩",Sg="0123456789";function Un(n){if(typeof n!="string")return String(n);let e="";for(let t=0;t<n.length;t++){const r=Rg.indexOf(n[t]);e+=r>=0?Sg[r]:n[t]}return e}function q(n){return new Intl.NumberFormat("ar-SA",{minimumFractionDigits:0,maximumFractionDigits:2,numberingSystem:"latn"}).format(n)}function jg(n){const e=new Date(n),t=new Date;return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Pg(n){const e=new Date(n),t=new Date;return t.setDate(t.getDate()-1),e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Vg(n){const e=new Date(n),t=new Date,r=new Date(t);return r.setDate(r.getDate()-7),e>=r&&e<=t}function nc(n,e){return e==="today"?n.filter(t=>t.closedAt&&jg(t.closedAt)):e==="yesterday"?n.filter(t=>t.closedAt&&Pg(t.closedAt)):e==="lastWeek"?n.filter(t=>t.closedAt&&Vg(t.closedAt)):n}const rc=["cash","sentToTreasury","expenseCompensation","expenses","programBalanceCash","mada","visa","mastercard","amex","bankTransfer","programBalanceBank"],wa="border-stone-200 dark:border-teal-500/20",sc=`border-t-2 border-b-2 border-r-2 ${wa} rounded-s-xl`,$r=`border-t-2 border-b-2 ${wa}`,ic=`border-t-2 border-b-2 border-l-2 ${wa} rounded-e-xl`;function Dg({row:n,rowNumber:e,rowIndex:t=0,isFirstActive:r,liveNow:s,closingRowId:o,closingSecondsLeft:l,onUpdate:u,isSelected:h=!1,onToggleSelect:f,onDeleteRow:m,onPrintRow:g,onOpenExpenseDetails:E,onClearExpensesAndOpen:C,onLockedFieldClick:j,onExpenseCompensationExceeded:L,lastExcelDetails:V,onShowExcelDetails:O,onRequestConfirmBankEdit:U,onShowEmployeeNames:G,onShowVarianceExplanation:Y,currentUserName:W,onClearRow:ee,isStickyRows:v=!1,onOpenShiftNotesModal:b}){const y=r&&W?W:n.employeeName,w=I.useMemo(()=>Ys(n),[n.mada,n.visa,n.mastercard,n.amex,n.bankTransfer,n.programBalanceBank]),k=I.useMemo(()=>Js(n),[n.cash,n.sentToTreasury,n.programBalanceCash,n.expenses,n.expenseCompensation]),A=I.useMemo(()=>{const Z=n.carriedExpenseCount??0;return(n.expenseItems??[]).slice(0,Z).reduce((Pe,Le)=>Pe+Le.amount,0)},[n.carriedExpenseCount,n.expenseItems]),x=n.status==="closed",$=o===n.id,J=I.useCallback((Z,We)=>{const Pe=Un(We);let Le=parseFloat(Pe)||0;Z==="expenses"&&A>0&&Le<A&&(Le=A);const Re=n.expenses??0;Z==="expenseCompensation"&&Le>Re&&(L==null||L(Re),Le=Re),u(n.id,Z,Le)},[n.id,n.expenses,u,A,L]),ye=I.useCallback(Z=>{if(Z.key==="Enter"||Z.key==="Tab"){const We=Z.currentTarget.closest("tr");if(!We)return;const Pe=Array.from(We.querySelectorAll("input:not([disabled])")),Le=Pe.indexOf(Z.currentTarget),Re=Z.key==="Tab"&&Z.shiftKey,Ve=Z.key==="Enter"||Z.key==="Tab"&&!Z.shiftKey;Re&&Le>0?(Z.preventDefault(),Pe[Le-1].focus()):Ve&&Le>=0&&Le<Pe.length-1&&(Z.preventDefault(),Pe[Le+1].focus())}},[]),F=k>0?"text-emerald-700 dark:text-emerald-400":k<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",te=w>0?"text-emerald-700 dark:text-emerald-400":w<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",de=n.programBalanceCash>0,ge=["programBalanceCash","expenses"],[ce,ve]=I.useState(!1),[ke,Se]=I.useState(null),[je,rt]=I.useState(null),pt=I.useCallback(Z=>{j==null||j(),ve(!0),Se(Z)},[j]);I.useEffect(()=>{if(!ce)return;const Z=setTimeout(()=>ve(!1),3e3);return()=>clearTimeout(Z)},[ce]),I.useEffect(()=>{if(ke===null)return;const Z=setTimeout(()=>Se(null),1200);return()=>clearTimeout(Z)},[ke]);const Ie=(Z,We)=>{var vt;const Pe=n[Z]??0,Le=(Z==="mada"||Z==="visa"||Z==="mastercard"||Z==="amex"||Z==="bankTransfer")&&((vt=V==null?void 0:V[Z])==null?void 0:vt.length)>0&&O;if(x||$)return Z==="expenses"&&E?a.jsx("button",{type:"button",onClick:()=>E(n.id),className:`block w-full py-1 text-sm font-cairo text-center rounded-xl transition cursor-pointer ${x?"text-red-700 dark:text-red-600 hover:text-red-800 dark:hover:text-red-500 hover:bg-red-50/80 dark:hover:bg-red-500/10":"text-stone-800 dark:text-slate-300 hover:text-stone-900 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/[0.06]"}`,title:"عرض تفاصيل المصروفات",children:Pe===0?"—":q(Pe)}):Le&&O?a.jsxs("div",{className:"flex items-center gap-1 w-full",children:[a.jsx("span",{className:`flex-1 min-w-0 py-1 text-sm font-cairo text-center tabular-nums ${x?"text-red-700 dark:text-red-600":"text-stone-800 dark:text-slate-300"}`,children:Pe===0?"—":q(Pe)}),a.jsx("button",{type:"button",onClick:()=>O(Z,n.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-stone-800 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 8v4l2 2"}),a.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):a.jsx("span",{className:`block py-1 text-sm font-cairo text-center tabular-nums ${x?"text-red-700 dark:text-red-600":"text-stone-800 dark:text-slate-300"}`,children:Pe===0?"—":q(Pe)});const Re=Z==="expenses",Ve=!ge.includes(Z)&&!de,Lt=Z==="programBalanceCash"&&r?0:Ve?-1:1,An=Le&&U&&["mada","visa","mastercard","amex","bankTransfer"].includes(Z),rn=An&&(je==null?void 0:je.field)===Z?je.value===0?"":String(je.value):Pe===0?"":String(Pe),sn=a.jsx("input",{type:"text",inputMode:"decimal",value:rn,onChange:Ee=>{const bt=Un(Ee.target.value).replace(/[^\d.]/g,""),At=bt.indexOf("."),Cn=At===-1?bt:bt.slice(0,At+1)+bt.slice(At+1).replace(/\./g,""),on=parseFloat(Cn)||0;An?rt({field:Z,value:on}):J(Z,Cn)},onBlur:()=>{if(An&&(je==null?void 0:je.field)===Z){const Ee=je.value;rt(null),Ee!==Pe&&U(n.id,Z,Pe,Ee)}},dir:"ltr","aria-label":Z,onKeyDown:ye,onFocus:Ee=>{Ee.currentTarget.select(),Re&&E&&E(n.id)},placeholder:"—",tabIndex:Lt,disabled:Ve,title:Ve?"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش":Z==="expenseCompensation"?"يجب أن يكون مساوياً أو أقل من مبلغ المصروفات":void 0,className:"cashbox-input w-full min-h-[1.6rem] px-2 py-1.5 rounded-lg bg-white dark:bg-slate-900/70 border-2 border-stone-400 dark:border-white/[0.04] text-stone-900 dark:text-white text-sm font-cairo text-center focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 dark:focus:border-teal-500/28 dark:focus:ring-teal-500/14 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm"});return Ve&&j?a.jsx("div",{role:"button",tabIndex:0,className:"locked-field-wrapper w-full cursor-not-allowed rounded-lg",onClick:Ee=>{Ee.preventDefault(),Ee.stopPropagation(),pt(Z)},onKeyDown:Ee=>{(Ee.key==="Enter"||Ee.key===" ")&&(Ee.preventDefault(),pt(Z))},title:"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش",children:sn}):Le&&O?a.jsxs("div",{className:"flex items-center gap-1 w-full",children:[a.jsx("div",{className:"flex-1 min-w-0",children:sn}),a.jsx("button",{type:"button",onClick:()=>O(Z,n.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-stone-800 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 8v4l2 2"}),a.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):sn},wt=$&&l>0?l<=1?"0.35s":l<=2?"0.6s":l<=3?"1s":"1.5s":void 0,It=x&&n.closedAt?mi(n.closedAt):mi(s),Qt=v?"sticky top-[6.5rem] sm:top-[7rem] z-[9] bg-[#ebe6df]/98 dark:bg-slate-800/98 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b-2 border-stone-500 dark:border-teal-500/20":"",Xe=v?"sticky top-[8.75rem] sm:top-[9.25rem] z-[9] bg-white dark:bg-slate-800/95 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b-2 border-stone-500 dark:border-teal-500/20":"",gt=x?"min-h-[1.6rem] py-1.5 px-2 border-0 rounded-none bg-transparent text-red-700 dark:text-red-600 text-sm font-cairo text-center tabular-nums":"min-h-[1.6rem] py-1.5 px-2 rounded-lg border-2 border-stone-400 dark:border-white/[0.04] bg-white dark:bg-slate-900/70 text-stone-900 dark:text-white text-sm font-cairo text-center tabular-nums",xt=$?"bg-sky-100 dark:bg-sky-500/10":x?"bg-slate-100 dark:bg-slate-800/50":t%2===0?"bg-[#f8f4ee] dark:bg-slate-800/30 hover:bg-[#f2ede5] dark:hover:bg-slate-800/40":"bg-[#f2ede5] dark:bg-slate-800/20 hover:bg-[#ebe6df] dark:hover:bg-slate-800/35";return a.jsxs(a.Fragment,{children:[a.jsx("tr",{"data-row-id":n.id,...x?{"data-row-closed":"true"}:{},className:`bg-transparent border-b-2 border-stone-500 dark:border-teal-500/20 ${v?"sticky-label-row":""} ${x?"border-l-2 border-l-stone-400 dark:border-l-slate-600":"border-l-4 border-l-teal-500 dark:border-l-teal-500/40"}`,children:a.jsx("td",{colSpan:16,className:`py-0.5 px-2 sm:px-3 align-middle text-[10px] sm:text-[11px] font-semibold font-cairo whitespace-nowrap ${Qt}`,style:{lineHeight:1.2,verticalAlign:"middle",paddingInlineStart:"4%"},children:a.jsxs("div",{className:"flex items-center w-full gap-2",children:[a.jsxs("span",{className:`inline-flex items-center gap-1.5 flex-wrap rounded-lg border px-2 py-0.5 flex-1 min-w-0 ${x?"border-2 border-red-300 dark:border-red-500/40 bg-slate-200/80 dark:bg-slate-700/40 shadow-none":"border-2 border-stone-400 dark:border-teal-500/18 bg-stone-50 dark:bg-teal-500/10 shadow-sm dark:shadow-accent-soft"}`,children:[y==="أكثر من موظف"&&G?a.jsx("button",{type:"button",onClick:G,className:x?"text-red-700 dark:text-red-600 hover:text-red-800 dark:hover:text-red-500 underline underline-offset-1 cursor-pointer transition-colors font-semibold":"text-stone-800 dark:text-teal-400 hover:text-stone-900 dark:hover:text-teal-300 underline underline-offset-1 cursor-pointer transition-colors font-semibold",title:"عرض أسماء الموظفين",children:"أكثر من موظف"}):a.jsx("span",{className:`font-semibold ${x?"text-red-700 dark:text-red-600":"text-stone-900 dark:text-teal-300"}`,children:y}),a.jsx("span",{className:x?"text-red-700 dark:text-red-600":"text-stone-500 dark:text-slate-400",children:"·"}),a.jsx("span",{className:`tabular-nums font-medium ${x?"text-red-700 dark:text-red-600":"text-stone-600 dark:text-slate-400"}`,children:It}),b&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-stone-500 dark:text-slate-400",children:"·"}),a.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[!x&&r?a.jsx("button",{type:"button",onClick:()=>b(n,"edit"),className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[10px] sm:text-[11px] font-semibold font-cairo bg-teal-500/20 dark:bg-teal-500/25 text-teal-700 dark:text-white border border-teal-400/50 dark:border-teal-500/28 hover:bg-teal-500/30 dark:hover:bg-teal-500/35 transition-colors",title:"تسجيل ملاحظات الشيفت",children:"ملاحظات الشيفت"}):null,a.jsx("button",{type:"button",onClick:()=>b(n,"view"),title:(n.notes||"").trim()?"عرض ملاحظات الشيفت":"لا توجد ملاحظات",className:`inline-flex items-center justify-center w-6 h-6 rounded-md transition-colors ${(n.notes||"").trim()?"text-red-500 dark:text-red-400 animate-pulse":"text-stone-400 dark:text-slate-500"}`,"aria-label":"عرض ملاحظات الشيفت",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]})]})]}),x&&a.jsx("span",{className:"flex items-center justify-center shrink-0 text-red-700 dark:text-red-600",title:"صف مغلق","aria-hidden":!0,children:a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),a.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),a.jsx("span",{className:x?"flex-1 min-w-0":"hidden","aria-hidden":!0})]})})}),a.jsxs("tr",{"data-row-id":n.id,...x?{"data-row-closed":"true"}:{},className:`bg-transparent ${$?"animate-pulse border-l-2 border-r-2 border-l-sky-400/50 border-r-sky-400/50 border-b-2 border-stone-500 dark:border-teal-500/20":"border-b-2 border-stone-500 dark:border-slate-600 transition-colors"} ${v?"sticky-data-row":""}`,style:wt?{animationDuration:wt}:void 0,children:[a.jsx("td",{className:`p-1 text-center align-middle bg-transparent ${Xe}`,children:f&&a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("button",{type:"button",onClick:()=>f(n.id),"aria-label":h?"إلغاء تحديد الصف":"تحديد الصف للطباعة",className:`inline-flex items-center justify-center w-4 h-4 rounded-md border-2 transition-all ${h?"border-teal-500 bg-teal-100 text-teal-600 ring-2 ring-teal-500/30 ring-offset-2 ring-offset-stone-50 dark:border-teal-500/60 dark:bg-teal-500/20 dark:text-teal-400 dark:ring-teal-500/30 dark:ring-offset-slate-800":"border-2 border-stone-500 dark:border-white/12 bg-stone-300 dark:bg-slate-800/60 text-stone-800 dark:text-slate-400 hover:border-teal-400 dark:hover:border-teal-500/40 hover:text-teal-600 dark:hover:text-teal-400/90 shadow-sm"}`,children:h?a.jsx("svg",{className:"w-2 h-2 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})}):a.jsx("span",{className:"w-2 h-2 block shrink-0"})})})}),a.jsx("td",{className:`p-1 text-center text-stone-800 dark:text-slate-400 text-xs font-medium font-cairo align-middle tabular-nums bg-transparent ${Xe}`,children:e}),rc.slice(0,4).map(Z=>a.jsx("td",{"data-transfer-target":!0,"data-field":Z,"data-row-id":n.id,className:`p-1 text-center align-middle ${xt} ${ke===Z?"locked-cell-pulse":""} ${Xe} ${Z==="cash"?sc:$r}`,children:Ie(Z)},Z)),a.jsx("td",{"data-transfer-target":!0,"data-field":"programBalanceCash","data-row-id":n.id,className:`p-1 text-center align-middle ${xt} ${ce&&r?"program-balance-pulse-cell":""} ${Xe} ${$r}`,title:!de&&r?"لا يمكن الإدخال في الخانات الأخرى قبل إدخال رصيد البرنامج كاش هنا":void 0,children:Ie("programBalanceCash")}),a.jsx("td",{className:`p-1 text-center align-middle ${xt} ${Xe} ${ic}`,children:Y?a.jsx("button",{type:"button",onClick:()=>Y("cash",n),className:`block w-full ${gt} transition cursor-pointer focus:outline-none focus:ring-2 focus:ring-teal-500/20 ${x?"":"hover:bg-stone-50 dark:hover:bg-white/[0.06]"} ${k===0?"cursor-default text-stone-500 dark:text-slate-500":F}`,title:k===0?void 0:"شرح سبب انحراف الكاش",disabled:k===0,children:k===0?"—":q(k)}):a.jsx("span",{className:`block w-full ${gt} ${k===0?"text-stone-500 dark:text-slate-500":F}`,children:k===0?"—":q(k)})}),rc.slice(5,10).map((Z,We)=>a.jsx("td",{"data-transfer-target":!0,"data-field":Z,"data-row-id":n.id,className:`p-1 text-center align-middle ${xt} ${ke===Z?"locked-cell-pulse":""} ${Xe} ${Z==="mada"?sc:$r}`,children:Ie(Z)},Z)),a.jsx("td",{className:`p-1 text-center align-middle ${xt} ${Xe} ${$r}`,children:a.jsx("span",{className:`block w-full ${gt} font-medium`,children:(()=>{const Z=n.mada+n.visa+n.mastercard+(n.amex??0);return Z===0?"—":q(Z)})()})}),a.jsx("td",{"data-transfer-target":!0,"data-field":"programBalanceBank","data-row-id":n.id,className:`p-1 text-center align-middle ${xt} ${ke==="programBalanceBank"?"locked-cell-pulse":""} ${Xe} ${$r}`,children:Ie("programBalanceBank")}),a.jsx("td",{className:`p-1 text-center align-middle ${xt} ${Xe} ${ic}`,children:Y?a.jsx("button",{type:"button",onClick:()=>Y("bank",n),className:`block w-full ${gt} transition cursor-pointer focus:outline-none focus:ring-2 focus:ring-teal-500/20 ${x?"":"hover:bg-stone-50 dark:hover:bg-white/[0.06]"} ${w===0?"cursor-default text-stone-500 dark:text-slate-500":te}`,title:w===0?void 0:"شرح سبب انحراف البنك",disabled:w===0,children:w===0?"—":q(w)}):a.jsx("span",{className:`block w-full ${gt} ${w===0?"text-stone-500 dark:text-slate-500":te}`,children:w===0?"—":q(w)})}),a.jsx("td",{className:`px-0.5 py-0.5 text-center align-middle overflow-hidden min-w-0 bg-transparent ${Xe}`,children:x?a.jsxs("div",{className:"flex flex-row items-center justify-center gap-0.5 flex-wrap min-w-0 w-full",children:[a.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded-full px-1 py-0.5 bg-emerald-100 dark:bg-emerald-500/15 border border-emerald-300 dark:border-emerald-500/25 text-[8px] font-medium text-emerald-700 dark:text-white font-cairo whitespace-nowrap shrink-0",children:[a.jsx("svg",{className:"w-2 h-2 text-emerald-600 dark:text-white shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})}),"تم الإغلاق"]}),(m||g)&&a.jsxs("div",{className:"inline-flex items-center justify-center gap-0.5 shrink-0",children:[m&&a.jsx("button",{type:"button",onClick:()=>m(n.id),"aria-label":"حذف الصف",className:"inline-flex items-center justify-center w-6 h-6 rounded border border-stone-400 dark:border-red-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 transition-all shrink-0",title:"حذف الصف",children:a.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),g&&a.jsx("button",{type:"button",onClick:()=>g(n.id),"aria-label":"طباعة الصف",className:"inline-flex items-center justify-center w-6 h-6 rounded border border-stone-500 dark:border-teal-500/25 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-stone-300 dark:hover:bg-teal-500/15 hover:text-teal-400 transition-all shrink-0",title:"طباعة هذه التقفيلة",children:a.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M6 9V2h12v7"}),a.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),a.jsx("path",{d:"M6 14h12v8H6z"})]})})]})]}):ee?a.jsx("button",{type:"button",onClick:()=>ee(n.id),title:"افراغ كل المدخلات في الصف النشط",className:"inline-flex items-center justify-center rounded px-0.5 py-0.5 bg-stone-200 dark:bg-teal-500/15 border border-stone-400 dark:border-teal-500/18 text-[8px] font-medium text-stone-800 dark:text-teal-400 font-cairo whitespace-nowrap w-full min-w-0 truncate hover:bg-stone-300 dark:hover:bg-teal-500/25 transition",children:"افراغ"}):a.jsx("span",{className:"inline-flex items-center justify-center rounded px-0.5 py-0.5 bg-stone-200 dark:bg-teal-500/15 border border-stone-400 dark:border-teal-500/18 text-[8px] font-medium text-stone-800 dark:text-teal-400 font-cairo whitespace-nowrap w-full min-w-0 truncate",children:"الشفت الحالي"})})]})]})}const Mg={Enter:"=","=":"=",Backspace:"⌫",Escape:"C",",":"."},Lg="programBalanceBank",no="اجمالى الموازنه";function Og({onTransfer:n,hasActiveRow:e}={}){const[t,r]=I.useState("0"),[s,o]=I.useState(""),[l,u]=I.useState([]),[h,f]=I.useState(!1),m=I.useRef(null),g=I.useRef(null),[E,C]=I.useState(null);I.useLayoutEffect(()=>{if(!h){C(null);return}const $=m.current;if(!$){C(null);return}const J=$.getBoundingClientRect();C({right:window.innerWidth-J.right,bottom:window.innerHeight-J.top+8})},[h]);const j=I.useRef("0"),L=I.useRef(""),V=I.useRef(null),O=I.useRef(!1),U=I.useRef(()=>{}),G=I.useRef(null),Y=I.useCallback($=>{j.current=$,r($)},[]),W=I.useCallback($=>{r($)},[]),ee=I.useCallback(($,J,ye)=>{const F=parseFloat($)||0,te=parseFloat(ye)||0;return J?J==="+"?F+te:J==="-"?F-te:J==="*"?F*te:J==="/"?te===0?0:F/te:J==="%"?te===0?0:F*te/100:te:te},[]),v=I.useCallback(()=>{const $=ee(L.current,V.current,j.current),J=`${L.current} ${V.current} ${j.current} = ${$}`;u(ye=>[J,...ye].slice(0,20)),Y(String($)),o(""),L.current="",V.current=null,O.current=!0},[Y,ee]),b=I.useCallback($=>{if($==="C"){Y("0"),o(""),u([]),f(!1),L.current="",V.current=null,O.current=!1;return}if($==="⌫"){const J=j.current;if(J.length<=1){Y("0");return}Y(J.slice(0,-1));return}if($==="="){V.current&&v();return}if(["+","-","*","/","%"].includes($)){V.current&&v(),L.current=j.current,V.current=$,o(J=>J+" "+$),O.current=!0;return}if($==="."){if(O.current){Y("0."),j.current="0.",O.current=!1;return}if(j.current.includes("."))return;const J=j.current+".";j.current=J,V.current?W(String(ee(L.current,V.current,J))):Y(J),o(ye=>ye+$);return}if(/\d/.test($)){if(O.current)j.current=$,V.current?W(String(ee(L.current,V.current,$))):Y($),O.current=!1;else{const J=j.current==="0"?$:j.current+$;j.current=J,V.current?W(String(ee(L.current,V.current,J))):Y(J)}o(J=>J+$)}},[Y,W,v,ee]);U.current=b,I.useEffect(()=>{const $=J=>{var de;const ye=J.target;if(ye.closest("input, textarea, select")||!((de=G.current)!=null&&de.contains(ye)))return;const F=Mg[J.key]??(J.key.length===1?J.key:"");!F||!["C","⌫","%","/","*","-","+","=",".","0","1","2","3","4","5","6","7","8","9"].includes(F)&&!/^\d$/.test(F)||(J.preventDefault(),U.current(F))};return window.addEventListener("keydown",$),()=>window.removeEventListener("keydown",$)},[]);const y=[["C","⌫","%","/"],["7","8","9","*"],["4","5","6","-"],["1","2","3","+"],["0",".","="]],w=$=>["+","-","*","/","%"].includes($),k=$=>$==="="?"col-span-2 bg-teal-500 hover:bg-teal-600 dark:bg-teal-500/20 dark:hover:bg-teal-500/30 text-white dark:text-teal-400 font-bold text-lg border-2 border-teal-400 dark:border-teal-500/12 shadow-sm":w($)?"bg-teal-100 hover:bg-teal-200 dark:bg-teal-500/20 dark:hover:bg-teal-500/30 text-teal-700 dark:text-teal-400 font-bold border-2 border-teal-300 dark:border-teal-500/12 flex items-center justify-center shadow-sm":$==="C"?"bg-red-100 hover:bg-red-200 dark:bg-red-500/20 dark:hover:bg-red-500/30 text-red-600 dark:text-red-400 border-2 border-red-300 dark:border-red-500/40 text-base shadow-sm":$==="⌫"?"bg-stone-400 hover:bg-stone-500 dark:bg-slate-600/40 dark:hover:bg-slate-500/50 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/[0.06] text-base shadow-sm":"bg-white dark:bg-slate-700/40 hover:bg-stone-100 dark:hover:bg-slate-600/50 text-stone-900 dark:text-slate-200 border-2 border-stone-400 dark:border-white/[0.06] active:scale-[0.98] text-base shadow-sm",A={"+":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:a.jsx("path",{d:"M12 5v14M5 12h14"})}),"-":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:a.jsx("path",{d:"M5 12h14"})}),"*":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M7 7l10 10M17 7L7 17"})}),"/":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M5 4l14 16"})}),"%":a.jsxs("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"6",cy:"6",r:"2.5"}),a.jsx("circle",{cx:"18",cy:"18",r:"2.5"}),a.jsx("path",{d:"M6 18L18 6"})]})},x=$=>A[$]?A[$]:a.jsx("span",{className:"inline-block leading-none",children:$});return a.jsxs("div",{ref:G,className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/14 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",tabIndex:0,title:"انقر هنا ثم استخدم لوحة المفاتيح. النتيجة لا تتغير عند الكتابة في الجدول.",children:[a.jsxs("div",{className:"bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-3 sm:px-4 py-1.5 sm:py-2 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shadow-sm",children:[a.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide min-w-0",children:[a.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 shrink-0",children:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2"}),a.jsx("path",{d:"M6 6h12M6 10h12"}),a.jsx("rect",{x:"6.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"10.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"14.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"6.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"10.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"14.5",y:"17.5",width:"3",height:"3",rx:"0.5"})]})}),"الآلة الحاسبة"]}),a.jsx("button",{ref:m,type:"button",onClick:()=>f($=>!$),className:`p-1.5 rounded-lg transition ${h?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:h?"إخفاء السجل":"سجل العمليات","aria-label":"سجل العمليات",children:a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]})})]}),a.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 gap-2 sm:gap-3 min-h-0 overflow-hidden",children:[a.jsxs("div",{className:"shrink-0 rounded-xl bg-stone-100 dark:bg-slate-900/80 border-2 border-stone-400 dark:border-slate-600 p-2 shadow-inner dark:ring-0",children:[a.jsx("div",{className:"text-right text-stone-700 text-xs min-h-[14px] font-cairo tabular-nums select-none","aria-hidden":"true",children:s||"​"}),a.jsx("div",{className:"w-full px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/50 border-2 border-stone-300 dark:border-transparent text-stone-900 dark:text-white text-right font-cairo text-xl sm:text-2xl font-semibold tabular-nums min-h-[2.25rem] flex items-center justify-end","aria-live":"polite","aria-label":`النتيجة: ${t}`,children:t})]}),n&&a.jsxs("button",{ref:g,type:"button",onClick:()=>{const $=parseFloat(t)||0;if(!e||$<=0)return;let J;if(g.current){const ye=g.current.getBoundingClientRect();J={x:ye.x,y:ye.y,width:ye.width,height:ye.height}}n($,Lg,J),u(ye=>[`مرحّل → ${no}: ${$}`,...ye].slice(0,20)),Y("0"),o("")},disabled:!e||!parseFloat(t),title:`ترحيل الرقم إلى ${no}`,className:"shrink-0 w-full py-1.5 sm:py-2 rounded-xl text-xs sm:text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/24 disabled:opacity-50 disabled:pointer-events-none transition flex items-center justify-center gap-2 shadow-sm",children:[a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل إلى ",no]}),a.jsx("div",{className:"grid grid-cols-4 grid-rows-5 gap-1.5 sm:gap-2 min-h-0 flex-1",children:y.flat().map($=>a.jsx("button",{type:"button",onClick:()=>b($),className:`min-h-0 rounded-lg sm:rounded-xl font-cairo transition-all duration-150 flex items-center justify-center ${k($)}`,"aria-label":$==="⌫"?"حذف":$,children:x($)},$))}),h&&E&&_n.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>f(!1)}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[180px] max-h-[280px] overflow-y-auto",style:{right:E.right,bottom:E.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"سجل العمليات"}),l.length===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لا يوجد سجل بعد"}):a.jsx("ul",{className:"space-y-1 mb-1 max-h-48 overflow-y-auto scrollbar-thin",children:l.map(($,J)=>a.jsx("li",{className:"tabular-nums px-2 py-1 rounded-md bg-stone-100 dark:bg-slate-800/40 text-stone-800 dark:text-slate-300 border border-stone-300 dark:border-transparent",children:$},J))}),a.jsx("button",{type:"button",onClick:()=>f(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]})}const Kr=[...hd],ro=()=>Object.fromEntries(Kr.map(n=>[n,0]));function Fg({onApplyToCash:n,hasActiveRow:e}){const[t,r]=I.useState(ro()),[s,o]=I.useState(ro()),[l,u]=I.useState(!1),h=I.useRef(null),[f,m]=I.useState(null);I.useLayoutEffect(()=>{if(!l){m(null);return}const O=h.current;if(!O){m(null);return}const U=O.getBoundingClientRect();m({right:window.innerWidth-U.right,bottom:window.innerHeight-U.top+8})},[l]);const g=Kr.reduce((O,U)=>O+(t[U]??0)*U,0),E=Kr.reduce((O,U)=>O+(s[U]??0)*U,0),C=I.useCallback((O,U)=>{r(G=>({...G,[O]:U}))},[]),j=I.useCallback(()=>{r(ro())},[]),L=I.useRef(null),V=I.useCallback(()=>{if(!e)return;let O;if(L.current){const U=L.current.getBoundingClientRect();O={x:U.x,y:U.y,width:U.width,height:U.height}}o({...t}),n(g,O),j()},[e,g,n,j,t]);return a.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/14 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[a.jsxs("div",{className:"relative bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-3 sm:px-4 py-1.5 sm:py-2 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide min-w-0",children:[a.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 shrink-0",children:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),a.jsx("path",{d:"M2 10h20M2 14h20M7 8v8M12 8v8M17 8v8"})]})}),"حاسبة الكاش"]}),a.jsx("button",{ref:h,type:"button",onClick:()=>u(O=>!O),className:`p-1.5 rounded-lg transition shrink-0 ${l?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:"آخر عمليات رُحّلت إلى الكاش","aria-label":"سجل العمليات",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]})})]}),a.jsx("span",{className:"text-xs font-semibold text-stone-800 dark:text-teal-300 font-cairo",children:"المجموع"}),a.jsx("span",{className:"text-sm font-semibold text-stone-800 dark:text-teal-400 font-cairo tabular-nums",children:g>0?`${g} ريال سعودي`:"— ريال سعودي"}),l&&f&&_n.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>u(!1)}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[280px] overflow-y-auto",style:{right:f.right,bottom:f.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"آخر عمليات رُحّلت إلى الكاش:"}),E===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-0.5 mb-1",children:Kr.map(O=>{const U=s[O]??0;return U===0?null:a.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:["فئة ",O,": ",U," × ",O," = ",U*O," ريال"]},O)})}),a.jsxs("p",{className:"border-t border-stone-300 dark:border-white/[0.06] pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",E," ريال سعودي"]})]}),a.jsx("button",{type:"button",onClick:()=>u(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]}),a.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 min-h-0 overflow-hidden gap-3 sm:gap-4",children:[a.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 shrink-0",children:Kr.map(O=>{const U=(t[O]??0)*O;return a.jsxs("div",{className:"flex flex-col items-center gap-2 rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-teal-500/12 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] px-2.5 py-2.5 sm:px-3 sm:py-3 overflow-hidden min-w-[120px]",children:[a.jsxs("span",{className:"text-stone-800 dark:text-teal-400/90 text-xs font-cairo font-semibold tabular-nums w-full text-center",children:["فئة النقد ",O]}),a.jsxs("div",{className:"flex items-center gap-1.5 w-full min-w-0 justify-center",children:[a.jsx("button",{type:"button","aria-label":"نقص واحد",onClick:()=>C(O,Math.max(0,(t[O]??0)-1)),disabled:(t[O]??0)<=0,className:"flex items-center justify-center w-8 h-8 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/[0.06] text-white dark:text-slate-300 hover:bg-red-100 dark:hover:bg-red-500/20 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 disabled:opacity-40 disabled:pointer-events-none transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:a.jsx("span",{className:"text-base font-bold leading-none",children:"−"})}),a.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",value:t[O]===0||t[O]==null?"":String(t[O]),onChange:G=>{const Y=Un(G.target.value).replace(/\D/g,"");C(O,Math.max(0,parseInt(Y,10)||0))},onFocus:G=>{const Y=G.target.value;(Y===""||Number(Y)===0)&&C(O,0)},className:"flex-1 min-w-[2.5rem] max-w-[3.5rem] px-1.5 py-1.5 rounded-md bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/[0.06] text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums cashbox-input focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-teal-500/50 dark:focus:ring-teal-500/16 focus:outline-none"}),a.jsx("button",{type:"button","aria-label":"زد واحد",onClick:()=>C(O,(t[O]??0)+1),className:"flex items-center justify-center w-8 h-8 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/[0.06] text-white dark:text-slate-300 hover:bg-stone-500 dark:hover:bg-emerald-500/20 hover:text-white dark:hover:text-emerald-400 hover:border-stone-600 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:a.jsx("span",{className:"text-base font-bold leading-none",children:"+"})})]}),U>0?a.jsxs("span",{className:"text-stone-800 dark:text-slate-300 text-xs font-semibold font-cairo tabular-nums w-full text-center",children:[U," ريال سعودي"]}):a.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-semibold font-cairo w-full text-center",children:"— ريال سعودي"})]},O)})}),a.jsxs("div",{className:"w-full py-3 px-4 rounded-xl text-sm font-cairo font-semibold bg-stone-200 dark:bg-slate-700/80 border-2 border-stone-400 dark:border-slate-600 text-stone-900 dark:text-slate-200 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[a.jsx("span",{children:"المجموع"}),a.jsx("span",{className:"text-base font-semibold tabular-nums",children:g>0?`${g} ريال سعودي`:"— ريال سعودي"})]}),a.jsxs("div",{className:"flex gap-2 shrink-0",children:[a.jsxs("button",{ref:L,type:"button",onClick:V,disabled:!e||g===0,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل للكاش"]}),a.jsxs("button",{type:"button",onClick:j,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/[0.06] transition-all flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح"]})]})]})]})}const Bg=[{field:"mada",label:"مدى"},{field:"visa",label:"فيزا"},{field:"mastercard",label:"ماستر كارد"},{field:"amex",label:"أ- إكسبريس"}];function $g({onTransfer:n,onTransferToBudget:e,hasActiveRow:t,disableTransferButtons:r=!1}){const[s,o]=I.useState({mada:[],visa:[],mastercard:[],amex:[]}),[l,u]=I.useState({mada:"",visa:"",mastercard:"",amex:""}),[h,f]=I.useState({mada:[],visa:[],mastercard:[],amex:[]}),[m,g]=I.useState([]),[E,C]=I.useState(null),[j,L]=I.useState(!1),V=I.useRef(null),O=I.useRef(null),[U,G]=I.useState(null);I.useLayoutEffect(()=>{if(j){const de=O.current;if(!de){G(null);return}const ge=de.getBoundingClientRect();G({left:ge.right+8,bottom:window.innerHeight-ge.top+8});return}if(E===null){G(null);return}const F=V.current;if(!F){G(null);return}const te=F.getBoundingClientRect();G({left:te.right+8,bottom:window.innerHeight-te.top+8})},[E,j]);const Y=I.useCallback(F=>F.reduce((te,de)=>te+de,0),[]),W=Y(s.mada),ee=Y(s.visa),v=Y(s.mastercard),b=Y(s.amex),y=W+ee+v+b,w=I.useCallback(F=>{const te=Un(l[F]).replace(",",".").replace(/[^\d.]/g,""),de=parseFloat(te)||0;de<=0||(o(ge=>({...ge,[F]:[...ge[F],de]})),u(ge=>({...ge,[F]:""})))},[l]),k=I.useCallback((F,te)=>{o(de=>({...de,[F]:de[F].filter((ge,ce)=>ce!==te)}))},[]),A=I.useCallback((F,te)=>{u(de=>({...de,[F]:te}))},[]),x=I.useCallback(()=>{o({mada:[],visa:[],mastercard:[],amex:[]}),u({mada:"",visa:"",mastercard:"",amex:""})},[]),$=I.useCallback((F,te)=>{if(!t)return;const de=s[F],ge=F==="mada"?W:F==="visa"?ee:F==="mastercard"?v:b;if(ge===0)return;f(ke=>({...ke,[F]:[...ke[F],...de]}));const ce=F==="mada"?[ge,0,0,0]:F==="visa"?[0,ge,0,0]:F==="mastercard"?[0,0,ge,0]:[0,0,0,ge],ve=te?{sourceRect:te,targetField:F}:void 0;n(ce[0],ce[1],ce[2],ce[3],ve),o(ke=>({...ke,[F]:[]})),u(ke=>({...ke,[F]:""}))},[t,W,ee,v,b,n,s]),J=I.useRef(null),ye=I.useCallback(()=>{if(!(!t||y===0))if(e){g(te=>[...te,y]);let F;if(J.current){const te=J.current.getBoundingClientRect();F={x:te.x,y:te.y,width:te.width,height:te.height}}e(y,F),x()}else f(F=>({mada:[...F.mada,...s.mada],visa:[...F.visa,...s.visa],mastercard:[...F.mastercard,...s.mastercard],amex:[...F.amex,...s.amex]})),n(W,ee,v,b),x()},[t,y,W,ee,v,b,n,e,s,x]);return a.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/14 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[a.jsxs("div",{className:"bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-4 py-2 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[a.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide",children:[a.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200",children:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"1"}),a.jsx("path",{d:"M2 10h20M7 14h2"})]})}),"حاسبه العمليات البنكيه"]}),a.jsx("span",{className:"text-xs font-semibold text-slate-700 font-cairo tabular-nums",children:y>0?`${y} ريال`:"—"})]}),a.jsxs("div",{className:"flex-1 flex flex-col p-4 min-h-0 overflow-hidden gap-4",children:[a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 flex-1 min-h-0",children:Bg.map(({field:F,label:te})=>{const de=s[F],ge=Y(de);return a.jsxs("div",{className:"relative flex flex-col rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-teal-500/12 px-3 py-3 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-h-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1 shrink-0",children:[a.jsx("span",{className:"text-stone-800 dark:text-teal-400/90 text-xs font-cairo font-semibold",children:te}),a.jsxs("div",{className:"relative shrink-0",children:[a.jsx("button",{ref:E===F?V:void 0,type:"button",onClick:()=>{L(!1),C(ce=>ce===F?null:F)},className:`p-1.5 rounded-lg transition ${E===F?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:"كل العمليات المرحّلة لهذا النوع","aria-label":"سجل العمليات",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]})}),E===F&&U&&_n.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>{C(null),L(!1)}}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[140px] max-h-[220px] overflow-y-auto",style:{left:U.left,bottom:U.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"كل العمليات المرحّلة إلى الصف:"}),h[F].length===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-0.5 mb-1",children:h[F].map((ce,ve)=>a.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[ce," ريال"]},ve))}),a.jsxs("p",{className:"border-t border-stone-200 dark:border-white/[0.06] pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",Y(h[F])," ريال"]})]}),a.jsx("button",{type:"button",onClick:()=>C(null),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]}),a.jsx("p",{className:"text-[9px] text-stone-500 dark:text-slate-500 font-cairo mb-1.5 shrink-0",children:"أدخل المبلغ ثم +"}),a.jsxs("div",{className:"flex items-center gap-1.5 mb-2 shrink-0",children:[a.jsx("input",{type:"text",inputMode:"decimal",dir:"ltr",placeholder:"مبلغ العملية",value:l[F],onChange:ce=>{const ke=(Un(ce.target.value).replace(",",".").replace(/[^\d.]/g,"").match(/^\d*\.?\d*/)||[""])[0];A(F,ke)},onKeyDown:ce=>{ce.key==="Enter"&&(ce.preventDefault(),w(F))},className:"flex-1 min-w-0 px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/[0.06] text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums placeholder:text-xs placeholder:text-stone-400 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-teal-500/32 dark:focus:ring-teal-500/16 focus:outline-none"}),a.jsx("button",{type:"button","aria-label":`إضافة لـ ${te}`,onClick:()=>w(F),className:"flex items-center justify-center w-8 h-8 rounded-lg bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/[0.06] text-white dark:text-slate-300 hover:bg-stone-500 dark:hover:bg-emerald-500/20 hover:text-white dark:hover:text-emerald-400 hover:border-stone-600 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm",children:a.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})]}),a.jsx("div",{className:"flex-1 min-h-0 overflow-auto space-y-1",children:de.length===0?a.jsx("span",{className:"text-stone-600 dark:text-slate-500 text-[10px] font-cairo",children:"لا عمليات — أضف مبالغ بالزر +"}):de.map((ce,ve)=>a.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-lg bg-white dark:bg-slate-700/50 px-2 py-1 border-2 border-stone-400 dark:border-white/[0.06] shadow-sm",children:[a.jsxs("span",{className:"text-xs font-cairo tabular-nums text-stone-800 dark:text-slate-200",children:[ce," ريال"]}),a.jsx("button",{type:"button",onClick:()=>k(F,ve),"aria-label":"حذف",className:"w-5 h-5 rounded flex items-center justify-center text-stone-600 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-500/20 transition shrink-0",children:a.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},`${F}-${ve}`))}),a.jsxs("div",{className:"pt-2 mt-auto border-t-2 border-stone-400 dark:border-white/[0.06] shrink-0 space-y-2",children:[a.jsxs("span",{className:"text-xs font-semibold font-cairo text-stone-800 dark:text-teal-400 tabular-nums block",children:["المجموع: ",ge>0?`${ge} ريال`:"—"]}),a.jsxs("button",{type:"button",onClick:ce=>{const ve=ce.currentTarget.getBoundingClientRect(),ke={x:ve.x,y:ve.y,width:ve.width,height:ve.height};$(F,ke)},disabled:r||!t||ge===0,title:r?"معطّل — تم جلب القيم من إكسل":`ترحيل ${te} إلى الصف النشط`,className:"w-full py-2 rounded-lg text-xs font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex flex-col items-center justify-center gap-0.5",children:[a.jsxs("span",{className:"flex items-center gap-1.5",children:[a.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل إلى"]}),a.jsx("span",{children:te})]})]})]},F)})}),a.jsxs("div",{className:"w-full py-2.5 px-4 rounded-xl text-xs font-cairo font-semibold bg-stone-200 dark:bg-slate-700/80 border-2 border-stone-400 dark:border-slate-600 text-stone-900 dark:text-slate-200 flex items-center justify-between gap-4 shrink-0 flex-wrap shadow-sm",children:[a.jsxs("span",{className:"tabular-nums",children:["مدى ",a.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:W})]}),a.jsxs("span",{className:"tabular-nums",children:["فيزا ",a.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:ee})]}),a.jsxs("span",{className:"tabular-nums",children:["ماستر ",a.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:v})]}),a.jsxs("span",{className:"tabular-nums",title:"أمريكان إكسبريس",children:["أ- إكسبريس ",a.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:b})]}),a.jsxs("span",{className:"tabular-nums font-bold px-2 py-0.5 rounded-md bg-white/60 dark:bg-slate-600/60 border border-stone-300 dark:border-slate-500",children:["المجموع = ",a.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:y})]})]}),a.jsxs("div",{className:"flex gap-2 shrink-0 items-center",children:[e?a.jsxs("div",{ref:J,className:"flex flex-1 min-w-0 min-h-[56px] rounded-xl overflow-hidden border-2 border-teal-400 dark:border-emerald-500/40 bg-teal-500 dark:bg-emerald-500/20 hover:bg-teal-600 dark:hover:bg-emerald-500/30 disabled:opacity-50 disabled:pointer-events-none transition-all shadow-sm",children:[a.jsxs("button",{type:"button",onClick:ye,disabled:!t||y===0,title:"ترحيل المجموع إلى خانة اجمالى الموازنه في الصف النشط",className:"flex-1 min-w-0 min-h-[52px] py-3 px-3 flex items-center justify-center gap-2 text-sm font-cairo font-medium text-white dark:text-emerald-400 whitespace-nowrap",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الى اجمالى الموازنه"]}),a.jsxs("button",{ref:O,type:"button",onClick:F=>{F.stopPropagation(),C(null),L(te=>!te)},title:"سجل ترحيلات اجمالى الموازنه","aria-label":"سجل ترحيلات اجمالى الموازنه",className:`relative shrink-0 w-10 min-h-[52px] h-full flex items-center justify-center border-s-2 border-teal-400/50 dark:border-emerald-500/40 transition-colors ${j?"bg-teal-600/90 dark:bg-emerald-500/40 text-white":"hover:bg-teal-600/70 dark:hover:bg-emerald-500/30 text-white/90 hover:text-white"}`,children:[a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]}),m.length>0&&a.jsx("span",{className:"absolute top-0.5 end-0.5 min-w-[14px] h-3.5 px-0.5 rounded-full bg-white/90 dark:bg-black/40 text-teal-700 dark:text-emerald-300 text-[9px] font-bold flex items-center justify-center leading-none shadow-sm",children:m.length})]})]}):a.jsxs("button",{ref:J,type:"button",onClick:ye,disabled:!t||y===0,title:"ترحيل مدى + فيزا + ماستر كارد معاً إلى الصف النشط",className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الكل"]}),j&&U&&_n.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>L(!1)}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[220px] overflow-y-auto",style:{left:U.left,bottom:U.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"ترحيلات إلى اجمالى الموازنه:"}),m.length===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-0.5 mb-1",children:m.map((F,te)=>a.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[F.toLocaleString("ar-SA",{minimumFractionDigits:2})," ريال"]},te))}),a.jsxs("p",{className:"border-t border-stone-200 dark:border-white/[0.06] pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",m.reduce((F,te)=>F+te,0).toLocaleString("ar-SA",{minimumFractionDigits:2})," ريال"]})]}),a.jsx("button",{type:"button",onClick:()=>L(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body),a.jsxs("button",{type:"button",onClick:x,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/[0.06] transition-all flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح الكل"]})]})]})]})}const Ug={success:{bg:"bg-emerald-100 dark:bg-emerald-500/15",border:"border-emerald-400 dark:border-emerald-500/40",icon:"text-emerald-700 dark:text-emerald-400"},error:{bg:"bg-red-100 dark:bg-red-500/15",border:"border-red-400 dark:border-red-500/40",icon:"text-red-700 dark:text-red-400"},warning:{bg:"bg-amber-100 dark:bg-amber-500/15",border:"border-amber-400 dark:border-amber-500/40",icon:"text-amber-700 dark:text-amber-400"},info:{bg:"bg-sky-100 dark:bg-sky-500/15",border:"border-sky-400 dark:border-sky-500/40",icon:"text-sky-700 dark:text-sky-400"}},qg={success:a.jsx("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})}),error:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),warning:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 9v4M12 17h.01"}),a.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})]}),info:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 16v-4M12 8h.01"})]})},oc=3e3;function zg({message:n,type:e,onClose:t,position:r="bottom",autoHideMs:s=oc}){const o=I.useRef(t);o.current=t,I.useEffect(()=>{const h=s>0?s:oc,f=setTimeout(()=>o.current(),h);return()=>clearTimeout(f)},[n,s]);const l=Ug[e],u=r==="center"?"fixed top-1/2 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2":"fixed bottom-6 left-1/2 z-50 -translate-x-1/2";return a.jsxs("div",{role:"alert",className:`${u} flex items-center gap-3 px-4 py-3 rounded-2xl border ${l.bg} ${l.border} shadow-xl shadow-black/10 dark:shadow-black/20 backdrop-blur-md min-w-[200px] max-w-[90vw]`,children:[a.jsx("span",{className:l.icon,"aria-hidden":"true",children:qg[e]}),a.jsx("span",{className:"font-cairo text-sm text-stone-800 dark:text-slate-200 flex-1",children:n}),a.jsx("button",{type:"button",onClick:t,className:"p-1 rounded-lg text-stone-600 dark:text-slate-400 hover:text-stone-900 dark:hover:text-slate-200 hover:bg-stone-300 dark:hover:bg-white/10 transition focus-visible:ring-2 focus-visible:ring-teal-400 dark:focus-visible:ring-amber-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none","aria-label":"إغلاق",children:a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})}const Wg=550;function Hg({sourceRect:n,targetRect:e,amount:t,formatCurrency:r,rowId:s,field:o,onEnd:l,onLanded:u}){const[h,f]=I.useState("start"),m=I.useRef(e);m.current=e;const g=I.useRef(u);g.current=u,I.useEffect(()=>{if(h!=="start")return;const V=requestAnimationFrame(()=>f("fly"));return()=>cancelAnimationFrame(V)},[h]),I.useEffect(()=>{var O;if(h!=="done")return;(O=g.current)==null||O.call(g,s,o);const V=setTimeout(l,120);return()=>clearTimeout(V)},[h,l,s,o]);const E=()=>{f("done")},C=h==="start"?n.x:m.current.x,j=h==="start"?n.y:m.current.y,L=a.jsx("div",{role:"presentation","aria-hidden":!0,className:"transfer-fly-badge pointer-events-none fixed z-[9999] flex items-center justify-center rounded-xl border-2 border-teal-500 dark:border-teal-500/80 bg-teal-500/95 dark:bg-teal-500/90 text-white font-cairo font-bold text-sm tabular-nums shadow-lg px-3 py-2 min-w-[72px]",style:{left:n.x,top:n.y,width:Math.max(72,n.width),height:n.height,transform:`translate(${C-n.x}px, ${j-n.y}px)`,transition:h==="fly"?`transform ${Wg}ms cubic-bezier(0.25, 0.1, 0.25, 1)`:"none"},onTransitionEnd:E,children:a.jsx("span",{className:"opacity-95",children:r(t)})});return _n.createPortal(L,document.body)}const so=4,ac=5;function Gg(n,e){const[t,r]=I.useState([]),[s,o]=I.useState([]),[l,u]=I.useState(1),[h,f]=I.useState(!0),[m,g]=I.useState(!1),E=I.useRef({}),C=I.useRef({}),j=I.useRef(new Map),L=t.length>0||s.length>0?[...t.sort((W,ee)=>new Date(ee.createdAt).getTime()-new Date(W.createdAt).getTime()),...s].sort((W,ee)=>W.status!=="closed"&&ee.status==="closed"?-1:W.status==="closed"&&ee.status!=="closed"?1:W.status==="closed"&&ee.status==="closed"?new Date((ee.closedAt??"").toString()).getTime()-new Date((W.closedAt??"").toString()).getTime():new Date(ee.createdAt).getTime()-new Date(W.createdAt).getTime()):[],V=I.useCallback(async(W,ee=!1)=>{const v=j.current.get(W);if(v&&!ee)return o(v.rows),g(v.hasMore),v;const b=W===1?so:ac;let y=null;if(W>1){const k=j.current.get(W-1);y=(k==null?void 0:k.lastDoc)??null}const w=await Qs(e,b,y);return j.current.set(W,w),o(w.rows),g(w.hasMore),w},[e]),O=I.useCallback(async W=>{var b;if(W<1)return;f(!0);const ee=j.current.get(W-1);if(W>1&&!ee)for(let y=1;y<W;y++){const w=y===1?so:ac,k=y===1?null:((b=j.current.get(y-1))==null?void 0:b.lastDoc)??null,A=await Qs(e,w,k);if(j.current.set(y,A),!A.hasMore&&y<W-1)break}await V(W),u(W),f(!1)},[e,V]),U=I.useCallback(async()=>{f(!0);const W=Os(e);r(W),j.current.clear(),u(1);const ee=await V(1,!0);[...W,...(ee==null?void 0:ee.rows)??[]].forEach(b=>{C.current[b.id]=b}),f(!1)},[e,V]),G=I.useRef([]);G.current=L;const Y=I.useCallback(W=>{const ee=typeof W=="function"?W(G.current):W,v=ee.filter(y=>y.status!=="closed"),b=ee.filter(y=>y.status==="closed");r(v),o(b),ee.forEach(y=>{C.current[y.id]=y})},[]);return I.useEffect(()=>{let W=!1;return(async()=>{if(Os(e).length===0&&ad(e,n),W)return;f(!0),r(Os(e)),j.current.clear(),u(1);const v=await Qs(e,so);if(W)return;j.current.set(1,v),o(v.rows),g(v.hasMore),[...Os(e),...v.rows].forEach(y=>{C.current[y.id]=y}),f(!1)})(),()=>{W=!0,Object.values(E.current).forEach(clearTimeout),E.current={}}},[n,e]),{rows:L,setRows:Y,loadRows:U,loading:h,debounceRef:E,rowDataRef:C,currentClosedPage:l,setCurrentClosedPage:u,goToClosedPage:O,hasMoreClosedPages:m,closedPagesCache:j.current}}function Kg(){const[n,e]=I.useState(()=>new Date),[t,r]=I.useState(null),[s,o]=I.useState(null),[l,u]=I.useState(0);return I.useEffect(()=>{const h=setInterval(()=>{const f=Date.now();e(new Date(f)),s!==null&&u(Math.max(0,Math.ceil((s-f)/1e3)))},1e3);return()=>clearInterval(h)},[s]),{liveNow:n,closingRowId:t,setClosingRowId:r,closingEndsAt:s,setClosingEndsAt:o,closingSecondsLeft:l,setClosingSecondsLeft:u}}function Qg(n,e){const[t,r]=I.useState(null),[s,o]=I.useState(null),l=I.useRef({}),u=I.useRef(null),h=I.useRef(null);h.current=(t==null?void 0:t.rowId)??null;const f=I.useCallback(m=>{var G;if(h.current===m)return;l.current={},o(null);const g=n.find(Y=>Y.id===m)??e.current[m],E=(g==null?void 0:g.expenses)??0;let C=(G=g==null?void 0:g.expenseItems)!=null&&G.length?g.expenseItems.map(Y=>({amount:String(Y.amount),description:Y.description||""})):[{amount:E?String(E):"",description:""}];const j=Y=>(Number(Y.amount)||0)!==0||String(Y.description||"").trim()!=="",L=(g==null?void 0:g.carriedExpenseCount)??0,V=C.slice(0,L).filter(j).length;C=C.filter(j);let O=V;const U=(g==null?void 0:g.status)==="closed";if(!U&&C.length>0){const Y=C[C.length-1];if(String(Y.amount||"").trim()!==""||String(Y.description||"").trim()!==""){const W=C.reduce((b,y)=>b+(Number(y.amount)||0),0),ee=E-W,v=ee>0?String(ee):"";C=[...C,{amount:v,description:""}]}}!U&&C.length===0&&(C=[{amount:E?String(E):"",description:""}]),r({rowId:m,items:C,readOnly:U,carriedCount:O})},[n,e]);return I.useEffect(()=>{t||(u.current=null)},[t]),I.useEffect(()=>{if(s===null)return;const m=setTimeout(()=>o(null),3e3);return()=>clearTimeout(m)},[s]),{expenseModal:t,setExpenseModal:r,pulseExpenseDescriptionIndex:s,setPulseExpenseDescriptionIndex:o,openExpenseDetails:f,expenseAmountRef:l,expenseModalFocusedRowIdRef:u}}const fd="cashbox_theme",lc="cashbox-theme-pink-vars",ur=typeof document<"u"?document.documentElement:null,io=typeof document<"u"?document.body:null,Yg=["light","dark","dark-pink"],Jg={"--tw-teal-50":"253 245 250","--tw-teal-100":"252 235 245","--tw-teal-200":"250 212 235","--tw-teal-300":"248 195 222","--tw-teal-400":"243 175 210","--tw-teal-500":"238 160 200","--tw-teal-600":"220 135 180","--tw-teal-700":"195 110 158","--tw-teal-800":"168 88 135","--tw-teal-900":"140 70 112","--tw-emerald-50":"253 245 250","--tw-emerald-100":"252 235 245","--tw-emerald-200":"250 212 235","--tw-emerald-300":"248 195 222","--tw-emerald-400":"243 175 210","--tw-emerald-500":"238 160 200","--tw-emerald-600":"220 135 180","--tw-emerald-700":"195 110 158","--tw-emerald-800":"168 88 135","--tw-emerald-900":"140 70 112"};function cc(){return`:root, html, .theme-pink.dark, .theme-pink.dark * { ${Object.entries(Jg).map(([e,t])=>`${e}: ${t} !important`).join(" ")} }`}function Xg(n){if(typeof document>"u")return;const e=document.getElementById(lc);if(n)if(e&&e instanceof HTMLStyleElement)e.textContent=cc();else{const t=document.createElement("style");t.id=lc,t.textContent=cc(),document.head.appendChild(t)}else e&&e.remove()}function md(){try{if(typeof localStorage>"u")return"dark";const n=localStorage.getItem(fd);return Yg.includes(n)?n:"dark"}catch{return"dark"}}function jo(n){if(!ur)return;const e=n==="dark"||n==="dark-pink",t=n==="dark-pink";ur.classList.toggle("dark",e),ur.classList.toggle("theme-pink",t),ur.setAttribute("data-theme",t?"pink":""),Xg(t),io&&(io.classList.toggle("dark",e),io.classList.toggle("theme-pink",t));try{localStorage.setItem(fd,n)}catch{}ur.offsetHeight}function Zg(n){try{window.dispatchEvent(new CustomEvent("cashbox-theme-change",{detail:n}))}catch{}}function pd(){if(!ur)return;const n=md(),e=n==="light"?"dark":n==="dark"?"dark-pink":"light";jo(e),Zg(e)}const $s=10,ex=2;function oo(){return"ayman5255"}const tx=[{id:"today",label:"اليوم"},{id:"yesterday",label:"أمس"},{id:"lastWeek",label:"الأسبوع الماضي"}],Ur={corniche:"الكورنيش",andalusia:"الأندلس"};function uc(){pd()}function nx({name:n,branch:e,onExit:t,onSwitchBranch:r,theme:s,onToggleTheme:o}){const l=I.useRef(null),[u,h]=I.useState(null),{rows:f,setRows:m,loadRows:g,debounceRef:E,rowDataRef:C,currentClosedPage:j,goToClosedPage:L,hasMoreClosedPages:V}=Gg(n,e),{liveNow:O,closingRowId:U,setClosingRowId:G,setClosingEndsAt:Y,closingSecondsLeft:W,setClosingSecondsLeft:ee}=Kg(),[v,b]=I.useState("today"),[y,w]=I.useState(null),[k,A]=I.useState(null),[x,$]=I.useState(null),[J,ye]=I.useState(new Set),[F,te]=I.useState(null),[de,ge]=I.useState(null),[ce,ve]=I.useState(null),[ke,Se]=I.useState(""),[je,rt]=I.useState(!1),[pt,Ie]=I.useState(!1),[wt,It]=I.useState(null),[Qt,Xe]=I.useState(null),[gt,xt]=I.useState(0),Z=I.useRef(null),[We,Pe]=I.useState(null),[Le,Re]=I.useState([]),[Ve,Lt]=I.useState(null),[An,rn]=I.useState(!1),[sn,vt]=I.useState(null),[Ee,bt]=I.useState(null),[At,Cn]=I.useState(""),[on,Qn]=I.useState(null),[ct,Yt]=I.useState(null);I.useEffect(()=>{const _=l.current;if(!_)return;const T=R=>{R.preventDefault(),R.stopPropagation(),R.stopImmediatePropagation(),uc()};return _.addEventListener("click",T,!0),()=>_.removeEventListener("click",T,!0)},[]),I.useEffect(()=>{(Ee==null?void 0:Ee.mode)==="edit"&&Cn(Ee.row.notes??"")},[Ee==null?void 0:Ee.row.id,Ee==null?void 0:Ee.mode]);const{expenseModal:_e,setExpenseModal:Ct,pulseExpenseDescriptionIndex:Ot,setPulseExpenseDescriptionIndex:Rr,openExpenseDetails:Yn,expenseAmountRef:ut,expenseModalFocusedRowIdRef:an}=Qg(f,C);I.useEffect(()=>{if(U===null||W>0)return;const _=U,T=f.find(R=>R.id===_);if(!T||T.status==="closed"){G(null),Y(null);return}G(null),Y(null),(async()=>{try{const R=E.current[_];R&&(clearTimeout(R),delete E.current[_],Pt(e,_,T));const M=rg(e,_),B=M?{...M,...T,id:_,status:"active"}:T,K=Bs(B);await sg(e,_,{...B,employeeName:n,variance:K});const Q=B.expenses??0,ae=B.expenseCompensation??0,ie=Math.max(0,Q-ae),ne=B.expenseItems??[],Be=ae>0?ie>0?[{amount:ie,description:"مرحّل (صافي بعد التعويض)"}]:[]:ne.map(Te=>({amount:Te.amount,description:Te.description||""}));ad(e,n,{expenses:ie,expenseItems:Be,carriedExpenseCount:Be.length}),await g(),w({msg:"تم إغلاق الشفت وإضافة صف جديد",type:"success"}),xt(Te=>Te+1)}catch{w({msg:"فشل ترحيل الصف المغلَق إلى السحابة — تحقق من الاتصال",type:"error"})}})()},[W,U,f,n,g,e]);const Nt=I.useMemo(()=>{const _=f.filter(R=>R.status!=="closed").sort((R,M)=>new Date(M.createdAt).getTime()-new Date(R.createdAt).getTime()),T=nc(f.filter(R=>R.status==="closed"),v).sort((R,M)=>new Date((M.closedAt??"").toString()).getTime()-new Date((R.closedAt??"").toString()).getTime());return v==="today"?[..._,...T]:T},[f,v]),He=Nt,se=I.useMemo(()=>{var _;return((_=Nt.find(T=>T.status!=="closed"))==null?void 0:_.id)??null},[Nt]);I.useMemo(()=>{const _=f.filter(T=>T.status==="closed"&&T.closedAt);return _.length===0?null:_.sort((T,R)=>new Date((R.closedAt??"").toString()).getTime()-new Date((T.closedAt??"").toString()).getTime())[0]??null},[f]);const dt=I.useMemo(()=>f.find(_=>_.status!=="closed")??null,[f]),Ft=I.useMemo(()=>{if(!dt)return!1;const _=dt.cash??0,T=dt.programBalanceCash??0,R=dt.programBalanceBank??0;return _>0&&T>0&&R>0},[dt]),Vi=I.useCallback(async _=>{var lt;const T=(lt=_.target.files)==null?void 0:lt[0];if(_.target.value="",!T)return;const R=dt;if(!R){w({msg:"لا يوجد صف نشط لملء البيانات",type:"warning"});return}let M;try{M=await T.arrayBuffer()}catch{w({msg:"تعذر قراءة الملف",type:"error"});return}const B=new Date(0),{sums:K,counts:Q,details:ae,employeeName:ie,employeeNamesList:ne,error:oe}=Cg(M,B);if(oe){w({msg:oe,type:"error"});return}Pe(ae),Re(ne??[]);const Be=E.current[R.id];Be&&(clearTimeout(Be),delete E.current[R.id],Pt(e,R.id,C.current[R.id]??R));const Te=C.current[R.id]??R,Ze={mada:K.mada,visa:K.visa,mastercard:K.mastercard,amex:K.amex,bankTransfer:K.bankTransfer},yt=K.mada+K.visa+K.mastercard+K.amex,ht=ie&&ie.trim()!==""?ie.trim():Te.employeeName,jt={...Te,...Ze,employeeName:ht,variance:Bs({...Te,...Ze})};Pt(e,R.id,jt),C.current[R.id]=jt,m(tr=>tr.map(cn=>cn.id===R.id?jt:cn)),g();const ft=[];Q.mada>0&&ft.push(`مدى ${q(K.mada)}`),Q.visa>0&&ft.push(`فيزا ${q(K.visa)}`),Q.mastercard>0&&ft.push(`ماستر كارد ${q(K.mastercard)}`),Q.amex>0&&ft.push(`أمريكان إكسبريس ${q(K.amex)}`),Q.bankTransfer>0&&ft.push(`تحويل بنكي ${q(K.bankTransfer)}`);const jn=ft.length>0?ft.join(" — ")+` — المجموع: ${q(yt)}`:"";w({msg:yt>0?`تم استخراج: ${jn}`:"لم يُعثر على مدى/فيزا/ماستر كارد/أمريكان إكسبريس/تحويل بنكي في الملف",type:yt>0?"success":"info"})},[dt,g]),Di=I.useCallback(()=>{var _;(_=Z.current)==null||_.click()},[]),ln=I.useCallback(_=>{const T=E.current[_];T&&(clearTimeout(T),delete E.current[_]);const R=f.find(Q=>Q.id===_),M=(R==null?void 0:R.carriedExpenseCount)??0,B=((R==null?void 0:R.expenseItems)??[]).slice(0,M),K=B.reduce((Q,ae)=>Q+ae.amount,0);if(Pt(e,_,{expenses:K,expenseItems:B}),R){const Q={...R,expenses:K,expenseItems:B,variance:Bs({...R})};C.current[_]=Q,m(ae=>ae.map(ie=>ie.id!==_?ie:Q))}g(),ut.current={}},[f,g]),ms=I.useCallback((_,T,R)=>{Ct(M=>M?{...M,items:M.items.map((B,K)=>K===_?{...B,[T]:String(R)}:B)}:null)},[]),Mi=I.useCallback(()=>{ut.current={},Ct(_=>_?{..._,items:[..._.items,{amount:"",description:""}]}:null)},[]),Jn=I.useCallback(_=>{Ct(T=>{if(!T)return T;const R=T.carriedCount??0;return _<R||T.items.length<=1?T:(ut.current={},{...T,items:T.items.filter((M,B)=>B!==_)})})},[]),ps=I.useCallback((_,T)=>{Se(""),Ie(!1),ve({rowId:_,itemIndex:T,step:"confirm"})},[]),gs=I.useCallback(()=>{ce&&ve(_=>_?{..._,step:"code"}:null)},[ce]),Xn=I.useCallback(()=>{if(!ce)return;if(ke.trim()!==oo()){Ie(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ie(!1);const{rowId:_,itemIndex:T}=ce,R=f.find(ie=>ie.id===_)??C.current[_];if(!R){ve(null),Se("");return}const M=(R.expenseItems??[]).slice(),B=R.carriedExpenseCount??0;if(T>=M.length||T>=B){ve(null),Se("");return}M.splice(T,1);const K=Math.max(0,B-1),Q=M.reduce((ie,ne)=>ie+ne.amount,0);Pt(e,_,{expenseItems:M,expenses:Q,carriedExpenseCount:K});const ae={...R,expenseItems:M,expenses:Q,carriedExpenseCount:K};C.current[_]=ae,m(ie=>ie.map(ne=>ne.id===_?ae:ne)),Ct(ie=>{if(!ie||ie.rowId!==_)return ie;const ne=ie.items.filter((oe,Be)=>Be!==T);return{...ie,items:ne,carriedCount:K}}),ut.current={},g(),ve(null),Se(""),rt(!1),w({msg:"تم حذف البند المرحّل",type:"success"})},[ce,ke,f,g,Pt]),Rt=I.useCallback(()=>{if(!_e)return;const _=_e.rowId,T=_e.carriedCount??0,R=_e.items.map((Q,ae)=>{const ie=ut.current[ae]!==void 0?ut.current[ae]:String(Q.amount??"");return{amount:Number(String(ie).replace(/,/g,""))||0,description:String(Q.description||"").trim(),index:ae}}),M=R.find(Q=>Q.index>=T&&Q.amount>0&&!Q.description);if(M){w({msg:"يجب إدخال وصف لكل بند فيه مبلغ",type:"warning"}),Rr(M.index);return}const B=R.map(({amount:Q,description:ae})=>({amount:Q,description:ae})),K=B.reduce((Q,ae)=>Q+ae.amount,0);Pt(e,_,{expenseItems:B,expenses:K}),Ct(null),g(),requestAnimationFrame(()=>{setTimeout(()=>{const Q=document.querySelectorAll(`tr[data-row-id="${_}"] input.cashbox-input`);let ae=Q[5]??Q[0];for(let ie=5;ie<Q.length;ie++)if(!Q[ie].disabled){ae=Q[ie];break}ae==null||ae.focus()},0)})},[_e,g,Pt]),Li=I.useCallback(()=>{w({msg:"يجب إدخال رصيد البرنامج كاش أولاً",type:"warning"})},[]),Bt=I.useCallback(_=>{w({msg:`تعويض المصروفات يجب ألا يتخطى مبلغ المصروفات (المصروفات: ${q(_)})`,type:"warning"})},[]),Sr=I.useCallback(_=>{const T=f.find(M=>M.id===_);if(!T||T.status==="closed")return;const R={cash:0,sentToTreasury:0,expenseCompensation:0,expenses:0,expenseItems:[],carriedExpenseCount:0,mada:0,visa:0,mastercard:0,amex:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0};Pt(e,_,R),_n.flushSync(()=>{m(M=>{const B=M.map(Q=>Q.id!==_?Q:{...Q,...R}),K=B.find(Q=>Q.id===_);return K&&(C.current[_]=K),B})}),g(),Qn(null),xt(M=>M+1),w({msg:"تم إفراغ كل المدخلات في الصف النشط ومسح سجلات الحاسبات",type:"success"})},[f,g]),xs=I.useCallback(()=>{on&&Sr(on)},[on,Sr]),jr=I.useCallback(()=>{Qn(null)},[]),De=I.useCallback((_,T,R)=>{const M=f.find(ae=>ae.id===_);if(!M||M.status==="closed")return;const B={[T]:R};if(T==="expenses"&&typeof R=="number"){const ae=M.expenseCompensation??0;R<ae&&(B.expenseCompensation=R)}if(rx.includes(T)){const ae={...M,...B};B.variance=Bs(ae)}const Q=E.current[_];Q&&clearTimeout(Q),E.current[_]=setTimeout(()=>{const ae=C.current[_];ae&&Pt(e,_,ae),g()},400),_n.flushSync(()=>{m(ae=>{const ie=ae.map(oe=>oe.id!==_?oe:{...oe,...B}),ne=ie.find(oe=>oe.id===_);return ne&&(C.current[_]=ne),ie})})},[f,g]),bs=I.useCallback(_=>{const T=f.find(B=>B.id===_);if(!T||T.status!=="active")return;const R=Js(T),M=Ys(T);if(R!==0||M!==0){Xe({rowId:_,cashVar:R,bankVar:M});return}w({msg:"الصندوق مظبوط — تم عمل جيد ✓",type:"success"}),G(_),Y(Date.now()+$s*1e3),ee($s)},[f]),Oi=I.useCallback(()=>{if(!Qt)return;const{rowId:_}=Qt;Xe(null),G(_),Y(Date.now()+$s*1e3),ee($s)},[Qt]),ys=I.useCallback(()=>{Xe(null)},[]),Fi=I.useCallback(()=>{G(null),Y(null),ee(0),w({msg:"تم التراجع — يمكنك تعديل الصف",type:"info"})},[]),St=I.useCallback((_,T,R)=>{if(_.length===0){w({msg:"لا توجد تقفيلات للطباعة",type:"warning"});return}const M=window.open("","_blank","width=800,height=900");if(!M){w({msg:"السماح بالنوافذ المنبثقة للطباعة",type:"warning"});return}const{firstActiveId:B,currentUserName:K,branchLabel:Q}=R??{},ae=Q?`<p class="page-branch">فرع ${Q.replace(/&/g,"&amp;").replace(/</g,"&lt;")}</p>`:"",ie=hd.join("، "),ne=_.map((oe,Be)=>{const Ze=((oe.status==="closed"?oe.employeeName:B&&oe.id===B&&K?K:oe.employeeName)??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),yt=oe.mada+oe.visa+oe.mastercard+(oe.amex??0),ht=Ys(oe),jt=Js(oe),ft=oe.expenses??0,jn=oe.expenseCompensation??0,lt=oe.sentToTreasury??0,tr=oe.expenseItems??[],cn=jt>0?"variance pos":jt<0?"variance neg":"variance",nr=ht>0?"variance pos":ht<0?"variance neg":"variance",Ts=tr.length>0?`<div class="block expenses-detail">
                  <div class="block-title">تفاصيل المصروفات</div>
                  <div class="block-body">${tr.map(sr=>`<div class="expense-item">${q(sr.amount)} — ${(sr.description||"—").replace(/</g,"&lt;")}</div>`).join("")}</div>
                </div>`:"",Pn=`<div class="block notes-block"><div class="block-title">ملاحظات الشيفت</div><div class="block-body">${(oe.notes||"").trim().length>0?(oe.notes||"").replace(/</g,"&lt;").replace(/\n/g,"<br>"):"— لا توجد —"}</div></div>`,Lr=(Be>0?"page-break-before: always;":"")+(Be<_.length-1?"page-break-after: always;":"");return`
            <div class="page" ${Lr?`style="${Lr}"`:""}>
              <header class="page-header">
                <h1 class="page-title">تقرير تقفيلة</h1>
                ${ae}
                <p class="page-sub">${Ze}</p>
                <p class="page-time">${oe.closedAt?mi(oe.closedAt):"—"}</p>
              </header>
              <div class="page-main">
              <div class="grid">
                <div class="block cash-block">
                  <div class="block-title">الكاش</div>
                  <div class="block-body">
                    <div class="row"><span class="label">كاش</span><span class="val">${q(oe.cash)}</span></div>
                    <div class="row"><span class="label">مرسل للخزنة</span><span class="val">${q(lt)}</span></div>
                    <div class="row"><span class="label">المصروفات</span><span class="val">${q(ft)}</span></div>
                    <div class="row"><span class="label">تعويض مصروفات</span><span class="val">${q(jn)}</span></div>
                    <div class="row"><span class="label">رصيد البرنامج كاش</span><span class="val">${q(oe.programBalanceCash)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف الكاش</span><span class="val ${cn}">${q(jt)}</span></div>
                  </div>
                </div>
                <div class="block bank-block">
                  <div class="block-title">البنك</div>
                  <div class="block-body">
                    <div class="row"><span class="label">مدى</span><span class="val">${q(oe.mada)}</span></div>
                    <div class="row"><span class="label">فيزا</span><span class="val">${q(oe.visa)}</span></div>
                    <div class="row"><span class="label">ماستر كارد</span><span class="val">${q(oe.mastercard)}</span></div>
                    <div class="row"><span class="label">أمريكان إكسبريس</span><span class="val">${q(oe.amex??0)}</span></div>
                    <div class="row"><span class="label">تحويل بنكي</span><span class="val">${q(oe.bankTransfer)}</span></div>
                    <div class="row"><span class="label">بنك نزيل (مدى+فيزا+ماستر+أمريكان إكسبريس)</span><span class="val total">${q(yt)}</span></div>
                    <div class="row"><span class="label">اجمالى الموازنه</span><span class="val">${q(oe.programBalanceBank??0)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف البنك</span><span class="val ${nr}">${q(ht)}</span></div>
                  </div>
                </div>
              </div>
              ${Ts}
              ${Pn}
              </div>
              <footer class="page-footer">
                <p class="footer-formulas">فئات الكاش (ريال): ${ie}. — بنك نزيل = مدى + فيزا + ماستر كارد + أمريكان إكسبريس (تحويل بنكي للعرض فقط) — انحراف البنك = بنك نزيل − اجمالى الموازنه — انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش</p>
                <p>${Q?`فرع ${Q} — `:""}تاريخ الطباعة: ${mi(new Date)} ${_.length>1?` — تقفيلة ${Be+1} من ${_.length}`:""}</p>
              </footer>
            </div>`}).join("");M.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
          <head>
            <meta charset="utf-8">
            <title>${Q?`${T} — فرع ${Q}`:T}</title>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
            <style>
              * { box-sizing: border-box; margin: 0; padding: 0; }
              @page { size: A4 portrait; margin: 12mm; }
              html, body {
                font-family: 'Cairo', sans-serif;
                background: #fff;
                color: #1e293b;
                font-size: 13px;
                line-height: 1.4;
                padding: 0;
                margin: 0;
                height: auto;
              }
              @media print {
                html, body {
                  padding: 0 !important;
                  margin: 0 !important;
                  height: auto !important;
                  min-height: unset !important;
                  overflow: visible !important;
                  background: #fff;
                  font-size: 12px !important;
                  line-height: 1.45 !important;
                }
                .page {
                  box-shadow: none !important;
                  margin: 0 auto !important;
                  min-height: 273mm !important;
                  height: 273mm !important;
                  max-height: 273mm !important;
                  page-break-inside: avoid;
                  display: flex !important;
                  flex-direction: column !important;
                  justify-content: space-between !important;
                }
                .page:last-child { page-break-after: avoid !important; }
                .page-main { flex: 1 1 auto; display: flex; flex-direction: column; justify-content: flex-start; min-height: 0; }
              }
              .page {
                width: 100%;
                max-width: 186mm;
                margin: 0 auto 12px;
                padding: 10px 12px 14px;
                background: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                min-height: 273mm;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
              }
              .page-main { flex: 1 1 auto; min-height: 0; }
              .page-header {
                text-align: center;
                padding: 14px 0 12px;
                border-bottom: 2px solid #0f172a;
                margin-bottom: 14px;
              }
              .page-title {
                font-size: 1.5rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 4px;
              }
              .page-sub {
                font-size: 1.15rem;
                font-weight: 600;
                color: #334155;
                margin-bottom: 3px;
              }
              .page-time {
                font-size: 1rem;
                color: #64748b;
              }
              .page-branch {
                font-size: 1.05rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 4px;
              }
              .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
                margin-bottom: 14px;
              }
              .block {
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                overflow: hidden;
              }
              .block-title {
                background: #f1f5f9;
                padding: 10px 12px;
                font-weight: 700;
                font-size: 1rem;
                color: #334155;
                border-bottom: 1px solid #e2e8f0;
              }
              .block-body {
                padding: 10px 12px;
                background: #fff;
              }
              .block .row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid #f1f5f9;
                font-size: 0.95rem;
              }
              .block .row:last-child { border-bottom: none; }
              .block .row.highlight { font-weight: 700; background: #f8fafc; margin: 4px -12px -4px; padding: 8px 12px; }
              .block .row.variance-row {
                margin: 8px -12px -4px;
                padding: 10px 12px;
                background: #f1f5f9;
                border-top: 1px solid #cbd5e1;
                font-size: 1.05rem;
              }
              .block .row.variance-row .label {
                font-size: 1.05rem;
                font-weight: 800;
                color: #0f172a;
              }
              .block .row.variance-row .val { font-size: 1.05rem; font-weight: 800; }
              .block .label { color: #475569; font-size: 0.95rem; }
              .block .val {
                font-variant-numeric: tabular-nums;
                font-weight: 500;
                color: #0f172a;
                font-size: 0.95rem;
              }
              .block .val.total { font-weight: 700; }
              .block .val.variance.pos { color: #059669; }
              .block .val.variance.neg { color: #dc2626; }
              .expenses-detail, .notes-block {
                margin-top: 12px;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                overflow: hidden;
              }
              .expenses-detail .block-title, .notes-block .block-title {
                padding: 8px 12px;
                font-size: 0.95rem;
              }
              .expenses-detail .block-body, .notes-block .block-body {
                padding: 8px 12px;
              }
              .expense-item {
                padding: 6px 12px;
                font-size: 0.9rem;
                border-bottom: 1px solid #f1f5f9;
              }
              .expense-item:last-child { border-bottom: none; }
              .page-footer {
                margin-top: 14px;
                padding-top: 12px;
                border-top: 1px solid #e2e8f0;
                font-size: 0.85rem;
                color: #64748b;
                text-align: center;
                flex-shrink: 0;
              }
              .page-footer .footer-formulas {
                font-size: 0.75rem;
                color: #94a3b8;
                margin-bottom: 6px;
                line-height: 1.4;
              }
            </style>
          </head>
          <body>
            ${ne}
            <script>setTimeout(function(){ window.print(); window.close(); }, 350);<\/script>
          </body>
        </html>
      `),M.document.close()},[]),_s=I.useCallback(async()=>{const T=await sd(e,v==="today"?50:v==="yesterday"?100:200),R=nc(T,v);St(R,`تقرير التقفيلات — ${v==="today"?"اليوم":v==="yesterday"?"أمس":"الأسبوع الماضي"}`,{firstActiveId:se,currentUserName:n,branchLabel:Ur[e]})},[v,St,se,n,e]),Pr=I.useCallback(_=>{ye(T=>{const R=new Set(T);return R.has(_)?R.delete(_):R.add(_),R})},[]),Nn=I.useCallback(()=>{if(J.size===0){w({msg:"لم تحدد أي صفوف للطباعة",type:"warning"});return}const _=Nt.filter(T=>J.has(T.id));St(_,"طباعة الصفوف المحددة",{firstActiveId:se,currentUserName:n,branchLabel:Ur[e]})},[J,Nt,St,se,n,e]),Jt=I.useCallback(_=>{const T=Nt.find(R=>R.id===_);T&&St([T],"طباعة تقفيلة",{firstActiveId:se,currentUserName:n,branchLabel:Ur[e]})},[Nt,St,se,n,e]),Vr=I.useCallback(_=>{Se(""),Ie(!1),te({rowId:_,step:"confirm"})},[]),Bi=I.useCallback(()=>{F&&te(_=>_?{..._,step:"code"}:null)},[F]),Dr=I.useCallback(async()=>{if(!F)return;if(ke.trim()!==oo()){Ie(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ie(!1);const _=f.find(R=>R.id===F.rowId),T=(_==null?void 0:_.status)==="closed";await ig(e,F.rowId,T),ye(R=>{const M=new Set(R);return M.delete(F.rowId),M}),await g(),te(null),Se(""),rt(!1),w({msg:"تم حذف الصف",type:"success"})},[F,ke,g,e,f]),ws=I.useCallback(()=>{Se(""),Ie(!1),ge({step:"confirm"})},[]),vs=I.useCallback(()=>{de&&ge(_=>_?{..._,step:"code"}:null)},[de]),Zn=I.useCallback(async()=>{if(de){if(ke.trim()!==oo()){Ie(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ie(!1),await og(e),ye(new Set),await g(),ge(null),Se(""),rt(!1),w({msg:"تم حذف كل التقفيلات المغلقة",type:"success"})}},[de,ke,g,e]),Xt=_=>_==="cash"?"الكاش":_==="programBalanceBank"?"اجمالى الموازنه":_==="mada"?"مدى":_==="visa"?"فيزا":_==="mastercard"?"ماستر كارد":_==="amex"?"أمريكان إكسبريس":"تحويل بنكي",at=I.useCallback((_,T)=>{const R=document.querySelector(`[data-transfer-target][data-field="${T}"][data-row-id="${_}"]`);if(!R)return null;const M=R.getBoundingClientRect();return{x:M.x,y:M.y,width:M.width,height:M.height}},[]),ks=I.useCallback((_,T)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل الكاش إليه",type:"warning"});return}const R=f.find(B=>B.id===se),M=(R==null?void 0:R.cash)??0;if(M>0){A({amount:_,currentValue:M,field:"cash"});return}if(T){const B=at(se,"cash");B&&It({sourceRect:{...T},targetRect:{...B},amount:_,rowId:se,field:"cash"})}De(se,"cash",_),w({msg:`تم ترحيل ${q(_)} إلى خانة الكاش`,type:"success"})},[se,f,De,at]),Es=I.useCallback((_,T)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const R=f.find(B=>B.id===se);if(!R)return;const M=R.programBalanceBank??0;if(T){const B=at(se,"programBalanceBank");B&&It({sourceRect:{...T},targetRect:{...B},amount:_,rowId:se,field:"programBalanceBank"})}De(se,"programBalanceBank",M+_),w({msg:`تم ترحيل ${q(_)} إلى اجمالى الموازنه`,type:"success"})},[se,f,De,at]),$i=I.useCallback((_,T,R,M,B)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل العمليات البنكية إليه",type:"warning"});return}const K=f.find(Ze=>Ze.id===se);if(!K)return;const Q=K.mada??0,ae=K.visa??0,ie=K.mastercard??0,ne=K.amex??0;if(Q>0&&_>0||ae>0&&T>0||ie>0&&R>0||ne>0&&M>0){$({mada:_,visa:T,mastercard:R,amex:M,currentMada:Q,currentVisa:ae,currentMaster:ie,currentAmex:ne});return}const Be=_>0?_:T>0?T:R>0?R:M;if(B!=null&&B.sourceRect&&(B!=null&&B.targetField)&&Be>0){const Ze=at(se,B.targetField);Ze&&It({sourceRect:{...B.sourceRect},targetRect:{...Ze},amount:Be,rowId:se,field:B.targetField})}De(se,"mada",Q+_),De(se,"visa",ae+T),De(se,"mastercard",ie+R),De(se,"amex",ne+M);const Te=[];_>0&&Te.push(`مدى ${q(_)}`),T>0&&Te.push(`فيزا ${q(T)}`),R>0&&Te.push(`ماستر ${q(R)}`),M>0&&Te.push(`أمريكان إكسبريس ${q(M)}`),w({msg:`تم ترحيل العمليات البنكية: ${Te.join("، ")||"—"}`,type:"success"})},[se,f,De,at]),$t=I.useCallback(_=>{if(!x||!se)return;const{mada:T,visa:R,mastercard:M,amex:B,currentMada:K,currentVisa:Q,currentMaster:ae,currentAmex:ie}=x;if(_){const oe=_.currentTarget.getBoundingClientRect(),Be={x:oe.x,y:oe.y,width:oe.width,height:oe.height},Te=T>0?"mada":R>0?"visa":M>0?"mastercard":"amex",Ze=T>0?T:R>0?R:M>0?M:B,yt=at(se,Te);yt&&It({sourceRect:{...Be},targetRect:{...yt},amount:Ze,rowId:se,field:Te})}De(se,"mada",K+T),De(se,"visa",Q+R),De(se,"mastercard",ae+M),De(se,"amex",ie+B);const ne=[];T>0&&ne.push(`مدى ${q(T)}`),R>0&&ne.push(`فيزا ${q(R)}`),M>0&&ne.push(`ماستر ${q(M)}`),B>0&&ne.push(`أمريكان إكسبريس ${q(B)}`),w({msg:`تم ترحيل العمليات البنكية: ${ne.join("، ")||"—"}`,type:"success"}),$(null)},[x,se,De,at]),kt=I.useCallback(()=>{$(null)},[]),Rn=I.useCallback(()=>{if(!ct)return;De(ct.rowId,ct.field,ct.newValue);const _=Xt(ct.field);w({msg:`تم تعديل ${_} إلى ${q(ct.newValue)}`,type:"success"}),Yt(null)},[ct,De]),Sn=I.useCallback(()=>{Yt(null)},[]),Mr=I.useCallback(_=>{if(!(!k||!se)){if(_){const T=_.currentTarget.getBoundingClientRect(),R={x:T.x,y:T.y,width:T.width,height:T.height},M=at(se,k.field);M&&It({sourceRect:{...R},targetRect:{...M},amount:k.amount,rowId:se,field:k.field})}De(se,k.field,k.amount),w({msg:`تم ترحيل ${q(k.amount)} إلى ${Xt(k.field)}`,type:"success"}),A(null)}},[k,se,De,at]),Ae=I.useCallback(()=>{A(null)},[]),er=I.useCallback((_,T,R)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const M=f.find(K=>K.id===se),B=M?M[T]??0:0;if(B>0){A({amount:_,currentValue:B,field:T});return}if(R){const K=at(se,T);K&&It({sourceRect:{...R},targetRect:{...K},amount:_,rowId:se,field:T})}De(se,T,_),w({msg:`تم ترحيل ${q(_)} إلى ${Xt(T)}`,type:"success"})},[se,f,De,at]);return a.jsxs("div",{className:"min-h-screen min-h-[100dvh] page-bg-warm dark:bg-slate-900 text-stone-900 dark:text-slate-200 font-cairo page-bg-pattern flex flex-col",children:[a.jsx("header",{className:"header-glass sticky top-0 z-40 border-b-2 border-stone-300 dark:border-white/[0.06] shadow-sm dark:shadow-none safe-top",children:a.jsxs("div",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-2 flex flex-wrap items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const{label:_,kind:T}=Ng(O),R="w-4 h-4 shrink-0",M={morning:a.jsxs("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),a.jsx("path",{d:"M12 2v1.5M12 20.5V22M4.22 4.22l1.06 1.06M18.72 18.72l1.06 1.06M2 12h1.5M20.5 12H22M4.22 19.78l1.06-1.06M18.72 5.28l1.06-1.06"})]}),noon:a.jsxs("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),a.jsx("path",{d:"M12 2.5v2M12 19.5V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2.5 12H5M19 12h2.5M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"}),a.jsx("path",{d:"M12 7.5v4l2.5 2.5",strokeWidth:"1.8"})]}),evening:a.jsxs("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}),a.jsx("path",{d:"M12 2v3M12 19v3M3.5 12H6.5M17.5 12h3M4.93 4.93l2.12 2.12M16.95 16.95l2.12 2.12M4.93 19.07l2.12-2.12M16.95 7.05l2.12-2.12",strokeWidth:"1.2",opacity:"0.7"})]}),night:a.jsx("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})},B=T==="night";return a.jsxs("h1",{className:"flex items-center gap-1.5 sm:gap-2 py-1.5 px-2 sm:px-3 rounded-lg sm:rounded-xl border-2 border-stone-300 dark:border-white/[0.06] bg-[#f0ebe3] dark:bg-slate-800/50 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)]",children:[a.jsx("span",{className:`flex items-center justify-center w-7 h-7 sm:w-8 sm:h-8 rounded-lg shrink-0 ${B?"bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300":"bg-stone-200 text-stone-700 dark:bg-teal-500/15 dark:text-teal-400"}`,children:M[T]}),a.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-stone-800 dark:text-slate-200 tracking-tight flex items-center gap-1 min-w-0 truncate max-w-[120px] sm:max-w-none",children:[a.jsx("span",{className:B?"text-indigo-700 dark:text-indigo-300/90":"text-stone-800 dark:text-teal-400/95",children:_}),a.jsx("span",{className:"text-stone-600 dark:text-slate-400 font-normal",children:"،"}),a.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-cairo text-right",children:n})]})]})})(),a.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-stone-200 dark:bg-teal-500/15 text-stone-800 dark:text-teal-300 text-xs font-cairo font-semibold border-2 border-stone-400 dark:border-teal-500/18 shadow-sm dark:shadow-none",children:["فرع ",Ur[e]]}),a.jsx("div",{className:"relative z-[50] rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsx("button",{"data-testid":"theme-toggle",ref:l,type:"button",onClick:_=>{_.preventDefault(),_.stopPropagation(),uc()},className:"flex items-center justify-center w-9 h-9 rounded-lg text-stone-700 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 transition cursor-pointer select-none touch-manipulation",title:s==="light"?"الوضع الفاتح (شمس)":s==="dark"?"الوضع الداكن (تركواز)":"الوضع بينك بناتي","aria-label":s==="light"?"وضع فاتح — شمس":s==="dark"?"وضع داكن — تركواز":"وضع بينك بناتي",children:s==="light"?a.jsxs("svg",{className:"w-4 h-4 text-amber-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("circle",{cx:"12",cy:"12",r:"3.5"}),a.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42-1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l-1.42-1.42"})]}):s==="dark"?a.jsxs("svg",{className:"w-4 h-4 text-teal-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("circle",{cx:"12",cy:"8",r:"3.5"}),a.jsx("path",{d:"M6 21v-1.5a3.5 3.5 0 0 1 3.5-3.5h5a3.5 3.5 0 0 1 3.5 3.5V21"})]}):a.jsxs("svg",{className:"w-4 h-4 text-pink-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("circle",{cx:"12",cy:"7",r:"3.5"}),a.jsx("path",{d:"M8.5 11L12 20l3.5-9"})]})})}),a.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsxs("button",{type:"button",onClick:()=>h(e==="corniche"?"andalusia":"corniche"),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 text-xs font-cairo transition",title:"تغيير الفرع",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),a.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),a.jsx("span",{children:"تغيير الفرع"})]})}),a.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-red-600 hover:text-red-700 hover:bg-red-500/15 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-500/10 text-xs font-cairo font-semibold transition border border-red-200 dark:border-red-500/30",title:"خروج — العودة لتسجيل الاسم والفرع",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"}),a.jsx("polyline",{points:"16 17 21 12 16 7"}),a.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),a.jsx("span",{children:"خروج"})]})}),a.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 text-xs font-cairo transition",title:"تغيير المستخدم",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"8",r:"4"}),a.jsx("path",{d:"M4 20c0-3.3 2.7-6 6-6s6 2.7 6 6"}),a.jsx("path",{d:"M16 11l3 3-3 3"}),a.jsx("path",{d:"M19 14h-5"})]}),a.jsx("span",{children:"تغيير المستخدم"})]})})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("input",{ref:Z,type:"file",accept:".xlsx,.xls",className:"hidden","aria-hidden":!0,onChange:Vi}),a.jsx("div",{className:"rounded-xl border border-violet-300 dark:border-violet-500/25 bg-violet-100 dark:bg-violet-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_8px_rgba(139,92,246,0.12)]",children:a.jsxs("button",{type:"button",onClick:Di,className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg text-sm font-cairo font-bold bg-teal-500 hover:bg-teal-600 dark:bg-gradient-to-r dark:from-violet-600 dark:to-indigo-600 dark:hover:from-violet-500 dark:hover:to-indigo-500 text-white border border-teal-400/50 dark:border-violet-400/30 shadow-md transition-all hover:scale-[1.02] active:scale-[0.98]",title:"استخراج قيم مدى، فيزا، ماستر كارد، أمريكان إكسبريس، تحويل بنكي من تقرير إكسل",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),a.jsx("path",{d:"M17 8l-5-5-5 5"}),a.jsx("path",{d:"M12 3v12"})]}),a.jsx("span",{children:"استخراج قيم"})]})}),a.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),a.jsxs("div",{className:"flex items-center gap-1 rounded-xl border-2 border-stone-400 dark:border-teal-500/18 page-surface-warm dark:bg-teal-500/10 px-1.5 py-1 shadow-sm dark:shadow-accent-sm",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-200 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400 shrink-0","aria-hidden":"true",children:a.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})}),tx.map(_=>a.jsx("button",{type:"button",onClick:()=>b(_.id),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition ${v===_.id?"bg-teal-500/30 text-teal-900 border-2 border-teal-600 dark:bg-teal-500/25 dark:text-white dark:border-teal-500/24 shadow-sm":"text-stone-700 border border-transparent hover:bg-stone-300 hover:text-stone-900 dark:text-slate-400 dark:hover:bg-white/5 dark:hover:text-slate-300"}`,children:_.label},_.id))]}),a.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),a.jsxs("div",{className:"flex items-center gap-1.5 rounded-xl border border-stone-300 dark:border-sky-500/25 bg-stone-200 dark:bg-sky-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(14,165,233,0.08)]",children:[a.jsxs("button",{type:"button",onClick:_s,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-500 hover:bg-teal-600 dark:bg-sky-600 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:"طباعة كل الصفوف المعروضة",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M6 9V2h12v7"}),a.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),a.jsx("path",{d:"M6 14h12v8H6z"})]}),a.jsx("span",{children:"الكل"})]}),J.size>0&&a.jsxs("button",{type:"button",onClick:Nn,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-400 hover:bg-teal-500 dark:bg-sky-500/90 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:`طباعة ${J.size} صف محدد`,children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M6 9V2h12v7"}),a.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),a.jsx("path",{d:"M6 14h12v8H6z"})]}),a.jsxs("span",{children:["المحددة (",J.size,")"]})]})]})]})]})}),a.jsxs("main",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-1 sm:py-2 flex flex-col gap-2 sm:gap-3 flex-1 min-h-0",children:[a.jsxs("div",{className:"rounded-2xl sm:rounded-3xl flex flex-col border-2 border-stone-400 dark:border-teal-500/14 page-surface-warm-card dark:bg-slate-800/30 backdrop-blur-sm shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] min-h-[200px] sm:min-h-[240px] min-w-0 overflow-hidden",children:[a.jsx("div",{className:"px-3 sm:px-4 py-1 sm:py-1.5 border-b border-stone-300 dark:border-slate-600 flex items-center justify-end gap-2 shrink-0 rounded-t-2xl sm:rounded-t-3xl bg-stone-50/80 dark:bg-slate-800/50",children:a.jsx("span",{className:"text-[9px] sm:text-[10px] font-cairo text-stone-600 dark:text-slate-400 tabular-nums",children:(()=>{const _=He.filter(R=>R.status!=="closed").length,T=He.filter(R=>R.status==="closed").length;return a.jsxs(a.Fragment,{children:[_>0&&a.jsxs("span",{children:["صف نشط: ",_]}),_>0&&T>0&&a.jsx("span",{className:"text-stone-400 dark:text-slate-500",children:"·"}),a.jsxs("span",{children:["تقفيلات مغلقة: ",T]})]})})()})}),a.jsx("div",{className:"cashbox-table-scroll min-w-0 w-full overflow-x-auto overflow-y-hidden rounded-t-2xl sm:rounded-t-3xl scrollbar-thin",style:{scrollbarGutter:"stable"},children:a.jsxs("table",{className:"text-xs sm:text-sm border-separate w-full min-w-[1380px]",style:{tableLayout:"fixed",width:"100%",borderSpacing:0},children:[a.jsxs("colgroup",{children:[a.jsx("col",{style:{width:"2.2%"}}),a.jsx("col",{style:{width:"1.8%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"8%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"5%"}}),a.jsx("col",{style:{width:"5%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"5%"}})]}),a.jsx("thead",{className:"border-b-2 border-stone-400 dark:border-slate-600",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-0.5 sm:px-1 py-3 sm:py-4 text-center text-xs font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[36px] rounded-t-2xl rounded-s-2xl sm:rounded-t-3xl sm:rounded-s-3xl bg-transparent",children:"تحديد"}),a.jsx("th",{className:"px-0.5 sm:px-1 py-3 sm:py-4 text-center text-xs font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[28px] bg-transparent",children:"م"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-r-2 border-stone-200 dark:border-teal-500/12 rounded-s-xl bg-stone-300/90 dark:bg-slate-700/90",children:"كاش"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo min-w-[64px] sm:min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden break-words sm:whitespace-nowrap",title:"مرسل للخزنة — يدخل في معادلة انحراف الكاش",children:"مرسل للخزنة"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo min-w-[52px] sm:min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden break-words sm:whitespace-nowrap",title:"يُخصم من المصروفات في انحراف الكاش",children:"تعويض م"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[64px] sm:min-w-[76px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90",children:"المصروفات"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo min-w-[64px] sm:min-w-[110px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden break-words sm:whitespace-nowrap",children:"كاش نزيل"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-rose-700 dark:text-rose-400 align-middle font-cairo min-w-[72px] sm:min-w-[92px] border-t-2 border-b-2 border-l-2 border-stone-200 dark:border-teal-500/12 rounded-e-xl bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden whitespace-nowrap",title:"انحراف الكاش — الفرق بين المتوقع والفعلي للكاش",children:"انحراف"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-r-2 border-stone-200 dark:border-teal-500/12 rounded-s-xl bg-stone-300/90 dark:bg-slate-700/90",children:"مدى"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90",children:"فيزا"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo min-w-[64px] sm:min-w-[82px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden break-words sm:whitespace-nowrap",children:"ماستر كارد"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[64px] sm:min-w-[82px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90",title:"أمريكان إكسبريس",children:"أ- إكسبريس"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-sky-600 dark:text-sky-400 align-middle font-cairo min-w-[64px] sm:min-w-[82px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden break-words sm:whitespace-nowrap",title:"للعرض فقط — لا يدخل في بنك نزيل ولا انحراف البنك",children:"تحويل بنكي"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo min-w-[64px] sm:min-w-[76px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden break-words sm:whitespace-nowrap",title:"بنك نزيل = مدى + فيزا + ماستر كارد + أمريكان إكسبريس",children:"بنك نزيل"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo min-w-[72px] sm:min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/12 bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden break-words sm:whitespace-nowrap",title:"اجمالى الموازنه",children:"أ-الموازنه"}),a.jsx("th",{className:"px-1.5 sm:px-3 py-3 sm:py-4 text-center text-[10px] sm:text-sm font-medium text-rose-700 dark:text-rose-400 align-middle font-cairo min-w-[72px] sm:min-w-[92px] border-t-2 border-b-2 border-l-2 border-stone-200 dark:border-teal-500/12 rounded-e-xl bg-stone-300/90 dark:bg-slate-700/90 overflow-hidden whitespace-nowrap",title:"انحراف البنك — الفرق بين بنك نزيل واجمالى الموازنه",children:"انحراف"}),a.jsx("th",{className:"px-0.5 py-1.5 sm:py-2 text-center align-middle font-cairo min-w-[44px] rounded-t-2xl rounded-e-2xl sm:rounded-t-3xl sm:rounded-e-3xl bg-transparent",children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-0.5 min-w-0",children:[a.jsx("span",{className:"text-[9px] sm:text-[10px] font-medium text-stone-700 dark:text-slate-300 whitespace-nowrap leading-none",children:"إجراءات"}),a.jsx("button",{type:"button",onClick:ws,"aria-label":"حذف كل التقفيلات المغلقة",className:"inline-flex items-center justify-center w-5 h-5 rounded border border-stone-300 dark:border-white/[0.06] bg-white dark:bg-slate-700/50 text-stone-600 dark:text-slate-400 hover:bg-rose-50 dark:hover:bg-red-500/10 hover:text-rose-600 dark:hover:text-rose-400 hover:border-rose-200 dark:hover:border-red-500/20 transition-all shrink-0",title:"حذف كل التقفيلات المغلقة",children:a.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]})})]})})]})}),a.jsx("tbody",{children:He.map((_,T)=>a.jsx(Dg,{row:_,rowNumber:T+1,rowIndex:T,isFirstActive:_.id===se,liveNow:O,closingRowId:U,closingSecondsLeft:U===_.id?W:0,onUpdate:De,isSelected:J.has(_.id),onToggleSelect:Pr,onDeleteRow:Vr,onPrintRow:Jt,onOpenExpenseDetails:Yn,onClearExpensesAndOpen:ln,onLockedFieldClick:Li,onExpenseCompensationExceeded:Bt,lastExcelDetails:We,onShowExcelDetails:(R,M)=>Lt({field:R,rowId:M}),onRequestConfirmBankEdit:We?(R,M,B,K)=>Yt({rowId:R,field:M,oldValue:B,newValue:K}):void 0,onShowEmployeeNames:Le.length>0?()=>rn(!0):void 0,onShowVarianceExplanation:(R,M)=>vt({type:R,row:M}),currentUserName:n,onClearRow:R=>Qn(R),isStickyRows:!1,onOpenShiftNotesModal:(R,M)=>bt({row:R,mode:M})},_.id))})]})}),(j>1||V)&&a.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-t-2 border-stone-400 dark:border-white/[0.06] flex items-center justify-center gap-2 flex-wrap rounded-b-2xl sm:rounded-b-3xl page-surface-warm dark:bg-slate-800/50 backdrop-blur-sm",children:[a.jsxs("button",{type:"button",onClick:()=>L(j-1),disabled:j<=1,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-stone-300 dark:border-teal-500/18 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 hover:border-stone-400 dark:hover:bg-teal-500/20 dark:hover:border-teal-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة السابقة",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M15 18l-6-6 6-6"})}),"السابق"]}),a.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.max(j,1)},(_,T)=>T+1).map(_=>a.jsx("button",{type:"button",onClick:()=>L(_),className:`inline-flex items-center justify-center min-w-[2.25rem] px-2 py-2 rounded-xl text-sm font-cairo font-medium transition-all ${_===j?"bg-teal-500 dark:bg-teal-500/40 text-white border border-teal-500 dark:border-teal-500/32":"border border-stone-300 dark:border-teal-500/18 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 dark:hover:bg-teal-500/20"}`,"aria-label":_===1?"الرئيسية":`صفحة ${_}`,children:_===1?"١":_},_))}),a.jsxs("button",{type:"button",onClick:()=>L(j+1),disabled:!V,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-stone-300 dark:border-teal-500/18 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 hover:border-stone-400 dark:hover:bg-teal-500/20 dark:hover:border-teal-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة التالية",children:["التالي",a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M9 18l6-6-6-6"})})]})]}),Nt.length===0&&a.jsxs("div",{className:"py-16 px-4 text-center rounded-b-3xl page-surface-warm dark:bg-slate-800/20",children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-500 font-cairo mb-1",children:"لا توجد تقفيلات"}),a.jsx("p",{className:"text-stone-700 dark:text-slate-600 text-sm font-cairo",children:"اختر فلتراً مختلفاً أو ابدأ شفتاً جديداً"})]})]}),a.jsx("div",{className:"flex flex-col items-center justify-center gap-1.5 py-2 px-3 rounded-xl border-2 border-stone-400 dark:border-slate-600 page-surface-warm dark:bg-slate-800/90 min-h-0 shadow-sm dark:shadow-none",children:U?a.jsx("div",{className:"flex flex-wrap items-center justify-center w-full",dir:"ltr",children:W>0?a.jsxs("button",{type:"button",onClick:Fi,className:"btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 border-teal-400 bg-teal-500 hover:bg-teal-600 text-white shadow-md dark:border-emerald-500/38 dark:bg-gradient-to-b dark:from-emerald-500/30 dark:to-emerald-600/20 dark:text-emerald-50 dark:shadow-[0_4px_24px_rgba(16,185,129,0.25)] dark:hover:from-emerald-500/40 dark:hover:to-emerald-600/30 dark:hover:shadow-[0_6px_28px_rgba(16,185,129,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all select-none touch-manipulation min-h-[36px]",children:[a.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 10h10a5 5 0 015 5v2"}),a.jsx("path",{d:"M7 15l-4-4 4-4"})]}),a.jsx("span",{className:"tracking-wide",children:"تراجع"}),a.jsxs("span",{className:"tabular-nums font-cairo",children:["(",W," ثانية)"]})]}):a.jsx("span",{className:"text-sm font-cairo font-medium text-stone-900 dark:text-teal-400 tabular-nums",children:"جاري الإغلاق..."})}):se&&dt?a.jsxs("button",{type:"button",onClick:()=>bs(se),disabled:!Ft,className:`btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 w-full sm:w-auto sm:min-w-[180px] rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 select-none transition-all touch-manipulation min-h-[36px]
                ${Ft?"bg-teal-500 hover:bg-teal-600 text-white border-teal-400 shadow-md dark:bg-gradient-to-b dark:from-teal-500/50 dark:to-teal-600/40 dark:text-white dark:border-teal-400 dark:shadow-accent-md dark:hover:from-teal-500/60 dark:hover:to-teal-600/50 dark:hover:shadow-accent-md-hover hover:scale-[1.02] active:scale-[0.98]":"opacity-60 bg-stone-200 text-stone-500 border-stone-300 dark:opacity-50 dark:bg-slate-800/40 dark:text-slate-500 dark:border-slate-600/50 cursor-not-allowed"}`,title:Ft?"إغلاق الشفت وحفظ التقفيلة":"أدخل رصيد البرنامج كاش وإجمالي الموازنة (البنك) أولاً",children:[a.jsxs("svg",{className:`btn-close-shift-icon w-5 h-5 shrink-0 ${Ft?"text-white dark:text-teal-200":"text-stone-500 dark:text-slate-500"}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),a.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]}),a.jsx("span",{className:"tracking-wide",children:n?`إغلاق شفت ${n}`:"إغلاق الشفت الحالي"})]}):null}),a.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-[minmax(260px,320px)_1fr_1fr] gap-2 sm:gap-3 w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] items-stretch min-h-[101px] sm:min-h-[122px] xl:min-h-[137px] [&>div]:min-h-[86px] sm:[&>div]:min-h-[107px] xl:[&>div]:min-h-[122px]",children:[a.jsx("div",{className:"min-h-0 flex flex-col",children:a.jsx(Og,{onTransfer:er,hasActiveRow:!!se},`calculator-${gt}`)}),a.jsx("div",{className:"min-h-0 flex flex-col",children:a.jsx(Fg,{onApplyToCash:ks,hasActiveRow:!!se},`cashCalculator-${gt}`)}),a.jsx("div",{className:"min-h-0 flex flex-col",children:a.jsx($g,{onTransfer:$i,onTransferToBudget:Es,hasActiveRow:!!se,disableTransferButtons:!!We},`bankOps-${gt}`)})]})]}),y&&a.jsx(zg,{message:y.msg,type:y.type,onClose:()=>w(null),position:"center",autoHideMs:y.autoHideMs}),wt&&a.jsx(Hg,{sourceRect:wt.sourceRect,targetRect:wt.targetRect,amount:wt.amount,formatCurrency:q,rowId:wt.rowId,field:wt.field,onEnd:()=>It(null),onLanded:(_,T)=>{const R=document.querySelector(`[data-transfer-target][data-field="${T}"][data-row-id="${_}"]`);R&&(R.classList.add("transfer-land-pulse"),setTimeout(()=>R.classList.remove("transfer-land-pulse"),450))}}),Ve&&We&&(()=>{const{field:_,rowId:T}=Ve,R=We[_]??[],M=R.reduce((ne,oe)=>ne+oe.amount,0),B=f.find(ne=>ne.id===T),K=B?B[_]??0:0,Q=K-M,ie=`سجل التغيير — ${{mada:"مدى",visa:"فيزا",mastercard:"ماستر كارد",amex:"أمريكان إكسبريس",bankTransfer:"تحويل بنكي"}[_]}`;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"excel-detail-title",onClick:()=>Lt(null),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-sm w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:ne=>ne.stopPropagation(),children:[a.jsx("h2",{id:"excel-detail-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/[0.06]",children:ie}),a.jsxs("div",{className:"p-3 space-y-2 border-b border-stone-200 dark:border-white/[0.06]",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"من إكسل (مرفوع):"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-200",children:q(M)})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الحالي في الخانة:"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-slate-200",children:q(K)})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الفرق (ترحيل أو تعديل يدوي):"}),a.jsx("span",{className:`tabular-nums font-medium ${Q>=0?"text-stone-800 dark:text-teal-400":"text-rose-600 dark:text-rose-400"}`,children:q(Q)})]})]}),R.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-2",children:[a.jsxs("p",{className:"text-xs font-cairo text-stone-500 dark:text-slate-400 mb-1",children:[R.length," عملية من الإكسل"]}),R.map((ne,oe)=>a.jsxs("div",{className:"py-2 border-b border-stone-200 dark:border-white/5",children:[a.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm text-stone-800 dark:text-slate-300",children:[a.jsx("div",{className:"flex flex-col items-start gap-0.5 min-w-0",children:ne.employeeName?a.jsx("span",{className:"text-xs text-stone-500 font-cairo",children:ne.employeeName}):null}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-200 shrink-0",children:q(ne.amount)})]}),ne.purpose&&a.jsx("p",{className:"text-xs font-cairo text-stone-600 dark:text-slate-300 mt-1 pr-0 border-t border-stone-300 dark:border-teal-500/14 pt-1",children:ne.purpose})]},oe))]}),a.jsxs("div",{className:"p-4 pt-2 border-t border-stone-300 dark:border-teal-500/18 flex justify-between items-center bg-stone-100 dark:bg-slate-900/50",children:[a.jsx("span",{className:"font-bold text-stone-800 dark:text-slate-200",children:"إجمالي الإكسل"}),a.jsx("span",{className:"tabular-nums font-bold text-stone-800 dark:text-teal-400",children:q(M)})]})]}),a.jsx("div",{className:"p-3",children:a.jsx("button",{type:"button",onClick:()=>Lt(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-500 hover:bg-teal-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white dark:text-slate-200 transition",children:"إغلاق"})})]})})})(),An&&Le.length>0&&(()=>{const _=Le.map(T=>{let R=0,M=0;if(We)for(const B of["mada","visa","mastercard","amex","bankTransfer"]){const K=We[B]??[];for(const Q of K)(Q.employeeName??"").trim()===T&&(R+=1,M+=Q.amount)}return{name:T,count:R,total:M}});return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"employee-names-title",onClick:()=>rn(!1),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:T=>T.stopPropagation(),children:[a.jsx("h2",{id:"employee-names-title",className:"text-base font-bold text-stone-800 dark:text-teal-400 p-4 pb-2 border-b border-white/10",children:"أسماء الموظفين في العمليات المستوردة"}),a.jsx("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-1.5",children:_.map((T,R)=>a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm text-slate-300 py-2 px-3 rounded-lg bg-slate-900/50 border border-white/5 font-cairo",children:[a.jsx("span",{className:"font-medium text-slate-200",children:T.name}),a.jsxs("span",{className:"tabular-nums text-stone-800 dark:text-slate-200 text-xs",children:[T.count," عملية — الإجمالي: ",q(T.total)]})]},R))}),a.jsx("div",{className:"p-3 border-t border-white/10",children:a.jsx("button",{type:"button",onClick:()=>rn(!1),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إغلاق"})})]})})})(),sn&&(()=>{const{type:_,row:T}=sn,R=T.cash??0,M=T.sentToTreasury??0,B=T.expenses??0,K=T.expenseCompensation??0,Q=Math.max(0,B-K),ae=T.programBalanceCash??0,ie=R+M+Q,ne=Js(T),oe=T.mada+T.visa+T.mastercard+(T.amex??0),Be=T.programBalanceBank??0,Te=Ys(T),Ze=_==="cash",yt=Ze?"شرح انحراف الكاش":"شرح انحراف البنك",ht=ne!==0&&Te!==0&&ne>0!=Te>0,jt=Math.abs(Math.abs(ne)-Math.abs(Te))<=ex,ft=ht&&jt,jn=ft?Math.abs(ne):0;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"variance-explanation-title",onClick:()=>vt(null),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:lt=>lt.stopPropagation(),children:[a.jsx("h2",{id:"variance-explanation-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/[0.06]",children:yt}),a.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-4 space-y-3 text-sm text-stone-800 dark:text-slate-300",children:[Ze?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"font-semibold text-stone-900 dark:text-teal-300",children:"انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش"}),a.jsxs("ul",{className:"space-y-1.5 list-none",children:[a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"كاش"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(R)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مرسل للخزنة"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(M)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مصروفات"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(B)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"تعويض مصروفات"}),a.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",q(K)]})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/[0.06] pt-1.5",children:[a.jsx("span",{children:"مصروفات فعّالة (صافي)"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(Q)})]}),a.jsxs("li",{className:"flex justify-between gap-2 font-medium",children:[a.jsx("span",{children:"كاش + مرسل للخزنة + مصروفات فعّالة"}),a.jsx("span",{className:"tabular-nums font-bold text-stone-900 dark:text-teal-300",children:q(ie)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"رصيد البرنامج كاش"}),a.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",q(ae)]})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-stone-400 dark:border-teal-500/18 pt-2 font-bold text-stone-900 dark:text-teal-300",children:[a.jsx("span",{children:"انحراف الكاش"}),a.jsxs("span",{className:"tabular-nums",children:[ne>0?"+":"",q(ne)]})]})]}),a.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:ne>0?"زيادة: الكاش الفعلي (أو المرسل + المصروف الفعلي) أكبر من رصيد البرنامج.":ne<0?"عجز: رصيد البرنامج كاش أكبر من المتوقّع من الكاش والمرسل والمصروف.":"لا يوجد انحراف."})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"font-semibold text-stone-900 dark:text-teal-300",children:"انحراف البنك = بنك نزيل − اجمالى الموازنه"}),a.jsxs("ul",{className:"space-y-1.5 list-none",children:[a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مدى"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(T.mada)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"فيزا"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(T.visa)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"ماستر كارد"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(T.mastercard)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"أمريكان إكسبريس"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(T.amex??0)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsxs("span",{children:["تحويل بنكي ",a.jsx("span",{className:"text-stone-500 dark:text-slate-500 text-[10px]",children:"(للعرض فقط)"})]}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:q(T.bankTransfer)})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/[0.06] pt-1.5 font-medium",children:[a.jsx("span",{children:"بنك نزيل (مدى+فيزا+ماستر+أمريكان إكسبريس)"}),a.jsx("span",{className:"tabular-nums font-bold text-stone-900 dark:text-teal-300",children:q(oe)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"اجمالى الموازنه"}),a.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",q(Be)]})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-stone-400 dark:border-teal-500/18 pt-2 font-bold text-stone-900 dark:text-teal-300",children:[a.jsx("span",{children:"انحراف البنك"}),a.jsxs("span",{className:"tabular-nums",children:[Te>0?"+":"",q(Te)]})]})]}),a.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:Te>0?"زيادة: بنك نزيل أكبر من اجمالى الموازنه المدخل.":Te<0?"عجز: اجمالى الموازنه أكبر من بنك نزيل.":"لا يوجد انحراف."})]}),ft&&a.jsxs("div",{className:"mt-3 p-3 rounded-xl border-2 border-stone-400 dark:border-teal-500/18 bg-stone-100 dark:bg-teal-900/20 text-stone-800 dark:text-teal-200 text-sm font-medium",children:["تنبيه: قد تكون سندات بقيمة ",a.jsx("strong",{children:jn.toLocaleString("ar-SA",{minimumFractionDigits:2})})," ريال دخلت في خانة خاطئة (نقداً ↔ شبكة). راجع تحويل المبلغ بين الكاش وبنك نزيل."]})]}),a.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/[0.06]",children:a.jsx("button",{type:"button",onClick:()=>vt(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),Ee&&(()=>{const{row:_,mode:T}=Ee,R=T==="edit",M=()=>{Pt(e,_.id,{notes:At}),m(B=>B.map(K=>K.id===_.id?{...K,notes:At}:K)),bt(null),w({msg:"تم حفظ ملاحظات الشيفت",type:"success"})};return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"shift-notes-title",onClick:()=>bt(null),children:a.jsxs("div",{className:"rounded-2xl border-2 border-stone-300 dark:border-teal-500/18 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:B=>B.stopPropagation(),children:[a.jsx("h2",{id:"shift-notes-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/[0.06]",children:"ملاحظات الشيفت"}),a.jsx("div",{className:"flex-1 min-h-0 overflow-hidden p-4",children:R?a.jsx("textarea",{dir:"auto",value:At,onChange:B=>Cn(B.target.value),placeholder:"اكتب ملاحظاتك قبل إغلاق الشيفت...",className:"w-full h-40 sm:h-48 px-3 py-2 rounded-xl border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-stone-900 dark:text-slate-200 text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 focus:outline-none resize-none",autoFocus:!0}):a.jsx("div",{className:"text-sm text-stone-800 dark:text-slate-300 font-cairo whitespace-pre-wrap break-words max-h-48 overflow-y-auto py-2",children:(_.notes||"").trim()||"— لا توجد ملاحظات —"})}),a.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/[0.06] flex gap-2",children:R?a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:M,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"حفظ"}),a.jsx("button",{type:"button",onClick:()=>bt(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-stone-400 hover:bg-stone-500 text-stone-800 transition",children:"إلغاء"})]}):a.jsx("button",{type:"button",onClick:()=>bt(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),Qt&&(()=>{const{cashVar:_,bankVar:T}=Qt,R=_!==0?_>0?"زيادة في صندوق الكاش — راجع الرصيد الفعلي":"عجز في صندوق الكاش — راجع الكاش والرصيد والمصروف":"",M=T!==0?T>0?"زيادة في البنك — راجع إدخالات مدى/فيزا/ماستر/أمريكان إكسبريس أو اجمالى الموازنه":"عجز في البنك — راجع بنك نزيل أو اجمالى الموازنه":"";return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"close-variance-title",children:a.jsxs("div",{className:"rounded-2xl border-2 border-teal-300 dark:border-teal-500/18 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"close-variance-title",className:"text-lg font-bold text-stone-900 dark:text-teal-400 mb-3",children:"تنبيه: يوجد انحراف"}),a.jsxs("div",{className:"text-stone-800 dark:text-slate-300 text-sm leading-relaxed mb-4 space-y-2",children:[_!==0&&a.jsxs("p",{className:"block",children:[a.jsx("span",{className:"font-medium",children:"انحراف الكاش: "}),a.jsxs("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:[_>0?"+":"",q(_)]}),R&&a.jsx("span",{className:"block text-stone-600 dark:text-slate-200 text-xs mt-0.5",children:R})]}),T!==0&&a.jsxs("p",{className:"block",children:[a.jsx("span",{className:"font-medium",children:"انحراف البنك: "}),a.jsxs("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:[T>0?"+":"",q(T)]}),M&&a.jsx("span",{className:"block text-stone-600 dark:text-slate-200 text-xs mt-0.5",children:M})]}),a.jsx("p",{className:"pt-2 text-stone-700 dark:text-slate-200",children:"هل تريد الإغلاق مع هذا الانحراف؟"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Oi,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، إغلاق الشفت"}),a.jsx("button",{type:"button",onClick:ys,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا، متابعة التعديل"})]})]})})})(),k&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"transfer-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsxs("h2",{id:"transfer-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:["ترحيل إلى ",Xt(k.field)]}),a.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد ترحيل الرقم الجديد وهو ",a.jsx("span",{className:"font-bold text-white tabular-nums",children:q(k.amount)}),"؟ يوجد رقم في الخانة وهو ",a.jsx("span",{className:"font-bold text-white tabular-nums",children:q(k.currentValue)}),"."]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:_=>Mr(_),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:Ae,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),x&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-transfer-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"bank-transfer-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"ترحيل العمليات البنكية"}),a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"هل تريد ترحيل الأرقام الجديدة؟ توجد قيم في الخانات:"}),a.jsxs("ul",{className:"text-sm text-stone-700 dark:text-slate-300 space-y-1.5 mb-4",children:[x.mada>0&&a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مدى:"}),a.jsxs("span",{className:"tabular-nums",children:["مرحّل ",a.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:q(x.mada)})," — في الخانة ",a.jsx("strong",{children:q(x.currentMada)})]})]}),x.visa>0&&a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"فيزا:"}),a.jsxs("span",{className:"tabular-nums",children:["مرحّل ",a.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:q(x.visa)})," — في الخانة ",a.jsx("strong",{children:q(x.currentVisa)})]})]}),x.mastercard>0&&a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"ماستر:"}),a.jsxs("span",{className:"tabular-nums",children:["مرحّل ",a.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:q(x.mastercard)})," — في الخانة ",a.jsx("strong",{children:q(x.currentMaster)})]})]}),x.amex>0&&a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"أمريكان إكسبريس:"}),a.jsxs("span",{className:"tabular-nums",children:["مرحّل ",a.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:q(x.amex)})," — في الخانة ",a.jsx("strong",{children:q(x.currentAmex)})]})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:_=>$t(_),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:kt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),ct&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-edit-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsxs("h2",{id:"bank-edit-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:["تعديل خانة ",Xt(ct.field)]}),a.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد تعديل الرقم من ",a.jsx("span",{className:"font-bold tabular-nums",children:q(ct.oldValue)})," إلى ",a.jsx("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:q(ct.newValue)}),"؟"]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Rn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:Sn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),on&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"clear-row-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"clear-row-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"إفراغ الصف"}),a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد إفراغ كل المدخلات في هذا الصف؟ (كاش، مدى، فيزا، ماستر، اجمالى الموازنه، مصروفات، وغيرها)"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:xs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:jr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),_e&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"expense-modal-title",onClick:()=>Ct(null),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-lg w-full max-h-[85vh] flex flex-col font-cairo cursor-auto",onClick:_=>_.stopPropagation(),onKeyDown:_=>{_.key==="Enter"&&!_e.readOnly&&(_.preventDefault(),Rt())},children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[a.jsx("h2",{id:"expense-modal-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400",children:_e.readOnly?"تفاصيل المصروفات":"تصنيف المبلغ المصروف"}),a.jsx("button",{type:"button",onClick:()=>Ct(null),className:"p-2 rounded-lg text-stone-500 hover:text-white hover:bg-white/10 transition","aria-label":"إغلاق",children:a.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),!_e.readOnly&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-500 text-sm px-4 pt-2",children:"أدخل تفاصيل المصروف (مثال: 10 ريال كتب، 10 ريال مسطرة)"}),(_e.carriedCount??0)>0&&a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-xs px-4 pt-0.5 font-cairo",children:"البنود المرحّلة للعرض فقط — يمكنك إضافة تصنيف ومبلغ جديد فقط، ويُحدَّث المجموع وخانة المصروفات تلقائياً."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[!_e.readOnly&&_e.items.length>0&&a.jsxs("div",{className:"flex gap-2 items-center pb-0.5",children:[a.jsx("span",{className:"flex-1 text-xs font-medium text-stone-700 font-cairo",children:"بند المصروف"}),a.jsx("span",{className:"w-24 text-xs font-medium text-stone-700 font-cairo text-center",children:"مبلغ المصروف"}),a.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}),_e.items.map((_,T)=>{const R=_e.carriedCount??0,M=!_e.readOnly&&T<R;return a.jsx("div",{className:"flex gap-2 items-center",children:_e.readOnly||M?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"w-24 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm text-center tabular-nums",children:q(Number(_.amount)||0)}),a.jsxs("span",{className:"flex-1 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm font-cairo",children:[_.description||"—",M&&a.jsx("span",{className:"mr-1 text-[10px] text-stone-600 font-cairo",title:"من الشفت السابق",children:" (مرحّل)"})]}),!_e.readOnly&&M?a.jsx("button",{type:"button",onClick:()=>ps(_e.rowId,T),className:"shrink-0 w-8 h-8 flex items-center justify-center rounded-lg border border-red-500/20 text-slate-400 hover:text-red-400 hover:border-red-500/40",title:"حذف البند المرحّل (يتطلب كود أدمن)","aria-label":"حذف بند مرحّل",children:a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}):a.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}):a.jsxs(a.Fragment,{children:[(()=>{const B=ut.current[T]!==void 0?ut.current[T]:String(_.amount??""),K=(Number(String(B).replace(/,/g,""))||0)>0,Q=!String(_.description||"").trim(),ae=K&&Q,ie=Ot===T;return a.jsx("input",{ref:ne=>{!ne||T!==R||_e.readOnly||an.current===_e.rowId||(an.current=_e.rowId,ne.focus())},type:"text",tabIndex:T===R?0:-1,value:_.description,onChange:ne=>{ms(T,"description",ne.target.value),Ot===T&&Rr(null)},onKeyDown:ne=>{ne.key==="Enter"&&(ne.preventDefault(),Rt())},placeholder:K?"الوصف إلزامي":"الوصف",title:K?"الوصف إلزامي عند وجود مبلغ":void 0,"aria-required":K,className:`flex-1 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 dark:focus:border-teal-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-teal-500/16 ${ae?"border-teal-500 dark:border-teal-500/32 ring-1 ring-teal-500/25":"border-stone-300 dark:border-teal-500/18"} ${ie?"expense-description-pulse":""}`})})(),a.jsx("input",{type:"text",inputMode:"decimal",tabIndex:-1,dir:"ltr",value:Un(ut.current[T]!==void 0?ut.current[T]:String(_.amount??"")),onChange:B=>{let K=Un(B.target.value).replace(/[^\d.]/g,"");const Q=K.indexOf(".");Q>=0&&(K=K.slice(0,Q+1)+K.slice(Q+1).replace(/\./g,"")),ut.current[T]=K,ms(T,"amount",K)},onKeyDown:B=>{B.key==="Enter"&&(B.preventDefault(),Rt())},placeholder:"مبلغ",className:"cashbox-input w-24 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border border-stone-300 dark:border-teal-500/18 text-stone-900 dark:text-white text-sm text-center focus:border-teal-500/50 dark:focus:border-teal-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-teal-500/16"}),a.jsx("button",{type:"button",tabIndex:-1,onClick:()=>Jn(T),disabled:_e.items.length<=1,className:"p-2 rounded-lg text-stone-500 hover:text-red-400 hover:bg-red-500/20 disabled:opacity-40 disabled:pointer-events-none transition","aria-label":"حذف السطر",title:"حذف",children:a.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})},T)})]}),a.jsxs("div",{className:"p-4 border-t border-white/10 flex flex-wrap items-center gap-3",children:[!_e.readOnly&&a.jsxs("button",{type:"button",tabIndex:-1,onClick:Mi,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium bg-stone-200 text-stone-800 border-2 border-stone-400 hover:bg-stone-300 transition",children:[a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 5v14M5 12h14"})}),"إضافة سطر"]}),a.jsx("div",{className:"flex-1"}),_e.readOnly?a.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",a.jsx("span",{className:"font-bold text-stone-800 dark:text-teal-400 tabular-nums",children:q(_e.items.reduce((_,T)=>_+(Number(T.amount)||0),0))})]}):a.jsxs("div",{className:"flex flex-col items-end gap-2",children:[a.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",a.jsx("span",{className:"font-bold text-stone-800 dark:text-teal-400 tabular-nums",children:q(_e.items.reduce((_,T)=>_+(Number(T.amount)||0),0))})]}),a.jsx("button",{type:"button",onClick:Rt,onKeyDown:_=>{(_.key==="Enter"||_.key===" "||_.key==="Tab")&&(_.preventDefault(),Rt())},className:"px-4 py-2 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-slate-800 focus:shadow-[0_0_16px_rgba(16,185,129,0.4)]",children:"تعديل مبلغ المصروفات"})]})]})]})}),ce&&a.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-carried-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"delete-carried-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:ce.step==="confirm"?"حذف بند مرحّل":"كود الأدمن"}),ce.step==="confirm"?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف هذا البند المرحّل؟ يتطلب إدخال كود الأدمن في الخطوة التالية."}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:gs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:()=>{ve(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),pt&&a.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx("input",{type:je?"text":"password",value:ke,onChange:_=>{Se(_.target.value),Ie(!1)},onKeyDown:_=>{_.key==="Enter"&&Xn(),_.key==="Escape"&&(ve(null),Se(""),Ie(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${pt?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/[0.06]"}`,autoFocus:!0}),a.jsx("button",{type:"button",onClick:()=>rt(_=>!_),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":je?"إخفاء الكود":"إظهار الكود",children:je?a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),a.jsx("path",{d:"M1 1l22 22"})]}):a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Xn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),a.jsx("button",{type:"button",onClick:()=>{ve(null),Se(""),rt(!1),Ie(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),F&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"delete-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:F.step==="confirm"?"حذف الصف":"كود الأدمن"}),F.step==="confirm"?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف الصف؟"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Bi,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:()=>te(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),pt&&a.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx("input",{type:je?"text":"password",value:ke,onChange:_=>{Se(_.target.value),Ie(!1)},onKeyDown:_=>{_.key==="Enter"&&Dr(),_.key==="Escape"&&(te(null),Se(""),Ie(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${pt?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/[0.06]"}`,autoFocus:!0}),a.jsx("button",{type:"button",onClick:()=>rt(_=>!_),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":je?"إخفاء الكود":"إظهار الكود",title:je?"إخفاء":"إظهار",children:je?a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),a.jsx("path",{d:"M1 1l22 22"})]}):a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Dr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),a.jsx("button",{type:"button",onClick:()=>{te(null),Se(""),rt(!1),Ie(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),de&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-all-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"delete-all-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:de.step==="confirm"?"حذف كل التقفيلات المغلقة":"كود الأدمن"}),de.step==="confirm"?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف كل التقفيلات المغلقة؟"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:vs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:()=>ge(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),pt&&a.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx("input",{type:je?"text":"password",value:ke,onChange:_=>{Se(_.target.value),Ie(!1)},onKeyDown:_=>{_.key==="Enter"&&Zn(),_.key==="Escape"&&(ge(null),Se(""),Ie(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${pt?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/[0.06]"}`,autoFocus:!0}),a.jsx("button",{type:"button",onClick:()=>rt(_=>!_),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":je?"إخفاء الكود":"إظهار الكود",title:je?"إخفاء":"إظهار",children:je?a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),a.jsx("path",{d:"M1 1l22 22"})]}):a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Zn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),a.jsx("button",{type:"button",onClick:()=>{ge(null),Se(""),rt(!1),Ie(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),u&&a.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"switch-branch-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/[0.06] bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"switch-branch-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"تغيير الفرع"}),a.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد الانتقال إلى فرع ",Ur[u],"؟"]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>{r(u),h(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، الانتقال"}),a.jsx("button",{type:"button",onClick:()=>h(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})})]})}const rx=["cash","sentToTreasury","expenseCompensation","expenses","mada","visa","mastercard","amex","bankTransfer","programBalanceCash","programBalanceBank"],ao="cashbox_name",Us="cashbox_branch",Po="cashbox_session_start",sx=6*60*60*1e3;function ix(n){return n==="corniche"||n==="andalusia"}function dc(){const n=sessionStorage.getItem(Po);if(!n)return!0;const e=parseInt(n,10);return Number.isNaN(e)?!0:Date.now()-e>=sx}function ox(){const[n,e]=I.useState(null),[t,r]=I.useState("corniche"),[s,o]=I.useState(!1),[l,u]=I.useState("dark");I.useEffect(()=>{const E=sessionStorage.getItem(ao),C=sessionStorage.getItem(Us);E!=null&&E.trim()&&ix(C)&&!dc()&&(e(E.trim()),r(C));const j=md();u(j),jo(j),o(!0)},[]),I.useEffect(()=>{const E=C=>u(C.detail);return window.addEventListener("cashbox-theme-change",E),()=>window.removeEventListener("cashbox-theme-change",E)},[]),I.useEffect(()=>{jo(l)},[l]);const h=I.useCallback(()=>{sessionStorage.removeItem(ao),sessionStorage.removeItem(Us),sessionStorage.removeItem(Po),e(null),r("corniche")},[]),f=(E,C)=>{sessionStorage.setItem(ao,E),sessionStorage.setItem(Us,C),sessionStorage.setItem(Po,Date.now().toString()),e(E),r(C)},m=E=>{sessionStorage.setItem(Us,E),r(E)};if(I.useEffect(()=>{if(!n)return;const C=setInterval(()=>{dc()&&h()},6e4);return()=>clearInterval(C)},[n,h]),!s)return a.jsx("div",{className:"min-h-screen page-bg-warm dark:bg-slate-900 flex items-center justify-center",children:a.jsx("div",{className:"text-slate-700 dark:text-slate-500 font-cairo",children:"جاري التحميل..."})});const g=()=>pd();return n?a.jsx(nx,{name:n,branch:t,onExit:h,onSwitchBranch:m,theme:l,onToggleTheme:g},t):a.jsx(Sd,{onEnter:f})}lo.createRoot(document.getElementById("root")).render(a.jsx(_d.StrictMode,{children:a.jsx(ox,{})}));
