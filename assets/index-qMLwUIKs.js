import{r as A,a as en,R as hd}from"./vendor-react-wGySg1uH.js";import{r as md,u as rr}from"./vendor-xlsx-DLNWaC59.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var sc={exports:{}},ci={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fd=A,pd=Symbol.for("react.element"),gd=Symbol.for("react.fragment"),xd=Object.prototype.hasOwnProperty,bd=fd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yd={key:!0,ref:!0,__self:!0,__source:!0};function ic(r,e,t){var n,s={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)xd.call(e,n)&&!yd.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:pd,type:r,key:o,ref:a,props:s,_owner:bd.current}}ci.Fragment=gd;ci.jsx=ic;ci.jsxs=ic;sc.exports=ci;var l=sc.exports,ro={},Da=en;ro.createRoot=Da.createRoot,ro.hydrateRoot=Da.hydrateRoot;const _d=/^[\p{L}\s]*$/u;function vd(r){return _d.test(r)&&r.length>0&&new RegExp("\\p{L}","u").test(r)}const wd=[{id:"corniche",label:"الكورنيش"},{id:"andalusia",label:"الأندلس"}];function kd({onEnter:r}){const[e,t]=A.useState(""),[n,s]=A.useState("corniche"),[o,a]=A.useState(""),u=vd(e.trim());function h(f){const b=f.target.value;/\d/.test(b)||(t(b),a(""))}function m(f){f.preventDefault();const b=e.trim();if(/\d/.test(b)){a("الاسم حروف فقط — بدون أرقام");return}if(!new RegExp("\\p{L}","u").test(b)){a("أدخل اسمك (حروف فقط)");return}a(""),r(b,n)}return l.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-br from-[#f4ebe0] via-[#f8f3ed] to-[#efe6dc] dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex flex-col items-center justify-center p-4 sm:p-6 safe-top safe-bottom",children:l.jsxs("div",{className:"w-full max-w-[95vw] sm:max-w-md bg-stone-50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl sm:rounded-3xl border border-stone-300 dark:border-white/20 shadow-xl dark:shadow-2xl p-5 sm:p-8",children:[l.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[l.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-primary-500 font-cairo mb-2",children:"أهلاً بك"}),l.jsx("p",{className:"text-sm sm:text-base text-stone-700 dark:text-slate-400 font-cairo",children:"اكتب اسمك للدخول"})]}),l.jsxs("form",{onSubmit:m,className:"space-y-4 sm:space-y-5",children:[o&&l.jsx("div",{className:"p-3 rounded-xl bg-red-50 dark:bg-red-500/20 border border-red-200 dark:border-red-500/40 text-red-700 dark:text-red-300 text-sm font-cairo",children:o}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الاسم (حروف فقط)"}),l.jsx("input",{id:"name",type:"text",value:e,onChange:h,placeholder:"أدخل اسمك",className:"w-full px-4 py-3 rounded-xl bg-stone-100 dark:bg-slate-900/80 border border-stone-300 dark:border-white/20 text-stone-900 dark:text-white placeholder-stone-500 dark:placeholder-slate-500 focus:border-primary-500/50 focus:ring-1 focus:ring-primary-500/25 focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-900 font-cairo",autoComplete:"off",autoFocus:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الفرع"}),l.jsx("div",{className:"flex gap-2",children:wd.map(f=>l.jsx("button",{type:"button",onClick:()=>s(f.id),className:`flex-1 py-3 rounded-xl font-cairo font-semibold text-sm border-2 transition ${n===f.id?"bg-primary-500 border-primary-600 text-white dark:bg-amber-500/30 dark:border-amber-500/50 dark:text-amber-200":"bg-stone-100 dark:bg-slate-900/80 border-stone-300 dark:border-white/20 text-stone-700 dark:text-slate-300 hover:border-primary-400 dark:hover:border-amber-500/40"}`,children:f.label},f.id))})]}),l.jsx("button",{type:"submit",disabled:!u,className:"w-full py-3 sm:py-3.5 rounded-xl font-bold font-cairo text-sm sm:text-base bg-primary-500 hover:bg-primary-600 text-white disabled:opacity-40 disabled:cursor-not-allowed transition focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none min-h-[44px] touch-manipulation",children:"دخول"})]})]})})}const Ed="modulepreload",Td=function(r){return"/cashbox/"+r},Ma={},Id=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(h=>{if(h=Td(h),h in Ma)return;Ma[h]=!0;const m=h.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${f}`))return;const b=document.createElement("link");if(b.rel=m?"stylesheet":Ed,m||(b.as="script"),b.crossOrigin="",b.href=h,u&&b.setAttribute("nonce",u),document.head.appendChild(b),m)return new Promise((E,I)=>{b.addEventListener("load",E),b.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return s.then(a=>{for(const u of a||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})},Ad=()=>{};var La={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oc=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Cd=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const s=r[t++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){const o=r[t++];e[n++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=r[t++],a=r[t++],u=r[t++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[n++]=String.fromCharCode(55296+(h>>10)),e[n++]=String.fromCharCode(56320+(h&1023))}else{const o=r[t++],a=r[t++];e[n++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return e.join("")},ac={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const o=r[s],a=s+1<r.length,u=a?r[s+1]:0,h=s+2<r.length,m=h?r[s+2]:0,f=o>>2,b=(o&3)<<4|u>>4;let E=(u&15)<<2|m>>6,I=m&63;h||(I=64,a||(E=64)),n.push(t[f],t[b],t[E],t[I])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(oc(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):Cd(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const o=t[r.charAt(s++)],u=s<r.length?t[r.charAt(s)]:0;++s;const m=s<r.length?t[r.charAt(s)]:64;++s;const b=s<r.length?t[r.charAt(s)]:64;if(++s,o==null||u==null||m==null||b==null)throw new Nd;const E=o<<2|u>>4;if(n.push(E),m!==64){const I=u<<4&240|m>>2;if(n.push(I),b!==64){const P=m<<6&192|b;n.push(P)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Nd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Rd=function(r){const e=oc(r);return ac.encodeByteArray(e,!0)},Hs=function(r){return Rd(r).replace(/\./g,"")},Sd=function(r){try{return ac.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd=()=>jd().__FIREBASE_DEFAULTS__,Vd=()=>{if(typeof process>"u"||typeof La>"u")return;const r=La.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Dd=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&Sd(r[1]);return e&&JSON.parse(e)},Co=()=>{try{return Ad()||Pd()||Vd()||Dd()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Md=r=>{var e,t;return(t=(e=Co())==null?void 0:e.emulatorHosts)==null?void 0:t[r]},Ld=r=>{const e=Md(r);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},lc=()=>{var r;return(r=Co())==null?void 0:r.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function No(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Fd(r){return(await fetch(r,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(r,e){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",s=r.iat||0,o=r.sub||r.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...r};return[Hs(JSON.stringify(t)),Hs(JSON.stringify(a)),""].join(".")}const Mn={};function Ud(){const r={prod:[],emulator:[]};for(const e of Object.keys(Mn))Mn[e]?r.emulator.push(e):r.prod.push(e);return r}function $d(r){let e=document.getElementById(r),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",r),t=!0),{created:t,element:e}}let Oa=!1;function qd(r,e){if(typeof window>"u"||typeof document>"u"||!No(window.location.host)||Mn[r]===e||Mn[r]||Oa)return;Mn[r]=e;function t(E){return`__firebase__banner__${E}`}const n="__firebase__banner",o=Ud().prod.length>0;function a(){const E=document.getElementById(n);E&&E.remove()}function u(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,I){E.setAttribute("width","24"),E.setAttribute("id",I),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function m(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Oa=!0,a()},E}function f(E,I){E.setAttribute("id",I),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function b(){const E=$d(n),I=t("text"),P=document.getElementById(I)||document.createElement("span"),M=t("learnmore"),R=document.getElementById(M)||document.createElement("a"),W=t("preprendIcon"),Y=document.getElementById(W)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const F=E.element;u(F),f(R,M);const ee=m();h(Y,W),F.append(Y,P,R,ee),document.body.appendChild(F)}o?(P.innerText="Preview backend disconnected.",Y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",I)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Wd(){var e;const r=(e=Co())==null?void 0:e.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Hd(){return!Wd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Gd(){try{return typeof indexedDB=="object"}catch{return!1}}function Kd(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)==null?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qd="FirebaseError";class cn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Qd,Object.setPrototypeOf(this,cn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cc.prototype.create)}}class cc{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?Yd(o,n):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new cn(s,u,n)}}function Yd(r,e){return r.replace(Jd,(t,n)=>{const s=e[n];return s!=null?String(s):`<${n}?>`})}const Jd=/\{\$([^}]+)}/g;function Gs(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const s of t){if(!n.includes(s))return!1;const o=r[s],a=e[s];if(Fa(o)&&Fa(a)){if(!Gs(o,a))return!1}else if(o!==a)return!1}for(const s of n)if(!t.includes(s))return!1;return!0}function Fa(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(r){return r&&r._delegate?r._delegate:r}class Un{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new Od;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(eh(e))try{this.getOrInitializeService({instanceIdentifier:Tr})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});n.resolve(o)}catch{}}}}clearInstance(e=Tr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Tr){return this.instances.has(e)}getOptions(e=Tr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);n===u&&a.resolve(s)}return s}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(n)??new Set;s.add(e),this.onInitCallbacks.set(n,s);const o=this.instances.get(n);return o&&e(o,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Zd(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Tr){return this.component?this.component.multipleInstances?e:Tr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Zd(r){return r===Tr?void 0:r}function eh(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Xd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var he;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(he||(he={}));const rh={debug:he.DEBUG,verbose:he.VERBOSE,info:he.INFO,warn:he.WARN,error:he.ERROR,silent:he.SILENT},nh=he.INFO,sh={[he.DEBUG]:"log",[he.VERBOSE]:"log",[he.INFO]:"info",[he.WARN]:"warn",[he.ERROR]:"error"},ih=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),s=sh[e];if(s)console[s](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class uc{constructor(e){this.name=e,this._logLevel=nh,this._logHandler=ih,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in he))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?rh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,he.DEBUG,...e),this._logHandler(this,he.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,he.VERBOSE,...e),this._logHandler(this,he.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,he.INFO,...e),this._logHandler(this,he.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,he.WARN,...e),this._logHandler(this,he.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,he.ERROR,...e),this._logHandler(this,he.ERROR,...e)}}const oh=(r,e)=>e.some(t=>r instanceof t);let Ba,Ua;function ah(){return Ba||(Ba=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function lh(){return Ua||(Ua=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const dc=new WeakMap,no=new WeakMap,hc=new WeakMap,Ui=new WeakMap,Ro=new WeakMap;function ch(r){const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("success",o),r.removeEventListener("error",a)},o=()=>{t(sr(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",o),r.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&dc.set(t,r)}).catch(()=>{}),Ro.set(e,r),e}function uh(r){if(no.has(r))return;const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("complete",o),r.removeEventListener("error",a),r.removeEventListener("abort",a)},o=()=>{t(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",o),r.addEventListener("error",a),r.addEventListener("abort",a)});no.set(r,e)}let so={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return no.get(r);if(e==="objectStoreNames")return r.objectStoreNames||hc.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return sr(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function dh(r){so=r(so)}function hh(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call($i(this),e,...t);return hc.set(n,e.sort?e.sort():[e]),sr(n)}:lh().includes(r)?function(...e){return r.apply($i(this),e),sr(dc.get(this))}:function(...e){return sr(r.apply($i(this),e))}}function mh(r){return typeof r=="function"?hh(r):(r instanceof IDBTransaction&&uh(r),oh(r,ah())?new Proxy(r,so):r)}function sr(r){if(r instanceof IDBRequest)return ch(r);if(Ui.has(r))return Ui.get(r);const e=mh(r);return e!==r&&(Ui.set(r,e),Ro.set(e,r)),e}const $i=r=>Ro.get(r);function fh(r,e,{blocked:t,upgrade:n,blocking:s,terminated:o}={}){const a=indexedDB.open(r,e),u=sr(a);return n&&a.addEventListener("upgradeneeded",h=>{n(sr(a.result),h.oldVersion,h.newVersion,sr(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",m=>s(m.oldVersion,m.newVersion,m))}).catch(()=>{}),u}const ph=["get","getKey","getAll","getAllKeys","count"],gh=["put","add","delete","clear"],qi=new Map;function $a(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(qi.get(e))return qi.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=gh.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||ph.includes(t)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let m=h.store;return n&&(m=m.index(u.shift())),(await Promise.all([m[t](...u),s&&h.done]))[0]};return qi.set(e,o),o}dh(r=>({...r,get:(e,t,n)=>$a(e,t)||r.get(e,t,n),has:(e,t)=>!!$a(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(bh(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function bh(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const io="@firebase/app",qa="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht=new uc("@firebase/app"),yh="@firebase/app-compat",_h="@firebase/analytics-compat",vh="@firebase/analytics",wh="@firebase/app-check-compat",kh="@firebase/app-check",Eh="@firebase/auth",Th="@firebase/auth-compat",Ih="@firebase/database",Ah="@firebase/data-connect",Ch="@firebase/database-compat",Nh="@firebase/functions",Rh="@firebase/functions-compat",Sh="@firebase/installations",jh="@firebase/installations-compat",Ph="@firebase/messaging",Vh="@firebase/messaging-compat",Dh="@firebase/performance",Mh="@firebase/performance-compat",Lh="@firebase/remote-config",Oh="@firebase/remote-config-compat",Fh="@firebase/storage",Bh="@firebase/storage-compat",Uh="@firebase/firestore",$h="@firebase/ai",qh="@firebase/firestore-compat",zh="firebase",Wh="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oo="[DEFAULT]",Hh={[io]:"fire-core",[yh]:"fire-core-compat",[vh]:"fire-analytics",[_h]:"fire-analytics-compat",[kh]:"fire-app-check",[wh]:"fire-app-check-compat",[Eh]:"fire-auth",[Th]:"fire-auth-compat",[Ih]:"fire-rtdb",[Ah]:"fire-data-connect",[Ch]:"fire-rtdb-compat",[Nh]:"fire-fn",[Rh]:"fire-fn-compat",[Sh]:"fire-iid",[jh]:"fire-iid-compat",[Ph]:"fire-fcm",[Vh]:"fire-fcm-compat",[Dh]:"fire-perf",[Mh]:"fire-perf-compat",[Lh]:"fire-rc",[Oh]:"fire-rc-compat",[Fh]:"fire-gcs",[Bh]:"fire-gcs-compat",[Uh]:"fire-fst",[qh]:"fire-fst-compat",[$h]:"fire-vertex","fire-js":"fire-js",[zh]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ks=new Map,Gh=new Map,ao=new Map;function za(r,e){try{r.container.addComponent(e)}catch(t){Ht.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Qs(r){const e=r.name;if(ao.has(e))return Ht.debug(`There were multiple attempts to register component ${e}.`),!1;ao.set(e,r);for(const t of Ks.values())za(t,r);for(const t of Gh.values())za(t,r);return!0}function Kh(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function Qh(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yh={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ir=new cc("app","Firebase",Yh);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Un("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ir.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh=Wh;function mc(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n={name:oo,automaticDataCollectionEnabled:!0,...e},s=n.name;if(typeof s!="string"||!s)throw ir.create("bad-app-name",{appName:String(s)});if(t||(t=lc()),!t)throw ir.create("no-options");const o=Ks.get(s);if(o){if(Gs(t,o.options)&&Gs(n,o.config))return o;throw ir.create("duplicate-app",{appName:s})}const a=new th(s);for(const h of ao.values())a.addComponent(h);const u=new Jh(t,n,a);return Ks.set(s,u),u}function Zh(r=oo){const e=Ks.get(r);if(!e&&r===oo&&lc())return mc();if(!e)throw ir.create("no-app",{appName:r});return e}function Kr(r,e,t){let n=Hh[r]??r;t&&(n+=`-${t}`);const s=n.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${n}" with version "${e}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ht.warn(a.join(" "));return}Qs(new Un(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const em="firebase-heartbeat-database",tm=1,$n="firebase-heartbeat-store";let zi=null;function fc(){return zi||(zi=fh(em,tm,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore($n)}catch(t){console.warn(t)}}}}).catch(r=>{throw ir.create("idb-open",{originalErrorMessage:r.message})})),zi}async function rm(r){try{const t=(await fc()).transaction($n),n=await t.objectStore($n).get(pc(r));return await t.done,n}catch(e){if(e instanceof cn)Ht.warn(e.message);else{const t=ir.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ht.warn(t.message)}}}async function Wa(r,e){try{const n=(await fc()).transaction($n,"readwrite");await n.objectStore($n).put(e,pc(r)),await n.done}catch(t){if(t instanceof cn)Ht.warn(t.message);else{const n=ir.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ht.warn(n.message)}}}function pc(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm=1024,sm=30;class im{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new am(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ha();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>sm){const a=lm(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Ht.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ha(),{heartbeatsToSend:n,unsentEntries:s}=om(this._heartbeatsCache.heartbeats),o=Hs(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return Ht.warn(t),""}}}function Ha(){return new Date().toISOString().substring(0,10)}function om(r,e=nm){const t=[];let n=r.slice();for(const s of r){const o=t.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Ga(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Ga(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class am{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Gd()?Kd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await rm(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Wa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Wa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Ga(r){return Hs(JSON.stringify({version:2,heartbeats:r})).length}function lm(r){if(r.length===0)return-1;let e=0,t=r[0].date;for(let n=1;n<r.length;n++)r[n].date<t&&(t=r[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(r){Qs(new Un("platform-logger",e=>new xh(e),"PRIVATE")),Qs(new Un("heartbeat",e=>new im(e),"PRIVATE")),Kr(io,qa,r),Kr(io,qa,"esm2020"),Kr("fire-js","")}cm("");var Ka=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var or,gc;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(w,g){function y(){}y.prototype=g.prototype,w.F=g.prototype,w.prototype=new y,w.prototype.constructor=w,w.D=function(_,v,T){for(var x=Array(arguments.length-2),J=2;J<arguments.length;J++)x[J-2]=arguments[J];return g.prototype[v].apply(_,x)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,g,y){y||(y=0);const _=Array(16);if(typeof g=="string")for(var v=0;v<16;++v)_[v]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(v=0;v<16;++v)_[v]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=w.g[0],y=w.g[1],v=w.g[2];let T=w.g[3],x;x=g+(T^y&(v^T))+_[0]+3614090360&4294967295,g=y+(x<<7&4294967295|x>>>25),x=T+(v^g&(y^v))+_[1]+3905402710&4294967295,T=g+(x<<12&4294967295|x>>>20),x=v+(y^T&(g^y))+_[2]+606105819&4294967295,v=T+(x<<17&4294967295|x>>>15),x=y+(g^v&(T^g))+_[3]+3250441966&4294967295,y=v+(x<<22&4294967295|x>>>10),x=g+(T^y&(v^T))+_[4]+4118548399&4294967295,g=y+(x<<7&4294967295|x>>>25),x=T+(v^g&(y^v))+_[5]+1200080426&4294967295,T=g+(x<<12&4294967295|x>>>20),x=v+(y^T&(g^y))+_[6]+2821735955&4294967295,v=T+(x<<17&4294967295|x>>>15),x=y+(g^v&(T^g))+_[7]+4249261313&4294967295,y=v+(x<<22&4294967295|x>>>10),x=g+(T^y&(v^T))+_[8]+1770035416&4294967295,g=y+(x<<7&4294967295|x>>>25),x=T+(v^g&(y^v))+_[9]+2336552879&4294967295,T=g+(x<<12&4294967295|x>>>20),x=v+(y^T&(g^y))+_[10]+4294925233&4294967295,v=T+(x<<17&4294967295|x>>>15),x=y+(g^v&(T^g))+_[11]+2304563134&4294967295,y=v+(x<<22&4294967295|x>>>10),x=g+(T^y&(v^T))+_[12]+1804603682&4294967295,g=y+(x<<7&4294967295|x>>>25),x=T+(v^g&(y^v))+_[13]+4254626195&4294967295,T=g+(x<<12&4294967295|x>>>20),x=v+(y^T&(g^y))+_[14]+2792965006&4294967295,v=T+(x<<17&4294967295|x>>>15),x=y+(g^v&(T^g))+_[15]+1236535329&4294967295,y=v+(x<<22&4294967295|x>>>10),x=g+(v^T&(y^v))+_[1]+4129170786&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^v&(g^y))+_[6]+3225465664&4294967295,T=g+(x<<9&4294967295|x>>>23),x=v+(g^y&(T^g))+_[11]+643717713&4294967295,v=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(v^T))+_[0]+3921069994&4294967295,y=v+(x<<20&4294967295|x>>>12),x=g+(v^T&(y^v))+_[5]+3593408605&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^v&(g^y))+_[10]+38016083&4294967295,T=g+(x<<9&4294967295|x>>>23),x=v+(g^y&(T^g))+_[15]+3634488961&4294967295,v=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(v^T))+_[4]+3889429448&4294967295,y=v+(x<<20&4294967295|x>>>12),x=g+(v^T&(y^v))+_[9]+568446438&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^v&(g^y))+_[14]+3275163606&4294967295,T=g+(x<<9&4294967295|x>>>23),x=v+(g^y&(T^g))+_[3]+4107603335&4294967295,v=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(v^T))+_[8]+1163531501&4294967295,y=v+(x<<20&4294967295|x>>>12),x=g+(v^T&(y^v))+_[13]+2850285829&4294967295,g=y+(x<<5&4294967295|x>>>27),x=T+(y^v&(g^y))+_[2]+4243563512&4294967295,T=g+(x<<9&4294967295|x>>>23),x=v+(g^y&(T^g))+_[7]+1735328473&4294967295,v=T+(x<<14&4294967295|x>>>18),x=y+(T^g&(v^T))+_[12]+2368359562&4294967295,y=v+(x<<20&4294967295|x>>>12),x=g+(y^v^T)+_[5]+4294588738&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^v)+_[8]+2272392833&4294967295,T=g+(x<<11&4294967295|x>>>21),x=v+(T^g^y)+_[11]+1839030562&4294967295,v=T+(x<<16&4294967295|x>>>16),x=y+(v^T^g)+_[14]+4259657740&4294967295,y=v+(x<<23&4294967295|x>>>9),x=g+(y^v^T)+_[1]+2763975236&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^v)+_[4]+1272893353&4294967295,T=g+(x<<11&4294967295|x>>>21),x=v+(T^g^y)+_[7]+4139469664&4294967295,v=T+(x<<16&4294967295|x>>>16),x=y+(v^T^g)+_[10]+3200236656&4294967295,y=v+(x<<23&4294967295|x>>>9),x=g+(y^v^T)+_[13]+681279174&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^v)+_[0]+3936430074&4294967295,T=g+(x<<11&4294967295|x>>>21),x=v+(T^g^y)+_[3]+3572445317&4294967295,v=T+(x<<16&4294967295|x>>>16),x=y+(v^T^g)+_[6]+76029189&4294967295,y=v+(x<<23&4294967295|x>>>9),x=g+(y^v^T)+_[9]+3654602809&4294967295,g=y+(x<<4&4294967295|x>>>28),x=T+(g^y^v)+_[12]+3873151461&4294967295,T=g+(x<<11&4294967295|x>>>21),x=v+(T^g^y)+_[15]+530742520&4294967295,v=T+(x<<16&4294967295|x>>>16),x=y+(v^T^g)+_[2]+3299628645&4294967295,y=v+(x<<23&4294967295|x>>>9),x=g+(v^(y|~T))+_[0]+4096336452&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~v))+_[7]+1126891415&4294967295,T=g+(x<<10&4294967295|x>>>22),x=v+(g^(T|~y))+_[14]+2878612391&4294967295,v=T+(x<<15&4294967295|x>>>17),x=y+(T^(v|~g))+_[5]+4237533241&4294967295,y=v+(x<<21&4294967295|x>>>11),x=g+(v^(y|~T))+_[12]+1700485571&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~v))+_[3]+2399980690&4294967295,T=g+(x<<10&4294967295|x>>>22),x=v+(g^(T|~y))+_[10]+4293915773&4294967295,v=T+(x<<15&4294967295|x>>>17),x=y+(T^(v|~g))+_[1]+2240044497&4294967295,y=v+(x<<21&4294967295|x>>>11),x=g+(v^(y|~T))+_[8]+1873313359&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~v))+_[15]+4264355552&4294967295,T=g+(x<<10&4294967295|x>>>22),x=v+(g^(T|~y))+_[6]+2734768916&4294967295,v=T+(x<<15&4294967295|x>>>17),x=y+(T^(v|~g))+_[13]+1309151649&4294967295,y=v+(x<<21&4294967295|x>>>11),x=g+(v^(y|~T))+_[4]+4149444226&4294967295,g=y+(x<<6&4294967295|x>>>26),x=T+(y^(g|~v))+_[11]+3174756917&4294967295,T=g+(x<<10&4294967295|x>>>22),x=v+(g^(T|~y))+_[2]+718787259&4294967295,v=T+(x<<15&4294967295|x>>>17),x=y+(T^(v|~g))+_[9]+3951481745&4294967295,w.g[0]=w.g[0]+g&4294967295,w.g[1]=w.g[1]+(v+(x<<21&4294967295|x>>>11))&4294967295,w.g[2]=w.g[2]+v&4294967295,w.g[3]=w.g[3]+T&4294967295}n.prototype.v=function(w,g){g===void 0&&(g=w.length);const y=g-this.blockSize,_=this.C;let v=this.h,T=0;for(;T<g;){if(v==0)for(;T<=y;)s(this,w,T),T+=this.blockSize;if(typeof w=="string"){for(;T<g;)if(_[v++]=w.charCodeAt(T++),v==this.blockSize){s(this,_),v=0;break}}else for(;T<g;)if(_[v++]=w[T++],v==this.blockSize){s(this,_),v=0;break}}this.h=v,this.o+=g},n.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var g=1;g<w.length-8;++g)w[g]=0;g=this.o*8;for(var y=w.length-8;y<w.length;++y)w[y]=g&255,g/=256;for(this.v(w),w=Array(16),g=0,y=0;y<4;++y)for(let _=0;_<32;_+=8)w[g++]=this.g[y]>>>_&255;return w};function o(w,g){var y=u;return Object.prototype.hasOwnProperty.call(y,w)?y[w]:y[w]=g(w)}function a(w,g){this.h=g;const y=[];let _=!0;for(let v=w.length-1;v>=0;v--){const T=w[v]|0;_&&T==g||(y[v]=T,_=!1)}this.g=y}var u={};function h(w){return-128<=w&&w<128?o(w,function(g){return new a([g|0],g<0?-1:0)}):new a([w|0],w<0?-1:0)}function m(w){if(isNaN(w)||!isFinite(w))return b;if(w<0)return R(m(-w));const g=[];let y=1;for(let _=0;w>=y;_++)g[_]=w/y|0,y*=4294967296;return new a(g,0)}function f(w,g){if(w.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(w.charAt(0)=="-")return R(f(w.substring(1),g));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=m(Math.pow(g,8));let _=b;for(let T=0;T<w.length;T+=8){var v=Math.min(8,w.length-T);const x=parseInt(w.substring(T,T+v),g);v<8?(v=m(Math.pow(g,v)),_=_.j(v).add(m(x))):(_=_.j(y),_=_.add(m(x)))}return _}var b=h(0),E=h(1),I=h(16777216);r=a.prototype,r.m=function(){if(M(this))return-R(this).m();let w=0,g=1;for(let y=0;y<this.g.length;y++){const _=this.i(y);w+=(_>=0?_:4294967296+_)*g,g*=4294967296}return w},r.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(P(this))return"0";if(M(this))return"-"+R(this).toString(w);const g=m(Math.pow(w,6));var y=this;let _="";for(;;){const v=ee(y,g).g;y=W(y,v.j(g));let T=((y.g.length>0?y.g[0]:y.h)>>>0).toString(w);if(y=v,P(y))return T+_;for(;T.length<6;)T="0"+T;_=T+_}},r.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function P(w){if(w.h!=0)return!1;for(let g=0;g<w.g.length;g++)if(w.g[g]!=0)return!1;return!0}function M(w){return w.h==-1}r.l=function(w){return w=W(this,w),M(w)?-1:P(w)?0:1};function R(w){const g=w.g.length,y=[];for(let _=0;_<g;_++)y[_]=~w.g[_];return new a(y,~w.h).add(E)}r.abs=function(){return M(this)?R(this):this},r.add=function(w){const g=Math.max(this.g.length,w.g.length),y=[];let _=0;for(let v=0;v<=g;v++){let T=_+(this.i(v)&65535)+(w.i(v)&65535),x=(T>>>16)+(this.i(v)>>>16)+(w.i(v)>>>16);_=x>>>16,T&=65535,x&=65535,y[v]=x<<16|T}return new a(y,y[y.length-1]&-2147483648?-1:0)};function W(w,g){return w.add(R(g))}r.j=function(w){if(P(this)||P(w))return b;if(M(this))return M(w)?R(this).j(R(w)):R(R(this).j(w));if(M(w))return R(this.j(R(w)));if(this.l(I)<0&&w.l(I)<0)return m(this.m()*w.m());const g=this.g.length+w.g.length,y=[];for(var _=0;_<2*g;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(let v=0;v<w.g.length;v++){const T=this.i(_)>>>16,x=this.i(_)&65535,J=w.i(v)>>>16,ue=w.i(v)&65535;y[2*_+2*v]+=x*ue,Y(y,2*_+2*v),y[2*_+2*v+1]+=T*ue,Y(y,2*_+2*v+1),y[2*_+2*v+1]+=x*J,Y(y,2*_+2*v+1),y[2*_+2*v+2]+=T*J,Y(y,2*_+2*v+2)}for(w=0;w<g;w++)y[w]=y[2*w+1]<<16|y[2*w];for(w=g;w<2*g;w++)y[w]=0;return new a(y,0)};function Y(w,g){for(;(w[g]&65535)!=w[g];)w[g+1]+=w[g]>>>16,w[g]&=65535,g++}function F(w,g){this.g=w,this.h=g}function ee(w,g){if(P(g))throw Error("division by zero");if(P(w))return new F(b,b);if(M(w))return g=ee(R(w),g),new F(R(g.g),R(g.h));if(M(g))return g=ee(w,R(g)),new F(R(g.g),g.h);if(w.g.length>30){if(M(w)||M(g))throw Error("slowDivide_ only works with positive integers.");for(var y=E,_=g;_.l(w)<=0;)y=$(y),_=$(_);var v=X(y,1),T=X(_,1);for(_=X(_,2),y=X(y,2);!P(_);){var x=T.add(_);x.l(w)<=0&&(v=v.add(y),T=x),_=X(_,1),y=X(y,1)}return g=W(w,v.j(g)),new F(v,g)}for(v=b;w.l(g)>=0;){for(y=Math.max(1,Math.floor(w.m()/g.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=_<=48?1:Math.pow(2,_-48),T=m(y),x=T.j(g);M(x)||x.l(w)>0;)y-=_,T=m(y),x=T.j(g);P(T)&&(T=E),v=v.add(T),w=W(w,x)}return new F(v,w)}r.B=function(w){return ee(this,w).h},r.and=function(w){const g=Math.max(this.g.length,w.g.length),y=[];for(let _=0;_<g;_++)y[_]=this.i(_)&w.i(_);return new a(y,this.h&w.h)},r.or=function(w){const g=Math.max(this.g.length,w.g.length),y=[];for(let _=0;_<g;_++)y[_]=this.i(_)|w.i(_);return new a(y,this.h|w.h)},r.xor=function(w){const g=Math.max(this.g.length,w.g.length),y=[];for(let _=0;_<g;_++)y[_]=this.i(_)^w.i(_);return new a(y,this.h^w.h)};function $(w){const g=w.g.length+1,y=[];for(let _=0;_<g;_++)y[_]=w.i(_)<<1|w.i(_-1)>>>31;return new a(y,w.h)}function X(w,g){const y=g>>5;g%=32;const _=w.g.length-y,v=[];for(let T=0;T<_;T++)v[T]=g>0?w.i(T+y)>>>g|w.i(T+y+1)<<32-g:w.i(T+y);return new a(v,w.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,gc=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=m,a.fromString=f,or=a}).apply(typeof Ka<"u"?Ka:typeof self<"u"?self:typeof window<"u"?window:{});var Is=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xc,Rn,bc,Ls,lo,yc,_c,vc;(function(){var r,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Is=="object"&&Is];for(var c=0;c<i.length;++c){var d=i[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function s(i,c){if(c)e:{var d=n;i=i.split(".");for(var p=0;p<i.length-1;p++){var N=i[p];if(!(N in d))break e;d=d[N]}i=i[i.length-1],p=d[i],c=c(p),c!=p&&c!=null&&e(d,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var d=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push([p,c[p]]);return d}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,d){return i.call.apply(i.bind,arguments)}function m(i,c,d){return m=h,m.apply(null,arguments)}function f(i,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),i.apply(this,p)}}function b(i,c){function d(){}d.prototype=c.prototype,i.Z=c.prototype,i.prototype=new d,i.prototype.constructor=i,i.Ob=function(p,N,j){for(var B=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)B[oe-2]=arguments[oe];return c.prototype[N].apply(p,B)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function I(i){const c=i.length;if(c>0){const d=Array(c);for(let p=0;p<c;p++)d[p]=i[p];return d}return[]}function P(i,c){for(let p=1;p<arguments.length;p++){const N=arguments[p];var d=typeof N;if(d=d!="object"?d:N?Array.isArray(N)?"array":d:"null",d=="array"||d=="object"&&typeof N.length=="number"){d=i.length||0;const j=N.length||0;i.length=d+j;for(let B=0;B<j;B++)i[d+B]=N[B]}else i.push(N)}}class M{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function R(i){a.setTimeout(()=>{throw i},0)}function W(){var i=w;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class Y{constructor(){this.h=this.g=null}add(c,d){const p=F.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var F=new M(()=>new ee,i=>i.reset());class ee{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let $,X=!1,w=new Y,g=()=>{const i=Promise.resolve(void 0);$=()=>{i.then(y)}};function y(){for(var i;i=W();){try{i.h.call(i.g)}catch(d){R(d)}var c=F;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}X=!1}function _(){this.u=this.u,this.C=this.C}_.prototype.u=!1,_.prototype.dispose=function(){this.u||(this.u=!0,this.N())},_.prototype[Symbol.dispose]=function(){this.dispose()},_.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function v(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}v.prototype.h=function(){this.defaultPrevented=!0};var T=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const d=()=>{};a.addEventListener("test",d,c),a.removeEventListener("test",d,c)}catch{}return i}();function x(i){return/^[\s\xa0]*$/.test(i)}function J(i,c){v.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}b(J,v),J.prototype.init=function(i,c){const d=this.type=i.type,p=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(d=="mouseover"?c=i.fromElement:d=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&J.Z.h.call(this)},J.prototype.h=function(){J.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var ue="closure_listenable_"+(Math.random()*1e6|0),Ae=0;function me(i,c,d,p,N){this.listener=i,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=N,this.key=++Ae,this.da=this.fa=!1}function Ce(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function Ee(i,c,d){for(const p in i)c.call(d,i[p],p,i)}function Ze(i,c){for(const d in i)c.call(void 0,i[d],d,i)}function ge(i){const c={};for(const d in i)c[d]=i[d];return c}const et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ne(i,c){let d,p;for(let N=1;N<arguments.length;N++){p=arguments[N];for(d in p)i[d]=p[d];for(let j=0;j<et.length;j++)d=et[j],Object.prototype.hasOwnProperty.call(p,d)&&(i[d]=p[d])}}function ve(i){this.src=i,this.g={},this.h=0}ve.prototype.add=function(i,c,d,p,N){const j=i.toString();i=this.g[j],i||(i=this.g[j]=[],this.h++);const B=ze(i,c,p,N);return B>-1?(c=i[B],d||(c.fa=!1)):(c=new me(c,this.src,j,!!p,N),c.fa=d,i.push(c)),c};function qe(i,c){const d=c.type;if(d in i.g){var p=i.g[d],N=Array.prototype.indexOf.call(p,c,void 0),j;(j=N>=0)&&Array.prototype.splice.call(p,N,1),j&&(Ce(c),i.g[d].length==0&&(delete i.g[d],i.h--))}}function ze(i,c,d,p){for(let N=0;N<i.length;++N){const j=i[N];if(!j.da&&j.listener==c&&j.capture==!!d&&j.ha==p)return N}return-1}var lt="closure_lm_"+(Math.random()*1e6|0),ke={};function Tt(i,c,d,p,N){if(Array.isArray(c)){for(let j=0;j<c.length;j++)Tt(i,c[j],d,p,N);return null}return d=Ft(d),i&&i[ue]?i.J(c,d,u(p)?!!p.capture:!1,N):tt(i,c,d,!1,p,N)}function tt(i,c,d,p,N,j){if(!c)throw Error("Invalid event type");const B=u(N)?!!N.capture:!!N;let oe=ot(i);if(oe||(i[lt]=oe=new ve(i)),d=oe.add(c,d,p,B,j),d.proxy)return d;if(p=K(),d.proxy=p,p.src=i,p.listener=d,i.addEventListener)T||(N=B),N===void 0&&(N=!1),i.addEventListener(c.toString(),p,N);else if(i.attachEvent)i.attachEvent(xe(c.toString()),p);else if(i.addListener&&i.removeListener)i.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function K(){function i(d){return c.call(i.src,i.listener,d)}const c=bt;return i}function mt(i,c,d,p,N){if(Array.isArray(c))for(var j=0;j<c.length;j++)mt(i,c[j],d,p,N);else p=u(p)?!!p.capture:!!p,d=Ft(d),i&&i[ue]?(i=i.i,j=String(c).toString(),j in i.g&&(c=i.g[j],d=ze(c,d,p,N),d>-1&&(Ce(c[d]),Array.prototype.splice.call(c,d,1),c.length==0&&(delete i.g[j],i.h--)))):i&&(i=ot(i))&&(c=i.g[c.toString()],i=-1,c&&(i=ze(c,d,p,N)),(d=i>-1?c[i]:null)&&_e(d))}function _e(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[ue])qe(c.i,i);else{var d=i.type,p=i.proxy;c.removeEventListener?c.removeEventListener(d,p,i.capture):c.detachEvent?c.detachEvent(xe(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=ot(c))?(qe(d,i),d.h==0&&(d.src=null,c[lt]=null)):Ce(i)}}}function xe(i){return i in ke?ke[i]:ke[i]="on"+i}function bt(i,c){if(i.da)i=!0;else{c=new J(c,this);const d=i.listener,p=i.ha||i.src;i.fa&&_e(i),i=d.call(p,c)}return i}function ot(i){return i=i[lt],i instanceof ve?i:null}var pr="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ft(i){return typeof i=="function"?i:(i[pr]||(i[pr]=function(c){return i.handleEvent(c)}),i[pr])}function Re(){_.call(this),this.i=new ve(this),this.M=this,this.G=null}b(Re,_),Re.prototype[ue]=!0,Re.prototype.removeEventListener=function(i,c,d,p){mt(this,i,c,d,p)};function Pe(i,c){var d,p=i.G;if(p)for(d=[];p;p=p.G)d.push(p);if(i=i.M,p=c.type||c,typeof c=="string")c=new v(c,i);else if(c instanceof v)c.target=c.target||i;else{var N=c;c=new v(p,i),Ne(c,N)}N=!0;let j,B;if(d)for(B=d.length-1;B>=0;B--)j=c.g=d[B],N=yt(j,p,!0,c)&&N;if(j=c.g=i,N=yt(j,p,!0,c)&&N,N=yt(j,p,!1,c)&&N,d)for(B=0;B<d.length;B++)j=c.g=d[B],N=yt(j,p,!1,c)&&N}Re.prototype.N=function(){if(Re.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const d=i.g[c];for(let p=0;p<d.length;p++)Ce(d[p]);delete i.g[c],i.h--}}this.G=null},Re.prototype.J=function(i,c,d,p){return this.i.add(String(i),c,!1,d,p)},Re.prototype.K=function(i,c,d,p){return this.i.add(String(i),c,!0,d,p)};function yt(i,c,d,p){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let N=!0;for(let j=0;j<c.length;++j){const B=c[j];if(B&&!B.da&&B.capture==d){const oe=B.listener,Be=B.ha||B.src;B.fa&&qe(i.i,B),N=oe.call(Be,p)!==!1&&N}}return N&&!p.defaultPrevented}function We(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=m(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function _t(i){i.g=We(()=>{i.g=null,i.i&&(i.i=!1,_t(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class It extends _{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:_t(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ft(i){_.call(this),this.h=i,this.g={}}b(ft,_);var rt=[];function Or(i){Ee(i.g,function(c,d){this.g.hasOwnProperty(d)&&_e(c)},i),i.g={}}ft.prototype.N=function(){ft.Z.N.call(this),Or(this)},ft.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var fe=a.JSON.stringify,Bt=a.JSON.parse,rs=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function pn(){}function ns(){}var Ke={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Fr(){v.call(this,"d")}b(Fr,v);function pt(){v.call(this,"c")}b(pt,v);var Ut={},ae=null;function ct(){return ae=ae||new Re}Ut.Ia="serverreachability";function gr(i){v.call(this,Ut.Ia,i)}b(gr,v);function xr(i){const c=ct();Pe(c,new gr(c))}Ut.STAT_EVENT="statevent";function ss(i,c){v.call(this,Ut.STAT_EVENT,i),this.stat=c}b(ss,v);function Qe(i){const c=ct();Pe(c,new ss(c,i))}Ut.Ja="timingevent";function gn(i,c){v.call(this,Ut.Ja,i),this.size=c}b(gn,v);function br(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function yr(){this.g=!0}yr.prototype.ua=function(){this.g=!1};function Ci(i,c,d,p,N,j){i.info(function(){if(i.g)if(j){var B="",oe=j.split("&");for(let be=0;be<oe.length;be++){var Be=oe[be].split("=");if(Be.length>1){const He=Be[0];Be=Be[1];const St=He.split("_");B=St.length>=2&&St[1]=="type"?B+(He+"="+Be+"&"):B+(He+"=redacted&")}}}else B=null;else B=j;return"XMLHTTP REQ ("+p+") [attempt "+N+"]: "+c+`
`+d+`
`+B})}function Ni(i,c,d,p,N,j,B){i.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+N+"]: "+c+`
`+d+`
`+j+" "+B})}function $t(i,c,d,p){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Ri(i,d)+(p?" "+p:"")})}function _r(i,c){i.info(function(){return"TIMEOUT: "+c})}yr.prototype.info=function(){};function Ri(i,c){if(!i.g)return c;if(!c)return null;try{const j=JSON.parse(c);if(j){for(i=0;i<j.length;i++)if(Array.isArray(j[i])){var d=j[i];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var N=p[0];if(N!="noop"&&N!="stop"&&N!="close")for(let B=1;B<p.length;B++)p[B]=""}}}}return fe(j)}catch{return c}}var Br={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},xn={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},is;function bn(){}b(bn,pn),bn.prototype.g=function(){return new XMLHttpRequest},is=new bn;function Te(i){return encodeURIComponent(String(i))}function Si(i){var c=1;i=i.split(":");const d=[];for(;c>0&&i.length;)d.push(i.shift()),c--;return i.length&&d.push(i.join(":")),d}function At(i,c,d,p){this.j=i,this.i=c,this.l=d,this.S=p||1,this.V=new ft(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new os}function os(){this.i=null,this.g="",this.h=!1}var as={},Ct={};function yn(i,c,d){i.M=1,i.A=ne(S(c)),i.u=d,i.R=!0,ls(i,null)}function ls(i,c){i.F=Date.now(),Ur(i),i.B=S(i.A);var d=i.B,p=i.S;Array.isArray(p)||(p=[String(p)]),wr(d.i,"t",p),i.C=0,d=i.j.L,i.h=new os,i.g=Sa(i.j,d?c:null,!i.u),i.P>0&&(i.O=new It(m(i.Y,i,i.g),i.P)),c=i.V,d=i.g,p=i.ba;var N="readystatechange";Array.isArray(N)||(N&&(rt[0]=N.toString()),N=rt);for(let j=0;j<N.length;j++){const B=Tt(d,N[j],p||c.handleEvent,!1,c.h||c);if(!B)break;c.g[B.key]=B}c=i.J?ge(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),xr(),Ci(i.i,i.v,i.B,i.l,i.S,i.u)}At.prototype.ba=function(i){i=i.target;const c=this.O;c&&Zt(i)==3?c.j():this.Y(i)},At.prototype.Y=function(i){try{if(i==this.g)e:{const oe=Zt(this.g),Be=this.g.ya(),be=this.g.ca();if(!(oe<3)&&(oe!=3||this.g&&(this.h.h||this.g.la()||_a(this.g)))){this.K||oe!=4||Be==7||(Be==8||be<=0?xr(3):xr(2)),vn(this);var c=this.g.ca();this.X=c;var d=ji(this);if(this.o=c==200,Ni(this.i,this.v,this.B,this.l,this.S,oe,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,N=this.g;if((p=N.g?N.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(p)){var j=p;break t}}j=null}if(i=j)$t(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,qt(this,i);else{this.o=!1,this.m=3,Qe(12),Nt(this),vr(this);break e}}if(this.R){i=!0;let He;for(;!this.K&&this.C<d.length;)if(He=Pi(this,d),He==Ct){oe==4&&(this.m=4,Qe(14),i=!1),$t(this.i,this.l,null,"[Incomplete Response]");break}else if(He==as){this.m=4,Qe(15),$t(this.i,this.l,d,"[Invalid Chunk]"),i=!1;break}else $t(this.i,this.l,He,null),qt(this,He);if(cs(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),oe!=4||d.length!=0||this.h.h||(this.m=1,Qe(16),i=!1),this.o=this.o&&i,!i)$t(this.i,this.l,d,"[Invalid Chunked Response]"),Nt(this),vr(this);else if(d.length>0&&!this.W){this.W=!0;var B=this.j;B.g==this&&B.aa&&!B.P&&(B.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),Fi(B),B.P=!0,Qe(11))}}else $t(this.i,this.l,d,null),qt(this,d);oe==4&&Nt(this),this.o&&!this.K&&(oe==4?Aa(this.j,this):(this.o=!1,Ur(this)))}else ud(this.g),c==400&&d.indexOf("Unknown SID")>0?(this.m=3,Qe(12)):(this.m=0,Qe(13)),Nt(this),vr(this)}}}catch{}finally{}};function ji(i){if(!cs(i))return i.g.la();const c=_a(i.g);if(c==="")return"";let d="";const p=c.length,N=Zt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Nt(i),vr(i),"";i.h.i=new a.TextDecoder}for(let j=0;j<p;j++)i.h.h=!0,d+=i.h.i.decode(c[j],{stream:!(N&&j==p-1)});return c.length=0,i.h.g+=d,i.C=0,i.h.g}function cs(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Pi(i,c){var d=i.C,p=c.indexOf(`
`,d);return p==-1?Ct:(d=Number(c.substring(d,p)),isNaN(d)?as:(p+=1,p+d>c.length?Ct:(c=c.slice(p,p+d),i.C=p+d,c)))}At.prototype.cancel=function(){this.K=!0,Nt(this)};function Ur(i){i.T=Date.now()+i.H,_n(i,i.H)}function _n(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=br(m(i.aa,i),c)}function vn(i){i.D&&(a.clearTimeout(i.D),i.D=null)}At.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(_r(this.i,this.B),this.M!=2&&(xr(),Qe(17)),Nt(this),this.m=2,vr(this)):_n(this,this.T-i)};function vr(i){i.j.I==0||i.K||Aa(i.j,i)}function Nt(i){vn(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Or(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function qt(i,c){try{var d=i.j;if(d.I!=0&&(d.g==i||wn(d.h,i))){if(!i.L&&wn(d.h,i)&&d.I==3){try{var p=d.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var N=p;if(N[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<i.F)ks(d),vs(d);else break e;Oi(d),Qe(18)}}else d.xa=N[1],0<d.xa-d.K&&N[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=br(m(d.Va,d),6e3));hs(d.h)<=1&&d.ta&&(d.ta=void 0)}else kr(d,11)}else if((i.L||d.g==i)&&ks(d),!x(c))for(N=d.Ba.g.parse(c),c=0;c<N.length;c++){let be=N[c];const He=be[0];if(!(He<=d.K))if(d.K=He,be=be[1],d.I==2)if(be[0]=="c"){d.M=be[1],d.ba=be[2];const St=be[3];St!=null&&(d.ka=St,d.j.info("VER="+d.ka));const Er=be[4];Er!=null&&(d.za=Er,d.j.info("SVER="+d.za));const er=be[5];er!=null&&typeof er=="number"&&er>0&&(p=1.5*er,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const tr=i.g;if(tr){const Ts=tr.g?tr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ts){var j=p.h;j.g||Ts.indexOf("spdy")==-1&&Ts.indexOf("quic")==-1&&Ts.indexOf("h2")==-1||(j.j=j.l,j.g=new Set,j.h&&(kn(j,j.h),j.h=null))}if(p.G){const Bi=tr.g?tr.g.getResponseHeader("X-HTTP-Session-Id"):null;Bi&&(p.wa=Bi,L(p.J,p.G,Bi))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-i.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var B=i;if(p.na=Ra(p,p.L?p.ba:null,p.W),B.L){ms(p.h,B);var oe=B,Be=p.O;Be&&(oe.H=Be),oe.D&&(vn(oe),Ur(oe)),p.g=B}else Ta(p);d.i.length>0&&ws(d)}else be[0]!="stop"&&be[0]!="close"||kr(d,7);else d.I==3&&(be[0]=="stop"||be[0]=="close"?be[0]=="stop"?kr(d,7):Li(d):be[0]!="noop"&&d.l&&d.l.qa(be),d.A=0)}}xr(4)}catch{}}var Vi=class{constructor(i,c){this.g=i,this.map=c}};function us(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ds(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function hs(i){return i.h?1:i.g?i.g.size:0}function wn(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function kn(i,c){i.g?i.g.add(c):i.h=c}function ms(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}us.prototype.cancel=function(){if(this.i=fs(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function fs(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const d of i.g.values())c=c.concat(d.G);return c}return I(i.i)}var ps=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function k(i,c){if(i){i=i.split("&");for(let d=0;d<i.length;d++){const p=i[d].indexOf("=");let N,j=null;p>=0?(N=i[d].substring(0,p),j=i[d].substring(p+1)):N=i[d],c(N,j?decodeURIComponent(j.replace(/\+/g," ")):"")}}}function C(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof C?(this.l=i.l,O(this,i.j),this.o=i.o,this.g=i.g,H(this,i.u),this.h=i.h,Q(this,gs(i.i)),this.m=i.m):i&&(c=String(i).match(ps))?(this.l=!1,O(this,c[1]||"",!0),this.o=te(c[2]||""),this.g=te(c[3]||"",!0),H(this,c[4]),this.h=te(c[5]||"",!0),Q(this,c[6]||"",!0),this.m=te(c[7]||"")):(this.l=!1,this.i=new dt(null,this.l))}C.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(q(c,ut,!0),":");var d=this.g;return(d||c=="file")&&(i.push("//"),(c=this.o)&&i.push(q(c,ut,!0),"@"),i.push(Te(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&i.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&i.push("/"),i.push(q(d,d.charAt(0)=="/"?zt:De,!0))),(d=this.i.toString())&&i.push("?",d),(d=this.m)&&i.push("#",q(d,Wt)),i.join("")},C.prototype.resolve=function(i){const c=S(this);let d=!!i.j;d?O(c,i.j):d=!!i.o,d?c.o=i.o:d=!!i.g,d?c.g=i.g:d=i.u!=null;var p=i.h;if(d)H(c,i.u);else if(d=!!i.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var N=c.h.lastIndexOf("/");N!=-1&&(p=c.h.slice(0,N+1)+p)}if(N=p,N==".."||N==".")p="";else if(N.indexOf("./")!=-1||N.indexOf("/.")!=-1){p=N.lastIndexOf("/",0)==0,N=N.split("/");const j=[];for(let B=0;B<N.length;){const oe=N[B++];oe=="."?p&&B==N.length&&j.push(""):oe==".."?((j.length>1||j.length==1&&j[0]!="")&&j.pop(),p&&B==N.length&&j.push("")):(j.push(oe),p=!0)}p=j.join("/")}else p=N}return d?c.h=p:d=i.i.toString()!=="",d?Q(c,gs(i.i)):d=!!i.m,d&&(c.m=i.m),c};function S(i){return new C(i)}function O(i,c,d){i.j=d?te(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function H(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Q(i,c,d){c instanceof dt?(i.i=c,xs(i.i,i.l)):(d||(c=q(c,vt)),i.i=new dt(c,i.l))}function L(i,c,d){i.i.set(c,d)}function ne(i){return L(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function te(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function q(i,c,d){return typeof i=="string"?(i=encodeURI(i).replace(c,Se),d&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Se(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var ut=/[#\/\?@]/g,De=/[#\?:]/g,zt=/[#\?]/g,vt=/[#\?@]/g,Wt=/#/g;function dt(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Fe(i){i.g||(i.g=new Map,i.h=0,i.i&&k(i.i,function(c,d){i.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}r=dt.prototype,r.add=function(i,c){Fe(this),this.i=null,i=Jt(this,i);let d=this.g.get(i);return d||this.g.set(i,d=[]),d.push(c),this.h+=1,this};function Yt(i,c){Fe(i),c=Jt(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Rt(i,c){return Fe(i),c=Jt(i,c),i.g.has(c)}r.forEach=function(i,c){Fe(this),this.g.forEach(function(d,p){d.forEach(function(N){i.call(c,N,p,this)},this)},this)};function $r(i,c){Fe(i);let d=[];if(typeof c=="string")Rt(i,c)&&(d=d.concat(i.g.get(Jt(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)d=d.concat(i[c]);return d}r.set=function(i,c){return Fe(this),this.i=null,i=Jt(this,i),Rt(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},r.get=function(i,c){return i?(i=$r(this,i),i.length>0?String(i[0]):c):c};function wr(i,c,d){Yt(i,c),d.length>0&&(i.i=null,i.g.set(Jt(i,c),I(d)),i.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var d=c[p];const N=Te(d);d=$r(this,d);for(let j=0;j<d.length;j++){let B=N;d[j]!==""&&(B+="="+Te(d[j])),i.push(B)}}return this.i=i.join("&")};function gs(i){const c=new dt;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Jt(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function xs(i,c){c&&!i.j&&(Fe(i),i.i=null,i.g.forEach(function(d,p){const N=p.toLowerCase();p!=N&&(Yt(this,p),wr(this,N,d))},i)),i.j=c}function bs(i,c){const d=new yr;if(a.Image){const p=new Image;p.onload=f(Xt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=f(Xt,d,"TestLoadImage: error",!1,c,p),p.onabort=f(Xt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(Xt,d,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=i}else c(!1)}function od(i,c){const d=new yr,p=new AbortController,N=setTimeout(()=>{p.abort(),Xt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:p.signal}).then(j=>{clearTimeout(N),j.ok?Xt(d,"TestPingServer: ok",!0,c):Xt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(N),Xt(d,"TestPingServer: error",!1,c)})}function Xt(i,c,d,p,N){try{N&&(N.onload=null,N.onerror=null,N.onabort=null,N.ontimeout=null),p(d)}catch{}}function ad(){this.g=new rs}function Di(i){this.i=i.Sb||null,this.h=i.ab||!1}b(Di,pn),Di.prototype.g=function(){return new ys(this.i,this.h)};function ys(i,c){Re.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}b(ys,Re),r=ys.prototype,r.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Tn(this)},r.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,En(this)),this.readyState=0},r.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Tn(this)),this.g&&(this.readyState=3,Tn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;pa(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function pa(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}r.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?En(this):Tn(this),this.readyState==3&&pa(this)}},r.Oa=function(i){this.g&&(this.response=this.responseText=i,En(this))},r.Na=function(i){this.g&&(this.response=i,En(this))},r.ga=function(){this.g&&En(this)};function En(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Tn(i)}r.setRequestHeader=function(i,c){this.A.append(i,c)},r.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,i.push(d[0]+": "+d[1]),d=c.next();return i.join(`\r
`)};function Tn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(ys.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ga(i){let c="";return Ee(i,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function Mi(i,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=ga(d),typeof i=="string"?d!=null&&Te(d):L(i,c,d))}function je(i){Re.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}b(je,Re);var ld=/^https?$/i,cd=["POST","PUT"];r=je.prototype,r.Fa=function(i){this.H=i},r.ea=function(i,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():is.g(),this.g.onreadystatechange=E(m(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(j){xa(this,j);return}if(i=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var N in p)d.set(N,p[N]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const j of p.keys())d.set(j,p.get(j));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(j=>j.toLowerCase()=="content-type"),N=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(cd,c,void 0)>=0)||p||N||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[j,B]of d)this.g.setRequestHeader(j,B);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(j){xa(this,j)}};function xa(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,ba(i),_s(i)}function ba(i){i.A||(i.A=!0,Pe(i,"complete"),Pe(i,"error"))}r.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Pe(this,"complete"),Pe(this,"abort"),_s(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_s(this,!0)),je.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?ya(this):this.Xa())},r.Xa=function(){ya(this)};function ya(i){if(i.h&&typeof o<"u"){if(i.v&&Zt(i)==4)setTimeout(i.Ca.bind(i),0);else if(Pe(i,"readystatechange"),Zt(i)==4){i.h=!1;try{const j=i.ca();e:switch(j){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=j===0){let B=String(i.D).match(ps)[1]||null;!B&&a.self&&a.self.location&&(B=a.self.location.protocol.slice(0,-1)),p=!ld.test(B?B.toLowerCase():"")}d=p}if(d)Pe(i,"complete"),Pe(i,"success");else{i.o=6;try{var N=Zt(i)>2?i.g.statusText:""}catch{N=""}i.l=N+" ["+i.ca()+"]",ba(i)}}finally{_s(i)}}}}function _s(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const d=i.g;i.g=null,c||Pe(i,"ready");try{d.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function Zt(i){return i.g?i.g.readyState:0}r.ca=function(){try{return Zt(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Bt(c)}};function _a(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function ud(i){const c={};i=(i.g&&Zt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<i.length;p++){if(x(i[p]))continue;var d=Si(i[p]);const N=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const j=c[N]||[];c[N]=j,j.push(d)}Ze(c,function(p){return p.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function In(i,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[i]||c}function va(i){this.za=0,this.i=[],this.j=new yr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=In("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=In("baseRetryDelayMs",5e3,i),this.Za=In("retryDelaySeedMs",1e4,i),this.Ta=In("forwardChannelMaxRetries",2,i),this.va=In("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new us(i&&i.concurrentRequestLimit),this.Ba=new ad,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=va.prototype,r.ka=8,r.I=1,r.connect=function(i,c,d,p){Qe(0),this.W=i,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=Ra(this,null,this.W),ws(this)};function Li(i){if(wa(i),i.I==3){var c=i.V++,d=S(i.J);if(L(d,"SID",i.M),L(d,"RID",c),L(d,"TYPE","terminate"),An(i,d),c=new At(i,i.j,c),c.M=2,c.A=ne(S(d)),d=!1,a.navigator&&a.navigator.sendBeacon)try{d=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!d&&a.Image&&(new Image().src=c.A,d=!0),d||(c.g=Sa(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Ur(c)}Na(i)}function vs(i){i.g&&(Fi(i),i.g.cancel(),i.g=null)}function wa(i){vs(i),i.v&&(a.clearTimeout(i.v),i.v=null),ks(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function ws(i){if(!ds(i.h)&&!i.m){i.m=!0;var c=i.Ea;$||g(),X||($(),X=!0),w.add(c,i),i.D=0}}function dd(i,c){return hs(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=br(m(i.Ea,i,c),Ca(i,i.D)),i.D++,!0)}r.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const N=new At(this,this.j,i);let j=this.o;if(this.U&&(j?(j=ge(j),Ne(j,this.U)):j=this.U),this.u!==null||this.R||(N.J=j,j=null),this.S)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=Ea(this,N,c),d=S(this.J),L(d,"RID",i),L(d,"CVER",22),this.G&&L(d,"X-HTTP-Session-Id",this.G),An(this,d),j&&(this.R?c="headers="+Te(ga(j))+"&"+c:this.u&&Mi(d,this.u,j)),kn(this.h,N),this.Ra&&L(d,"TYPE","init"),this.S?(L(d,"$req",c),L(d,"SID","null"),N.U=!0,yn(N,d,null)):yn(N,d,c),this.I=2}}else this.I==3&&(i?ka(this,i):this.i.length==0||ds(this.h)||ka(this))};function ka(i,c){var d;c?d=c.l:d=i.V++;const p=S(i.J);L(p,"SID",i.M),L(p,"RID",d),L(p,"AID",i.K),An(i,p),i.u&&i.o&&Mi(p,i.u,i.o),d=new At(i,i.j,d,i.D+1),i.u===null&&(d.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Ea(i,d,1e3),d.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),kn(i.h,d),yn(d,p,c)}function An(i,c){i.H&&Ee(i.H,function(d,p){L(c,p,d)}),i.l&&Ee({},function(d,p){L(c,p,d)})}function Ea(i,c,d){d=Math.min(i.i.length,d);const p=i.l?m(i.l.Ka,i.l,i):null;e:{var N=i.i;let oe=-1;for(;;){const Be=["count="+d];oe==-1?d>0?(oe=N[0].g,Be.push("ofs="+oe)):oe=0:Be.push("ofs="+oe);let be=!0;for(let He=0;He<d;He++){var j=N[He].g;const St=N[He].map;if(j-=oe,j<0)oe=Math.max(0,N[He].g-100),be=!1;else try{j="req"+j+"_"||"";try{var B=St instanceof Map?St:Object.entries(St);for(const[Er,er]of B){let tr=er;u(er)&&(tr=fe(er)),Be.push(j+Er+"="+encodeURIComponent(tr))}}catch(Er){throw Be.push(j+"type="+encodeURIComponent("_badmap")),Er}}catch{p&&p(St)}}if(be){B=Be.join("&");break e}}B=void 0}return i=i.i.splice(0,d),c.G=i,B}function Ta(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;$||g(),X||($(),X=!0),w.add(c,i),i.A=0}}function Oi(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=br(m(i.Da,i),Ca(i,i.A)),i.A++,!0)}r.Da=function(){if(this.v=null,Ia(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=br(m(this.Wa,this),i)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Qe(10),vs(this),Ia(this))};function Fi(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Ia(i){i.g=new At(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=S(i.na);L(c,"RID","rpc"),L(c,"SID",i.M),L(c,"AID",i.K),L(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&L(c,"TO",i.ia),L(c,"TYPE","xmlhttp"),An(i,c),i.u&&i.o&&Mi(c,i.u,i.o),i.O&&(i.g.H=i.O);var d=i.g;i=i.ba,d.M=1,d.A=ne(S(c)),d.u=null,d.R=!0,ls(d,i)}r.Va=function(){this.C!=null&&(this.C=null,vs(this),Oi(this),Qe(19))};function ks(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Aa(i,c){var d=null;if(i.g==c){ks(i),Fi(i),i.g=null;var p=2}else if(wn(i.h,c))d=c.G,ms(i.h,c),p=1;else return;if(i.I!=0){if(c.o)if(p==1){d=c.u?c.u.length:0,c=Date.now()-c.F;var N=i.D;p=ct(),Pe(p,new gn(p,d)),ws(i)}else Ta(i);else if(N=c.m,N==3||N==0&&c.X>0||!(p==1&&dd(i,c)||p==2&&Oi(i)))switch(d&&d.length>0&&(c=i.h,c.i=c.i.concat(d)),N){case 1:kr(i,5);break;case 4:kr(i,10);break;case 3:kr(i,6);break;default:kr(i,2)}}}function Ca(i,c){let d=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(d*=2),d*c}function kr(i,c){if(i.j.info("Error code "+c),c==2){var d=m(i.bb,i),p=i.Ua;const N=!p;p=new C(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||O(p,"https"),ne(p),N?bs(p.toString(),d):od(p.toString(),d)}else Qe(2);i.I=0,i.l&&i.l.pa(c),Na(i),wa(i)}r.bb=function(i){i?(this.j.info("Successfully pinged google.com"),Qe(2)):(this.j.info("Failed to ping google.com"),Qe(1))};function Na(i){if(i.I=0,i.ja=[],i.l){const c=fs(i.h);(c.length!=0||i.i.length!=0)&&(P(i.ja,c),P(i.ja,i.i),i.h.i.length=0,I(i.i),i.i.length=0),i.l.oa()}}function Ra(i,c,d){var p=d instanceof C?S(d):new C(d);if(p.g!="")c&&(p.g=c+"."+p.g),H(p,p.u);else{var N=a.location;p=N.protocol,c=c?c+"."+N.hostname:N.hostname,N=+N.port;const j=new C(null);p&&O(j,p),c&&(j.g=c),N&&H(j,N),d&&(j.h=d),p=j}return d=i.G,c=i.wa,d&&c&&L(p,d,c),L(p,"VER",i.ka),An(i,p),p}function Sa(i,c,d){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new je(new Di({ab:d})):new je(i.ma),c.Fa(i.L),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function ja(){}r=ja.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function Es(){}Es.prototype.g=function(i,c){return new ht(i,c)};function ht(i,c){Re.call(this),this.g=new va(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!x(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!x(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new qr(this)}b(ht,Re),ht.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ht.prototype.close=function(){Li(this.g)},ht.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var d={};d.__data__=i,i=d}else this.v&&(d={},d.__data__=fe(i),i=d);c.i.push(new Vi(c.Ya++,i)),c.I==3&&ws(c)},ht.prototype.N=function(){this.g.l=null,delete this.j,Li(this.g),delete this.g,ht.Z.N.call(this)};function Pa(i){Fr.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const d in c){i=d;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}b(Pa,Fr);function Va(){pt.call(this),this.status=1}b(Va,pt);function qr(i){this.g=i}b(qr,ja),qr.prototype.ra=function(){Pe(this.g,"a")},qr.prototype.qa=function(i){Pe(this.g,new Pa(i))},qr.prototype.pa=function(i){Pe(this.g,new Va)},qr.prototype.oa=function(){Pe(this.g,"b")},Es.prototype.createWebChannel=Es.prototype.g,ht.prototype.send=ht.prototype.o,ht.prototype.open=ht.prototype.m,ht.prototype.close=ht.prototype.close,vc=function(){return new Es},_c=function(){return ct()},yc=Ut,lo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Br.NO_ERROR=0,Br.TIMEOUT=8,Br.HTTP_ERROR=6,Ls=Br,xn.COMPLETE="complete",bc=xn,ns.EventType=Ke,Ke.OPEN="a",Ke.CLOSE="b",Ke.ERROR="c",Ke.MESSAGE="d",Re.prototype.listen=Re.prototype.J,Rn=ns,je.prototype.listenOnce=je.prototype.K,je.prototype.getLastError=je.prototype.Ha,je.prototype.getLastErrorCode=je.prototype.ya,je.prototype.getStatus=je.prototype.ca,je.prototype.getResponseJson=je.prototype.La,je.prototype.getResponseText=je.prototype.la,je.prototype.send=je.prototype.ea,je.prototype.setWithCredentials=je.prototype.Fa,xc=je}).apply(typeof Is<"u"?Is:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}st.UNAUTHENTICATED=new st(null),st.GOOGLE_CREDENTIALS=new st("google-credentials-uid"),st.FIRST_PARTY=new st("first-party-uid"),st.MOCK_USER=new st("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let un="12.9.0";function um(r){un=r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cr=new uc("@firebase/firestore");function zr(){return Cr.logLevel}function G(r,...e){if(Cr.logLevel<=he.DEBUG){const t=e.map(So);Cr.debug(`Firestore (${un}): ${r}`,...t)}}function Gt(r,...e){if(Cr.logLevel<=he.ERROR){const t=e.map(So);Cr.error(`Firestore (${un}): ${r}`,...t)}}function Nr(r,...e){if(Cr.logLevel<=he.WARN){const t=e.map(So);Cr.warn(`Firestore (${un}): ${r}`,...t)}}function So(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function re(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,wc(r,n,t)}function wc(r,e,t){let n=`FIRESTORE (${un}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw Gt(n),new Error(n)}function pe(r,e,t,n){let s="Unexpected state";typeof t=="string"?s=t:n=t,r||wc(e,s,n)}function ie(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends cn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class dm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(st.UNAUTHENTICATED))}shutdown(){}}class hm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class mm{constructor(e){this.t=e,this.currentUser=st.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){pe(this.o===void 0,42304);let n=this.i;const s=h=>this.i!==n?(n=this.i,t(h)):Promise.resolve();let o=new ar;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ar,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const h=o;e.enqueueRetryable(async()=>{await h.promise,await s(this.currentUser)})},u=h=>{G("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(G("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ar)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(G("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(pe(typeof n.accessToken=="string",31837,{l:n}),new kc(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return pe(e===null||typeof e=="string",2055,{h:e}),new st(e)}}class fm{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=st.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class pm{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new fm(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(st.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Qa{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gm{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Qh(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){pe(this.o===void 0,3512);const n=o=>{o.error!=null&&G("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,G("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>n(o))};const s=o=>{G("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):G("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Qa(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(pe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Qa(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xm(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=xm(40);for(let o=0;o<s.length;++o)n.length<20&&s[o]<t&&(n+=e.charAt(s[o]%62))}return n}}function le(r,e){return r<e?-1:r>e?1:0}function co(r,e){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++){const s=r.charAt(n),o=e.charAt(n);if(s!==o)return Wi(s)===Wi(o)?le(s,o):Wi(s)?1:-1}return le(r.length,e.length)}const bm=55296,ym=57343;function Wi(r){const e=r.charCodeAt(0);return e>=bm&&e<=ym}function tn(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya="__name__";class Pt{constructor(e,t,n){t===void 0?t=0:t>e.length&&re(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&re(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Pt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Pt?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const o=Pt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return le(e.length,t.length)}static compareSegments(e,t){const n=Pt.isNumericId(e),s=Pt.isNumericId(t);return n&&!s?-1:!n&&s?1:n&&s?Pt.extractNumericId(e).compare(Pt.extractNumericId(t)):co(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return or.fromString(e.substring(4,e.length-2))}}class ye extends Pt{construct(e,t,n){return new ye(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new U(V.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new ye(t)}static emptyPath(){return new ye([])}}const _m=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Je extends Pt{construct(e,t,n){return new Je(e,t,n)}static isValidIdentifier(e){return _m.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Je.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ya}static keyField(){return new Je([Ya])}static fromServerFormat(e){const t=[];let n="",s=0;const o=()=>{if(n.length===0)throw new U(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new U(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new U(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(n+=u,s++):(o(),s++)}if(o(),a)throw new U(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Je(t)}static emptyPath(){return new Je([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z{constructor(e){this.path=e}static fromPath(e){return new Z(ye.fromString(e))}static fromName(e){return new Z(ye.fromString(e).popFirst(5))}static empty(){return new Z(ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ye.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Z(new ye(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ec(r,e,t){if(!t)throw new U(V.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function vm(r,e,t,n){if(e===!0&&n===!0)throw new U(V.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Ja(r){if(!Z.isDocumentKey(r))throw new U(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Xa(r){if(Z.isDocumentKey(r))throw new U(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Tc(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function ui(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":re(12329,{type:typeof r})}function rn(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new U(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ui(r);throw new U(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function wm(r,e){if(e<=0)throw new U(V.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oe(r,e){const t={typeString:r};return e&&(t.value=e),t}function Jn(r,e){if(!Tc(r))throw new U(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const s=e[n].typeString,o="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}const a=r[n];if(s&&typeof a!==s){t=`JSON field '${n}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${n}' field to equal '${o.value}'`;break}}if(t)throw new U(V.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Za=-62135596800,el=1e6;class we{static now(){return we.fromMillis(Date.now())}static fromDate(e){return we.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*el);return new we(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new U(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new U(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Za)throw new U(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new U(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/el}_compareTo(e){return this.seconds===e.seconds?le(this.nanoseconds,e.nanoseconds):le(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:we._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Jn(e,we._jsonSchema))return new we(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Za;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}we._jsonSchemaVersion="firestore/timestamp/1.0",we._jsonSchema={type:Oe("string",we._jsonSchemaVersion),seconds:Oe("number"),nanoseconds:Oe("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{static fromTimestamp(e){return new se(e)}static min(){return new se(new we(0,0))}static max(){return new se(new we(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qn=-1;function km(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=se.fromTimestamp(n===1e9?new we(t+1,0):new we(t,n));return new cr(s,Z.empty(),e)}function Em(r){return new cr(r.readTime,r.key,qn)}class cr{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new cr(se.min(),Z.empty(),qn)}static max(){return new cr(se.max(),Z.empty(),qn)}}function Tm(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=Z.comparator(r.documentKey,e.documentKey),t!==0?t:le(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Im="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Am{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dn(r){if(r.code!==V.FAILED_PRECONDITION||r.message!==Im)throw r;G("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&re(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D((n,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(n,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):D.reject(t)}static resolve(e){return new D((t,n)=>{t(e)})}static reject(e){return new D((t,n)=>{n(e)})}static waitFor(e){return new D((t,n)=>{let s=0,o=0,a=!1;e.forEach(u=>{++s,u.next(()=>{++o,a&&o===s&&t()},h=>n(h))}),a=!0,o===s&&t()})}static or(e){let t=D.resolve(!1);for(const n of e)t=t.next(s=>s?D.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,o)=>{n.push(t.call(this,s,o))}),this.waitFor(n)}static mapArray(e,t){return new D((n,s)=>{const o=e.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const m=h;t(e[m]).next(f=>{a[m]=f,++u,u===o&&n(a)},f=>s(f))}})}static doWhile(e,t){return new D((n,s)=>{const o=()=>{e()===!0?t().next(()=>{o()},s):n()};o()})}}function Cm(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function hn(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}di.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Po=-1;function hi(r){return r==null}function Ys(r){return r===0&&1/r==-1/0}function Nm(r){return typeof r=="number"&&Number.isInteger(r)&&!Ys(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ic="";function Rm(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=tl(e)),e=Sm(r.get(t),e);return tl(e)}function Sm(r,e){let t=e;const n=r.length;for(let s=0;s<n;s++){const o=r.charAt(s);switch(o){case"\0":t+="";break;case Ic:t+="";break;default:t+=o}}return t}function tl(r){return r+Ic+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rl(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function jr(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Ac(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e,t){this.comparator=e,this.root=t||Ye.EMPTY}insert(e,t){return new Ie(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ye.BLACK,null,null))}remove(e){return new Ie(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ye.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new As(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new As(this.root,e,this.comparator,!1)}getReverseIterator(){return new As(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new As(this.root,e,this.comparator,!0)}}class As{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ye{constructor(e,t,n,s,o){this.key=e,this.value=t,this.color=n??Ye.RED,this.left=s??Ye.EMPTY,this.right=o??Ye.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,o){return new Ye(e??this.key,t??this.value,n??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const o=n(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,n),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ye.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ye.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ye.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ye.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw re(43730,{key:this.key,value:this.value});if(this.right.isRed())throw re(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw re(27949);return e+(this.isRed()?0:1)}}Ye.EMPTY=null,Ye.RED=!0,Ye.BLACK=!1;Ye.EMPTY=new class{constructor(){this.size=0}get key(){throw re(57766)}get value(){throw re(16141)}get color(){throw re(16727)}get left(){throw re(29726)}get right(){throw re(36894)}copy(e,t,n,s,o){return this}insert(e,t,n){return new Ye(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $e{constructor(e){this.comparator=e,this.data=new Ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nl(this.data.getIterator())}getIteratorFrom(e){return new nl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof $e)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=n.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new $e(this.comparator);return t.data=e,t}}class nl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this.fields=e,e.sort(Je.comparator)}static empty(){return new wt([])}unionWith(e){let t=new $e(Je.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new wt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tn(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Cc("Invalid base64 string: "+o):o}}(e);return new Xe(t)}static fromUint8Array(e){const t=function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o}(e);return new Xe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return le(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xe.EMPTY_BYTE_STRING=new Xe("");const jm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ur(r){if(pe(!!r,39018),typeof r=="string"){let e=0;const t=jm.exec(r);if(pe(!!t,46558,{timestamp:r}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ve(r.seconds),nanos:Ve(r.nanos)}}function Ve(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function dr(r){return typeof r=="string"?Xe.fromBase64String(r):Xe.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc="server_timestamp",Rc="__type__",Sc="__previous_value__",jc="__local_write_time__";function mi(r){var t,n;return((n=(((t=r==null?void 0:r.mapValue)==null?void 0:t.fields)||{})[Rc])==null?void 0:n.stringValue)===Nc}function fi(r){const e=r.mapValue.fields[Sc];return mi(e)?fi(e):e}function zn(r){const e=ur(r.mapValue.fields[jc].timestampValue);return new we(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(e,t,n,s,o,a,u,h,m,f,b){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=m,this.isUsingEmulator=f,this.apiKey=b}}const Js="(default)";class Wn{constructor(e,t){this.projectId=e,this.database=t||Js}static empty(){return new Wn("","")}get isDefaultDatabase(){return this.database===Js}isEqual(e){return e instanceof Wn&&e.projectId===this.projectId&&e.database===this.database}}function Vm(r,e){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new U(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wn(r.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pc="__type__",Dm="__max__",Cs={mapValue:{}},Vc="__vector__",Xs="value";function hr(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?mi(r)?4:Lm(r)?9007199254740991:Mm(r)?10:11:re(28295,{value:r})}function Ot(r,e){if(r===e)return!0;const t=hr(r);if(t!==hr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return zn(r).isEqual(zn(e));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=ur(s.timestampValue),u=ur(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(s,o){return dr(s.bytesValue).isEqual(dr(o.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,o){return Ve(s.geoPointValue.latitude)===Ve(o.geoPointValue.latitude)&&Ve(s.geoPointValue.longitude)===Ve(o.geoPointValue.longitude)}(r,e);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return Ve(s.integerValue)===Ve(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=Ve(s.doubleValue),u=Ve(o.doubleValue);return a===u?Ys(a)===Ys(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return tn(r.arrayValue.values||[],e.arrayValue.values||[],Ot);case 10:case 11:return function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(rl(a)!==rl(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Ot(a[h],u[h])))return!1;return!0}(r,e);default:return re(52216,{left:r})}}function Hn(r,e){return(r.values||[]).find(t=>Ot(t,e))!==void 0}function nn(r,e){if(r===e)return 0;const t=hr(r),n=hr(e);if(t!==n)return le(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return le(r.booleanValue,e.booleanValue);case 2:return function(o,a){const u=Ve(o.integerValue||o.doubleValue),h=Ve(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(r,e);case 3:return sl(r.timestampValue,e.timestampValue);case 4:return sl(zn(r),zn(e));case 5:return co(r.stringValue,e.stringValue);case 6:return function(o,a){const u=dr(o),h=dr(a);return u.compareTo(h)}(r.bytesValue,e.bytesValue);case 7:return function(o,a){const u=o.split("/"),h=a.split("/");for(let m=0;m<u.length&&m<h.length;m++){const f=le(u[m],h[m]);if(f!==0)return f}return le(u.length,h.length)}(r.referenceValue,e.referenceValue);case 8:return function(o,a){const u=le(Ve(o.latitude),Ve(a.latitude));return u!==0?u:le(Ve(o.longitude),Ve(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return il(r.arrayValue,e.arrayValue);case 10:return function(o,a){var E,I,P,M;const u=o.fields||{},h=a.fields||{},m=(E=u[Xs])==null?void 0:E.arrayValue,f=(I=h[Xs])==null?void 0:I.arrayValue,b=le(((P=m==null?void 0:m.values)==null?void 0:P.length)||0,((M=f==null?void 0:f.values)==null?void 0:M.length)||0);return b!==0?b:il(m,f)}(r.mapValue,e.mapValue);case 11:return function(o,a){if(o===Cs.mapValue&&a===Cs.mapValue)return 0;if(o===Cs.mapValue)return 1;if(a===Cs.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),m=a.fields||{},f=Object.keys(m);h.sort(),f.sort();for(let b=0;b<h.length&&b<f.length;++b){const E=co(h[b],f[b]);if(E!==0)return E;const I=nn(u[h[b]],m[f[b]]);if(I!==0)return I}return le(h.length,f.length)}(r.mapValue,e.mapValue);default:throw re(23264,{he:t})}}function sl(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return le(r,e);const t=ur(r),n=ur(e),s=le(t.seconds,n.seconds);return s!==0?s:le(t.nanos,n.nanos)}function il(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const o=nn(t[s],n[s]);if(o)return o}return le(t.length,n.length)}function sn(r){return uo(r)}function uo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=ur(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return dr(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return Z.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const o of t.values||[])s?s=!1:n+=",",n+=uo(o);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const a of n)o?o=!1:s+=",",s+=`${a}:${uo(t.fields[a])}`;return s+"}"}(r.mapValue):re(61005,{value:r})}function Os(r){switch(hr(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fi(r);return e?16+Os(e):16;case 5:return 2*r.stringValue.length;case 6:return dr(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((s,o)=>s+Os(o),0)}(r.arrayValue);case 10:case 11:return function(n){let s=0;return jr(n.fields,(o,a)=>{s+=o.length+Os(a)}),s}(r.mapValue);default:throw re(13486,{value:r})}}function Zs(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function ho(r){return!!r&&"integerValue"in r}function Vo(r){return!!r&&"arrayValue"in r}function ol(r){return!!r&&"nullValue"in r}function al(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Fs(r){return!!r&&"mapValue"in r}function Mm(r){var t,n;return((n=(((t=r==null?void 0:r.mapValue)==null?void 0:t.fields)||{})[Pc])==null?void 0:n.stringValue)===Vc}function Ln(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const e={mapValue:{fields:{}}};return jr(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Ln(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ln(r.arrayValue.values[t]);return e}return{...r}}function Lm(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Dm}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gt{constructor(e){this.value=e}static empty(){return new gt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Fs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ln(t)}setAll(e){let t=Je.emptyPath(),n={},s=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,n,s),n={},s=[],t=u.popLast()}a?n[u.lastSegment()]=Ln(a):s.push(u.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,n,s)}delete(e){const t=this.field(e.popLast());Fs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ot(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];Fs(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){jr(t,(s,o)=>e[s]=o);for(const s of n)delete e[s]}clone(){return new gt(Ln(this.value))}}function Dc(r){const e=[];return jr(r.fields,(t,n)=>{const s=new Je([t]);if(Fs(n)){const o=Dc(n.mapValue).fields;if(o.length===0)e.push(s);else for(const a of o)e.push(s.child(a))}else e.push(s)}),new wt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e,t,n,s,o,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new it(e,0,se.min(),se.min(),se.min(),gt.empty(),0)}static newFoundDocument(e,t,n,s){return new it(e,1,t,se.min(),n,s,0)}static newNoDocument(e,t){return new it(e,2,t,se.min(),se.min(),gt.empty(),0)}static newUnknownDocument(e,t){return new it(e,3,t,se.min(),se.min(),gt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(se.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=se.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof it&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new it(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e,t){this.position=e,this.inclusive=t}}function ll(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const o=e[s],a=r.position[s];if(o.field.isKeyField()?n=Z.comparator(Z.fromName(a.referenceValue),t.key):n=nn(a,t.data.field(o.field)),o.dir==="desc"&&(n*=-1),n!==0)break}return n}function cl(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Ot(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Om(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{}class Le extends Mc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new Bm(e,t,n):t==="array-contains"?new qm(e,n):t==="in"?new zm(e,n):t==="not-in"?new Wm(e,n):t==="array-contains-any"?new Hm(e,n):new Le(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Um(e,n):new $m(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(nn(t,this.value)):t!==null&&hr(this.value)===hr(t)&&this.matchesComparison(nn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return re(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Et extends Mc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Et(e,t)}matches(e){return Lc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Lc(r){return r.op==="and"}function Oc(r){return Fm(r)&&Lc(r)}function Fm(r){for(const e of r.filters)if(e instanceof Et)return!1;return!0}function mo(r){if(r instanceof Le)return r.field.canonicalString()+r.op.toString()+sn(r.value);if(Oc(r))return r.filters.map(e=>mo(e)).join(",");{const e=r.filters.map(t=>mo(t)).join(",");return`${r.op}(${e})`}}function Fc(r,e){return r instanceof Le?function(n,s){return s instanceof Le&&n.op===s.op&&n.field.isEqual(s.field)&&Ot(n.value,s.value)}(r,e):r instanceof Et?function(n,s){return s instanceof Et&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((o,a,u)=>o&&Fc(a,s.filters[u]),!0):!1}(r,e):void re(19439)}function Bc(r){return r instanceof Le?function(t){return`${t.field.canonicalString()} ${t.op} ${sn(t.value)}`}(r):r instanceof Et?function(t){return t.op.toString()+" {"+t.getFilters().map(Bc).join(" ,")+"}"}(r):"Filter"}class Bm extends Le{constructor(e,t,n){super(e,t,n),this.key=Z.fromName(n.referenceValue)}matches(e){const t=Z.comparator(e.key,this.key);return this.matchesComparison(t)}}class Um extends Le{constructor(e,t){super(e,"in",t),this.keys=Uc("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class $m extends Le{constructor(e,t){super(e,"not-in",t),this.keys=Uc("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Uc(r,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(n=>Z.fromName(n.referenceValue))}class qm extends Le{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Vo(t)&&Hn(t.arrayValue,this.value)}}class zm extends Le{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Hn(this.value.arrayValue,t)}}class Wm extends Le{constructor(e,t){super(e,"not-in",t)}matches(e){if(Hn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Hn(this.value.arrayValue,t)}}class Hm extends Le{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Vo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Hn(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(e,t=null,n=[],s=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function ul(r,e=null,t=[],n=[],s=null,o=null,a=null){return new Gm(r,e,t,n,s,o,a)}function Do(r){const e=ie(r);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>mo(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(o){return o.field.canonicalString()+o.dir}(n)).join(","),hi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>sn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>sn(n)).join(",")),e.Te=t}return e.Te}function Mo(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Om(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Fc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!cl(r.startAt,e.startAt)&&cl(r.endAt,e.endAt)}function fo(r){return Z.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e,t=null,n=[],s=[],o=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Km(r,e,t,n,s,o,a,u){return new Pr(r,e,t,n,s,o,a,u)}function $c(r){return new Pr(r)}function dl(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Qm(r){return Z.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Lo(r){return r.collectionGroup!==null}function Qr(r){const e=ie(r);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new $e(Je.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(m=>{m.isInequality()&&(u=u.add(m.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Gn(o,n))}),t.has(Je.keyField().canonicalString())||e.Ie.push(new Gn(Je.keyField(),n))}return e.Ie}function Vt(r){const e=ie(r);return e.Ee||(e.Ee=Ym(e,Qr(r))),e.Ee}function Ym(r,e){if(r.limitType==="F")return ul(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>{const o=s.dir==="desc"?"asc":"desc";return new Gn(s.field,o)});const t=r.endAt?new on(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new on(r.startAt.position,r.startAt.inclusive):null;return ul(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function po(r,e){const t=r.filters.concat([e]);return new Pr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Jm(r,e){const t=r.explicitOrderBy.concat([e]);return new Pr(r.path,r.collectionGroup,t,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}function ei(r,e,t){return new Pr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Xm(r,e){return new Pr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,e,r.endAt)}function pi(r,e){return Mo(Vt(r),Vt(e))&&r.limitType===e.limitType}function qc(r){return`${Do(Vt(r))}|lt:${r.limitType}`}function Wr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>Bc(s)).join(", ")}]`),hi(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>sn(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>sn(s)).join(",")),`Target(${n})`}(Vt(r))}; limitType=${r.limitType})`}function gi(r,e){return e.isFoundDocument()&&function(n,s){const o=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):Z.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)}(r,e)&&function(n,s){for(const o of Qr(n))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(r,e)&&function(n,s){for(const o of n.filters)if(!o.matches(s))return!1;return!0}(r,e)&&function(n,s){return!(n.startAt&&!function(a,u,h){const m=ll(a,u,h);return a.inclusive?m<=0:m<0}(n.startAt,Qr(n),s)||n.endAt&&!function(a,u,h){const m=ll(a,u,h);return a.inclusive?m>=0:m>0}(n.endAt,Qr(n),s))}(r,e)}function Zm(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function zc(r){return(e,t)=>{let n=!1;for(const s of Qr(r)){const o=ef(s,e,t);if(o!==0)return o;n=n||s.field.isKeyField()}return 0}}function ef(r,e,t){const n=r.field.isKeyField()?Z.comparator(e.key,t.key):function(o,a,u){const h=a.data.field(o),m=u.data.field(o);return h!==null&&m!==null?nn(h,m):re(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return re(19790,{direction:r.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[s,o]of n)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){jr(this.inner,(t,n)=>{for(const[s,o]of n)e(s,o)})}isEmpty(){return Ac(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf=new Ie(Z.comparator);function Kt(){return tf}const Wc=new Ie(Z.comparator);function Sn(...r){let e=Wc;for(const t of r)e=e.insert(t.key,t);return e}function Hc(r){let e=Wc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Ir(){return On()}function Gc(){return On()}function On(){return new Vr(r=>r.toString(),(r,e)=>r.isEqual(e))}const rf=new Ie(Z.comparator),nf=new $e(Z.comparator);function ce(...r){let e=nf;for(const t of r)e=e.add(t);return e}const sf=new $e(le);function of(){return sf}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oo(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ys(e)?"-0":e}}function Kc(r){return{integerValue:""+r}}function af(r,e){return Nm(e)?Kc(e):Oo(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(){this._=void 0}}function lf(r,e,t){return r instanceof ti?function(s,o){const a={fields:{[Rc]:{stringValue:Nc},[jc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&mi(o)&&(o=fi(o)),o&&(a.fields[Sc]=o),{mapValue:a}}(t,e):r instanceof Kn?Yc(r,e):r instanceof Qn?Jc(r,e):function(s,o){const a=Qc(s,o),u=hl(a)+hl(s.Ae);return ho(a)&&ho(s.Ae)?Kc(u):Oo(s.serializer,u)}(r,e)}function cf(r,e,t){return r instanceof Kn?Yc(r,e):r instanceof Qn?Jc(r,e):t}function Qc(r,e){return r instanceof ri?function(n){return ho(n)||function(o){return!!o&&"doubleValue"in o}(n)}(e)?e:{integerValue:0}:null}class ti extends xi{}class Kn extends xi{constructor(e){super(),this.elements=e}}function Yc(r,e){const t=Xc(e);for(const n of r.elements)t.some(s=>Ot(s,n))||t.push(n);return{arrayValue:{values:t}}}class Qn extends xi{constructor(e){super(),this.elements=e}}function Jc(r,e){let t=Xc(e);for(const n of r.elements)t=t.filter(s=>!Ot(s,n));return{arrayValue:{values:t}}}class ri extends xi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function hl(r){return Ve(r.integerValue||r.doubleValue)}function Xc(r){return Vo(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function uf(r,e){return r.field.isEqual(e.field)&&function(n,s){return n instanceof Kn&&s instanceof Kn||n instanceof Qn&&s instanceof Qn?tn(n.elements,s.elements,Ot):n instanceof ri&&s instanceof ri?Ot(n.Ae,s.Ae):n instanceof ti&&s instanceof ti}(r.transform,e.transform)}class df{constructor(e,t){this.version=e,this.transformResults=t}}class Dt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Dt}static exists(e){return new Dt(void 0,e)}static updateTime(e){return new Dt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Bs(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class bi{}function Zc(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Fo(r.key,Dt.none()):new Xn(r.key,r.data,Dt.none());{const t=r.data,n=gt.empty();let s=new $e(Je.comparator);for(let o of e.fields)if(!s.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?n.delete(o):n.set(o,a),s=s.add(o)}return new Dr(r.key,n,new wt(s.toArray()),Dt.none())}}function hf(r,e,t){r instanceof Xn?function(s,o,a){const u=s.value.clone(),h=fl(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof Dr?function(s,o,a){if(!Bs(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=fl(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(eu(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(r,e,t):function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Fn(r,e,t,n){return r instanceof Xn?function(o,a,u,h){if(!Bs(o.precondition,a))return u;const m=o.value.clone(),f=pl(o.fieldTransforms,h,a);return m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null}(r,e,t,n):r instanceof Dr?function(o,a,u,h){if(!Bs(o.precondition,a))return u;const m=pl(o.fieldTransforms,h,a),f=a.data;return f.setAll(eu(o)),f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(b=>b.field))}(r,e,t,n):function(o,a,u){return Bs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,e,t)}function mf(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),o=Qc(n.transform,s||null);o!=null&&(t===null&&(t=gt.empty()),t.set(n.field,o))}return t||null}function ml(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&tn(n,s,(o,a)=>uf(o,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class Xn extends bi{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Dr extends bi{constructor(e,t,n,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function eu(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function fl(r,e,t){const n=new Map;pe(r.length===t.length,32656,{Ve:t.length,de:r.length});for(let s=0;s<t.length;s++){const o=r[s],a=o.transform,u=e.data.field(o.field);n.set(o.field,cf(a,u,t[s]))}return n}function pl(r,e,t){const n=new Map;for(const s of r){const o=s.transform,a=t.data.field(s.field);n.set(s.field,lf(o,a,e))}return n}class Fo extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ff extends bi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&hf(o,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Fn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Fn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Gc();return this.mutations.forEach(s=>{const o=e.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(s.key)?null:u;const h=Zc(a,u);h!==null&&n.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(se.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ce())}isEqual(e){return this.batchId===e.batchId&&tn(this.mutations,e.mutations,(t,n)=>ml(t,n))&&tn(this.baseMutations,e.baseMutations,(t,n)=>ml(t,n))}}class Bo{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){pe(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let s=function(){return rf}();const o=e.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,n[a].version);return new Bo(e,t,n,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Me,de;function bf(r){switch(r){case V.OK:return re(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return re(15467,{code:r})}}function tu(r){if(r===void 0)return Gt("GRPC error has no .code"),V.UNKNOWN;switch(r){case Me.OK:return V.OK;case Me.CANCELLED:return V.CANCELLED;case Me.UNKNOWN:return V.UNKNOWN;case Me.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Me.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Me.INTERNAL:return V.INTERNAL;case Me.UNAVAILABLE:return V.UNAVAILABLE;case Me.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Me.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Me.NOT_FOUND:return V.NOT_FOUND;case Me.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Me.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Me.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Me.ABORTED:return V.ABORTED;case Me.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Me.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Me.DATA_LOSS:return V.DATA_LOSS;default:return re(39323,{code:r})}}(de=Me||(Me={}))[de.OK=0]="OK",de[de.CANCELLED=1]="CANCELLED",de[de.UNKNOWN=2]="UNKNOWN",de[de.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",de[de.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",de[de.NOT_FOUND=5]="NOT_FOUND",de[de.ALREADY_EXISTS=6]="ALREADY_EXISTS",de[de.PERMISSION_DENIED=7]="PERMISSION_DENIED",de[de.UNAUTHENTICATED=16]="UNAUTHENTICATED",de[de.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",de[de.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",de[de.ABORTED=10]="ABORTED",de[de.OUT_OF_RANGE=11]="OUT_OF_RANGE",de[de.UNIMPLEMENTED=12]="UNIMPLEMENTED",de[de.INTERNAL=13]="INTERNAL",de[de.UNAVAILABLE=14]="UNAVAILABLE",de[de.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yf(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _f=new or([4294967295,4294967295],0);function gl(r){const e=yf().encode(r),t=new gc;return t.update(e),new Uint8Array(t.digest())}function xl(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new or([t,n],0),new or([s,o],0)]}class Uo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new jn(`Invalid padding: ${t}`);if(n<0)throw new jn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new jn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new jn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=or.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(or.fromNumber(n)));return s.compare(_f)===1&&(s=new or([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=gl(e),[n,s]=xl(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(n,s,o);if(!this.we(a))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Uo(o,s,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(this.ge===0)return;const t=gl(e),[n,s]=xl(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(n,s,o);this.be(a)}}be(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class jn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi{constructor(e,t,n,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,Zn.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new yi(se.min(),s,new Ie(le),Kt(),ce())}}class Zn{constructor(e,t,n,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Zn(n,t,ce(),ce(),ce())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us{constructor(e,t,n,s){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=s}}class ru{constructor(e,t){this.targetId=e,this.Ce=t}}class nu{constructor(e,t,n=Xe.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class bl{constructor(){this.ve=0,this.Fe=yl(),this.Me=Xe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ce(),t=ce(),n=ce();return this.Fe.forEach((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:re(38017,{changeType:o})}}),new Zn(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=yl()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,pe(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class vf{constructor(e){this.Ge=e,this.ze=new Map,this.je=Kt(),this.He=Ns(),this.Je=Ns(),this.Ze=new Ie(le)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:re(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((n,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,n=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(fo(o))if(n===0){const a=new Z(o.path);this.et(t,a,it.newNoDocument(a,se.min()))}else pe(n===1,20013,{expectedCount:n});else{const a=this._t(t);if(a!==n){const u=this.ut(e),h=u?this.ct(u,e,a):1;if(h!==0){this.it(t);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,m)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:o=0}=t;let a,u;try{a=dr(n).toUint8Array()}catch(h){if(h instanceof Cc)return Nr("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Uo(a,s,o)}catch(h){return Nr(h instanceof jn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let s=0;return n.forEach(o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((o,a)=>{const u=this.ot(a);if(u){if(o.current&&fo(u.target)){const h=new Z(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,it.newNoDocument(h,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}});let n=ce();this.Je.forEach((o,a)=>{let u=!0;a.forEachWhile(h=>{const m=this.ot(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(o))}),this.je.forEach((o,a)=>a.setReadTime(e));const s=new yi(e,t,this.Ze,this.je,n);return this.je=Kt(),this.He=Ns(),this.Je=Ns(),this.Ze=new Ie(le),s}Ye(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new bl,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new $e(le),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new $e(le),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||G("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new bl),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ns(){return new Ie(Z.comparator)}function yl(){return new Ie(Z.comparator)}const wf={asc:"ASCENDING",desc:"DESCENDING"},kf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ef={and:"AND",or:"OR"};class Tf{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function go(r,e){return r.useProto3Json||hi(e)?e:{value:e}}function ni(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function su(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function If(r,e){return ni(r,e.toTimestamp())}function Mt(r){return pe(!!r,49232),se.fromTimestamp(function(t){const n=ur(t);return new we(n.seconds,n.nanos)}(r))}function $o(r,e){return xo(r,e).canonicalString()}function xo(r,e){const t=function(s){return new ye(["projects",s.projectId,"databases",s.database])}(r).child("documents");return e===void 0?t:t.child(e)}function iu(r){const e=ye.fromString(r);return pe(uu(e),10190,{key:e.toString()}),e}function bo(r,e){return $o(r.databaseId,e.path)}function Hi(r,e){const t=iu(e);if(t.get(1)!==r.databaseId.projectId)throw new U(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new U(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new Z(au(t))}function ou(r,e){return $o(r.databaseId,e)}function Af(r){const e=iu(r);return e.length===4?ye.emptyPath():au(e)}function yo(r){return new ye(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function au(r){return pe(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function _l(r,e,t){return{name:bo(r,e),fields:t.value.mapValue.fields}}function Cf(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:re(39313,{state:m})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=function(m,f){return m.useProto3Json?(pe(f===void 0||typeof f=="string",58123),Xe.fromBase64String(f||"")):(pe(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Xe.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(m){const f=m.code===void 0?V.UNKNOWN:tu(m.code);return new U(f,m.message||"")}(a);t=new nu(n,s,o,u||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const s=Hi(r,n.document.name),o=Mt(n.document.updateTime),a=n.document.createTime?Mt(n.document.createTime):se.min(),u=new gt({mapValue:{fields:n.document.fields}}),h=it.newFoundDocument(s,o,a,u),m=n.targetIds||[],f=n.removedTargetIds||[];t=new Us(m,f,h.key,h)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const s=Hi(r,n.document),o=n.readTime?Mt(n.readTime):se.min(),a=it.newNoDocument(s,o),u=n.removedTargetIds||[];t=new Us([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const s=Hi(r,n.document),o=n.removedTargetIds||[];t=new Us([],o,s,null)}else{if(!("filter"in e))return re(11601,{Vt:e});{e.filter;const n=e.filter;n.targetId;const{count:s=0,unchangedNames:o}=n,a=new xf(s,o),u=n.targetId;t=new ru(u,a)}}return t}function Nf(r,e){let t;if(e instanceof Xn)t={update:_l(r,e.key,e.value)};else if(e instanceof Fo)t={delete:bo(r,e.key)};else if(e instanceof Dr)t={update:_l(r,e.key,e.data),updateMask:Of(e.fieldMask)};else{if(!(e instanceof ff))return re(16599,{dt:e.type});t={verify:bo(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(o,a){const u=a.transform;if(u instanceof ti)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Kn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Qn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof ri)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw re(20930,{transform:a.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:If(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:re(27497)}(r,e.precondition)),t}function Rf(r,e){return r&&r.length>0?(pe(e!==void 0,14353),r.map(t=>function(s,o){let a=s.updateTime?Mt(s.updateTime):Mt(o);return a.isEqual(se.min())&&(a=Mt(o)),new df(a,s.transformResults||[])}(t,e))):[]}function Sf(r,e){return{documents:[ou(r,e.path)]}}function jf(r,e){const t={structuredQuery:{}},n=e.path;let s;e.collectionGroup!==null?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=ou(r,s);const o=function(m){if(m.length!==0)return cu(Et.create(m,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const a=function(m){if(m.length!==0)return m.map(f=>function(E){return{field:Hr(E.field),direction:Df(E.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=go(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{ft:t,parent:s}}function Pf(r){let e=Af(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){pe(n===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let o=[];t.where&&(o=function(b){const E=lu(b);return E instanceof Et&&Oc(E)?E.getFilters():[E]}(t.where));let a=[];t.orderBy&&(a=function(b){return b.map(E=>function(P){return new Gn(Gr(P.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(E))}(t.orderBy));let u=null;t.limit&&(u=function(b){let E;return E=typeof b=="object"?b.value:b,hi(E)?null:E}(t.limit));let h=null;t.startAt&&(h=function(b){const E=!!b.before,I=b.values||[];return new on(I,E)}(t.startAt));let m=null;return t.endAt&&(m=function(b){const E=!b.before,I=b.values||[];return new on(I,E)}(t.endAt)),Km(e,s,a,o,u,"F",h,m)}function Vf(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return re(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function lu(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Gr(t.unaryFilter.field);return Le.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=Gr(t.unaryFilter.field);return Le.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Gr(t.unaryFilter.field);return Le.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Gr(t.unaryFilter.field);return Le.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return re(61313);default:return re(60726)}}(r):r.fieldFilter!==void 0?function(t){return Le.create(Gr(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return re(58110);default:return re(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return Et.create(t.compositeFilter.filters.map(n=>lu(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return re(1026)}}(t.compositeFilter.op))}(r):re(30097,{filter:r})}function Df(r){return wf[r]}function Mf(r){return kf[r]}function Lf(r){return Ef[r]}function Hr(r){return{fieldPath:r.canonicalString()}}function Gr(r){return Je.fromServerFormat(r.fieldPath)}function cu(r){return r instanceof Le?function(t){if(t.op==="=="){if(al(t.value))return{unaryFilter:{field:Hr(t.field),op:"IS_NAN"}};if(ol(t.value))return{unaryFilter:{field:Hr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(al(t.value))return{unaryFilter:{field:Hr(t.field),op:"IS_NOT_NAN"}};if(ol(t.value))return{unaryFilter:{field:Hr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hr(t.field),op:Mf(t.op),value:t.value}}}(r):r instanceof Et?function(t){const n=t.getFilters().map(s=>cu(s));return n.length===1?n[0]:{compositeFilter:{op:Lf(t.op),filters:n}}}(r):re(54877,{filter:r})}function Of(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function uu(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}function du(r){return!!r&&typeof r._toProto=="function"&&r._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e,t,n,s,o=se.min(),a=se.min(),u=Xe.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new nr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new nr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new nr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new nr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e){this.yt=e}}function Bf(r){const e=Pf({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?ei(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(){this.Sn=new $f}addToCollectionParentIndex(e,t){return this.Sn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(cr.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(cr.min())}updateCollectionGroup(e,t,n){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class $f{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new $e(ye.comparator),o=!s.has(n);return this.index[t]=s.add(n),o}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new $e(ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hu=41943040;class at{static withCacheSize(e){return new at(e,at.DEFAULT_COLLECTION_PERCENTILE,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */at.DEFAULT_COLLECTION_PERCENTILE=10,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,at.DEFAULT=new at(hu,at.DEFAULT_COLLECTION_PERCENTILE,at.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),at.DISABLED=new at(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new an(0)}static ar(){return new an(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wl="LruGarbageCollector",qf=1048576;function kl([r,e],[t,n]){const s=le(r,t);return s===0?le(e,n):s}class zf{constructor(e){this.Pr=e,this.buffer=new $e(kl),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();kl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Wf{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){G(wl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){hn(t)?G(wl,"Ignoring IndexedDB error during garbage collection: ",t):await dn(t)}await this.Ar(3e5)})}}class Hf{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return D.resolve(di.ce);const n=new zf(t);return this.Vr.forEachTarget(e,s=>n.Er(s.sequenceNumber)).next(()=>this.Vr.mr(e,s=>n.Er(s))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(G("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(vl)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(G("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vl):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,s,o,a,u,h,m;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(G("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),s=this.params.maximumSequenceNumbersToCollect):s=b,a=Date.now(),this.nthSequenceNumber(e,s))).next(b=>(n=b,u=Date.now(),this.removeTargets(e,n,t))).next(b=>(o=b,h=Date.now(),this.removeOrphanedDocuments(e,n))).next(b=>(m=Date.now(),zr()<=he.DEBUG&&G("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${b} documents in `+(m-h)+`ms
Total Duration: ${m-f}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:b})))}}function Gf(r,e){return new Hf(r,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kf{constructor(){this.changes=new Vr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,it.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?D.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(n!==null&&Fn(n.mutation,s,wt.empty(),we.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,ce()).next(()=>n))}getLocalViewOfDocuments(e,t,n=ce()){const s=Ir();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(o=>{let a=Sn();return o.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=Ir();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ce()))}populateOverlays(e,t,n){const s=[];return n.forEach(o=>{t.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(e,s).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,s){let o=Kt();const a=On(),u=function(){return On()}();return t.forEach((h,m)=>{const f=n.get(m.key);s.has(m.key)&&(f===void 0||f.mutation instanceof Dr)?o=o.insert(m.key,m):f!==void 0?(a.set(m.key,f.mutation.getFieldMask()),Fn(f.mutation,m,f.mutation.getFieldMask(),we.now())):a.set(m.key,wt.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((m,f)=>a.set(m,f)),t.forEach((m,f)=>u.set(m,new Qf(f,a.get(m)??null))),u))}recalculateAndSaveOverlays(e,t){const n=On();let s=new Ie((a,u)=>a-u),o=ce();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(h=>{const m=t.get(h);if(m===null)return;let f=n.get(h)||wt.empty();f=u.applyToLocalView(m,f),n.set(h,f);const b=(s.get(u.batchId)||ce()).add(h);s=s.insert(u.batchId,b)})}).next(()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),m=h.key,f=h.value,b=Gc();f.forEach(E=>{if(!o.has(E)){const I=Zc(t.get(E),n.get(E));I!==null&&b.set(E,I),o=o.add(E)}}),a.push(this.documentOverlayCache.saveOverlays(e,m,b))}return D.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return Qm(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Lo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-o.size):D.resolve(Ir());let u=qn,h=o;return a.next(m=>D.forEach(m,(f,b)=>(u<b.largestBatchId&&(u=b.largestBatchId),o.get(f)?D.resolve():this.remoteDocumentCache.getEntry(e,f).next(E=>{h=h.insert(f,E)}))).next(()=>this.populateOverlays(e,m,o)).next(()=>this.computeViews(e,h,m,ce())).next(f=>({batchId:u,changes:Hc(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Z(t)).next(n=>{let s=Sn();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const o=t.collectionGroup;let a=Sn();return this.indexManager.getCollectionParents(e,o).next(u=>D.forEach(u,h=>{const m=function(b,E){return new Pr(E,null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,n,s).next(f=>{f.forEach((b,E)=>{a=a.insert(b,E)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,o,s))).next(a=>{o.forEach((h,m)=>{const f=m.getKey();a.get(f)===null&&(a=a.insert(f,it.newInvalidDocument(f)))});let u=Sn();return a.forEach((h,m)=>{const f=o.get(h);f!==void 0&&Fn(f.mutation,m,wt.empty(),we.now()),gi(t,m)&&(u=u.insert(h,m))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return D.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Mt(s.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(s){return{name:s.name,query:Bf(s.bundledQuery),readTime:Mt(s.readTime)}}(t)),D.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xf{constructor(){this.overlays=new Ie(Z.comparator),this.Lr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ir();return D.forEach(t,s=>this.getOverlay(e,s).next(o=>{o!==null&&n.set(s,o)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,o)=>{this.bt(e,t,o)}),D.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Lr.get(n);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Lr.delete(n)),D.resolve()}getOverlaysForCollection(e,t,n){const s=Ir(),o=t.length+1,a=new Z(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,m=h.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===o&&h.largestBatchId>n&&s.set(h.getKey(),h)}return D.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let o=new Ie((m,f)=>m-f);const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>n){let f=o.get(m.largestBatchId);f===null&&(f=Ir(),o=o.insert(m.largestBatchId,f)),f.set(m.getKey(),m)}}const u=Ir(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((m,f)=>u.set(m,f)),!(u.size()>=s)););return D.resolve(u)}bt(e,t,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.Lr.get(s.largestBatchId).delete(n.key);this.Lr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new gf(t,n));let o=this.Lr.get(t);o===void 0&&(o=ce(),this.Lr.set(t,o)),this.Lr.set(t,o.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(){this.sessionToken=Xe.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(){this.kr=new $e(Ge.Kr),this.qr=new $e(Ge.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const n=new Ge(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Wr(new Ge(e,t))}Qr(e,t){e.forEach(n=>this.removeReference(n,t))}Gr(e){const t=new Z(new ye([])),n=new Ge(t,e),s=new Ge(t,e+1),o=[];return this.qr.forEachInRange([n,s],a=>{this.Wr(a),o.push(a.key)}),o}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new Z(new ye([])),n=new Ge(t,e),s=new Ge(t,e+1);let o=ce();return this.qr.forEachInRange([n,s],a=>{o=o.add(a.key)}),o}containsKey(e){const t=new Ge(e,0),n=this.kr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Ge{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return Z.comparator(e.key,t.key)||le(e.Hr,t.Hr)}static Ur(e,t){return le(e.Hr,t.Hr)||Z.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new $e(Ge.Kr)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,s){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new pf(o,t,n,s);this.mutationQueue.push(a);for(const u of s)this.Jr=this.Jr.add(new Ge(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return D.resolve(a)}lookupMutationBatch(e,t){return D.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.Xr(n),o=s<0?0:s;return D.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?Po:this.Yn-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ge(t,0),s=new Ge(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([n,s],a=>{const u=this.Zr(a.Hr);o.push(u)}),D.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new $e(le);return t.forEach(s=>{const o=new Ge(s,0),a=new Ge(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],u=>{n=n.add(u.Hr)})}),D.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let o=n;Z.isDocumentKey(o)||(o=o.child(""));const a=new Ge(new Z(o),0);let u=new $e(le);return this.Jr.forEachWhile(h=>{const m=h.key.path;return!!n.isPrefixOf(m)&&(m.length===s&&(u=u.add(h.Hr)),!0)},a),D.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach(n=>{const s=this.Zr(n);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){pe(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Jr;return D.forEach(t.mutations,s=>{const o=new Ge(s.key,t.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Jr=n})}nr(e){}containsKey(e,t){const n=new Ge(t,0),s=this.Jr.firstAfterOrEqual(n);return D.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(e){this.ti=e,this.docs=function(){return new Ie(Z.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),o=s?s.size:0,a=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return D.resolve(n?n.document.mutableCopy():it.newInvalidDocument(t))}getEntries(e,t){let n=Kt();return t.forEach(s=>{const o=this.docs.get(s);n=n.insert(s,o?o.document.mutableCopy():it.newInvalidDocument(s))}),D.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let o=Kt();const a=t.path,u=new Z(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:m,value:{document:f}}=h.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||Tm(Em(f),n)<=0||(s.has(f.key)||gi(t,f))&&(o=o.insert(f.key,f.mutableCopy()))}return D.resolve(o)}getAllFromCollectionGroup(e,t,n,s){re(9500)}ni(e,t){return D.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new r0(this)}getSize(e){return D.resolve(this.size)}}class r0 extends Kf{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(n)}),D.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(e){this.persistence=e,this.ri=new Vr(t=>Do(t),Mo),this.lastRemoteSnapshotVersion=se.min(),this.highestTargetId=0,this.ii=0,this.si=new qo,this.targetCount=0,this.oi=an._r()}forEachTarget(e,t){return this.ri.forEach((n,s)=>t(s)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),D.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new an(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.lr(t),D.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,n){let s=0;const o=[];return this.ri.forEach((a,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),D.waitFor(o).next(()=>s)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const n=this.ri.get(t)||null;return D.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),D.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach(a=>{o.push(s.markPotentiallyOrphaned(e,a))}),D.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const n=this.si.jr(t);return D.resolve(n)}containsKey(e,t){return D.resolve(this.si.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(e,t){this._i={},this.overlays={},this.ai=new di(0),this.ui=!1,this.ui=!0,this.ci=new Zf,this.referenceDelegate=e(this),this.li=new n0(this),this.indexManager=new Uf,this.remoteDocumentCache=function(s){return new t0(s)}(n=>this.referenceDelegate.hi(n)),this.serializer=new Ff(t),this.Pi=new Jf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Xf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new e0(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){G("MemoryPersistence","Starting transaction:",e);const s=new s0(this.ai.next());return this.referenceDelegate.Ti(),n(s).next(o=>this.referenceDelegate.Ii(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ei(e,t){return D.or(Object.values(this._i).map(n=>()=>n.containsKey(e,t)))}}class s0 extends Am{constructor(e){super(),this.currentSequenceNumber=e}}class zo{constructor(e){this.persistence=e,this.Ri=new qo,this.Ai=null}static Vi(e){return new zo(e)}get di(){if(this.Ai)return this.Ai;throw re(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),D.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(s=>this.di.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.di.add(o.toString()))}).next(()=>n.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.di,n=>{const s=Z.fromPath(n);return this.mi(e,s).next(o=>{o||t.removeEntry(s,se.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(n=>{n?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class si{constructor(e,t){this.persistence=e,this.fi=new Vr(n=>Rm(n.path),(n,s)=>n.isEqual(s)),this.garbageCollector=Gf(this,t)}static Vi(e,t){return new si(e,t)}Ti(){}Ii(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(s=>n+s))}pr(e){let t=0;return this.mr(e,n=>{t++}).next(()=>t)}mr(e,t){return D.forEach(this.fi,(n,s)=>this.wr(e,n,s).next(o=>o?D.resolve():t(s)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ni(e,a=>this.wr(e,a,t).next(u=>{u||(n++,o.removeEntry(a,se.min()))})).next(()=>o.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),D.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Os(e.data.value)),t}wr(e,t,n){return D.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return D.resolve(s!==void 0&&s>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=s}static Es(e,t){let n=ce(),s=ce();for(const o of t.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Wo(e,t.fromCache,n,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return Hd()?8:Cm(zd())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,s){const o={result:null};return this.gs(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ps(e,t,s,n).next(a=>{o.result=a})}).next(()=>{if(o.result)return;const a=new i0;return this.ys(e,t,a).next(u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)})}).next(()=>o.result)}ws(e,t,n,s){return n.documentReadCount<this.Vs?(zr()<=he.DEBUG&&G("QueryEngine","SDK will not create cache indexes for query:",Wr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),D.resolve()):(zr()<=he.DEBUG&&G("QueryEngine","Query:",Wr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.ds*s?(zr()<=he.DEBUG&&G("QueryEngine","The SDK decides to create cache indexes for query:",Wr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vt(t))):D.resolve())}gs(e,t){if(dl(t))return D.resolve(null);let n=Vt(t);return this.indexManager.getIndexType(e,n).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ei(t,null,"F"),n=Vt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(o=>{const a=ce(...o);return this.fs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(h=>{const m=this.bs(t,u);return this.Ss(t,m,a,h.readTime)?this.gs(e,ei(t,null,"F")):this.Ds(e,m,t,h)}))})))}ps(e,t,n,s){return dl(t)||s.isEqual(se.min())?D.resolve(null):this.fs.getDocuments(e,n).next(o=>{const a=this.bs(t,o);return this.Ss(t,a,n,s)?D.resolve(null):(zr()<=he.DEBUG&&G("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Wr(t)),this.Ds(e,a,t,km(s,qn)).next(u=>u))})}bs(e,t){let n=new $e(zc(e));return t.forEach((s,o)=>{gi(e,o)&&(n=n.add(o))}),n}Ss(e,t,n,s){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ys(e,t,n){return zr()<=he.DEBUG&&G("QueryEngine","Using full collection scan to execute query:",Wr(t)),this.fs.getDocumentsMatchingQuery(e,t,cr.min(),n)}Ds(e,t,n,s){return this.fs.getDocumentsMatchingQuery(e,n,s).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho="LocalStore",a0=3e8;class l0{constructor(e,t,n,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new Ie(le),this.Fs=new Vr(o=>Do(o),Mo),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Yf(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function c0(r,e,t,n){return new l0(r,e,t,n)}async function fu(r,e){const t=ie(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(o=>(s=o,t.Os(e),t.mutationQueue.getAllMutationBatches(n))).next(o=>{const a=[],u=[];let h=ce();for(const m of s){a.push(m.batchId);for(const f of m.mutations)h=h.add(f.key)}for(const m of o){u.push(m.batchId);for(const f of m.mutations)h=h.add(f.key)}return t.localDocuments.getDocuments(n,h).next(m=>({Ns:m,removedBatchIds:a,addedBatchIds:u}))})})}function u0(r,e){const t=ie(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return function(u,h,m,f){const b=m.batch,E=b.keys();let I=D.resolve();return E.forEach(P=>{I=I.next(()=>f.getEntry(h,P)).next(M=>{const R=m.docVersions.get(P);pe(R!==null,48541),M.version.compareTo(R)<0&&(b.applyToRemoteDocument(M,m),M.isValidDocument()&&(M.setReadTime(m.commitVersion),f.addEntry(M)))})}),I.next(()=>u.mutationQueue.removeMutationBatch(h,b))}(t,n,e,o).next(()=>o.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let h=ce();for(let m=0;m<u.mutationResults.length;++m)u.mutationResults[m].transformResults.length>0&&(h=h.add(u.batch.mutations[m].key));return h}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}function pu(r){const e=ie(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function d0(r,e){const t=ie(r),n=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const u=[];e.targetChanges.forEach((f,b)=>{const E=s.get(b);if(!E)return;u.push(t.li.removeMatchingKeys(o,f.removedDocuments,b).next(()=>t.li.addMatchingKeys(o,f.addedDocuments,b)));let I=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(b)!==null?I=I.withResumeToken(Xe.EMPTY_BYTE_STRING,se.min()).withLastLimboFreeSnapshotVersion(se.min()):f.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(f.resumeToken,n)),s=s.insert(b,I),function(M,R,W){return M.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=a0?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0}(E,I,f)&&u.push(t.li.updateTargetData(o,I))});let h=Kt(),m=ce();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,f))}),u.push(h0(o,a,e.documentUpdates).next(f=>{h=f.Bs,m=f.Ls})),!n.isEqual(se.min())){const f=t.li.getLastRemoteSnapshotVersion(o).next(b=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,n));u.push(f)}return D.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,m)).next(()=>h)}).then(o=>(t.vs=s,o))}function h0(r,e,t){let n=ce(),s=ce();return t.forEach(o=>n=n.add(o)),e.getEntries(r,n).next(o=>{let a=Kt();return t.forEach((u,h)=>{const m=o.get(u);h.isFoundDocument()!==m.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(se.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):G(Ho,"Ignoring outdated watch update for ",u,". Current version:",m.version," Watch version:",h.version)}),{Bs:a,Ls:s}})}function m0(r,e){const t=ie(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=Po),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function f0(r,e){const t=ie(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.li.getTargetData(n,e).next(o=>o?(s=o,D.resolve(s)):t.li.allocateTargetId(n).next(a=>(s=new nr(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.li.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.vs.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(n.targetId,n),t.Fs.set(e,n.targetId)),n})}async function _o(r,e,t){const n=ie(r),s=n.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",o,a=>n.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!hn(a))throw a;G(Ho,`Failed to update sequence numbers for target ${e}: ${a}`)}n.vs=n.vs.remove(e),n.Fs.delete(s.target)}function El(r,e,t){const n=ie(r);let s=se.min(),o=ce();return n.persistence.runTransaction("Execute query","readwrite",a=>function(h,m,f){const b=ie(h),E=b.Fs.get(f);return E!==void 0?D.resolve(b.vs.get(E)):b.li.getTargetData(m,f)}(n,a,Vt(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,n.li.getMatchingKeysForTargetId(a,u.targetId).next(h=>{o=h})}).next(()=>n.Cs.getDocumentsMatchingQuery(a,e,t?s:se.min(),t?o:ce())).next(u=>(p0(n,Zm(e),u),{documents:u,ks:o})))}function p0(r,e,t){let n=r.Ms.get(e)||se.min();t.forEach((s,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)}),r.Ms.set(e,n)}class Tl{constructor(){this.activeTargetIds=of()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class g0{constructor(){this.vo=new Tl,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Tl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il="ConnectivityMonitor";class Al{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){G(Il,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){G(Il,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rs=null;function vo(){return Rs===null?Rs=function(){return 268435456+Math.round(2147483648*Math.random())}():Rs++,"0x"+Rs.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gi="RestConnection",b0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class y0{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${n}/databases/${s}`,this.$o=this.databaseId.database===Js?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Wo(e,t,n,s,o){const a=vo(),u=this.Qo(e,t.toUriEncodedString());G(Gi,`Sending RPC '${e}' ${a}:`,u,n);const h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,s,o);const{host:m}=new URL(u),f=No(m);return this.zo(e,u,h,n,f).then(b=>(G(Gi,`Received RPC '${e}' ${a}: `,b),b),b=>{throw Nr(Gi,`RPC '${e}' ${a} failed with error: `,b,"url: ",u,"request:",n),b})}jo(e,t,n,s,o,a){return this.Wo(e,t,n,s,o)}Go(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+un}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,o)=>e[o]=s),n&&n.headers.forEach((s,o)=>e[o]=s)}Qo(e,t){const n=b0[e];let s=`${this.qo}/v1/${t}:${n}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nt="WebChannelConnection",Cn=(r,e,t)=>{r.listen(e,n=>{try{t(n)}catch(s){setTimeout(()=>{throw s},0)}})};class Yr extends y0{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!Yr.c_){const e=_c();Cn(e,yc.STAT_EVENT,t=>{t.stat===lo.PROXY?G(nt,"STAT_EVENT: detected buffering proxy"):t.stat===lo.NOPROXY&&G(nt,"STAT_EVENT: detected no buffering proxy")}),Yr.c_=!0}}zo(e,t,n,s,o){const a=vo();return new Promise((u,h)=>{const m=new xc;m.setWithCredentials(!0),m.listenOnce(bc.COMPLETE,()=>{try{switch(m.getLastErrorCode()){case Ls.NO_ERROR:const b=m.getResponseJson();G(nt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(b)),u(b);break;case Ls.TIMEOUT:G(nt,`RPC '${e}' ${a} timed out`),h(new U(V.DEADLINE_EXCEEDED,"Request time out"));break;case Ls.HTTP_ERROR:const E=m.getStatus();if(G(nt,`RPC '${e}' ${a} failed with status:`,E,"response text:",m.getResponseText()),E>0){let I=m.getResponseJson();Array.isArray(I)&&(I=I[0]);const P=I==null?void 0:I.error;if(P&&P.status&&P.message){const M=function(W){const Y=W.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(Y)>=0?Y:V.UNKNOWN}(P.status);h(new U(M,P.message))}else h(new U(V.UNKNOWN,"Server responded with status "+m.getStatus()))}else h(new U(V.UNAVAILABLE,"Connection failed."));break;default:re(9055,{l_:e,streamId:a,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{G(nt,`RPC '${e}' ${a} completed.`)}});const f=JSON.stringify(s);G(nt,`RPC '${e}' ${a} sending request:`,s),m.send(t,"POST",f,n,15)})}T_(e,t,n){const s=vo(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const m=o.join("");G(nt,`Creating RPC '${e}' stream ${s}: ${m}`,u);const f=a.createWebChannel(m,u);this.I_(f);let b=!1,E=!1;const I=new _0({Ho:P=>{E?G(nt,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(b||(G(nt,`Opening RPC '${e}' stream ${s} transport.`),f.open(),b=!0),G(nt,`RPC '${e}' stream ${s} sending:`,P),f.send(P))},Jo:()=>f.close()});return Cn(f,Rn.EventType.OPEN,()=>{E||(G(nt,`RPC '${e}' stream ${s} transport opened.`),I.i_())}),Cn(f,Rn.EventType.CLOSE,()=>{E||(E=!0,G(nt,`RPC '${e}' stream ${s} transport closed`),I.o_(),this.E_(f))}),Cn(f,Rn.EventType.ERROR,P=>{E||(E=!0,Nr(nt,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),I.o_(new U(V.UNAVAILABLE,"The operation could not be completed")))}),Cn(f,Rn.EventType.MESSAGE,P=>{var M;if(!E){const R=P.data[0];pe(!!R,16349);const W=R,Y=(W==null?void 0:W.error)||((M=W[0])==null?void 0:M.error);if(Y){G(nt,`RPC '${e}' stream ${s} received error:`,Y);const F=Y.status;let ee=function(w){const g=Me[w];if(g!==void 0)return tu(g)}(F),$=Y.message;F==="NOT_FOUND"&&$.includes("database")&&$.includes("does not exist")&&$.includes(this.databaseId.database)&&Nr(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),ee===void 0&&(ee=V.INTERNAL,$="Unknown error status: "+F+" with message "+Y.message),E=!0,I.o_(new U(ee,$)),f.close()}else G(nt,`RPC '${e}' stream ${s} received:`,R),I.__(R)}}),Yr.u_(),setTimeout(()=>{I.s_()},0),I}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return vc()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v0(r){return new Yr(r)}function Ki(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _i(r){return new Tf(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Yr.c_=!1;class gu{constructor(e,t,n=1e3,s=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=n,this.A_=s,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-n);s>0&&G("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl="PersistentStream";class xu{constructor(e,t,n,s,o,a,u,h){this.Ci=e,this.b_=n,this.S_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new gu(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(Gt(t.toString()),Gt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.D_===t&&this.G_(n,s)},n=>{e(()=>{const s=new U(V.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)})})}G_(e,t){const n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.Yo(()=>{n(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(s=>{n(()=>this.z_(s))}),this.stream.onMessage(s=>{n(()=>++this.F_==1?this.H_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return G(Cl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(G(Cl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class w0 extends xu{constructor(e,t,n,s,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Cf(this.serializer,e),n=function(o){if(!("targetChange"in o))return se.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?se.min():a.readTime?Mt(a.readTime):se.min()}(e);return this.listener.J_(t,n)}Z_(e){const t={};t.database=yo(this.serializer),t.addTarget=function(o,a){let u;const h=a.target;if(u=fo(h)?{documents:Sf(o,h)}:{query:jf(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=su(o,a.resumeToken);const m=go(o,a.expectedCount);m!==null&&(u.expectedCount=m)}else if(a.snapshotVersion.compareTo(se.min())>0){u.readTime=ni(o,a.snapshotVersion.toTimestamp());const m=go(o,a.expectedCount);m!==null&&(u.expectedCount=m)}return u}(this.serializer,e);const n=Vf(this.serializer,e);n&&(t.labels=n),this.K_(t)}X_(e){const t={};t.database=yo(this.serializer),t.removeTarget=e,this.K_(t)}}class k0 extends xu{constructor(e,t,n,s,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return pe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,pe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){pe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Rf(e.writeResults,e.commitTime),n=Mt(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=yo(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Nf(this.serializer,n))};this.K_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{}class T0 extends E0{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new U(V.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Wo(e,xo(t,n),s,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new U(V.UNKNOWN,o.toString())})}jo(e,t,n,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.jo(e,xo(t,n),s,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new U(V.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function I0(r,e,t,n){return new T0(r,e,t,n)}class A0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Gt(t),this.aa=!1):G("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rr="RemoteStore";class C0{constructor(e,t,n,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo(a=>{n.enqueueAndForget(async()=>{Mr(this)&&(G(Rr,"Restarting streams for network reachability change."),await async function(h){const m=ie(h);m.Ea.add(4),await es(m),m.Va.set("Unknown"),m.Ea.delete(4),await vi(m)}(this))})}),this.Va=new A0(n,s)}}async function vi(r){if(Mr(r))for(const e of r.Ra)await e(!0)}async function es(r){for(const e of r.Ra)await e(!1)}function bu(r,e){const t=ie(r);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Yo(t)?Qo(t):mn(t).O_()&&Ko(t,e))}function Go(r,e){const t=ie(r),n=mn(t);t.Ia.delete(e),n.O_()&&yu(t,e),t.Ia.size===0&&(n.O_()?n.L_():Mr(t)&&t.Va.set("Unknown"))}function Ko(r,e){if(r.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(se.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}mn(r).Z_(e)}function yu(r,e){r.da.$e(e),mn(r).X_(e)}function Qo(r){r.da=new vf({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),At:e=>r.Ia.get(e)||null,ht:()=>r.datastore.serializer.databaseId}),mn(r).start(),r.Va.ua()}function Yo(r){return Mr(r)&&!mn(r).x_()&&r.Ia.size>0}function Mr(r){return ie(r).Ea.size===0}function _u(r){r.da=void 0}async function N0(r){r.Va.set("Online")}async function R0(r){r.Ia.forEach((e,t)=>{Ko(r,e)})}async function S0(r,e){_u(r),Yo(r)?(r.Va.ha(e),Qo(r)):r.Va.set("Unknown")}async function j0(r,e,t){if(r.Va.set("Online"),e instanceof nu&&e.state===2&&e.cause)try{await async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.da.removeTarget(u))}(r,e)}catch(n){G(Rr,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ii(r,n)}else if(e instanceof Us?r.da.Xe(e):e instanceof ru?r.da.st(e):r.da.tt(e),!t.isEqual(se.min()))try{const n=await pu(r.localStore);t.compareTo(n)>=0&&await function(o,a){const u=o.da.Tt(a);return u.targetChanges.forEach((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const f=o.Ia.get(m);f&&o.Ia.set(m,f.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,m)=>{const f=o.Ia.get(h);if(!f)return;o.Ia.set(h,f.withResumeToken(Xe.EMPTY_BYTE_STRING,f.snapshotVersion)),yu(o,h);const b=new nr(f.target,h,m,f.sequenceNumber);Ko(o,b)}),o.remoteSyncer.applyRemoteEvent(u)}(r,t)}catch(n){G(Rr,"Failed to raise snapshot:",n),await ii(r,n)}}async function ii(r,e,t){if(!hn(e))throw e;r.Ea.add(1),await es(r),r.Va.set("Offline"),t||(t=()=>pu(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{G(Rr,"Retrying IndexedDB access"),await t(),r.Ea.delete(1),await vi(r)})}function vu(r,e){return e().catch(t=>ii(r,t,e))}async function wi(r){const e=ie(r),t=mr(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Po;for(;P0(e);)try{const s=await m0(e.localStore,n);if(s===null){e.Ta.length===0&&t.L_();break}n=s.batchId,V0(e,s)}catch(s){await ii(e,s)}wu(e)&&ku(e)}function P0(r){return Mr(r)&&r.Ta.length<10}function V0(r,e){r.Ta.push(e);const t=mr(r);t.O_()&&t.Y_&&t.ea(e.mutations)}function wu(r){return Mr(r)&&!mr(r).x_()&&r.Ta.length>0}function ku(r){mr(r).start()}async function D0(r){mr(r).ra()}async function M0(r){const e=mr(r);for(const t of r.Ta)e.ea(t.mutations)}async function L0(r,e,t){const n=r.Ta.shift(),s=Bo.from(n,e,t);await vu(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),await wi(r)}async function O0(r,e){e&&mr(r).Y_&&await async function(n,s){if(function(a){return bf(a)&&a!==V.ABORTED}(s.code)){const o=n.Ta.shift();mr(n).B_(),await vu(n,()=>n.remoteSyncer.rejectFailedWrite(o.batchId,s)),await wi(n)}}(r,e),wu(r)&&ku(r)}async function Nl(r,e){const t=ie(r);t.asyncQueue.verifyOperationInProgress(),G(Rr,"RemoteStore received new credentials");const n=Mr(t);t.Ea.add(3),await es(t),n&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await vi(t)}async function F0(r,e){const t=ie(r);e?(t.Ea.delete(2),await vi(t)):e||(t.Ea.add(2),await es(t),t.Va.set("Unknown"))}function mn(r){return r.ma||(r.ma=function(t,n,s){const o=ie(t);return o.sa(),new w0(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(r.datastore,r.asyncQueue,{Zo:N0.bind(null,r),Yo:R0.bind(null,r),t_:S0.bind(null,r),J_:j0.bind(null,r)}),r.Ra.push(async e=>{e?(r.ma.B_(),Yo(r)?Qo(r):r.Va.set("Unknown")):(await r.ma.stop(),_u(r))})),r.ma}function mr(r){return r.fa||(r.fa=function(t,n,s){const o=ie(t);return o.sa(),new k0(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),Yo:D0.bind(null,r),t_:O0.bind(null,r),ta:M0.bind(null,r),na:L0.bind(null,r)}),r.Ra.push(async e=>{e?(r.fa.B_(),await wi(r)):(await r.fa.stop(),r.Ta.length>0&&(G(Rr,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))})),r.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,t,n,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=o,this.deferred=new ar,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,o){const a=Date.now()+n,u=new Jo(e,t,a,s,o);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xo(r,e){if(Gt("AsyncQueue",`${e}: ${r}`),hn(r))return new U(V.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{static emptySet(e){return new Jr(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Z.comparator(t.key,n.key):(t,n)=>Z.comparator(t.key,n.key),this.keyedMap=Sn(),this.sortedSet=new Ie(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Jr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=n.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Jr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(){this.ga=new Ie(Z.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):re(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class ln{constructor(e,t,n,s,o,a,u,h,m){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,t,n,s,o){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new ln(e,t,Jr.emptySet(t),a,n,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class U0{constructor(){this.queries=Sl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const s=ie(t),o=s.queries;s.queries=Sl(),o.forEach((a,u)=>{for(const h of u.ba)h.onError(n)})})(this,new U(V.ABORTED,"Firestore shutting down"))}}function Sl(){return new Vr(r=>qc(r),pi)}async function $0(r,e){const t=ie(r);let n=3;const s=e.query;let o=t.queries.get(s);o?!o.Sa()&&e.Da()&&(n=2):(o=new B0,n=e.Da()?0:1);try{switch(n){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const u=Xo(a,`Initialization of query '${Wr(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&Zo(t)}async function q0(r,e){const t=ie(r),n=e.query;let s=3;const o=t.queries.get(n);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?s=e.Da()?0:1:!o.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function z0(r,e){const t=ie(r);let n=!1;for(const s of e){const o=s.query,a=t.queries.get(o);if(a){for(const u of a.ba)u.Fa(s)&&(n=!0);a.wa=s}}n&&Zo(t)}function W0(r,e,t){const n=ie(r),s=n.queries.get(e);if(s)for(const o of s.ba)o.onError(t);n.queries.delete(e)}function Zo(r){r.Ca.forEach(e=>{e.next()})}var wo,jl;(jl=wo||(wo={})).Ma="default",jl.Cache="cache";class H0{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)s.type!==3&&n.push(s);e=new ln(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.Ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=ln.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==wo.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e){this.key=e}}class Tu{constructor(e){this.key=e}}class G0{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ce(),this.mutatedKeys=ce(),this.eu=zc(e),this.tu=new Jr(this.eu)}get nu(){return this.Za}ru(e,t){const n=t?t.iu:new Rl,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,m=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,b)=>{const E=s.get(f),I=gi(this.query,b)?b:null,P=!!E&&this.mutatedKeys.has(E.key),M=!!I&&(I.hasLocalMutations||this.mutatedKeys.has(I.key)&&I.hasCommittedMutations);let R=!1;E&&I?E.data.isEqual(I.data)?P!==M&&(n.track({type:3,doc:I}),R=!0):this.su(E,I)||(n.track({type:2,doc:I}),R=!0,(h&&this.eu(I,h)>0||m&&this.eu(I,m)<0)&&(u=!0)):!E&&I?(n.track({type:0,doc:I}),R=!0):E&&!I&&(n.track({type:1,doc:E}),R=!0,(h||m)&&(u=!0)),R&&(I?(a=a.add(I),o=M?o.add(f):o.delete(f)):(a=a.delete(f),o=o.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),o=o.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((f,b)=>function(I,P){const M=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return re(20277,{Vt:R})}};return M(I)-M(P)}(f.type,b.type)||this.eu(f.doc,b.doc)),this.ou(n),s=s??!1;const u=t&&!s?this._u():[],h=this.Ya.size===0&&this.current&&!s?1:0,m=h!==this.Xa;return this.Xa=h,a.length!==0||m?{snapshot:new ln(this.query,e.tu,o,a,e.mutatedKeys,h===0,m,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Rl,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ce(),this.tu.forEach(n=>{this.uu(n.key)&&(this.Ya=this.Ya.add(n.key))});const t=[];return e.forEach(n=>{this.Ya.has(n)||t.push(new Tu(n))}),this.Ya.forEach(n=>{e.has(n)||t.push(new Eu(n))}),t}cu(e){this.Za=e.ks,this.Ya=ce();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ln.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ea="SyncEngine";class K0{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Q0{constructor(e){this.key=e,this.hu=!1}}class Y0{constructor(e,t,n,s,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Vr(u=>qc(u),pi),this.Iu=new Map,this.Eu=new Set,this.Ru=new Ie(Z.comparator),this.Au=new Map,this.Vu=new qo,this.du={},this.mu=new Map,this.fu=an.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function J0(r,e,t=!0){const n=Su(r);let s;const o=n.Tu.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Iu(n,e,t,!0),s}async function X0(r,e){const t=Su(r);await Iu(t,e,!0,!1)}async function Iu(r,e,t,n){const s=await f0(r.localStore,Vt(e)),o=s.targetId,a=r.sharedClientState.addLocalQueryTarget(o,t);let u;return n&&(u=await Z0(r,e,o,a==="current",s.resumeToken)),r.isPrimaryClient&&t&&bu(r.remoteStore,s),u}async function Z0(r,e,t,n,s){r.pu=(b,E,I)=>async function(M,R,W,Y){let F=R.view.ru(W);F.Ss&&(F=await El(M.localStore,R.query,!1).then(({documents:w})=>R.view.ru(w,F)));const ee=Y&&Y.targetChanges.get(R.targetId),$=Y&&Y.targetMismatches.get(R.targetId)!=null,X=R.view.applyChanges(F,M.isPrimaryClient,ee,$);return Vl(M,R.targetId,X.au),X.snapshot}(r,b,E,I);const o=await El(r.localStore,e,!0),a=new G0(e,o.ks),u=a.ru(o.documents),h=Zn.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",s),m=a.applyChanges(u,r.isPrimaryClient,h);Vl(r,t,m.au);const f=new K0(e,t,a);return r.Tu.set(e,f),r.Iu.has(t)?r.Iu.get(t).push(e):r.Iu.set(t,[e]),m.snapshot}async function ep(r,e,t){const n=ie(r),s=n.Tu.get(e),o=n.Iu.get(s.targetId);if(o.length>1)return n.Iu.set(s.targetId,o.filter(a=>!pi(a,e))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await _o(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Go(n.remoteStore,s.targetId),ko(n,s.targetId)}).catch(dn)):(ko(n,s.targetId),await _o(n.localStore,s.targetId,!0))}async function tp(r,e){const t=ie(r),n=t.Tu.get(e),s=t.Iu.get(n.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Go(t.remoteStore,n.targetId))}async function rp(r,e,t){const n=cp(r);try{const s=await function(a,u){const h=ie(a),m=we.now(),f=u.reduce((I,P)=>I.add(P.key),ce());let b,E;return h.persistence.runTransaction("Locally write mutations","readwrite",I=>{let P=Kt(),M=ce();return h.xs.getEntries(I,f).next(R=>{P=R,P.forEach((W,Y)=>{Y.isValidDocument()||(M=M.add(W))})}).next(()=>h.localDocuments.getOverlayedDocuments(I,P)).next(R=>{b=R;const W=[];for(const Y of u){const F=mf(Y,b.get(Y.key).overlayedDocument);F!=null&&W.push(new Dr(Y.key,F,Dc(F.value.mapValue),Dt.exists(!0)))}return h.mutationQueue.addMutationBatch(I,m,W,u)}).next(R=>{E=R;const W=R.applyToLocalDocumentSet(b,M);return h.documentOverlayCache.saveOverlays(I,R.batchId,W)})}).then(()=>({batchId:E.batchId,changes:Hc(b)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(a,u,h){let m=a.du[a.currentUser.toKey()];m||(m=new Ie(le)),m=m.insert(u,h),a.du[a.currentUser.toKey()]=m}(n,s.batchId,t),await ts(n,s.changes),await wi(n.remoteStore)}catch(s){const o=Xo(s,"Failed to persist write");t.reject(o)}}async function Au(r,e){const t=ie(r);try{const n=await d0(t.localStore,e);e.targetChanges.forEach((s,o)=>{const a=t.Au.get(o);a&&(pe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?pe(a.hu,14607):s.removedDocuments.size>0&&(pe(a.hu,42227),a.hu=!1))}),await ts(t,n,e)}catch(n){await dn(n)}}function Pl(r,e,t){const n=ie(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const s=[];n.Tu.forEach((o,a)=>{const u=a.view.va(e);u.snapshot&&s.push(u.snapshot)}),function(a,u){const h=ie(a);h.onlineState=u;let m=!1;h.queries.forEach((f,b)=>{for(const E of b.ba)E.va(u)&&(m=!0)}),m&&Zo(h)}(n.eventManager,e),s.length&&n.Pu.J_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function np(r,e,t){const n=ie(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Au.get(e),o=s&&s.key;if(o){let a=new Ie(Z.comparator);a=a.insert(o,it.newNoDocument(o,se.min()));const u=ce().add(o),h=new yi(se.min(),new Map,new Ie(le),a,u);await Au(n,h),n.Ru=n.Ru.remove(o),n.Au.delete(e),ta(n)}else await _o(n.localStore,e,!1).then(()=>ko(n,e,t)).catch(dn)}async function sp(r,e){const t=ie(r),n=e.batch.batchId;try{const s=await u0(t.localStore,e);Nu(t,n,null),Cu(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await ts(t,s)}catch(s){await dn(s)}}async function ip(r,e,t){const n=ie(r);try{const s=await function(a,u){const h=ie(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let f;return h.mutationQueue.lookupMutationBatch(m,u).next(b=>(pe(b!==null,37113),f=b.keys(),h.mutationQueue.removeMutationBatch(m,b))).next(()=>h.mutationQueue.performConsistencyCheck(m)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(m,f,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,f)).next(()=>h.localDocuments.getDocuments(m,f))})}(n.localStore,e);Nu(n,e,t),Cu(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await ts(n,s)}catch(s){await dn(s)}}function Cu(r,e){(r.mu.get(e)||[]).forEach(t=>{t.resolve()}),r.mu.delete(e)}function Nu(r,e,t){const n=ie(r);let s=n.du[n.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),n.du[n.currentUser.toKey()]=s}}function ko(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Iu.get(e))r.Tu.delete(n),t&&r.Pu.yu(n,t);r.Iu.delete(e),r.isPrimaryClient&&r.Vu.Gr(e).forEach(n=>{r.Vu.containsKey(n)||Ru(r,n)})}function Ru(r,e){r.Eu.delete(e.path.canonicalString());const t=r.Ru.get(e);t!==null&&(Go(r.remoteStore,t),r.Ru=r.Ru.remove(e),r.Au.delete(t),ta(r))}function Vl(r,e,t){for(const n of t)n instanceof Eu?(r.Vu.addReference(n.key,e),op(r,n)):n instanceof Tu?(G(ea,"Document no longer in limbo: "+n.key),r.Vu.removeReference(n.key,e),r.Vu.containsKey(n.key)||Ru(r,n.key)):re(19791,{wu:n})}function op(r,e){const t=e.key,n=t.path.canonicalString();r.Ru.get(t)||r.Eu.has(n)||(G(ea,"New document in limbo: "+t),r.Eu.add(n),ta(r))}function ta(r){for(;r.Eu.size>0&&r.Ru.size<r.maxConcurrentLimboResolutions;){const e=r.Eu.values().next().value;r.Eu.delete(e);const t=new Z(ye.fromString(e)),n=r.fu.next();r.Au.set(n,new Q0(t)),r.Ru=r.Ru.insert(t,n),bu(r.remoteStore,new nr(Vt($c(t.path)),n,"TargetPurposeLimboResolution",di.ce))}}async function ts(r,e,t){const n=ie(r),s=[],o=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((u,h)=>{a.push(n.pu(h,e,t).then(m=>{var f;if((m||t)&&n.isPrimaryClient){const b=m?!m.fromCache:(f=t==null?void 0:t.targetChanges.get(h.targetId))==null?void 0:f.current;n.sharedClientState.updateQueryState(h.targetId,b?"current":"not-current")}if(m){s.push(m);const b=Wo.Es(h.targetId,m);o.push(b)}}))}),await Promise.all(a),n.Pu.J_(s),await async function(h,m){const f=ie(h);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",b=>D.forEach(m,E=>D.forEach(E.Ts,I=>f.persistence.referenceDelegate.addReference(b,E.targetId,I)).next(()=>D.forEach(E.Is,I=>f.persistence.referenceDelegate.removeReference(b,E.targetId,I)))))}catch(b){if(!hn(b))throw b;G(Ho,"Failed to update sequence numbers: "+b)}for(const b of m){const E=b.targetId;if(!b.fromCache){const I=f.vs.get(E),P=I.snapshotVersion,M=I.withLastLimboFreeSnapshotVersion(P);f.vs=f.vs.insert(E,M)}}}(n.localStore,o))}async function ap(r,e){const t=ie(r);if(!t.currentUser.isEqual(e)){G(ea,"User change. New user:",e.toKey());const n=await fu(t.localStore,e);t.currentUser=e,function(o,a){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new U(V.CANCELLED,a))})}),o.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await ts(t,n.Ns)}}function lp(r,e){const t=ie(r),n=t.Au.get(e);if(n&&n.hu)return ce().add(n.key);{let s=ce();const o=t.Iu.get(e);if(!o)return s;for(const a of o){const u=t.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function Su(r){const e=ie(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Au.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=np.bind(null,e),e.Pu.J_=z0.bind(null,e.eventManager),e.Pu.yu=W0.bind(null,e.eventManager),e}function cp(r){const e=ie(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=sp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ip.bind(null,e),e}class oi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_i(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return c0(this.persistence,new o0,e.initialUser,this.serializer)}Cu(e){return new mu(zo.Vi,this.serializer)}Du(e){return new g0}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}oi.provider={build:()=>new oi};class up extends oi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){pe(this.persistence.referenceDelegate instanceof si,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Wf(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?at.withCacheSize(this.cacheSizeBytes):at.DEFAULT;return new mu(n=>si.Vi(n,t),this.serializer)}}class Eo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Pl(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=ap.bind(null,this.syncEngine),await F0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new U0}()}createDatastore(e){const t=_i(e.databaseInfo.databaseId),n=v0(e.databaseInfo);return I0(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,s,o,a,u){return new C0(n,s,o,a,u)}(this.localStore,this.datastore,e.asyncQueue,t=>Pl(this.syncEngine,t,0),function(){return Al.v()?new Al:new x0}())}createSyncEngine(e,t){return function(s,o,a,u,h,m,f){const b=new Y0(s,o,a,u,h,m);return f&&(b.gu=!0),b}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const o=ie(s);G(Rr,"RemoteStore shutting down."),o.Ea.add(5),await es(o),o.Aa.shutdown(),o.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}Eo.provider={build:()=>new Eo};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Gt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fr="FirestoreClient";class hp{constructor(e,t,n,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=s,this.user=st.UNAUTHENTICATED,this.clientId=jo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,async a=>{G(fr,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(G(fr,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ar;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Xo(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Qi(r,e){r.asyncQueue.verifyOperationInProgress(),G(fr,"Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async s=>{n.isEqual(s)||(await fu(e.localStore,s),n=s)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function Dl(r,e){r.asyncQueue.verifyOperationInProgress();const t=await mp(r);G(fr,"Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Nl(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Nl(e.remoteStore,s)),r._onlineComponents=e}async function mp(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){G(fr,"Using user provided OfflineComponentProvider");try{await Qi(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Nr("Error using user provided cache. Falling back to memory cache: "+t),await Qi(r,new oi)}}else G(fr,"Using default OfflineComponentProvider"),await Qi(r,new up(void 0));return r._offlineComponents}async function ju(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(G(fr,"Using user provided OnlineComponentProvider"),await Dl(r,r._uninitializedComponentsProvider._online)):(G(fr,"Using default OnlineComponentProvider"),await Dl(r,new Eo))),r._onlineComponents}function fp(r){return ju(r).then(e=>e.syncEngine)}async function pp(r){const e=await ju(r),t=e.eventManager;return t.onListen=J0.bind(null,e.syncEngine),t.onUnlisten=ep.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=X0.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=tp.bind(null,e.syncEngine),t}function gp(r,e,t={}){const n=new ar;return r.asyncQueue.enqueueAndForget(async()=>function(o,a,u,h,m){const f=new dp({next:E=>{f.Nu(),a.enqueueAndForget(()=>q0(o,b)),E.fromCache&&h.source==="server"?m.reject(new U(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(E)},error:E=>m.reject(E)}),b=new H0(u,f,{includeMetadataChanges:!0,Ka:!0});return $0(o,b)}(await pp(r),r.asyncQueue,e,t,n)),n.promise}function xp(r,e){const t=new ar;return r.asyncQueue.enqueueAndForget(async()=>rp(await fp(r),e,t)),t.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pu(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bp="ComponentProvider",Ml=new Map;function yp(r,e,t,n,s){return new Pm(r,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Pu(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vu="firestore.googleapis.com",Ll=!0;class Ol{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new U(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Vu,this.ssl=Ll}else this.host=e.host,this.ssl=e.ssl??Ll;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=hu;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<qf)throw new U(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Pu(e.experimentalLongPollingOptions??{}),function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ki{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ol({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new U(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ol(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new dm;switch(n.type){case"firstParty":return new pm(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new U(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Ml.get(t);n&&(G(bp,"Removing Datastore"),Ml.delete(t),n.terminate())}(this),Promise.resolve()}}function _p(r,e,t,n={}){var m;r=rn(r,ki);const s=No(e),o=r._getSettings(),a={...o,emulatorOptions:r._getEmulatorOptions()},u=`${e}:${t}`;s&&(Fd(`https://${u}`),qd("Firestore",!0)),o.host!==Vu&&o.host!==u&&Nr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:n};if(!Gs(h,a)&&(r._setSettings(h),n.mockUserToken)){let f,b;if(typeof n.mockUserToken=="string")f=n.mockUserToken,b=st.MOCK_USER;else{f=Bd(n.mockUserToken,(m=r._app)==null?void 0:m.options.projectId);const E=n.mockUserToken.sub||n.mockUserToken.user_id;if(!E)throw new U(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");b=new st(E)}r._authCredentials=new hm(new kc(f,b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qt{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Qt(this.firestore,e,this._query)}}class Ue{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ue(this.firestore,e,this._key)}toJSON(){return{type:Ue._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Jn(t,Ue._jsonSchema))return new Ue(e,n||null,new Z(ye.fromString(t.referencePath)))}}Ue._jsonSchemaVersion="firestore/documentReference/1.0",Ue._jsonSchema={type:Oe("string",Ue._jsonSchemaVersion),referencePath:Oe("string")};class lr extends Qt{constructor(e,t,n){super(e,t,$c(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ue(this.firestore,null,new Z(e))}withConverter(e){return new lr(this.firestore,e,this._path)}}function vp(r,e,...t){if(r=Ar(r),Ec("collection","path",e),r instanceof ki){const n=ye.fromString(e,...t);return Xa(n),new lr(r,null,n)}{if(!(r instanceof Ue||r instanceof lr))throw new U(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ye.fromString(e,...t));return Xa(n),new lr(r.firestore,null,n)}}function Du(r,e,...t){if(r=Ar(r),arguments.length===1&&(e=jo.newId()),Ec("doc","path",e),r instanceof ki){const n=ye.fromString(e,...t);return Ja(n),new Ue(r,null,new Z(n))}{if(!(r instanceof Ue||r instanceof lr))throw new U(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(ye.fromString(e,...t));return Ja(n),new Ue(r.firestore,r instanceof lr?r.converter:null,new Z(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fl="AsyncQueue";class Bl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new gu(this,"async_queue_retry"),this._c=()=>{const n=Ki();n&&G(Fl,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=Ki();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ki();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new ar;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!hn(e))throw e;G(Fl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(n=>{throw this.nc=n,this.rc=!1,Gt("INTERNAL UNHANDLED ERROR: ",Ul(n)),n}).then(n=>(this.rc=!1,n))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Jo.createAndSchedule(this,e,t,n,o=>this.hc(o));return this.tc.push(s),s}uc(){this.nc&&re(47125,{Pc:Ul(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ul(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}class Ei extends ki{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Bl,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Bl(e),this._firestoreClient=void 0,await e}}}function wp(r,e){const t=typeof r=="object"?r:Zh(),n=typeof r=="string"?r:Js,s=Kh(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const o=Ld("firestore");o&&_p(s,...o)}return s}function Mu(r){if(r._terminated)throw new U(V.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||kp(r),r._firestoreClient}function kp(r){var n,s,o,a;const e=r._freezeSettings(),t=yp(r._databaseId,((n=r._app)==null?void 0:n.options.appId)||"",r._persistenceKey,(s=r._app)==null?void 0:s.options.apiKey,e);r._componentsProvider||(o=e.localCache)!=null&&o._offlineComponentProvider&&((a=e.localCache)!=null&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),r._firestoreClient=new hp(r._authCredentials,r._appCheckCredentials,r._queue,t,r._componentsProvider&&function(h){const m=h==null?void 0:h._online.build();return{_offline:h==null?void 0:h._offline.build(m),_online:m}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new xt(Xe.fromBase64String(e))}catch(t){throw new U(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new xt(Xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:xt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Jn(e,xt._jsonSchema))return xt.fromBase64String(e.bytes)}}xt._jsonSchemaVersion="firestore/bytes/1.0",xt._jsonSchema={type:Oe("string",xt._jsonSchemaVersion),bytes:Oe("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new U(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Je(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new U(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new U(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return le(this._lat,e._lat)||le(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Lt._jsonSchemaVersion}}static fromJSON(e){if(Jn(e,Lt._jsonSchema))return new Lt(e.latitude,e.longitude)}}Lt._jsonSchemaVersion="firestore/geoPoint/1.0",Lt._jsonSchema={type:Oe("string",Lt._jsonSchemaVersion),latitude:Oe("number"),longitude:Oe("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==s[o])return!1;return!0}(this._values,e._values)}toJSON(){return{type:kt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Jn(e,kt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new kt(e.vectorValues);throw new U(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}kt._jsonSchemaVersion="firestore/vectorValue/1.0",kt._jsonSchema={type:Oe("string",kt._jsonSchemaVersion),vectorValues:Oe("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ep=/^__.*__$/;class Tp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Dr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Xn(e,this.data,t,this.fieldTransforms)}}function Fu(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw re(40011,{dataSource:r})}}class ra{constructor(e,t,n,s,o,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new ra({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var s;const t=(s=this.path)==null?void 0:s.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){var s;const t=(s=this.path)==null?void 0:s.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return ai(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Fu(this.dataSource)&&Ep.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Ip{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||_i(e)}createContext(e,t,n,s=!1){return new ra({dataSource:e,methodName:t,targetDoc:n,path:Je.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function na(r){const e=r._freezeSettings(),t=_i(r._databaseId);return new Ip(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Ap(r,e,t,n,s,o={}){const a=r.createContext(o.merge||o.mergeFields?2:0,e,t,s);qu("Data must be an object, but it was:",a,n);const u=Uu(n,a);let h,m;if(o.merge)h=new wt(a.fieldMask),m=a.fieldTransforms;else if(o.mergeFields){const f=[];for(const b of o.mergeFields){const E=Ti(e,b,t);if(!a.contains(E))throw new U(V.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Rp(f,E)||f.push(E)}h=new wt(f),m=a.fieldTransforms.filter(b=>h.covers(b.field))}else h=null,m=a.fieldTransforms;return new Tp(new gt(u),h,m)}function Bu(r,e,t,n=!1){return sa(t,r.createContext(n?4:3,e))}function sa(r,e){if($u(r=Ar(r)))return qu("Unsupported field value:",e,r),Uu(r,e);if(r instanceof Ou)return function(n,s){if(!Fu(s.dataSource))throw s.createError(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(n,s){const o=[];let a=0;for(const u of n){let h=sa(u,s.childContextForArray(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}}(r,e)}return function(n,s){if((n=Ar(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return af(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const o=we.fromDate(n);return{timestampValue:ni(s.serializer,o)}}if(n instanceof we){const o=new we(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:ni(s.serializer,o)}}if(n instanceof Lt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof xt)return{bytesValue:su(s.serializer,n._byteString)};if(n instanceof Ue){const o=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(o))throw s.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:$o(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof kt)return function(a,u){const h=a instanceof kt?a.toArray():a;return{mapValue:{fields:{[Pc]:{stringValue:Vc},[Xs]:{arrayValue:{values:h.map(f=>{if(typeof f!="number")throw u.createError("VectorValues must only contain numeric values.");return Oo(u.serializer,f)})}}}}}}(n,s);if(du(n))return n._toProto(s.serializer);throw s.createError(`Unsupported field value: ${ui(n)}`)}(r,e)}function Uu(r,e){const t={};return Ac(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jr(r,(n,s)=>{const o=sa(s,e.childContextForField(n));o!=null&&(t[n]=o)}),{mapValue:{fields:t}}}function $u(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof we||r instanceof Lt||r instanceof xt||r instanceof Ue||r instanceof Ou||r instanceof kt||du(r))}function qu(r,e,t){if(!$u(t)||!Tc(t)){const n=ui(t);throw n==="an object"?e.createError(r+" a custom object"):e.createError(r+" "+n)}}function Ti(r,e,t){if((e=Ar(e))instanceof Lu)return e._internalPath;if(typeof e=="string")return Np(r,e);throw ai("Field path arguments must be of type string or ",r,!1,void 0,t)}const Cp=new RegExp("[~\\*/\\[\\]]");function Np(r,e,t){if(e.search(Cp)>=0)throw ai(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new Lu(...e.split("."))._internalPath}catch{throw ai(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ai(r,e,t,n,s){const o=n&&!n.isEmpty(),a=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${n}`),a&&(h+=` in document ${s}`),h+=")"),new U(V.INVALID_ARGUMENT,u+r+h)}function Rp(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{convertValue(e,t="none"){switch(hr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(dr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw re(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return jr(e,(s,o)=>{n[s]=this.convertValue(o,t)}),n}convertVectorValue(e){var n,s,o;const t=(o=(s=(n=e.fields)==null?void 0:n[Xs].arrayValue)==null?void 0:s.values)==null?void 0:o.map(a=>Ve(a.doubleValue));return new kt(t)}convertGeoPoint(e){return new Lt(Ve(e.latitude),Ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=fi(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(zn(e));default:return null}}convertTimestamp(e){const t=ur(e);return new we(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ye.fromString(e);pe(uu(n),9688,{name:e});const s=new Wn(n.get(1),n.get(3)),o=new Z(n.popFirst(5));return s.isEqual(t)||Gt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp extends Sp{constructor(e){super(),this.firestore=e}convertBytes(e){return new xt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}}const $l="@firebase/firestore",ql="4.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(e,t,n,s,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Pp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const t=this._document.data.field(Ti("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Pp extends ia{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vp(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new U(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class oa{}class Ii extends oa{}function zl(r,e,...t){let n=[];e instanceof oa&&n.push(e),n=n.concat(t),function(o){const a=o.filter(h=>h instanceof la).length,u=o.filter(h=>h instanceof aa).length;if(a>1||a>0&&u>0)throw new U(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class aa extends Ii{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new aa(e,t,n)}_apply(e){const t=this._parse(e);return zu(e._query,t),new Qt(e.firestore,e.converter,po(e._query,t))}_parse(e){const t=na(e.firestore);return function(o,a,u,h,m,f,b){let E;if(m.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new U(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Kl(b,f);const P=[];for(const M of b)P.push(Gl(h,o,M));E={arrayValue:{values:P}}}else E=Gl(h,o,b)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Kl(b,f),E=Bu(u,a,b,f==="in"||f==="not-in");return Le.create(m,f,E)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class la extends oa{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new la(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:Et.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,o){let a=s;const u=o.getFlattenedFilters();for(const h of u)zu(a,h),a=po(a,h)}(e._query,t),new Qt(e.firestore,e.converter,po(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ca extends Ii{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ca(e,t)}_apply(e){const t=function(s,o,a){if(s.startAt!==null)throw new U(V.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new U(V.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Gn(o,a)}(e._query,this._field,this._direction);return new Qt(e.firestore,e.converter,Jm(e._query,t))}}function Wl(r,e="asc"){const t=e,n=Ti("orderBy",r);return ca._create(n,t)}class ua extends Ii{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ua(e,t,n)}_apply(e){return new Qt(e.firestore,e.converter,ei(e._query,this._limit,this._limitType))}}function Hl(r){return wm("limit",r),ua._create("limit",r,"F")}class da extends Ii{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new da(e,t,n)}_apply(e){const t=Mp(e,this.type,this._docOrFields,this._inclusive);return new Qt(e.firestore,e.converter,Xm(e._query,t))}}function Dp(...r){return da._create("startAfter",r,!1)}function Mp(r,e,t,n){if(t[0]=Ar(t[0]),t[0]instanceof ia)return function(o,a,u,h,m){if(!h)throw new U(V.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const b of Qr(o))if(b.field.isKeyField())f.push(Zs(a,h.key));else{const E=h.data.field(b.field);if(mi(E))throw new U(V.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+b.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(E===null){const I=b.field.canonicalString();throw new U(V.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${I}' (used as the orderBy) does not exist.`)}f.push(E)}return new on(f,m)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const s=na(r.firestore);return function(a,u,h,m,f,b){const E=a.explicitOrderBy;if(f.length>E.length)throw new U(V.INVALID_ARGUMENT,`Too many arguments provided to ${m}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const I=[];for(let P=0;P<f.length;P++){const M=f[P];if(E[P].field.isKeyField()){if(typeof M!="string")throw new U(V.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${m}(), but got a ${typeof M}`);if(!Lo(a)&&M.indexOf("/")!==-1)throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${m}() must be a plain document ID, but '${M}' contains a slash.`);const R=a.path.child(ye.fromString(M));if(!Z.isDocumentKey(R))throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${m}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const W=new Z(R);I.push(Zs(u,W))}else{const R=Bu(h,m,M);I.push(R)}}return new on(I,b)}(r._query,r.firestore._databaseId,s,e,t,n)}}function Gl(r,e,t){if(typeof(t=Ar(t))=="string"){if(t==="")throw new U(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Lo(e)&&t.indexOf("/")!==-1)throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(ye.fromString(t));if(!Z.isDocumentKey(n))throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Zs(r,new Z(n))}if(t instanceof Ue)return Zs(r,t._key);throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ui(t)}.`)}function Kl(r,e){if(!Array.isArray(r)||r.length===0)throw new U(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function zu(r,e){const t=function(s,o){for(const a of s)for(const u of a.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new U(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new U(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Lp(r,e,t){let n;return n=r?r.toFirestore(e):e,n}class Ss{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Xr extends ia{constructor(e,t,n,s,o,a){super(e,t,n,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $s(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ti("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Xr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Xr._jsonSchemaVersion="firestore/documentSnapshot/1.0",Xr._jsonSchema={type:Oe("string",Xr._jsonSchemaVersion),bundleSource:Oe("string","DocumentSnapshot"),bundleName:Oe("string"),bundle:Oe("string")};class $s extends Xr{data(e={}){return super.data(e)}}class Zr{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ss(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new $s(this._firestore,this._userDataWriter,n.key,n,new Ss(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new U(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(u=>{const h=new $s(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ss(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{const h=new $s(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ss(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let m=-1,f=-1;return u.type!==0&&(m=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Op(u.type),doc:h,oldIndex:m,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Zr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=jo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),n.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Op(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return re(61501,{type:r})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Zr._jsonSchemaVersion="firestore/querySnapshot/1.0",Zr._jsonSchema={type:Oe("string",Zr._jsonSchemaVersion),bundleSource:Oe("string","QuerySnapshot"),bundleName:Oe("string"),bundle:Oe("string")};function Wu(r){r=rn(r,Qt);const e=rn(r.firestore,Ei),t=Mu(e),n=new jp(e);return Vp(r._query),gp(t,r._query).then(s=>new Zr(e,n,r,s))}function Fp(r,e,t){r=rn(r,Ue);const n=rn(r.firestore,Ei),s=Lp(r.converter,e),o=na(n);return Hu(n,[Ap(o,"setDoc",r._key,s,r.converter!==null,t).toMutation(r._key,Dt.none())])}function Bp(r){return Hu(rn(r.firestore,Ei),[new Fo(r._key,Dt.none())])}function Hu(r,e){const t=Mu(r);return xp(t,e)}(function(e,t=!0){um(Xh),Qs(new Un("firestore",(n,{instanceIdentifier:s,options:o})=>{const a=n.getProvider("app").getImmediate(),u=new Ei(new mm(n.getProvider("auth-internal")),new gm(a,n.getProvider("app-check-internal")),Vm(a,s),a);return o={useFetchStreams:t,...o},u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),Kr($l,ql,e),Kr($l,ql,"esm2020")})();var Up="firebase",$p="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Kr(Up,$p,"app");const qp={apiKey:"AIzaSyCXA8pqsLUjVKXr1ltz5gN7VaD-saqlF-g",authDomain:"box-elite.firebaseapp.com",projectId:"box-elite",storageBucket:"box-elite.firebasestorage.app",messagingSenderId:"133574833722",appId:"1:133574833722:web:310d172ecb6dc3a5bae703"},zp=mc(qp),ha=wp(zp);function Gu(r){return vp(ha,"branches",r,"closedRows")}function Wp(r){return{id:r.id,employeeName:r.employeeName,cash:r.cash,sentToTreasury:r.sentToTreasury??0,expenseCompensation:r.expenseCompensation??0,expenses:r.expenses??0,carriedExpenseCount:r.carriedExpenseCount??0,expenseItems:r.expenseItems??[],mada:r.mada??0,visa:r.visa??0,mastercard:r.mastercard??0,bankTransfer:r.bankTransfer??0,programBalanceCash:r.programBalanceCash??0,programBalanceBank:r.programBalanceBank??0,variance:r.variance??0,status:"closed",notes:r.notes??"",closedAt:r.closedAt,createdAt:r.createdAt}}function Ku(r){const e=Array.isArray(r.expenseItems)?r.expenseItems.filter(t=>typeof t.amount=="number"&&typeof t.description=="string"):[];return{id:String(r.id??""),employeeName:String(r.employeeName??""),cash:Number(r.cash??0),sentToTreasury:Number(r.sentToTreasury??0),expenseCompensation:Number(r.expenseCompensation??0),expenses:Number(r.expenses??0),carriedExpenseCount:Number(r.carriedExpenseCount??0),expenseItems:e,mada:Number(r.mada??0),visa:Number(r.visa??0),mastercard:Number(r.mastercard??0),bankTransfer:Number(r.bankTransfer??0),programBalanceCash:Number(r.programBalanceCash??0),programBalanceBank:Number(r.programBalanceBank??0),variance:Number(r.variance??0),status:"closed",notes:String(r.notes??""),closedAt:r.closedAt?String(r.closedAt):null,createdAt:String(r.createdAt??"")}}async function Qu(r,e){const t=Du(ha,"branches",r,"closedRows",e.id),n=Wp({...e,closedAt:e.closedAt??new Date().toISOString()});await Fp(t,n)}async function Yu(r,e=500){const t=Gu(r);return(await Wu(t)).docs.map(o=>Ku(o.data())).sort((o,a)=>new Date((a.closedAt??"").toString()).getTime()-new Date((o.closedAt??"").toString()).getTime()).slice(0,e)}async function qs(r,e,t){const n=Gu(r),s=t?zl(n,Wl("closedAt","desc"),Hl(e+1),Dp(t)):zl(n,Wl("closedAt","desc"),Hl(e+1)),a=(await Wu(s)).docs,u=a.length>e,h=u?a.slice(0,e):a,m=h.map(b=>Ku(b.data())),f=h.length>0?h[h.length-1]:null;return{rows:m,lastDoc:f,hasMore:u}}async function Ju(r,e){await Bp(Du(ha,"branches",r,"closedRows",e))}const Hp=Object.freeze(Object.defineProperty({__proto__:null,addClosedRowToFirebase:Qu,deleteClosedRowFromFirebase:Ju,getClosedRowsFromFirebase:Yu,getClosedRowsPaginated:qs},Symbol.toStringTag,{value:"Module"}));function Xu(r){return`cashbox_rows_${r}`}function Gp(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function Kp(r){const e=r,t=Array.isArray(e.expenseItems)?e.expenseItems.filter(n=>typeof n.amount=="number"&&typeof n.description=="string"):[];return{...r,sentToTreasury:typeof e.sentToTreasury=="number"?e.sentToTreasury:0,expenseCompensation:typeof e.expenseCompensation=="number"?e.expenseCompensation:0,expenses:typeof r.expenses=="number"?r.expenses:0,carriedExpenseCount:typeof e.carriedExpenseCount=="number"&&e.carriedExpenseCount>=0?e.carriedExpenseCount:0,expenseItems:t,mastercard:typeof r.mastercard=="number"?r.mastercard:0,programBalanceCash:typeof r.programBalanceCash=="number"?r.programBalanceCash:0,programBalanceBank:typeof r.programBalanceBank=="number"?r.programBalanceBank:0}}function fn(r){try{const e=Xu(r);let t=localStorage.getItem(e);if(!t&&r==="corniche"){const s=localStorage.getItem("cashbox_rows");s&&(localStorage.setItem(e,s),localStorage.removeItem("cashbox_rows"),t=s)}return t?JSON.parse(t).filter(s=>s.status!=="closed").map(Kp):[]}catch{return[]}}function Ai(r,e){try{localStorage.setItem(Xu(r),JSON.stringify(e.filter(t=>t.status!=="closed")))}catch{}}function js(r){return fn(r).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}function Qp(r,e){return fn(r).find(n=>n.id===e)??null}function Zu(r,e,t){const n=fn(r),s=new Date().toISOString(),o=(t==null?void 0:t.expenses)??0,a=(t==null?void 0:t.expenseItems)??[],u=(t==null?void 0:t.carriedExpenseCount)??0;n.push({id:Gp(),employeeName:e,cash:0,sentToTreasury:0,expenseCompensation:0,expenses:o,carriedExpenseCount:u,expenseItems:a,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0,status:"active",notes:"",closedAt:null,createdAt:s}),Ai(r,n)}function jt(r,e,t){const n=fn(r),s=n.findIndex(o=>o.id===e);s!==-1&&(n[s]={...n[s],...t},Ai(r,n))}async function Yp(r,e,t){const n=new Date().toISOString(),s={...t,status:"closed",closedAt:n};await Qu(r,s);const o=fn(r).filter(a=>a.id!==e);Ai(r,o)}async function Jp(r,e,t){if(t)await Ju(r,e);else{const n=fn(r).filter(s=>s.id!==e);Ai(r,n)}}async function Xp(r){const{getClosedRowsFromFirebase:e,deleteClosedRowFromFirebase:t}=await Id(async()=>{const{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}=await Promise.resolve().then(()=>Hp);return{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}},void 0),n=await e(r);await Promise.all(n.map(s=>t(r,s.id)))}const Zp="٠١٢٣٤٥٦٧٨٩",eg="0123456789";function ed(r){let e="";for(let t=0;t<r.length;t++){const n=Zp.indexOf(r[t]);e+=n>=0?eg[n]:r[t]}return e}function tg(r){return r.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a/g,"").replace(/\u202b/g,"").replace(/\u202c/g,"").replace(/[\u0640\u066a]/g,"").replace(/\/\s*/g,"/").trim()}function rg(r){const e=r.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2})\s*([صم])/);if(!e)return null;const t=parseInt(e[2],10)-1,n=parseInt(e[3],10),s=parseInt(e[1],10);let o=parseInt(e[4],10);const a=parseInt(e[5],10),u=e[6];u==="م"&&o!==12&&(o+=12),u==="ص"&&o===12&&(o=0);const h=new Date(n,t,s,o,a,0,0);return isNaN(h.getTime())?null:h}function ng(r){let e=r.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(e){let t=parseInt(e[1],10);const n=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),a=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(o,a,u,t,n,0,0);return isNaN(h.getTime())?null:h}if(e=r.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{1,2})\/(\d{1,2})\/(\d{4})/),e){let t=parseInt(e[1],10);const n=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),a=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(u,a,o,t,n,0,0);return isNaN(h.getTime())?null:h}return null}function Ql(r){const e=tg((r||"").toString());if(!e)return null;const t=ed(e);return ng(t)??rg(t)}const sg=32874,ig=52100;function og(r){if(r instanceof Date)return isNaN(r.getTime())?null:r;if(typeof r=="number"&&Number.isFinite(r)){if(r<sg||r>ig)return null;const t=(r-25569)*86400*1e3,n=new Date(t);return isNaN(n.getTime())?null:n}return null}const ag="٫";function To(r){let e=(r||"").toString().trim();e=e.replace(/\s*SAR\s*/gi," ").replace(/\s*ر\.?\s*س\.?\s*/g," ").replace(/\s*ريال\s*(سعودي)?\s*/gi," ").trim();let n=ed(e).replace(ag,".").replace(/[^\d.,\-]/g,"");if(!n)return 0;if(/^-?\d+,\d{1,3}$/.test(n)?n=n.replace(",","."):n=n.replace(/,/g,""),n.includes(".")){const a=n.split("."),u=a[a.length-1];u&&u.length===3&&/^\d+$/.test(u)&&(n=n.replace(/\./g,""))}const o=parseFloat(n);return Number.isFinite(o)?o:0}const td={مدى:"mada",فيزا:"visa","ماستر كارد":"mastercard",ماستركارد:"mastercard","تحويل بنكي":"bankTransfer",تحويل:"bankTransfer"},lg=["شيك","أمريكان إكسبريس","امريكان اكسبريس","نقداً","نقدا","كاش"];function rd(r){const e=r.replace(/\s+/g," ").trim();return lg.some(t=>e===t||e.includes(t))}function cg(r,e,t){const n={...Pn},s={...Vn},o={mada:[],visa:[],mastercard:[],bankTransfer:[]},a=Math.min(r.length,500);for(let u=t;u<a;u++){const h=r[u];if(!h||!Array.isArray(h))continue;const m=Math.min(Math.max(h.length,4),120);let f=null,b=-1;for(let P=0;P<m;P++){const M=e?Yn(e,h,u,P):(h[P]??"").toString().trim(),R=Lr(M);if(!R||rd(R))continue;const W=td[R]??(R.includes("مدى")?"mada":null);if(W&&W!=="cash"){f=W,b=P;break}}if(f==null||f==="cash")continue;let E=0;for(let P=0;P<m;P++){if(P===b)continue;const M=e?Yn(e,h,u,P):(h[P]??"").toString().trim(),R=To(M);if(R>0&&R<=nd){E=R;break}}if(E<=0)continue;const I=(h[b]??"").toString().trim();I.includes("إجمالي")||I.includes("مجموع")||I.includes("المجموع")||(n[f]+=E,s[f]+=1,o[f].push({date:new Date(0),amount:E,employeeName:void 0,purpose:void 0}))}return{sums:n,counts:s,details:o}}const Pn={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},Vn={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},Yi={mada:[],visa:[],mastercard:[],bankTransfer:[]};function Lr(r){let e=(r??"").toString();return e=e.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a|\u202b|\u202c/g,"").replace(/\u200b|\u200c|\u200d|\ufeff/g,"").replace(/\s+/g," "),e=e.replace(/SAR/gi,"").replace(/ر\.?\s*س\.?/g,"").replace(/ريال\s*(سعودي)?/g,""),e.trim()}function Yn(r,e,t,n){const s=rr.encode_cell({r:t,c:n}),o=r[s];if(o!=null){if(typeof o.w=="string"&&o.w.trim())return o.w.trim();if(typeof o.v=="number"&&!Number.isNaN(o.v))return String(o.v);if(typeof o.v=="string")return o.v.trim()}return(e[n]??"").toString().trim()}function ma(r){const e=Lr(r);return e.includes("طريقةالدفع")||e.includes("طريقة الدفع")||e.includes("الدفع")&&e.length<30||e.includes("طريقة")&&(e.includes("دفع")||e.includes("الدفع"))}function fa(r){const e=Lr(r);return e.includes("المبلغ")||e.includes("قيمةالسند")||e.includes("قيمة السند")||e.includes("المقبوضات")||e.includes("مقبوضات")||e.includes("قبوضات")||e.includes("المصروفات")||e.includes("مصروفات")||e.includes("الصافي")||e.includes("صافي")||e.includes("مبلغ")||e.includes("قيمة")&&!e.includes("رقم")&&e.length<35}function Ps(r){const e=new Map;for(const s of Object.keys(r)){if(s.startsWith("!"))continue;const o=rr.decode_cell(s);if(o==null||typeof o.r!="number")continue;const a=o.r,u=o.c,h=r[s],m=h&&typeof h.w=="string"&&h.w.trim()||h&&typeof h.v=="string"&&h.v.trim()||(h&&typeof h.v=="number"&&!Number.isNaN(h.v)?String(h.v):"");e.has(a)||e.set(a,new Map),e.get(a).set(u,m)}const t=e.size===0?0:Math.max(...e.keys()),n=[];for(let s=0;s<=t;s++){const o=e.get(s),a=o?Math.max(...o.keys()):0,u=[];for(let h=0;h<=a;h++)u.push((o==null?void 0:o.get(h))??"");n.push(u)}return n}function ug(r){const e=new Map;for(const n of Object.keys(r)){if(n.startsWith("!"))continue;const s=rr.decode_cell(n);if(s==null||typeof s.r!="number")continue;const o=s.r,a=s.c,u=r[n],h=u&&typeof u.w=="string"&&u.w.trim()||u&&typeof u.v=="string"&&u.v.trim()||(u&&typeof u.v=="number"&&!Number.isNaN(u.v)?String(u.v):"");if(!h)continue;e.has(o)||e.set(o,[]);const m=e.get(o);for(;m.length<=a;)m.push("");m[a]=h}const t=Array.from(e.keys()).sort((n,s)=>n-s);for(const n of t){const s=e.get(n)||[];let o=!1,a=!1;for(const u of s){const h=Lr(u);h&&(fa(h)&&(o=!0),ma(h)&&(a=!0))}if(o&&a)return n}return-1}const dg=["مدى","فيزا","ماستر كارد","ماستركارد","تحويل بنكي","تحويل","نقداً","نقدا","شيك","أمريكان إكسبريس"];function hg(r){const e=Lr(r);return!e||e.length>50?!1:dg.some(t=>e===t||e.includes(t))}function mg(r,e){const t=Math.min(r.length,200);for(let n=1;n<t;n++){const s=r[n];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);for(let a=0;a<o;a++){const u=e?Yn(e,s,n,a):(s[a]??"").toString().trim();if(hg(u))return n-1}}return-1}function Yl(r,e){const t=Math.min(r.length,200);for(let n=0;n<t;n++){const s=r[n];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);let a=!1,u=!1;for(let h=0;h<o;h++){const m=e?Yn(e,s,n,h):(s[h]??"").toString().trim(),f=Lr(m);f&&(fa(f)&&(a=!0),ma(f)&&(u=!0))}if(a&&u)return n}return-1}const fg=["الموظف","اسم الموظف","الاسم","اسم","المستخدم","اسم المستخدم","الموظف المسؤول","المسؤول","كاشير","الكاشير","المحاسب","اسم المحاسب"];function pg(r){const e=r.replace(/\s+/g," ").replace(/\u200e|\u200f/g,"").trim();return e?e.includes("موظف")||e.includes("كاشير")||e.includes("محاسب")?!0:fg.some(t=>e===t||e.includes(t)):!1}const gg=["الغرض","الوصف","البيان","الغرض من العملية","تفاصيل","ملاحظات","وصف العملية"];function xg(r){const e=r.replace(/\s+/g," ").trim();return e?gg.some(t=>e.includes(t)):!1}function bg(r){let e=-1,t=-1,n=-1,s=-1,o=-1,a=-1;const u=Math.min(Math.max((r==null?void 0:r.length)??0,10),120);let h=-1;for(let m=0;m<u;m++){const f=r[m],b=Lr(f);(b.includes("الوقت")||b.includes("التاريخ"))&&e<0&&(e=m),t<0&&ma(b)&&(t=m),(b.includes("الإتجاه")||b.includes("الاتجاه"))&&s<0&&(s=m),o<0&&pg(b)&&(o=m),a<0&&xg(b)&&(a=m),fa(b)&&((b.includes("المقبوضات")||b.includes("مقبوضات")||b.includes("قبوضات"))&&(h=m),n<0&&(n=m)),b.includes("رقم السند")&&b.includes("قيمة السند")}return h>=0&&(n=h),t>=0&&n>=0?{date:e,method:t,amount:n,direction:s,employeeName:o,purpose:a}:null}function yg(r){const e=(r??"").toString().trim();return typeof r=="string"||typeof r=="number"&&r<3e4?e?Ql(e):null:og(r)??(e?Ql(e):null)}const nd=999999;function _g(r,e){try{const t=md(r,{type:"array"}),n=t.SheetNames||[];if(n.length===0)return{sums:Pn,counts:Vn,details:Yi,employeeName:null,employeeNamesList:[],error:"الملف لا يحتوي على أي sheet"};let s=[],o={},a="",u=-1;for(let F=0;F<n.length;F++)if(a=n[F],o=t.Sheets[a],s=rr.sheet_to_json(o,{header:1,defval:""}),u=Yl(s,o),u<0&&(s=Ps(o),u=Yl(s,o)),u<0&&(u=ug(o)),u>=0){s.length<=u&&(s=Ps(o));break}if(u>=0&&s.length<=u&&(s=Ps(o)),u<0&&(u=mg(s,o)),u>=0&&s.length<=u&&(s=Ps(o)),u<0)return{sums:Pn,counts:Vn,details:Yi,employeeName:null,employeeNamesList:[],error:"لم يُعثر على صف العناوين (طريقة الدفع، المبلغ أو المقبوضات)"};const h=s[u],m=[];for(let F=0;F<Math.max((h==null?void 0:h.length)??0,80);F++)m.push(Yn(o,h,u,F)||h[F]);let f=bg(m);if(!f){const F=cg(s,o,u+1);return{sums:F.sums,counts:F.counts,details:F.details,employeeName:null,employeeNamesList:[],error:null}}const E={...Pn},I={...Vn},P={mada:[],visa:[],mastercard:[],bankTransfer:[]},M=new Set,R=e.getTime();for(let F=u+1;F<s.length;F++){const ee=s[F],$=(ee[f.method]??"").toString().trim();if(!$||rd($))continue;const X=f.date>=0?ee[f.date]:void 0,w=f.date>=0?yg(X):null;if(f.date>=0&&(!w||w.getTime()<R))continue;const g=w??new Date(0),_=(f.direction>=0?(ee[f.direction]??"").toString().trim():"").replace(/\u200e/g,"").replace(/\u200f/g,"").trim();if(f.direction>=0&&_!=="داخل")continue;const v=ee[f.amount];if(f.employeeName>=0){const Ce=rr.encode_cell({r:F,c:f.employeeName}),Ee=o[Ce],ge=(Ee&&typeof Ee.w=="string"?Ee.w.trim():"")||(ee[f.employeeName]??"").toString().trim();ge&&M.add(ge)}const T=rr.encode_cell({r:F,c:f.amount}),x=o[T],J=x&&typeof x.w=="string"?x.w.trim():"";let ue;if(J)ue=To(J);else if(typeof v=="number"&&Number.isFinite(v))ue=v;else{const Ce=(v??"").toString().trim();ue=To(Ce)}if(ue<=0||ue>nd)continue;const Ae=$.replace(/\s+/g," ").trim();if(Ae.includes("إجمالي")||Ae.includes("مجموع")||Ae.includes("المجموع"))continue;const me=td[$]??($.toLowerCase().includes("مدى")?"mada":null);if(me&&(E[me]+=ue,I[me]+=1,me!=="cash")){const Ce=f.employeeName>=0?(()=>{const Ze=rr.encode_cell({r:F,c:f.employeeName}),ge=o[Ze];return(ge&&typeof ge.w=="string"?ge.w.trim():"")||(ee[f.employeeName]??"").toString().trim()||void 0})():void 0;let Ee;if(f.purpose>=0){const Ze=rr.encode_cell({r:F,c:f.purpose}),ge=o[Ze];Ee=(ge&&typeof ge.w=="string"?ge.w.trim():"")||(ee[f.purpose]??"").toString().trim()||void 0}P[me].push({date:g,amount:ue,employeeName:Ce,purpose:Ee})}}const W=[...M],Y=M.size===0?null:M.size===1?W[0]:"أكثر من موظف";return{sums:E,counts:I,details:P,employeeName:Y,employeeNamesList:W,error:null}}catch(t){const n=t instanceof Error?t.message:String(t);return{sums:Pn,counts:Vn,details:Yi,employeeName:null,employeeNamesList:[],error:`خطأ في قراءة الملف: ${n}`}}}function vg(r){const e=r.getHours();return e>=5&&e<12?{label:"صباح الخير",kind:"morning"}:e>=12&&e<17?{label:"مساء الخير",kind:"noon"}:e>=17&&e<21?{label:"أمسية سعيدة",kind:"evening"}:{label:"ليلة سعيدة",kind:"night"}}function zs(r){const e=r.mada+r.visa+r.mastercard;return Math.round((e-r.programBalanceBank)*100)/100}function Ws(r){const e=r.cash??0,t=r.sentToTreasury??0,n=r.expenses??0,s=r.expenseCompensation??0,o=Math.max(0,n-s),a=e+t+o;return Math.round((a-r.programBalanceCash)*100)/100}function Vs(r){const e=r.cash+r.mada+r.visa+r.mastercard,t=r.programBalanceCash+r.programBalanceBank;return Math.round((e-t)*100)/100}function li(r){const e=typeof r=="string"?new Date(r):r,t={calendar:"gregory",numberingSystem:"latn"},n=e.toLocaleDateString("ar-SA",{...t,weekday:"long"}),s=e.getDate(),o=e.toLocaleDateString("ar-SA",{...t,month:"long"}),a=e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",numberingSystem:"latn"});return`${n} ${s} ${o} ${a}`}const wg="٠١٢٣٤٥٦٧٨٩",kg="0123456789";function Sr(r){if(typeof r!="string")return String(r);let e="";for(let t=0;t<r.length;t++){const n=wg.indexOf(r[t]);e+=n>=0?kg[n]:r[t]}return e}function z(r){return new Intl.NumberFormat("ar-SA",{minimumFractionDigits:2,maximumFractionDigits:2,numberingSystem:"latn"}).format(r)}function Eg(r){const e=new Date(r),t=new Date;return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Tg(r){const e=new Date(r),t=new Date;return t.setDate(t.getDate()-1),e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Ig(r){const e=new Date(r),t=new Date,n=new Date(t);return n.setDate(n.getDate()-7),e>=n&&e<=t}function Jl(r,e){return e==="today"?r.filter(t=>t.closedAt&&Eg(t.closedAt)):e==="yesterday"?r.filter(t=>t.closedAt&&Tg(t.closedAt)):e==="lastWeek"?r.filter(t=>t.closedAt&&Ig(t.closedAt)):r}const Xl=["cash","sentToTreasury","expenseCompensation","expenses","programBalanceCash","mada","visa","mastercard","bankTransfer","programBalanceBank"];function Ag({row:r,rowNumber:e,isFirstActive:t,liveNow:n,closingRowId:s,closingSecondsLeft:o,onUpdate:a,isSelected:u=!1,onToggleSelect:h,onDeleteRow:m,onPrintRow:f,onOpenExpenseDetails:b,onClearExpensesAndOpen:E,onLockedFieldClick:I,onExpenseCompensationExceeded:P,lastExcelDetails:M,onShowExcelDetails:R,onRequestConfirmBankEdit:W,onShowEmployeeNames:Y,onShowVarianceExplanation:F,currentUserName:ee,onClearRow:$,isStickyRows:X=!1}){const w=t&&ee?ee:r.employeeName,g=A.useMemo(()=>zs(r),[r.mada,r.visa,r.mastercard,r.bankTransfer,r.programBalanceBank]),y=A.useMemo(()=>Ws(r),[r.cash,r.sentToTreasury,r.programBalanceCash,r.expenses,r.expenseCompensation]),_=A.useMemo(()=>{const K=r.carriedExpenseCount??0;return(r.expenseItems??[]).slice(0,K).reduce((_e,xe)=>_e+xe.amount,0)},[r.carriedExpenseCount,r.expenseItems]),v=r.status==="closed",T=s===r.id,x=A.useCallback((K,mt)=>{const _e=Sr(mt);let xe=parseFloat(_e)||0;K==="expenses"&&_>0&&xe<_&&(xe=_);const bt=r.expenses??0;K==="expenseCompensation"&&xe>bt&&(P==null||P(bt),xe=bt),a(r.id,K,xe)},[r.id,r.expenses,a,_,P]),J=A.useCallback(K=>{if(K.key==="Enter"||K.key==="Tab"){const mt=K.currentTarget.closest("tr");if(!mt)return;const _e=Array.from(mt.querySelectorAll("input:not([disabled])")),xe=_e.indexOf(K.currentTarget),bt=K.key==="Tab"&&K.shiftKey,ot=K.key==="Enter"||K.key==="Tab"&&!K.shiftKey;bt&&xe>0?(K.preventDefault(),_e[xe-1].focus()):ot&&xe>=0&&xe<_e.length-1&&(K.preventDefault(),_e[xe+1].focus())}},[]),ue=y>0?"text-emerald-700 dark:text-emerald-400":y<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",Ae=g>0?"text-emerald-700 dark:text-emerald-400":g<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",me=r.programBalanceCash>0,Ce=["programBalanceCash","expenses"],[Ee,Ze]=A.useState(!1),[ge,et]=A.useState(null),[Ne,ve]=A.useState(null),qe=A.useCallback(K=>{I==null||I(),Ze(!0),et(K)},[I]);A.useEffect(()=>{if(!Ee)return;const K=setTimeout(()=>Ze(!1),3e3);return()=>clearTimeout(K)},[Ee]),A.useEffect(()=>{if(ge===null)return;const K=setTimeout(()=>et(null),1200);return()=>clearTimeout(K)},[ge]);const ze=(K,mt)=>{var yt;const _e=r[K]??0,xe=(K==="mada"||K==="visa"||K==="mastercard"||K==="bankTransfer")&&((yt=M==null?void 0:M[K])==null?void 0:yt.length)>0&&R;if(v||T)return K==="expenses"&&b?l.jsx("button",{type:"button",onClick:()=>b(r.id),className:"block w-full py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/[0.06] rounded-xl transition cursor-pointer",title:"عرض تفاصيل المصروفات",children:_e===0?"—":z(_e)}):xe&&R?l.jsxs("div",{className:"flex items-center gap-1 w-full",children:[l.jsx("span",{className:"flex-1 min-w-0 py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center tabular-nums",children:_e===0?"—":z(_e)}),l.jsx("button",{type:"button",onClick:()=>R(K,r.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 8v4l2 2"}),l.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):l.jsx("span",{className:"block py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center",children:_e===0?"—":z(_e)});const bt=K==="expenses",ot=!Ce.includes(K)&&!me,pr=K==="programBalanceCash"&&t?0:ot?-1:1,Ft=xe&&W&&["mada","visa","mastercard","bankTransfer"].includes(K),Re=Ft&&(Ne==null?void 0:Ne.field)===K?Ne.value===0?"":String(Ne.value):_e===0?"":String(_e),Pe=l.jsx("input",{type:"text",inputMode:"decimal",value:Re,onChange:We=>{const _t=Sr(We.target.value).replace(/[^\d.]/g,""),It=_t.indexOf("."),ft=It===-1?_t:_t.slice(0,It+1)+_t.slice(It+1).replace(/\./g,""),rt=parseFloat(ft)||0;Ft?ve({field:K,value:rt}):x(K,ft)},onBlur:()=>{if(Ft&&(Ne==null?void 0:Ne.field)===K){const We=Ne.value;ve(null),We!==_e&&W(r.id,K,_e,We)}},dir:"ltr","aria-label":K,onKeyDown:J,onFocus:We=>{We.currentTarget.select(),bt&&b&&b(r.id)},placeholder:"—",tabIndex:pr,disabled:ot,title:ot?"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش":K==="expenseCompensation"?"يجب أن يكون مساوياً أو أقل من مبلغ المصروفات":void 0,className:"cashbox-input w-full px-2 py-2 rounded-xl bg-white dark:bg-slate-900/70 border-2 border-stone-400 dark:border-white/[0.06] text-stone-900 dark:text-white text-sm font-cairo text-center focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 dark:focus:border-amber-500/40 dark:focus:ring-amber-500/20 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm"});return ot&&I?l.jsx("div",{role:"button",tabIndex:0,className:"locked-field-wrapper w-full cursor-not-allowed rounded-lg",onClick:We=>{We.preventDefault(),We.stopPropagation(),qe(K)},onKeyDown:We=>{(We.key==="Enter"||We.key===" ")&&(We.preventDefault(),qe(K))},title:"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش",children:Pe}):xe&&R?l.jsxs("div",{className:"flex items-center gap-1 w-full",children:[l.jsx("div",{className:"flex-1 min-w-0",children:Pe}),l.jsx("button",{type:"button",onClick:()=>R(K,r.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 8v4l2 2"}),l.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):Pe},lt=T&&o>0?o<=1?"0.35s":o<=2?"0.6s":o<=3?"1s":"1.5s":void 0,ke=v&&r.closedAt?li(r.closedAt):li(n),Tt=X?"sticky top-[6.5rem] sm:top-[7rem] z-[9] bg-stone-50 dark:bg-slate-800/95 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b border-stone-300 dark:border-amber-500/15":"",tt=X?"sticky top-[8.75rem] sm:top-[9.25rem] z-[9] bg-white dark:bg-slate-800/95 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b border-stone-400 dark:border-amber-500/15":"";return l.jsxs(l.Fragment,{children:[l.jsx("tr",{"data-row-id":r.id,className:`bg-stone-50 dark:bg-amber-500/[0.06] border-l-2 border-l-teal-500 dark:border-l-amber-500/40 border-b-2 border-stone-400 dark:border-amber-500/15 ${X?"sticky-label-row":""}`,children:l.jsx("td",{colSpan:16,className:`py-1 px-2 sm:px-3 align-middle text-[10px] sm:text-[11px] font-semibold font-cairo text-stone-800 dark:text-amber-200/90 whitespace-nowrap ${Tt}`,style:{lineHeight:1.2,verticalAlign:"middle"},children:l.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap rounded-lg border-2 border-teal-400 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 px-2.5 py-1 shadow-md dark:shadow-[0_2px_6px_rgba(245,158,11,0.08)]",children:[w==="أكثر من موظف"&&Y?l.jsx("button",{type:"button",onClick:Y,className:"text-teal-600 dark:text-amber-400/95 hover:text-teal-700 dark:hover:text-amber-300 underline underline-offset-1 cursor-pointer transition-colors",title:"عرض أسماء الموظفين",children:"أكثر من موظف"}):l.jsx("span",{className:"font-semibold",children:w}),l.jsx("span",{className:"text-stone-500 dark:text-slate-400",children:"·"}),l.jsx("span",{className:"tabular-nums font-semibold text-stone-600 dark:text-slate-400",children:ke})]})})}),l.jsxs("tr",{"data-row-id":r.id,className:`${T?"bg-sky-100 dark:bg-sky-500/10 animate-pulse border-l-2 border-r-2 border-l-sky-400/50 border-r-sky-400/50 border-b-2 border-stone-400 dark:border-amber-500/15":v?"bg-stone-100 dark:bg-slate-800/30 border-b-2 border-stone-400 dark:border-amber-500/15":"bg-white dark:bg-slate-800/20 hover:bg-stone-50 dark:hover:bg-slate-800/35 border-b-2 border-stone-400 dark:border-amber-500/15 transition-colors"} ${X?"sticky-data-row":""}`,style:lt?{animationDuration:lt}:void 0,children:[l.jsx("td",{className:`p-1.5 text-center align-middle border-r-2 border-stone-400 dark:border-amber-500/10 ${tt}`,children:h&&l.jsx("div",{className:"flex items-center justify-center",children:l.jsx("button",{type:"button",onClick:()=>h(r.id),"aria-label":u?"إلغاء تحديد الصف":"تحديد الصف للطباعة",className:`inline-flex items-center justify-center w-5 h-5 rounded-lg border-2 transition-all ${u?"border-teal-500 bg-teal-100 text-teal-600 ring-2 ring-teal-500/30 ring-offset-2 ring-offset-stone-50 dark:border-amber-500/60 dark:bg-amber-500/20 dark:text-amber-400 dark:ring-amber-500/30 dark:ring-offset-slate-800":"border-2 border-stone-400 dark:border-white/20 bg-stone-300 dark:bg-slate-800/60 text-stone-800 dark:text-slate-400 hover:border-teal-400 dark:hover:border-amber-500/40 hover:text-teal-600 dark:hover:text-amber-400/90 shadow-sm"}`,children:u?l.jsx("svg",{className:"w-2.5 h-2.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M20 6L9 17l-5-5"})}):l.jsx("span",{className:"w-2.5 h-2.5 block shrink-0"})})})}),l.jsx("td",{className:`p-1.5 text-center text-stone-800 dark:text-slate-500 text-sm font-medium font-cairo border-r-2 border-stone-400 dark:border-amber-500/10 align-middle tabular-nums ${tt}`,children:e}),Xl.slice(0,4).map(K=>l.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${ge===K?"locked-cell-pulse":""} ${tt}`,children:ze(K)},K)),l.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${Ee&&t?"program-balance-pulse-cell":""} ${tt}`,title:!me&&t?"لا يمكن الإدخال في الخانات الأخرى قبل إدخال رصيد البرنامج كاش هنا":void 0,children:ze("programBalanceCash")}),l.jsx("td",{className:`p-1.5 text-center font-bold font-cairo align-middle border-2 border-red-300 dark:border-red-500/20 rounded-xl bg-red-50 dark:bg-slate-800/40 shadow-sm dark:shadow-[0_0_0_1px_rgba(248,113,113,0.08)] ${ue} ${tt}`,children:F?l.jsx("button",{type:"button",onClick:()=>F("cash",r),className:`block w-full py-1.5 rounded-lg transition cursor-pointer hover:bg-red-100/50 dark:hover:bg-white/[0.06] ${y===0?"cursor-default hover:bg-transparent":""}`,title:y===0?void 0:"شرح سبب انحراف الكاش",disabled:y===0,children:y===0?"—":z(y)}):l.jsx("span",{className:"block py-1",children:y===0?"—":z(y)})}),Xl.slice(5,9).map(K=>l.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${ge===K?"locked-cell-pulse":""} ${tt}`,children:ze(K)},K)),l.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle bg-stone-300 dark:bg-slate-800/40 ${tt}`,children:l.jsx("span",{className:"block py-1.5 text-sm text-teal-700 dark:text-emerald-400/95 font-semibold font-cairo tabular-nums",children:(()=>{const K=r.mada+r.visa+r.mastercard;return K===0?"—":z(K)})()})}),l.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${ge==="programBalanceBank"?"locked-cell-pulse":""} ${tt}`,children:ze("programBalanceBank")}),l.jsx("td",{className:`p-1.5 text-center font-bold font-cairo align-middle border-2 border-red-300 dark:border-red-500/20 rounded-xl bg-red-50 dark:bg-slate-800/40 shadow-sm dark:shadow-[0_0_0_1px_rgba(248,113,113,0.08)] ${Ae} ${tt}`,children:F?l.jsx("button",{type:"button",onClick:()=>F("bank",r),className:`block w-full py-1.5 rounded-lg transition cursor-pointer hover:bg-red-100/50 dark:hover:bg-white/[0.06] ${g===0?"cursor-default hover:bg-transparent":""}`,title:g===0?void 0:"شرح سبب انحراف البنك",disabled:g===0,children:g===0?"—":z(g)}):l.jsx("span",{className:"block py-1",children:g===0?"—":z(g)})}),l.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle overflow-hidden min-w-0 ${tt}`,children:v?l.jsxs("div",{className:"flex flex-row items-center justify-center gap-1 flex-wrap min-w-0 w-full",children:[l.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded-full px-1.5 py-0.5 bg-emerald-100 dark:bg-emerald-500/15 border border-emerald-300 dark:border-emerald-500/25 text-[9px] font-medium text-emerald-700 dark:text-emerald-400/95 font-cairo whitespace-nowrap shrink-0",children:[l.jsx("svg",{className:"w-2 h-2 text-emerald-600 dark:text-emerald-500 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M20 6L9 17l-5-5"})}),"تم الإغلاق"]}),(m||f)&&l.jsxs("div",{className:"inline-flex items-center justify-center gap-0.5 shrink-0",children:[m&&l.jsx("button",{type:"button",onClick:()=>m(r.id),"aria-label":"حذف الصف",className:"inline-flex items-center justify-center w-5 h-5 rounded-md border-2 border-stone-400 dark:border-red-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 transition-all shrink-0 shadow-sm",title:"حذف الصف",children:l.jsx("svg",{className:"w-2.5 h-2.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),f&&l.jsx("button",{type:"button",onClick:()=>f(r.id),"aria-label":"طباعة الصف",className:"inline-flex items-center justify-center w-5 h-5 rounded-md border-2 border-teal-400 dark:border-amber-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-teal-100 dark:hover:bg-amber-500/15 hover:text-teal-600 dark:hover:text-amber-400 hover:border-teal-300 dark:hover:border-amber-500/30 transition-all shrink-0 shadow-sm",title:"طباعة هذه التقفيلة",children:l.jsxs("svg",{className:"w-2.5 h-2.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M6 9V2h12v7"}),l.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),l.jsx("path",{d:"M6 14h12v8H6z"})]})})]})]}):$?l.jsx("button",{type:"button",onClick:()=>$(r.id),title:"افراغ كل المدخلات في الصف النشط",className:"inline-flex items-center justify-center gap-0.5 rounded-full px-1.5 py-0.5 bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/25 text-[9px] font-medium text-teal-700 dark:text-amber-400 font-cairo whitespace-nowrap w-full min-w-0 truncate hover:bg-teal-200 dark:hover:bg-amber-500/25 transition",children:"افراغ الصف"}):l.jsx("span",{className:"inline-flex items-center justify-center gap-0.5 rounded-full px-1.5 py-0.5 bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/25 text-[9px] font-medium text-teal-700 dark:text-amber-400 font-cairo whitespace-nowrap w-full min-w-0 truncate",children:"الشفت الحالي"})})]})]})}const Cg={Enter:"=","=":"=",Backspace:"⌫",Escape:"C",",":"."},Ng="programBalanceBank",Ji="اجمالى الموازنه";function Rg({onTransfer:r,hasActiveRow:e}={}){const[t,n]=A.useState("0"),[s,o]=A.useState(""),[a,u]=A.useState([]),[h,m]=A.useState(!1),f=A.useRef(null),[b,E]=A.useState(null);A.useLayoutEffect(()=>{if(!h){E(null);return}const x=f.current;if(!x){E(null);return}const J=x.getBoundingClientRect();E({right:window.innerWidth-J.right,bottom:window.innerHeight-J.top+8})},[h]);const I=A.useRef("0"),P=A.useRef(""),M=A.useRef(null),R=A.useRef(!1),W=A.useRef(()=>{}),Y=A.useRef(null),F=A.useCallback(x=>{I.current=x,n(x)},[]),ee=A.useCallback(x=>{n(x)},[]),$=A.useCallback((x,J,ue)=>{const Ae=parseFloat(x)||0,me=parseFloat(ue)||0;return J?J==="+"?Ae+me:J==="-"?Ae-me:J==="*"?Ae*me:J==="/"?me===0?0:Ae/me:J==="%"?me===0?0:Ae*me/100:me:me},[]),X=A.useCallback(()=>{const x=$(P.current,M.current,I.current),J=`${P.current} ${M.current} ${I.current} = ${x}`;u(ue=>[J,...ue].slice(0,20)),F(String(x)),o(""),P.current="",M.current=null,R.current=!0},[F,$]),w=A.useCallback(x=>{if(x==="C"){F("0"),o(""),u([]),m(!1),P.current="",M.current=null,R.current=!1;return}if(x==="⌫"){const J=I.current;if(J.length<=1){F("0");return}F(J.slice(0,-1));return}if(x==="="){M.current&&X();return}if(["+","-","*","/","%"].includes(x)){M.current&&X(),P.current=I.current,M.current=x,o(J=>J+" "+x),R.current=!0;return}if(x==="."){if(R.current){F("0."),I.current="0.",R.current=!1;return}if(I.current.includes("."))return;const J=I.current+".";I.current=J,M.current?ee(String($(P.current,M.current,J))):F(J),o(ue=>ue+x);return}if(/\d/.test(x)){if(R.current)I.current=x,M.current?ee(String($(P.current,M.current,x))):F(x),R.current=!1;else{const J=I.current==="0"?x:I.current+x;I.current=J,M.current?ee(String($(P.current,M.current,J))):F(J)}o(J=>J+x)}},[F,ee,X,$]);W.current=w,A.useEffect(()=>{const x=J=>{var Ce;const ue=J.target;if(ue.closest("input, textarea, select")||!((Ce=Y.current)!=null&&Ce.contains(ue)))return;const Ae=Cg[J.key]??(J.key.length===1?J.key:"");!Ae||!["C","⌫","%","/","*","-","+","=",".","0","1","2","3","4","5","6","7","8","9"].includes(Ae)&&!/^\d$/.test(Ae)||(J.preventDefault(),W.current(Ae))};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[]);const g=[["C","⌫","%","/"],["7","8","9","*"],["4","5","6","-"],["1","2","3","+"],["0",".","="]],y=x=>["+","-","*","/","%"].includes(x),_=x=>x==="="?"col-span-2 bg-teal-500 hover:bg-teal-600 dark:bg-amber-500/20 dark:hover:bg-amber-500/30 text-white dark:text-amber-400 font-bold text-lg border-2 border-teal-400 dark:border-amber-500/40 shadow-sm":y(x)?"bg-teal-100 hover:bg-teal-200 dark:bg-amber-500/20 dark:hover:bg-amber-500/30 text-teal-700 dark:text-amber-400 font-bold border-2 border-teal-300 dark:border-amber-500/40 flex items-center justify-center shadow-sm":x==="C"?"bg-red-100 hover:bg-red-200 dark:bg-red-500/20 dark:hover:bg-red-500/30 text-red-600 dark:text-red-400 border-2 border-red-300 dark:border-red-500/40 text-base shadow-sm":x==="⌫"?"bg-stone-400 hover:bg-stone-500 dark:bg-slate-600/40 dark:hover:bg-slate-500/50 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 text-base shadow-sm":"bg-white dark:bg-slate-700/40 hover:bg-stone-100 dark:hover:bg-slate-600/50 text-stone-900 dark:text-slate-200 border-2 border-stone-400 dark:border-white/10 active:scale-[0.98] text-base shadow-sm",v={"+":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:l.jsx("path",{d:"M12 5v14M5 12h14"})}),"-":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:l.jsx("path",{d:"M5 12h14"})}),"*":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:l.jsx("path",{d:"M7 7l10 10M17 7L7 17"})}),"/":l.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:l.jsx("path",{d:"M5 4l14 16"})}),"%":l.jsxs("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"6",cy:"6",r:"2.5"}),l.jsx("circle",{cx:"18",cy:"18",r:"2.5"}),l.jsx("path",{d:"M6 18L18 6"})]})},T=x=>v[x]?v[x]:l.jsx("span",{className:"inline-block leading-none",children:x});return l.jsxs("div",{ref:Y,className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",tabIndex:0,title:"انقر هنا ثم استخدم لوحة المفاتيح. النتيجة لا تتغير عند الكتابة في الجدول.",children:[l.jsxs("div",{className:"bg-gradient-to-b from-teal-100 to-stone-200 dark:from-amber-500/15 dark:to-slate-800/60 px-3 sm:px-4 py-2 sm:py-3 border-b-2 border-teal-400 dark:border-amber-500/25 flex items-center justify-between gap-2 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[l.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide min-w-0",children:[l.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400 shrink-0",children:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2"}),l.jsx("path",{d:"M6 6h12M6 10h12"}),l.jsx("rect",{x:"6.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"10.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"14.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"6.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"10.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),l.jsx("rect",{x:"14.5",y:"17.5",width:"3",height:"3",rx:"0.5"})]})}),"الآلة الحاسبة"]}),l.jsx("button",{ref:f,type:"button",onClick:()=>m(x=>!x),className:`p-1.5 rounded-lg transition ${h?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:h?"إخفاء السجل":"سجل العمليات","aria-label":"سجل العمليات",children:l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]})})]}),l.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 space-y-2 sm:space-y-3 min-h-0",children:[l.jsxs("div",{className:"rounded-xl bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-amber-500/30 p-2 shadow-inner dark:shadow-[0_0_18px_rgba(245,158,11,0.14)]",children:[l.jsx("div",{className:"text-right text-stone-700 text-xs min-h-[16px] font-cairo tabular-nums select-none","aria-hidden":"true",children:s||"​"}),l.jsx("div",{className:"w-full px-3 py-2.5 rounded-lg bg-stone-50 dark:bg-slate-900/50 border-2 border-stone-300 dark:border-transparent text-stone-900 dark:text-white text-right font-cairo text-2xl font-semibold tabular-nums min-h-[2.5rem] flex items-center justify-end","aria-live":"polite","aria-label":`النتيجة: ${t}`,children:t})]}),r&&l.jsxs("button",{type:"button",onClick:()=>{const x=parseFloat(t)||0;!e||x<=0||(r(x,Ng),u(J=>[`مرحّل → ${Ji}: ${x}`,...J].slice(0,20)),F("0"),o(""))},disabled:!e||!parseFloat(t),title:`ترحيل الرقم إلى ${Ji}`,className:"w-full py-2 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition flex items-center justify-center gap-2 shadow-sm",children:[l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل إلى ",Ji]}),l.jsx("div",{className:"grid grid-cols-4 gap-2",children:g.flat().map(x=>l.jsx("button",{type:"button",onClick:()=>w(x),className:`py-2.5 rounded-xl font-cairo transition-all duration-150 ${_(x)}`,"aria-label":x==="⌫"?"حذف":x,children:T(x)},x))}),h&&b&&en.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>m(!1)}),l.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[180px] max-h-[280px] overflow-y-auto",style:{right:b.right,bottom:b.bottom},children:[l.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"سجل العمليات"}),a.length===0?l.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لا يوجد سجل بعد"}):l.jsx("ul",{className:"space-y-1 mb-1 max-h-48 overflow-y-auto scrollbar-thin",children:a.map((x,J)=>l.jsx("li",{className:"tabular-nums px-2 py-1 rounded-md bg-stone-100 dark:bg-slate-800/40 text-stone-800 dark:text-slate-300 border border-stone-300 dark:border-transparent",children:x},J))}),l.jsx("button",{type:"button",onClick:()=>m(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]})}const Dn=[500,200,100,50,10,5,1],Xi=()=>Object.fromEntries(Dn.map(r=>[r,0]));function Sg({onApplyToCash:r,hasActiveRow:e}){const[t,n]=A.useState(Xi()),[s,o]=A.useState(Xi()),[a,u]=A.useState(!1),h=A.useRef(null),[m,f]=A.useState(null);A.useLayoutEffect(()=>{if(!a){f(null);return}const R=h.current;if(!R){f(null);return}const W=R.getBoundingClientRect();f({right:window.innerWidth-W.right,bottom:window.innerHeight-W.top+8})},[a]);const b=Dn.reduce((R,W)=>R+(t[W]??0)*W,0),E=Dn.reduce((R,W)=>R+(s[W]??0)*W,0),I=A.useCallback((R,W)=>{n(Y=>({...Y,[R]:W}))},[]),P=A.useCallback(()=>{n(Xi())},[]),M=A.useCallback(()=>{e&&(o({...t}),r(b),P())},[e,b,r,P,t]);return l.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[l.jsxs("div",{className:"relative bg-gradient-to-b from-teal-100 to-stone-200 dark:from-amber-500/15 dark:to-slate-800/60 px-3 sm:px-4 py-2 sm:py-3 border-b-2 border-teal-300 dark:border-amber-500/25 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide min-w-0",children:[l.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400 shrink-0",children:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),l.jsx("path",{d:"M2 10h20M2 14h20M7 8v8M12 8v8M17 8v8"})]})}),"حاسبة الكاش"]}),l.jsx("button",{ref:h,type:"button",onClick:()=>u(R=>!R),className:`p-1.5 rounded-lg transition shrink-0 ${a?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:"آخر عمليات رُحّلت إلى الكاش","aria-label":"سجل العمليات",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]})})]}),l.jsx("span",{className:"text-xs font-semibold text-stone-800 dark:text-amber-200/95 font-cairo",children:"المجموع"}),l.jsx("span",{className:"text-sm font-semibold text-teal-700 dark:text-amber-400 font-cairo tabular-nums",children:b>0?`${b} ريال سعودي`:"— ريال سعودي"}),a&&m&&en.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>u(!1)}),l.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[280px] overflow-y-auto",style:{right:m.right,bottom:m.bottom},children:[l.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"آخر عمليات رُحّلت إلى الكاش:"}),E===0?l.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):l.jsxs(l.Fragment,{children:[l.jsx("ul",{className:"space-y-0.5 mb-1",children:Dn.map(R=>{const W=s[R]??0;return W===0?null:l.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:["فئة ",R,": ",W," × ",R," = ",W*R," ريال"]},R)})}),l.jsxs("p",{className:"border-t border-stone-300 dark:border-white/10 pt-1 font-semibold text-teal-700 dark:text-amber-400 tabular-nums",children:["المجموع: ",E," ريال سعودي"]})]}),l.jsx("button",{type:"button",onClick:()=>u(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]}),l.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 min-h-0 overflow-hidden gap-3 sm:gap-4",children:[l.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-5 shrink-0",children:Dn.map(R=>{const W=(t[R]??0)*R;return l.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-4 rounded-lg sm:rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-amber-500/15 px-2 sm:px-6 py-3 sm:py-5 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-w-0",children:[l.jsxs("span",{className:"text-teal-700 dark:text-amber-400/90 text-xs font-cairo font-semibold tabular-nums",children:["فئة النقد ",R]}),l.jsxs("div",{className:"flex items-center gap-2.5 w-full justify-center px-1",children:[l.jsx("button",{type:"button","aria-label":"نقص واحد",onClick:()=>I(R,Math.max(0,(t[R]??0)-1)),disabled:(t[R]??0)<=0,className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-red-100 dark:hover:bg-red-500/20 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 disabled:opacity-40 disabled:pointer-events-none transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:l.jsx("span",{className:"text-sm font-bold leading-none",children:"−"})}),l.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",value:t[R]===0||t[R]==null?"":String(t[R]),onChange:Y=>{const F=Sr(Y.target.value).replace(/\D/g,"");I(R,Math.max(0,parseInt(F,10)||0))},onFocus:Y=>{const F=Y.target.value;(F===""||Number(F)===0)&&I(R,0)},className:"w-full min-w-[3rem] max-w-[4.5rem] px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums cashbox-input focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-amber-500/50 dark:focus:ring-amber-500/25 focus:outline-none"}),l.jsx("button",{type:"button","aria-label":"زد واحد",onClick:()=>I(R,(t[R]??0)+1),className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-teal-100 dark:hover:bg-emerald-500/20 hover:text-teal-700 dark:hover:text-emerald-400 hover:border-teal-300 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:l.jsx("span",{className:"text-sm font-bold leading-none",children:"+"})})]}),W>0?l.jsxs("span",{className:"text-stone-800 dark:text-slate-300 text-[10px] font-semibold font-cairo tabular-nums whitespace-nowrap",children:[W," ريال سعودي"]}):l.jsx("span",{className:"text-stone-600 dark:text-slate-500/60 text-[10px] font-semibold font-cairo whitespace-nowrap",children:"— ريال سعودي"})]},R)})}),l.jsxs("div",{className:"w-full py-3 px-4 rounded-xl text-sm font-cairo font-semibold bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/30 text-teal-800 dark:text-amber-400 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_0_12px_rgba(245,158,11,0.08)]",children:[l.jsx("span",{children:"المجموع"}),l.jsx("span",{className:"text-base font-semibold tabular-nums",children:b>0?`${b} ريال سعودي`:"— ريال سعودي"})]}),l.jsxs("div",{className:"flex gap-2 shrink-0",children:[l.jsxs("button",{type:"button",onClick:M,disabled:!e||b===0,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل للكاش"]}),l.jsxs("button",{type:"button",onClick:P,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),l.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح"]})]})]})]})}const jg=[{field:"mada",label:"مدى"},{field:"visa",label:"فيزا"},{field:"mastercard",label:"ماستر كارد"}];function Pg({onTransfer:r,hasActiveRow:e}){const[t,n]=A.useState({mada:[],visa:[],mastercard:[]}),[s,o]=A.useState({mada:"",visa:"",mastercard:""}),[a,u]=A.useState({mada:[],visa:[],mastercard:[]}),[h,m]=A.useState(null),f=A.useRef(null),[b,E]=A.useState(null);A.useLayoutEffect(()=>{if(h===null){E(null);return}const g=f.current;if(!g){E(null);return}const y=g.getBoundingClientRect();E({right:window.innerWidth-y.right,bottom:window.innerHeight-y.top+8})},[h]);const I=A.useCallback(g=>g.reduce((y,_)=>y+_,0),[]),P=I(t.mada),M=I(t.visa),R=I(t.mastercard),W=P+M+R,Y=A.useCallback(g=>{const y=Sr(s[g]).replace(",",".").replace(/[^\d.]/g,""),_=parseFloat(y)||0;_<=0||(n(v=>({...v,[g]:[...v[g],_]})),o(v=>({...v,[g]:""})))},[s]),F=A.useCallback((g,y)=>{n(_=>({..._,[g]:_[g].filter((v,T)=>T!==y)}))},[]),ee=A.useCallback((g,y)=>{o(_=>({..._,[g]:y}))},[]),$=A.useCallback(()=>{n({mada:[],visa:[],mastercard:[]}),o({mada:"",visa:"",mastercard:""})},[]),X=A.useCallback(g=>{if(!e)return;const y=t[g],_=g==="mada"?P:g==="visa"?M:R;if(_===0)return;u(T=>({...T,[g]:[...T[g],...y]}));const v=g==="mada"?[_,0,0]:g==="visa"?[0,_,0]:[0,0,_];r(v[0],v[1],v[2]),n(T=>({...T,[g]:[]})),o(T=>({...T,[g]:""}))},[e,P,M,R,r,t]),w=A.useCallback(()=>{!e||P===0&&M===0&&R===0||(u(g=>({mada:[...g.mada,...t.mada],visa:[...g.visa,...t.visa],mastercard:[...g.mastercard,...t.mastercard]})),r(P,M,R),$())},[e,P,M,R,r,t,$]);return l.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[l.jsxs("div",{className:"bg-gradient-to-b from-teal-100 to-slate-200 dark:from-amber-500/15 dark:to-slate-800/60 px-4 py-3 border-b-2 border-teal-300 dark:border-amber-500/25 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[l.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide",children:[l.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400",children:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"1"}),l.jsx("path",{d:"M2 10h20M7 14h2"})]})}),"حاسبه العمليات البنكيه"]}),l.jsx("span",{className:"text-xs font-semibold text-slate-700 font-cairo tabular-nums",children:W>0?`${W} ريال`:"—"})]}),l.jsxs("div",{className:"flex-1 flex flex-col p-4 min-h-0 overflow-hidden gap-4",children:[l.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1 min-h-0",children:jg.map(({field:g,label:y})=>{const _=t[g],v=I(_);return l.jsxs("div",{className:"relative flex flex-col rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-amber-500/15 px-3 py-3 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-h-0",children:[l.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1 shrink-0",children:[l.jsx("span",{className:"text-teal-700 dark:text-amber-400/90 text-xs font-cairo font-semibold",children:y}),l.jsxs("div",{className:"relative shrink-0",children:[l.jsx("button",{ref:h===g?f:void 0,type:"button",onClick:()=>m(T=>T===g?null:g),className:`p-1.5 rounded-lg transition ${h===g?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:"كل العمليات المرحّلة لهذا النوع","aria-label":"سجل العمليات",children:l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 6v6l4 2"})]})}),h===g&&b&&en.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>m(null)}),l.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[140px] max-h-[220px] overflow-y-auto",style:{right:b.right,bottom:b.bottom},children:[l.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"كل العمليات المرحّلة إلى الصف:"}),a[g].length===0?l.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):l.jsxs(l.Fragment,{children:[l.jsx("ul",{className:"space-y-0.5 mb-1",children:a[g].map((T,x)=>l.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[T," ريال"]},x))}),l.jsxs("p",{className:"border-t border-stone-200 dark:border-white/10 pt-1 font-semibold text-teal-700 dark:text-amber-400 tabular-nums",children:["المجموع: ",I(a[g])," ريال"]})]}),l.jsx("button",{type:"button",onClick:()=>m(null),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]}),l.jsx("p",{className:"text-[9px] text-stone-500 dark:text-slate-500 font-cairo mb-1.5 shrink-0",children:"أدخل المبلغ ثم +"}),l.jsxs("div",{className:"flex items-center gap-1.5 mb-2 shrink-0",children:[l.jsx("input",{type:"text",inputMode:"decimal",dir:"ltr",placeholder:"مبلغ العملية",value:s[g],onChange:T=>{const J=(Sr(T.target.value).replace(",",".").replace(/[^\d.]/g,"").match(/^\d*\.?\d*/)||[""])[0];ee(g,J)},onKeyDown:T=>{T.key==="Enter"&&(T.preventDefault(),Y(g))},className:"flex-1 min-w-0 px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums placeholder:text-xs placeholder:text-stone-400 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-amber-500/50 dark:focus:ring-amber-500/25 focus:outline-none"}),l.jsx("button",{type:"button","aria-label":`إضافة لـ ${y}`,onClick:()=>Y(g),className:"flex items-center justify-center w-8 h-8 rounded-lg bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-teal-100 dark:hover:bg-emerald-500/20 hover:text-teal-700 dark:hover:text-emerald-400 hover:border-teal-300 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm",children:l.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})]}),l.jsx("div",{className:"flex-1 min-h-0 overflow-auto space-y-1",children:_.length===0?l.jsx("span",{className:"text-stone-600 dark:text-slate-500 text-[10px] font-cairo",children:"لا عمليات — أضف مبالغ بالزر +"}):_.map((T,x)=>l.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-lg bg-white dark:bg-slate-700/50 px-2 py-1 border-2 border-stone-400 dark:border-white/10 shadow-sm",children:[l.jsxs("span",{className:"text-xs font-cairo tabular-nums text-stone-800 dark:text-slate-200",children:[T," ريال"]}),l.jsx("button",{type:"button",onClick:()=>F(g,x),"aria-label":"حذف",className:"w-5 h-5 rounded flex items-center justify-center text-stone-600 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-500/20 transition shrink-0",children:l.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},`${g}-${x}`))}),l.jsxs("div",{className:"pt-2 mt-auto border-t-2 border-stone-400 dark:border-white/10 shrink-0 space-y-2",children:[l.jsxs("span",{className:"text-xs font-semibold font-cairo text-teal-700 dark:text-amber-400 tabular-nums block",children:["المجموع: ",v>0?`${v} ريال`:"—"]}),l.jsxs("button",{type:"button",onClick:()=>X(g),disabled:!e||v===0,title:`ترحيل ${y} إلى الصف النشط`,className:"w-full py-2 rounded-lg text-xs font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-1.5",children:[l.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل ",y]})]})]},g)})}),l.jsxs("div",{className:"w-full py-2.5 px-4 rounded-xl text-xs font-cairo font-semibold bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/30 text-teal-800 dark:text-amber-400 flex items-center justify-between gap-6 shrink-0",children:[l.jsxs("span",{className:"tabular-nums",children:["مدى ",l.jsx("span",{className:"font-bold",children:P})]}),l.jsxs("span",{className:"tabular-nums",children:["فيزا ",l.jsx("span",{className:"font-bold",children:M})]}),l.jsxs("span",{className:"tabular-nums",children:["ماستر ",l.jsx("span",{className:"font-bold",children:R})]})]}),l.jsxs("div",{className:"flex gap-2 shrink-0",children:[l.jsxs("button",{type:"button",onClick:w,disabled:!e||P===0&&M===0&&R===0,title:"ترحيل مدى + فيزا + ماستر كارد معاً إلى الصف النشط",className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الكل"]}),l.jsxs("button",{type:"button",onClick:$,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),l.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح الكل"]})]})]})]})}const Vg={success:{bg:"bg-emerald-100 dark:bg-emerald-500/15",border:"border-emerald-400 dark:border-emerald-500/40",icon:"text-emerald-700 dark:text-emerald-400"},error:{bg:"bg-red-100 dark:bg-red-500/15",border:"border-red-400 dark:border-red-500/40",icon:"text-red-700 dark:text-red-400"},warning:{bg:"bg-amber-100 dark:bg-amber-500/15",border:"border-amber-400 dark:border-amber-500/40",icon:"text-amber-700 dark:text-amber-400"},info:{bg:"bg-sky-100 dark:bg-sky-500/15",border:"border-sky-400 dark:border-sky-500/40",icon:"text-sky-700 dark:text-sky-400"}},Dg={success:l.jsx("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M20 6L9 17l-5-5"})}),error:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),warning:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M12 9v4M12 17h.01"}),l.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})]}),info:l.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"10"}),l.jsx("path",{d:"M12 16v-4M12 8h.01"})]})},Zl=3e3;function Mg({message:r,type:e,onClose:t,position:n="bottom",autoHideMs:s=Zl}){const o=A.useRef(t);o.current=t,A.useEffect(()=>{const h=s>0?s:Zl,m=setTimeout(()=>o.current(),h);return()=>clearTimeout(m)},[r,s]);const a=Vg[e],u=n==="center"?"fixed top-1/2 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2":"fixed bottom-6 left-1/2 z-50 -translate-x-1/2";return l.jsxs("div",{role:"alert",className:`${u} flex items-center gap-3 px-4 py-3 rounded-2xl border ${a.bg} ${a.border} shadow-xl shadow-black/10 dark:shadow-black/20 backdrop-blur-md min-w-[200px] max-w-[90vw]`,children:[l.jsx("span",{className:a.icon,"aria-hidden":"true",children:Dg[e]}),l.jsx("span",{className:"font-cairo text-sm text-stone-800 dark:text-slate-200 flex-1",children:r}),l.jsx("button",{type:"button",onClick:t,className:"p-1 rounded-lg text-stone-600 dark:text-slate-400 hover:text-stone-900 dark:hover:text-slate-200 hover:bg-stone-300 dark:hover:bg-white/10 transition focus-visible:ring-2 focus-visible:ring-teal-400 dark:focus-visible:ring-amber-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none","aria-label":"إغلاق",children:l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})}const Zi=4,ec=5;function Lg(r,e){const[t,n]=A.useState([]),[s,o]=A.useState([]),[a,u]=A.useState(1),[h,m]=A.useState(!0),[f,b]=A.useState(!1),E=A.useRef({}),I=A.useRef({}),P=A.useRef(new Map),M=t.length>0||s.length>0?[...t.sort(($,X)=>new Date(X.createdAt).getTime()-new Date($.createdAt).getTime()),...s].sort(($,X)=>$.status!=="closed"&&X.status==="closed"?-1:$.status==="closed"&&X.status!=="closed"?1:$.status==="closed"&&X.status==="closed"?new Date((X.closedAt??"").toString()).getTime()-new Date(($.closedAt??"").toString()).getTime():new Date(X.createdAt).getTime()-new Date($.createdAt).getTime()):[],R=A.useCallback(async($,X=!1)=>{const w=P.current.get($);if(w&&!X)return o(w.rows),b(w.hasMore),w;const g=$===1?Zi:ec;let y=null;if($>1){const v=P.current.get($-1);y=(v==null?void 0:v.lastDoc)??null}const _=await qs(e,g,y);return P.current.set($,_),o(_.rows),b(_.hasMore),_},[e]),W=A.useCallback(async $=>{var g;if($<1)return;m(!0);const X=P.current.get($-1);if($>1&&!X)for(let y=1;y<$;y++){const _=y===1?Zi:ec,v=y===1?null:((g=P.current.get(y-1))==null?void 0:g.lastDoc)??null,T=await qs(e,_,v);if(P.current.set(y,T),!T.hasMore&&y<$-1)break}await R($),u($),m(!1)},[e,R]),Y=A.useCallback(async()=>{m(!0);const $=js(e);n($),P.current.clear(),u(1);const X=await R(1,!0);[...$,...(X==null?void 0:X.rows)??[]].forEach(g=>{I.current[g.id]=g}),m(!1)},[e,R]),F=A.useRef([]);F.current=M;const ee=A.useCallback($=>{const X=typeof $=="function"?$(F.current):$,w=X.filter(y=>y.status!=="closed"),g=X.filter(y=>y.status==="closed");n(w),o(g),X.forEach(y=>{I.current[y.id]=y})},[]);return A.useEffect(()=>{let $=!1;return(async()=>{if(js(e).length===0&&Zu(e,r),$)return;m(!0),n(js(e)),P.current.clear(),u(1);const w=await qs(e,Zi);if($)return;P.current.set(1,w),o(w.rows),b(w.hasMore),[...js(e),...w.rows].forEach(y=>{I.current[y.id]=y}),m(!1)})(),()=>{$=!0,Object.values(E.current).forEach(clearTimeout),E.current={}}},[r,e]),{rows:M,setRows:ee,loadRows:Y,loading:h,debounceRef:E,rowDataRef:I,currentClosedPage:a,setCurrentClosedPage:u,goToClosedPage:W,hasMoreClosedPages:f,closedPagesCache:P.current}}function Og(){const[r,e]=A.useState(()=>new Date),[t,n]=A.useState(null),[s,o]=A.useState(null),[a,u]=A.useState(0);return A.useEffect(()=>{const h=setInterval(()=>{const m=Date.now();e(new Date(m)),s!==null&&u(Math.max(0,Math.ceil((s-m)/1e3)))},1e3);return()=>clearInterval(h)},[s]),{liveNow:r,closingRowId:t,setClosingRowId:n,closingEndsAt:s,setClosingEndsAt:o,closingSecondsLeft:a,setClosingSecondsLeft:u}}function Fg(r,e){const[t,n]=A.useState(null),[s,o]=A.useState(null),a=A.useRef({}),u=A.useRef(null),h=A.useRef(null);h.current=(t==null?void 0:t.rowId)??null;const m=A.useCallback(f=>{var F;if(h.current===f)return;a.current={},o(null);const b=r.find(ee=>ee.id===f)??e.current[f],E=(b==null?void 0:b.expenses)??0;let I=(F=b==null?void 0:b.expenseItems)!=null&&F.length?b.expenseItems.map(ee=>({amount:String(ee.amount),description:ee.description||""})):[{amount:E?String(E):"",description:""}];const P=ee=>(Number(ee.amount)||0)!==0||String(ee.description||"").trim()!=="",M=(b==null?void 0:b.carriedExpenseCount)??0,R=I.slice(0,M).filter(P).length;I=I.filter(P);let W=R;const Y=(b==null?void 0:b.status)==="closed";if(!Y&&I.length>0){const ee=I[I.length-1];if(String(ee.amount||"").trim()!==""||String(ee.description||"").trim()!==""){const $=I.reduce((g,y)=>g+(Number(y.amount)||0),0),X=E-$,w=X>0?String(X):"";I=[...I,{amount:w,description:""}]}}!Y&&I.length===0&&(I=[{amount:E?String(E):"",description:""}]),n({rowId:f,items:I,readOnly:Y,carriedCount:W})},[r,e]);return A.useEffect(()=>{t||(u.current=null)},[t]),A.useEffect(()=>{if(s===null)return;const f=setTimeout(()=>o(null),3e3);return()=>clearTimeout(f)},[s]),{expenseModal:t,setExpenseModal:n,pulseExpenseDescriptionIndex:s,setPulseExpenseDescriptionIndex:o,openExpenseDetails:m,expenseAmountRef:a,expenseModalFocusedRowIdRef:u}}const sd="cashbox_theme",Bn=typeof document<"u"?document.documentElement:null,tc=typeof document<"u"?document.body:null;function Bg(){try{if(typeof localStorage>"u")return"dark";const r=localStorage.getItem(sd);return r==="light"||r==="dark"?r:"dark"}catch{return"dark"}}function Io(r){if(!Bn)return;const e=r==="dark";Bn.classList.toggle("dark",e),tc&&tc.classList.toggle("dark",e);try{localStorage.setItem(sd,r)}catch{}Bn.offsetHeight}function Ug(r){try{window.dispatchEvent(new CustomEvent("cashbox-theme-change",{detail:r}))}catch{}}function id(){if(!Bn)return;const e=Bn.classList.contains("dark")?"light":"dark";Io(e),Ug(e)}const Ds=10,$g=2;function eo(){return"ayman5255"}const qg=[{id:"today",label:"اليوم"},{id:"yesterday",label:"أمس"},{id:"lastWeek",label:"الأسبوع الماضي"}],Nn={corniche:"الكورنيش",andalusia:"الأندلس"};function rc(){id()}function zg({name:r,branch:e,onExit:t,onSwitchBranch:n,theme:s,onToggleTheme:o}){const a=A.useRef(null),[u,h]=A.useState(null),{rows:m,setRows:f,loadRows:b,debounceRef:E,rowDataRef:I,currentClosedPage:P,goToClosedPage:M,hasMoreClosedPages:R}=Lg(r,e),{liveNow:W,closingRowId:Y,setClosingRowId:F,setClosingEndsAt:ee,closingSecondsLeft:$,setClosingSecondsLeft:X}=Og(),[w,g]=A.useState("today"),[y,_]=A.useState(null),[v,T]=A.useState(null),[x,J]=A.useState(null),[ue,Ae]=A.useState(new Set),[me,Ce]=A.useState(null),[Ee,Ze]=A.useState(null),[ge,et]=A.useState(null),[Ne,ve]=A.useState(""),[qe,ze]=A.useState(!1),[lt,ke]=A.useState(!1),[Tt,tt]=A.useState(null),[K,mt]=A.useState(0),_e=A.useRef(null),[xe,bt]=A.useState(null),[ot,pr]=A.useState([]),[Ft,Re]=A.useState(null),[Pe,yt]=A.useState(!1),[We,_t]=A.useState(null),[It,ft]=A.useState(null),[rt,Or]=A.useState(null);A.useEffect(()=>{const k=a.current;if(!k)return;const C=S=>{S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation(),rc()};return k.addEventListener("click",C,!0),()=>k.removeEventListener("click",C,!0)},[]);const{expenseModal:fe,setExpenseModal:Bt,pulseExpenseDescriptionIndex:rs,setPulseExpenseDescriptionIndex:pn,openExpenseDetails:ns,expenseAmountRef:Ke,expenseModalFocusedRowIdRef:Fr}=Fg(m,I);A.useEffect(()=>{if(Y===null||$>0)return;const k=Y,C=m.find(S=>S.id===k);if(!C||C.status==="closed"){F(null),ee(null);return}F(null),ee(null),(async()=>{try{const S=E.current[k];S&&(clearTimeout(S),delete E.current[k],jt(e,k,C));const O=Qp(e,k),H=O?{...O,...C,id:k,status:"active"}:C,Q=Vs(H);await Yp(e,k,{...H,employeeName:r,variance:Q});const L=H.expenses??0,ne=H.expenseCompensation??0,te=Math.max(0,L-ne),q=H.expenseItems??[],ut=ne>0?te>0?[{amount:te,description:"مرحّل (صافي بعد التعويض)"}]:[]:q.map(De=>({amount:De.amount,description:De.description||""}));Zu(e,r,{expenses:te,expenseItems:ut,carriedExpenseCount:ut.length}),await b(),_({msg:"تم إغلاق الشفت وإضافة صف جديد",type:"success"}),mt(De=>De+1)}catch{_({msg:"فشل ترحيل الصف المغلَق إلى السحابة — تحقق من الاتصال",type:"error"})}})()},[$,Y,m,r,b,e]);const pt=A.useMemo(()=>{const k=m.filter(S=>S.status!=="closed").sort((S,O)=>new Date(O.createdAt).getTime()-new Date(S.createdAt).getTime()),C=Jl(m.filter(S=>S.status==="closed"),w).sort((S,O)=>new Date((O.closedAt??"").toString()).getTime()-new Date((S.closedAt??"").toString()).getTime());return w==="today"?[...k,...C]:C},[m,w]),Ut=pt,ae=A.useMemo(()=>{var k;return((k=pt.find(C=>C.status!=="closed"))==null?void 0:k.id)??null},[pt]);A.useMemo(()=>{const k=m.filter(C=>C.status==="closed"&&C.closedAt);return k.length===0?null:k.sort((C,S)=>new Date((S.closedAt??"").toString()).getTime()-new Date((C.closedAt??"").toString()).getTime())[0]??null},[m]);const ct=A.useMemo(()=>m.find(k=>k.status!=="closed")??null,[m]),gr=A.useMemo(()=>{if(!ct)return!1;const k=ct.cash??0,C=ct.programBalanceCash??0,S=ct.programBalanceBank??0;return k>0&&C>0&&S>0},[ct]),xr=A.useCallback(async k=>{var Rt;const C=(Rt=k.target.files)==null?void 0:Rt[0];if(k.target.value="",!C)return;const S=ct;if(!S){_({msg:"لا يوجد صف نشط لملء البيانات",type:"warning"});return}let O;try{O=await C.arrayBuffer()}catch{_({msg:"تعذر قراءة الملف",type:"error"});return}const H=new Date(0),{sums:Q,counts:L,details:ne,employeeName:te,employeeNamesList:q,error:Se}=_g(O,H);if(Se){_({msg:Se,type:"error"});return}bt(ne),pr(q??[]);const ut=E.current[S.id];ut&&(clearTimeout(ut),delete E.current[S.id],jt(e,S.id,I.current[S.id]??S));const De=I.current[S.id]??S,zt={mada:Q.mada,visa:Q.visa,mastercard:Q.mastercard,bankTransfer:Q.bankTransfer},vt=Q.mada+Q.visa+Q.mastercard,Wt=te&&te.trim()!==""?te.trim():De.employeeName,dt={...De,...zt,employeeName:Wt,variance:Vs({...De,...zt})};jt(e,S.id,dt),I.current[S.id]=dt,f($r=>$r.map(wr=>wr.id===S.id?dt:wr)),b();const Fe=[];L.mada>0&&Fe.push(`مدى ${z(Q.mada)}`),L.visa>0&&Fe.push(`فيزا ${z(Q.visa)}`),L.mastercard>0&&Fe.push(`ماستر كارد ${z(Q.mastercard)}`),L.bankTransfer>0&&Fe.push(`تحويل بنكي ${z(Q.bankTransfer)}`);const Yt=Fe.length>0?Fe.join(" — ")+` — المجموع: ${z(vt)}`:"";_({msg:vt>0?`تم استخراج: ${Yt}`:"لم يُعثر على مدى/فيزا/ماستر كارد/تحويل بنكي في الملف",type:vt>0?"success":"info"})},[ct,b]),ss=A.useCallback(()=>{var k;(k=_e.current)==null||k.click()},[]),Qe=A.useCallback(k=>{const C=E.current[k];C&&(clearTimeout(C),delete E.current[k]);const S=m.find(L=>L.id===k),O=(S==null?void 0:S.carriedExpenseCount)??0,H=((S==null?void 0:S.expenseItems)??[]).slice(0,O),Q=H.reduce((L,ne)=>L+ne.amount,0);if(jt(e,k,{expenses:Q,expenseItems:H}),S){const L={...S,expenses:Q,expenseItems:H,variance:Vs({...S})};I.current[k]=L,f(ne=>ne.map(te=>te.id!==k?te:L))}b(),Ke.current={}},[m,b]),gn=A.useCallback((k,C,S)=>{Bt(O=>O?{...O,items:O.items.map((H,Q)=>Q===k?{...H,[C]:String(S)}:H)}:null)},[]),br=A.useCallback(()=>{Ke.current={},Bt(k=>k?{...k,items:[...k.items,{amount:"",description:""}]}:null)},[]),yr=A.useCallback(k=>{Bt(C=>{if(!C)return C;const S=C.carriedCount??0;return k<S||C.items.length<=1?C:(Ke.current={},{...C,items:C.items.filter((O,H)=>H!==k)})})},[]),Ci=A.useCallback((k,C)=>{ve(""),ke(!1),et({rowId:k,itemIndex:C,step:"confirm"})},[]),Ni=A.useCallback(()=>{ge&&et(k=>k?{...k,step:"code"}:null)},[ge]),$t=A.useCallback(()=>{if(!ge)return;if(Ne.trim()!==eo()){ke(!0),_({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}ke(!1);const{rowId:k,itemIndex:C}=ge,S=m.find(te=>te.id===k)??I.current[k];if(!S){et(null),ve("");return}const O=(S.expenseItems??[]).slice(),H=S.carriedExpenseCount??0;if(C>=O.length||C>=H){et(null),ve("");return}O.splice(C,1);const Q=Math.max(0,H-1),L=O.reduce((te,q)=>te+q.amount,0);jt(e,k,{expenseItems:O,expenses:L,carriedExpenseCount:Q});const ne={...S,expenseItems:O,expenses:L,carriedExpenseCount:Q};I.current[k]=ne,f(te=>te.map(q=>q.id===k?ne:q)),Bt(te=>{if(!te||te.rowId!==k)return te;const q=te.items.filter((Se,ut)=>ut!==C);return{...te,items:q,carriedCount:Q}}),Ke.current={},b(),et(null),ve(""),ze(!1),_({msg:"تم حذف البند المرحّل",type:"success"})},[ge,Ne,m,b,jt]),_r=A.useCallback(()=>{if(!fe)return;const k=fe.rowId,C=fe.carriedCount??0,S=fe.items.map((L,ne)=>{const te=Ke.current[ne]!==void 0?Ke.current[ne]:String(L.amount??"");return{amount:Number(String(te).replace(/,/g,""))||0,description:String(L.description||"").trim(),index:ne}}),O=S.find(L=>L.index>=C&&L.amount>0&&!L.description);if(O){_({msg:"يجب إدخال وصف لكل بند فيه مبلغ",type:"warning"}),pn(O.index);return}const H=S.map(({amount:L,description:ne})=>({amount:L,description:ne})),Q=H.reduce((L,ne)=>L+ne.amount,0);jt(e,k,{expenseItems:H,expenses:Q}),Bt(null),b(),requestAnimationFrame(()=>{setTimeout(()=>{const L=document.querySelectorAll(`tr[data-row-id="${k}"] input.cashbox-input`);let ne=L[5]??L[0];for(let te=5;te<L.length;te++)if(!L[te].disabled){ne=L[te];break}ne==null||ne.focus()},0)})},[fe,b,jt]),Ri=A.useCallback(()=>{_({msg:"يجب إدخال رصيد البرنامج كاش أولاً",type:"warning"})},[]),Br=A.useCallback(k=>{_({msg:`تعويض المصروفات يجب ألا يتخطى مبلغ المصروفات (المصروفات: ${z(k)})`,type:"warning"})},[]),xn=A.useCallback(k=>{const C=m.find(O=>O.id===k);if(!C||C.status==="closed")return;const S={cash:0,sentToTreasury:0,expenseCompensation:0,expenses:0,expenseItems:[],carriedExpenseCount:0,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0};jt(e,k,S),en.flushSync(()=>{f(O=>{const H=O.map(L=>L.id!==k?L:{...L,...S}),Q=H.find(L=>L.id===k);return Q&&(I.current[k]=Q),H})}),b(),ft(null),mt(O=>O+1),_({msg:"تم إفراغ كل المدخلات في الصف النشط ومسح سجلات الحاسبات",type:"success"})},[m,b]),is=A.useCallback(()=>{It&&xn(It)},[It,xn]),bn=A.useCallback(()=>{ft(null)},[]),Te=A.useCallback((k,C,S)=>{const O=m.find(ne=>ne.id===k);if(!O||O.status==="closed")return;const H={[C]:S};if(C==="expenses"&&typeof S=="number"){const ne=O.expenseCompensation??0;S<ne&&(H.expenseCompensation=S)}if(Wg.includes(C)){const ne={...O,...H};H.variance=Vs(ne)}const L=E.current[k];L&&clearTimeout(L),E.current[k]=setTimeout(()=>{const ne=I.current[k];ne&&jt(e,k,ne),b()},400),en.flushSync(()=>{f(ne=>{const te=ne.map(Se=>Se.id!==k?Se:{...Se,...H}),q=te.find(Se=>Se.id===k);return q&&(I.current[k]=q),te})})},[m,b]),Si=A.useCallback(k=>{const C=m.find(H=>H.id===k);if(!C||C.status!=="active")return;const S=Ws(C),O=zs(C);if(S!==0||O!==0){tt({rowId:k,cashVar:S,bankVar:O});return}_({msg:"الصندوق مظبوط — تم عمل جيد ✓",type:"success"}),F(k),ee(Date.now()+Ds*1e3),X(Ds)},[m]),At=A.useCallback(()=>{if(!Tt)return;const{rowId:k}=Tt;tt(null),F(k),ee(Date.now()+Ds*1e3),X(Ds)},[Tt]),os=A.useCallback(()=>{tt(null)},[]),as=A.useCallback(()=>{F(null),ee(null),X(0),_({msg:"تم التراجع — يمكنك تعديل الصف",type:"info"})},[]),Ct=A.useCallback((k,C,S)=>{if(k.length===0){_({msg:"لا توجد تقفيلات للطباعة",type:"warning"});return}const O=window.open("","_blank","width=800,height=900");if(!O){_({msg:"السماح بالنوافذ المنبثقة للطباعة",type:"warning"});return}const{firstActiveId:H,currentUserName:Q,branchLabel:L}=S??{},ne=L?`<p class="page-branch">فرع ${L.replace(/&/g,"&amp;").replace(/</g,"&lt;")}</p>`:"",te=k.map((q,Se)=>{const De=((q.status==="closed"?q.employeeName:H&&q.id===H&&Q?Q:q.employeeName)??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),zt=q.mada+q.visa+q.mastercard,vt=zs(q),Wt=Ws(q),dt=q.expenses??0,Fe=q.expenseCompensation??0,Yt=q.sentToTreasury??0,Rt=q.expenseItems??[],$r=Wt>0?"variance pos":Wt<0?"variance neg":"variance",wr=vt>0?"variance pos":vt<0?"variance neg":"variance",gs=Rt.length>0?`<div class="block expenses-detail">
                  <div class="block-title">تفاصيل المصروفات</div>
                  <div class="block-body">${Rt.map(bs=>`<div class="expense-item">${z(bs.amount)} — ${(bs.description||"—").replace(/</g,"&lt;")}</div>`).join("")}</div>
                </div>`:"",Jt=(q.notes||"").trim()?`<div class="block notes-block"><div class="block-title">ملاحظات</div><div class="block-body">${(q.notes||"").replace(/</g,"&lt;")}</div></div>`:"",xs=(Se>0?"page-break-before: always;":"")+(Se<k.length-1?"page-break-after: always;":"");return`
            <div class="page" ${xs?`style="${xs}"`:""}>
              <header class="page-header">
                <h1 class="page-title">تقرير تقفيلة</h1>
                ${ne}
                <p class="page-sub">${De}</p>
                <p class="page-time">${q.closedAt?li(q.closedAt):"—"}</p>
              </header>
              <div class="grid">
                <div class="block cash-block">
                  <div class="block-title">الكاش</div>
                  <div class="block-body">
                    <div class="row"><span class="label">كاش</span><span class="val">${z(q.cash)}</span></div>
                    <div class="row"><span class="label">مرسل للخزنة</span><span class="val">${z(Yt)}</span></div>
                    <div class="row"><span class="label">المصروفات</span><span class="val">${z(dt)}</span></div>
                    <div class="row"><span class="label">تعويض مصروفات</span><span class="val">${z(Fe)}</span></div>
                    <div class="row"><span class="label">رصيد البرنامج كاش</span><span class="val">${z(q.programBalanceCash)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف الكاش</span><span class="val ${$r}">${z(Wt)}</span></div>
                  </div>
                </div>
                <div class="block bank-block">
                  <div class="block-title">البنك</div>
                  <div class="block-body">
                    <div class="row"><span class="label">مدى</span><span class="val">${z(q.mada)}</span></div>
                    <div class="row"><span class="label">فيزا</span><span class="val">${z(q.visa)}</span></div>
                    <div class="row"><span class="label">ماستر كارد</span><span class="val">${z(q.mastercard)}</span></div>
                    <div class="row"><span class="label">تحويل بنكي</span><span class="val">${z(q.bankTransfer)}</span></div>
                    <div class="row"><span class="label">بنك نزيل (مدى+فيزا+ماستر)</span><span class="val total">${z(zt)}</span></div>
                    <div class="row"><span class="label">اجمالى الموازنه</span><span class="val">${z(q.programBalanceBank??0)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف البنك</span><span class="val ${wr}">${z(vt)}</span></div>
                  </div>
                </div>
              </div>
              ${gs}
              ${Jt}
              <footer class="page-footer">
                <p class="footer-formulas">بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط) — انحراف البنك = بنك نزيل − اجمالى الموازنه — انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش</p>
                <p>${L?`فرع ${L} — `:""}تاريخ الطباعة: ${li(new Date)} ${k.length>1?` — تقفيلة ${Se+1} من ${k.length}`:""}</p>
              </footer>
            </div>`}).join("");O.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
          <head>
            <meta charset="utf-8">
            <title>${L?`${C} — فرع ${L}`:C}</title>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
            <style>
              * { box-sizing: border-box; margin: 0; padding: 0; }
              @page { size: A4 portrait; margin: 10mm; }
              html, body {
                font-family: 'Cairo', sans-serif;
                background: #fff;
                color: #1e293b;
                font-size: 11px;
                line-height: 1.25;
                padding: 8px;
                margin: 0;
                height: auto;
              }
              @media print {
                html, body {
                  padding: 0 !important;
                  margin: 0 !important;
                  height: auto !important;
                  min-height: unset !important;
                  overflow: visible !important;
                  background: #fff;
                  font-size: 10px !important;
                }
                .page {
                  box-shadow: none !important;
                  margin: 0 auto !important;
                  min-height: 0 !important;
                  height: auto !important;
                  page-break-inside: avoid;
                }
                .page:last-child { page-break-after: avoid !important; }
              }
              .page {
                width: 100%;
                max-width: 210mm;
                margin: 0 auto 12px;
                padding: 0 8px 10px;
                background: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
              }
              .page-header {
                text-align: center;
                padding: 8px 0 6px;
                border-bottom: 1px solid #0f172a;
                margin-bottom: 8px;
              }
              .page-title {
                font-size: 1.15rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 2px;
              }
              .page-sub {
                font-size: 0.95rem;
                font-weight: 600;
                color: #334155;
                margin-bottom: 1px;
              }
              .page-time {
                font-size: 0.8rem;
                color: #64748b;
              }
              .page-branch {
                font-size: 0.9rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 2px;
              }
              .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-bottom: 8px;
              }
              .block {
                border: 1px solid #e2e8f0;
                border-radius: 4px;
                overflow: hidden;
              }
              .block-title {
                background: #f1f5f9;
                padding: 4px 8px;
                font-weight: 700;
                font-size: 0.8rem;
                color: #334155;
                border-bottom: 1px solid #e2e8f0;
              }
              .block-body {
                padding: 4px 8px;
                background: #fff;
              }
              .block .row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2px 0;
                border-bottom: 1px solid #f1f5f9;
                font-size: 0.8rem;
              }
              .block .row:last-child { border-bottom: none; }
              .block .row.highlight { font-weight: 700; background: #f8fafc; margin: 2px -8px -2px; padding: 4px 8px; }
              .block .row.variance-row {
                margin: 4px -8px -2px;
                padding: 6px 8px;
                background: #f1f5f9;
                border-top: 1px solid #cbd5e1;
                font-size: 0.9rem;
              }
              .block .row.variance-row .label {
                font-size: 0.9rem;
                font-weight: 800;
                color: #0f172a;
              }
              .block .row.variance-row .val { font-size: 0.9rem; font-weight: 800; }
              .block .label { color: #475569; }
              .block .val {
                font-variant-numeric: tabular-nums;
                font-weight: 500;
                color: #0f172a;
              }
              .block .val.total { font-weight: 700; }
              .block .val.variance.pos { color: #059669; }
              .block .val.variance.neg { color: #dc2626; }
              .expenses-detail, .notes-block {
                margin-top: 6px;
                border: 1px solid #e2e8f0;
                border-radius: 4px;
                overflow: hidden;
              }
              .expenses-detail .block-title, .notes-block .block-title {
                padding: 3px 8px;
                font-size: 0.75rem;
              }
              .expenses-detail .block-body, .notes-block .block-body {
                padding: 3px 8px;
              }
              .expense-item {
                padding: 2px 8px;
                font-size: 0.75rem;
                border-bottom: 1px solid #f1f5f9;
              }
              .expense-item:last-child { border-bottom: none; }
              .page-footer {
                margin-top: 8px;
                padding-top: 6px;
                border-top: 1px solid #e2e8f0;
                font-size: 0.7rem;
                color: #64748b;
                text-align: center;
              }
              .page-footer .footer-formulas {
                font-size: 0.6rem;
                color: #94a3b8;
                margin-bottom: 3px;
                line-height: 1.3;
              }
            </style>
          </head>
          <body>
            ${te}
            <script>setTimeout(function(){ window.print(); window.close(); }, 350);<\/script>
          </body>
        </html>
      `),O.document.close()},[]),yn=A.useCallback(async()=>{const C=await Yu(e,w==="today"?50:w==="yesterday"?100:200),S=Jl(C,w);Ct(S,`تقرير التقفيلات — ${w==="today"?"اليوم":w==="yesterday"?"أمس":"الأسبوع الماضي"}`,{firstActiveId:ae,currentUserName:r,branchLabel:Nn[e]})},[w,Ct,ae,r,e]),ls=A.useCallback(k=>{Ae(C=>{const S=new Set(C);return S.has(k)?S.delete(k):S.add(k),S})},[]),ji=A.useCallback(()=>{if(ue.size===0){_({msg:"لم تحدد أي صفوف للطباعة",type:"warning"});return}const k=pt.filter(C=>ue.has(C.id));Ct(k,"طباعة الصفوف المحددة",{firstActiveId:ae,currentUserName:r,branchLabel:Nn[e]})},[ue,pt,Ct,ae,r,e]),cs=A.useCallback(k=>{const C=pt.find(S=>S.id===k);C&&Ct([C],"طباعة تقفيلة",{firstActiveId:ae,currentUserName:r,branchLabel:Nn[e]})},[pt,Ct,ae,r,e]),Pi=A.useCallback(k=>{ve(""),ke(!1),Ce({rowId:k,step:"confirm"})},[]),Ur=A.useCallback(()=>{me&&Ce(k=>k?{...k,step:"code"}:null)},[me]),_n=A.useCallback(async()=>{if(!me)return;if(Ne.trim()!==eo()){ke(!0),_({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}ke(!1);const k=m.find(S=>S.id===me.rowId),C=(k==null?void 0:k.status)==="closed";await Jp(e,me.rowId,C),Ae(S=>{const O=new Set(S);return O.delete(me.rowId),O}),await b(),Ce(null),ve(""),ze(!1),_({msg:"تم حذف الصف",type:"success"})},[me,Ne,b,e,m]),vn=A.useCallback(()=>{ve(""),ke(!1),Ze({step:"confirm"})},[]),vr=A.useCallback(()=>{Ee&&Ze(k=>k?{...k,step:"code"}:null)},[Ee]),Nt=A.useCallback(async()=>{if(Ee){if(Ne.trim()!==eo()){ke(!0),_({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}ke(!1),await Xp(e),Ae(new Set),await b(),Ze(null),ve(""),ze(!1),_({msg:"تم حذف كل التقفيلات المغلقة",type:"success"})}},[Ee,Ne,b,e]),qt=k=>k==="cash"?"الكاش":k==="programBalanceBank"?"اجمالى الموازنه":k==="mada"?"مدى":k==="visa"?"فيزا":k==="mastercard"?"ماستر كارد":"تحويل بنكي",Vi=A.useCallback(k=>{if(!ae){_({msg:"لا يوجد صف نشط لترحيل الكاش إليه",type:"warning"});return}const C=m.find(O=>O.id===ae),S=(C==null?void 0:C.cash)??0;if(S>0){T({amount:k,currentValue:S,field:"cash"});return}Te(ae,"cash",k),_({msg:`تم ترحيل ${z(k)} إلى خانة الكاش`,type:"success"})},[ae,m,Te]),us=A.useCallback((k,C,S)=>{if(!ae){_({msg:"لا يوجد صف نشط لترحيل العمليات البنكية إليه",type:"warning"});return}const O=m.find(q=>q.id===ae);if(!O)return;const H=O.mada??0,Q=O.visa??0,L=O.mastercard??0;if(H>0&&k>0||Q>0&&C>0||L>0&&S>0){J({mada:k,visa:C,mastercard:S,currentMada:H,currentVisa:Q,currentMaster:L});return}Te(ae,"mada",H+k),Te(ae,"visa",Q+C),Te(ae,"mastercard",L+S);const te=[];k>0&&te.push(`مدى ${z(k)}`),C>0&&te.push(`فيزا ${z(C)}`),S>0&&te.push(`ماستر ${z(S)}`),_({msg:`تم ترحيل العمليات البنكية: ${te.join("، ")||"—"}`,type:"success"})},[ae,m,Te]),ds=A.useCallback(()=>{if(!x||!ae)return;const{mada:k,visa:C,mastercard:S,currentMada:O,currentVisa:H,currentMaster:Q}=x;Te(ae,"mada",O+k),Te(ae,"visa",H+C),Te(ae,"mastercard",Q+S);const L=[];k>0&&L.push(`مدى ${z(k)}`),C>0&&L.push(`فيزا ${z(C)}`),S>0&&L.push(`ماستر ${z(S)}`),_({msg:`تم ترحيل العمليات البنكية: ${L.join("، ")||"—"}`,type:"success"}),J(null)},[x,ae,Te]),hs=A.useCallback(()=>{J(null)},[]),wn=A.useCallback(()=>{if(!rt)return;Te(rt.rowId,rt.field,rt.newValue);const k=qt(rt.field);_({msg:`تم تعديل ${k} إلى ${z(rt.newValue)}`,type:"success"}),Or(null)},[rt,Te]),kn=A.useCallback(()=>{Or(null)},[]),ms=A.useCallback(()=>{!v||!ae||(Te(ae,v.field,v.amount),_({msg:`تم ترحيل ${z(v.amount)} إلى ${qt(v.field)}`,type:"success"}),T(null))},[v,ae,Te]),fs=A.useCallback(()=>{T(null)},[]),ps=A.useCallback((k,C)=>{if(!ae){_({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const S=m.find(H=>H.id===ae),O=S?S[C]??0:0;if(O>0){T({amount:k,currentValue:O,field:C});return}Te(ae,C,k),_({msg:`تم ترحيل ${z(k)} إلى ${qt(C)}`,type:"success"})},[ae,m,Te]);return l.jsxs("div",{className:"min-h-screen min-h-[100dvh] page-bg-warm dark:bg-slate-900 text-stone-900 dark:text-slate-200 font-cairo page-bg-pattern flex flex-col",children:[l.jsx("header",{className:"sticky top-0 z-40 border-b border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-900/95 backdrop-blur shadow-sm safe-top",children:l.jsxs("div",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-2 flex flex-wrap items-center justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const{label:k,kind:C}=vg(W),S="w-4 h-4 shrink-0",O={morning:l.jsxs("svg",{className:S,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),l.jsx("path",{d:"M12 2v1.5M12 20.5V22M4.22 4.22l1.06 1.06M18.72 18.72l1.06 1.06M2 12h1.5M20.5 12H22M4.22 19.78l1.06-1.06M18.72 5.28l1.06-1.06"})]}),noon:l.jsxs("svg",{className:S,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),l.jsx("path",{d:"M12 2.5v2M12 19.5V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2.5 12H5M19 12h2.5M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"}),l.jsx("path",{d:"M12 7.5v4l2.5 2.5",strokeWidth:"1.8"})]}),evening:l.jsxs("svg",{className:S,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}),l.jsx("path",{d:"M12 2v3M12 19v3M3.5 12H6.5M17.5 12h3M4.93 4.93l2.12 2.12M16.95 16.95l2.12 2.12M4.93 19.07l2.12-2.12M16.95 7.05l2.12-2.12",strokeWidth:"1.2",opacity:"0.7"})]}),night:l.jsx("svg",{className:S,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:l.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})},H=C==="night";return l.jsxs("h1",{className:"flex items-center gap-1.5 sm:gap-2 py-1.5 px-2 sm:px-3 rounded-lg sm:rounded-xl border border-stone-300 dark:border-white/10 bg-stone-200 dark:bg-slate-800/50 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)]",children:[l.jsx("span",{className:`flex items-center justify-center w-7 h-7 sm:w-8 sm:h-8 rounded-lg shrink-0 ${H?"bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300":"bg-teal-100 text-teal-700 dark:bg-amber-500/15 dark:text-amber-400"}`,children:O[C]}),l.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-stone-800 dark:text-slate-200 tracking-tight flex items-center gap-1 min-w-0 truncate max-w-[120px] sm:max-w-none",children:[l.jsx("span",{className:H?"text-indigo-700 dark:text-indigo-300/90":"text-teal-700 dark:text-amber-400/95",children:k}),l.jsx("span",{className:"text-stone-600 dark:text-slate-400 font-normal",children:"،"}),l.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-cairo text-right",children:r})]})]})})(),l.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-teal-100 dark:bg-amber-500/15 text-teal-800 dark:text-amber-300 text-xs font-cairo font-semibold border border-teal-300 dark:border-amber-500/30",children:["فرع ",Nn[e]]}),l.jsx("div",{className:"relative z-[50] rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsx("button",{ref:a,type:"button",onClick:k=>{k.preventDefault(),k.stopPropagation(),rc()},className:"flex items-center justify-center w-9 h-9 rounded-lg text-stone-700 hover:text-teal-600 hover:bg-teal-500/15 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 transition cursor-pointer select-none touch-manipulation",title:s==="dark"?"الوضع الفاتح":"الوضع الداكن","aria-label":s==="dark"?"الوضع الفاتح":"الوضع الداكن",children:s==="dark"?l.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("circle",{cx:"12",cy:"12",r:"4"}),l.jsx("path",{d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"})]}):l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})}),l.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsxs("button",{type:"button",onClick:()=>h(e==="corniche"?"andalusia":"corniche"),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-teal-600 hover:bg-teal-500/15 dark:text-slate-400 dark:hover:text-amber-400 dark:hover:bg-amber-500/10 text-xs font-cairo transition",title:"تغيير الفرع",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),l.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),l.jsx("span",{children:"تغيير الفرع"})]})}),l.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-red-600 hover:text-red-700 hover:bg-red-500/15 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-500/10 text-xs font-cairo font-semibold transition border border-red-200 dark:border-red-500/30",title:"خروج — العودة لتسجيل الاسم والفرع",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"}),l.jsx("polyline",{points:"16 17 21 12 16 7"}),l.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),l.jsx("span",{children:"خروج"})]})}),l.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:l.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-teal-600 hover:bg-teal-500/15 dark:text-slate-400 dark:hover:text-amber-400 dark:hover:bg-amber-500/10 text-xs font-cairo transition",title:"تغيير المستخدم",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("circle",{cx:"12",cy:"8",r:"4"}),l.jsx("path",{d:"M4 20c0-3.3 2.7-6 6-6s6 2.7 6 6"}),l.jsx("path",{d:"M16 11l3 3-3 3"}),l.jsx("path",{d:"M19 14h-5"})]}),l.jsx("span",{children:"تغيير المستخدم"})]})})]}),l.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[l.jsx("input",{ref:_e,type:"file",accept:".xlsx,.xls",className:"hidden","aria-hidden":!0,onChange:xr}),l.jsx("div",{className:"rounded-xl border border-violet-300 dark:border-violet-500/25 bg-violet-100 dark:bg-violet-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_8px_rgba(139,92,246,0.12)]",children:l.jsxs("button",{type:"button",onClick:ss,className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg text-sm font-cairo font-bold bg-teal-500 hover:bg-teal-600 dark:bg-gradient-to-r dark:from-violet-600 dark:to-indigo-600 dark:hover:from-violet-500 dark:hover:to-indigo-500 text-white border border-teal-400/50 dark:border-violet-400/30 shadow-md transition-all hover:scale-[1.02] active:scale-[0.98]",title:"استخراج قيم مدى، فيزا، ماستر كارد، تحويل بنكي من تقرير إكسل",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),l.jsx("path",{d:"M17 8l-5-5-5 5"}),l.jsx("path",{d:"M12 3v12"})]}),l.jsx("span",{children:"استخراج قيم"})]})}),l.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),l.jsxs("div",{className:"flex items-center gap-1 rounded-xl border-2 border-teal-300 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(245,158,11,0.08)]",children:[l.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-md bg-teal-200 text-teal-800 dark:bg-amber-500/15 dark:text-amber-400/90 shrink-0","aria-hidden":"true",children:l.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),l.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})}),qg.map(k=>l.jsx("button",{type:"button",onClick:()=>g(k.id),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition ${w===k.id?"bg-teal-500/20 text-teal-800 border border-teal-600 dark:bg-amber-500/25 dark:text-amber-300 dark:border-amber-500/40 shadow-sm":"text-stone-700 border border-transparent hover:bg-stone-300 hover:text-stone-900 dark:text-slate-400 dark:hover:bg-white/5 dark:hover:text-slate-300"}`,children:k.label},k.id))]}),l.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),l.jsxs("div",{className:"flex items-center gap-1.5 rounded-xl border border-stone-300 dark:border-sky-500/25 bg-stone-200 dark:bg-sky-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(14,165,233,0.08)]",children:[l.jsxs("button",{type:"button",onClick:yn,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-500 hover:bg-teal-600 dark:bg-sky-600 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:"طباعة كل الصفوف المعروضة",children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M6 9V2h12v7"}),l.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),l.jsx("path",{d:"M6 14h12v8H6z"})]}),l.jsx("span",{children:"الكل"})]}),ue.size>0&&l.jsxs("button",{type:"button",onClick:ji,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-400 hover:bg-teal-500 dark:bg-sky-500/90 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:`طباعة ${ue.size} صف محدد`,children:[l.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[l.jsx("path",{d:"M6 9V2h12v7"}),l.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),l.jsx("path",{d:"M6 14h12v8H6z"})]}),l.jsxs("span",{children:["المحددة (",ue.size,")"]})]})]})]})]})}),l.jsxs("main",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-1 sm:py-2 flex flex-col gap-2 sm:gap-3 flex-1 min-h-0",children:[l.jsxs("div",{className:"rounded-2xl sm:rounded-3xl overflow-x-auto overflow-hidden flex flex-col border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/30 backdrop-blur-sm shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] min-h-[200px] sm:min-h-[240px]",children:[l.jsx("div",{className:"cashbox-table-scroll overflow-x-auto scrollbar-thin",style:{scrollbarGutter:"stable"},children:l.jsxs("table",{className:"w-full text-xs sm:text-sm border-separate table-fixed",style:{tableLayout:"fixed",width:"100%",minWidth:"880px",borderSpacing:0},children:[l.jsxs("colgroup",{children:[l.jsx("col",{style:{width:"3%"}}),l.jsx("col",{style:{width:"2.5%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"6.35%"}}),l.jsx("col",{style:{width:"12%"}})]}),l.jsx("thead",{className:"border-b-2 border-stone-500 dark:border-amber-500/20",children:l.jsxs("tr",{className:"h-12 sm:h-14 bg-stone-100 dark:bg-amber-500/[0.08]",children:[l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"تحديد"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"م"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"كاش"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"مرسل للخزنة — يدخل في معادلة انحراف الكاش",children:"مرسل للخزنة"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"يُخصم من المصروفات في انحراف الكاش",children:"تعويض مصروفات"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"المصروفات"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-semibold text-teal-800 dark:text-teal-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"رصيد البرنامج كاش"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-red-700 dark:text-red-400 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 bg-red-100 dark:bg-red-500/10 font-cairo rounded-sm shadow-sm",title:"خانة مهمة: الفرق بين المتوقع والفعلي للكاش",children:"انحراف الكاش"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"مدى"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"فيزا"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"ماستر كارد"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-semibold text-sky-700 dark:text-sky-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"للعرض فقط — لا يدخل في بنك نزيل ولا انحراف البنك",children:"تحويل بنكي"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-semibold text-teal-800 dark:text-teal-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط)",children:"بنك نزيل"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"اجمالى الموازنه"}),l.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-red-700 dark:text-red-400 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 bg-red-100 dark:bg-red-500/10 font-cairo rounded-sm shadow-sm",title:"خانة مهمة: الفرق بين بنك نزيل واجمالى الموازنه",children:"انحراف البنك"}),l.jsx("th",{className:"px-1 sm:px-1.5 py-2 sm:py-3 text-center text-[10px] font-semibold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 overflow-hidden min-w-0 font-cairo",children:l.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 h-full min-w-0",children:[l.jsx("span",{className:"truncate max-w-full",children:"الحالة / إجراءات"}),l.jsx("button",{type:"button",onClick:vn,"aria-label":"حذف كل التقفيلات المغلقة",className:"inline-flex items-center justify-center w-7 h-7 rounded-lg border-2 border-stone-400 dark:border-white/10 bg-stone-200 dark:bg-slate-700/50 text-stone-800 dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 transition-all shrink-0 shadow-sm",title:"حذف كل التقفيلات المغلقة",children:l.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),l.jsx("path",{d:"M10 11v6M14 11v6"})]})})]})})]})}),l.jsx("tbody",{children:Ut.map((k,C)=>l.jsx(Ag,{row:k,rowNumber:C+1,isFirstActive:k.id===ae,liveNow:W,closingRowId:Y,closingSecondsLeft:Y===k.id?$:0,onUpdate:Te,isSelected:ue.has(k.id),onToggleSelect:ls,onDeleteRow:Pi,onPrintRow:cs,onOpenExpenseDetails:ns,onClearExpensesAndOpen:Qe,onLockedFieldClick:Ri,onExpenseCompensationExceeded:Br,lastExcelDetails:xe,onShowExcelDetails:(S,O)=>Re({field:S,rowId:O}),onRequestConfirmBankEdit:xe?(S,O,H,Q)=>Or({rowId:S,field:O,oldValue:H,newValue:Q}):void 0,onShowEmployeeNames:ot.length>0?()=>yt(!0):void 0,onShowVarianceExplanation:(S,O)=>_t({type:S,row:O}),currentUserName:r,onClearRow:S=>ft(S),isStickyRows:!1},k.id))})]})}),(P>1||R)&&l.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-t border-stone-300 dark:border-white/[0.06] flex items-center justify-center gap-2 flex-wrap rounded-b-2xl sm:rounded-b-3xl bg-stone-200 dark:bg-slate-800/50 backdrop-blur-sm",children:[l.jsxs("button",{type:"button",onClick:()=>M(P-1),disabled:P<=1,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-teal-200 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 text-teal-700 dark:text-amber-400/95 hover:bg-teal-100 hover:border-teal-300 dark:hover:bg-amber-500/20 dark:hover:border-amber-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة السابقة",children:[l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M15 18l-6-6 6-6"})}),"السابق"]}),l.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.max(P,1)},(k,C)=>C+1).map(k=>l.jsx("button",{type:"button",onClick:()=>M(k),className:`inline-flex items-center justify-center min-w-[2.25rem] px-2 py-2 rounded-xl text-sm font-cairo font-medium transition-all ${k===P?"bg-teal-500 dark:bg-amber-500/40 text-white border border-teal-500 dark:border-amber-500/50":"border border-teal-200 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 text-teal-700 dark:text-amber-400/95 hover:bg-teal-100 dark:hover:bg-amber-500/20"}`,"aria-label":k===1?"الرئيسية":`صفحة ${k}`,children:k===1?"١":k},k))}),l.jsxs("button",{type:"button",onClick:()=>M(P+1),disabled:!R,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-teal-200 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 text-teal-700 dark:text-amber-400/95 hover:bg-teal-100 hover:border-teal-300 dark:hover:bg-amber-500/20 dark:hover:border-amber-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة التالية",children:["التالي",l.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M9 18l6-6-6-6"})})]})]}),pt.length===0&&l.jsxs("div",{className:"py-16 px-4 text-center rounded-b-3xl bg-stone-100 dark:bg-slate-800/20",children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-500 font-cairo mb-1",children:"لا توجد تقفيلات"}),l.jsx("p",{className:"text-stone-700 dark:text-slate-600 text-sm font-cairo",children:"اختر فلتراً مختلفاً أو ابدأ شفتاً جديداً"})]})]}),l.jsx("div",{className:"flex flex-col items-center justify-center gap-1.5 py-2 px-3 rounded-xl border-2 border-teal-500 dark:border-amber-500/30 bg-gradient-to-b from-teal-50 to-stone-200 dark:from-amber-500/10 dark:to-slate-800/60 min-h-0 shadow-md dark:shadow-[0_4px_20px_rgba(245,158,11,0.12),0_0_1px_rgba(255,255,255,0.06)]",children:Y?l.jsx("div",{className:"flex flex-wrap items-center justify-center w-full",dir:"ltr",children:$>0?l.jsxs("button",{type:"button",onClick:as,className:"btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 border-teal-400 bg-teal-500 hover:bg-teal-600 text-white shadow-md dark:border-emerald-500/60 dark:bg-gradient-to-b dark:from-emerald-500/30 dark:to-emerald-600/20 dark:text-emerald-50 dark:shadow-[0_4px_24px_rgba(16,185,129,0.25)] dark:hover:from-emerald-500/40 dark:hover:to-emerald-600/30 dark:hover:shadow-[0_6px_28px_rgba(16,185,129,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all select-none touch-manipulation min-h-[36px]",children:[l.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M3 10h10a5 5 0 015 5v2"}),l.jsx("path",{d:"M7 15l-4-4 4-4"})]}),l.jsx("span",{className:"tracking-wide",children:"تراجع"}),l.jsxs("span",{className:"tabular-nums font-cairo",children:["(",$," ثانية)"]})]}):l.jsx("span",{className:"text-sm font-cairo font-medium text-teal-800 dark:text-amber-400 tabular-nums",children:"جاري الإغلاق..."})}):ae&&ct?l.jsxs("button",{type:"button",onClick:()=>Si(ae),disabled:!gr,className:`btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 w-full sm:w-auto sm:min-w-[180px] rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 select-none transition-all touch-manipulation min-h-[36px]
                ${gr?"bg-teal-500 hover:bg-teal-600 text-white border-teal-400 shadow-md dark:bg-gradient-to-b dark:from-amber-500/50 dark:to-amber-600/40 dark:text-amber-50 dark:border-amber-400 dark:shadow-[0_4px_24px_rgba(245,158,11,0.3)] dark:hover:from-amber-500/60 dark:hover:to-amber-600/50 dark:hover:shadow-[0_6px_28px_rgba(245,158,11,0.35)] hover:scale-[1.02] active:scale-[0.98]":"opacity-60 bg-stone-200 text-stone-500 border-stone-300 dark:opacity-50 dark:bg-slate-800/40 dark:text-slate-500 dark:border-slate-600/50 cursor-not-allowed"}`,title:gr?"إغلاق الشفت وحفظ التقفيلة":"أدخل رصيد البرنامج كاش وإجمالي الموازنة (البنك) أولاً",children:[l.jsxs("svg",{className:`btn-close-shift-icon w-5 h-5 shrink-0 ${gr?"text-white dark:text-amber-200":"text-stone-500 dark:text-slate-500"}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[l.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),l.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]}),l.jsx("span",{className:"tracking-wide",children:r?`إغلاق شفت ${r}`:"إغلاق الشفت الحالي"})]}):null}),l.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-[minmax(260px,320px)_1fr_1fr] gap-2 sm:gap-3 w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] items-stretch min-h-[280px] sm:min-h-[340px] xl:min-h-[380px] [&>div]:min-h-[240px] sm:[&>div]:min-h-[300px] xl:[&>div]:min-h-[340px]",children:[l.jsx("div",{className:"min-h-0 flex flex-col",children:l.jsx(Rg,{onTransfer:ps,hasActiveRow:!!ae},`calculator-${K}`)}),l.jsx("div",{className:"min-h-0 flex flex-col",children:l.jsx(Sg,{onApplyToCash:Vi,hasActiveRow:!!ae},`cashCalculator-${K}`)}),l.jsx("div",{className:"min-h-0 flex flex-col",children:l.jsx(Pg,{onTransfer:us,hasActiveRow:!!ae},`bankOps-${K}`)})]})]}),y&&l.jsx(Mg,{message:y.msg,type:y.type,onClose:()=>_(null),position:"center",autoHideMs:y.autoHideMs}),Ft&&xe&&(()=>{const{field:k,rowId:C}=Ft,S=xe[k]??[],O=S.reduce((q,Se)=>q+Se.amount,0),H=m.find(q=>q.id===C),Q=H?H[k]??0:0,L=Q-O,te=`سجل التغيير — ${{mada:"مدى",visa:"فيزا",mastercard:"ماستر كارد",bankTransfer:"تحويل بنكي"}[k]}`;return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"excel-detail-title",onClick:()=>Re(null),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-sm w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:q=>q.stopPropagation(),children:[l.jsx("h2",{id:"excel-detail-title",className:"text-base font-bold text-teal-800 dark:text-amber-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:te}),l.jsxs("div",{className:"p-3 space-y-2 border-b border-stone-200 dark:border-white/10",children:[l.jsxs("div",{className:"flex justify-between items-center text-sm",children:[l.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"من إكسل (مرفوع):"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-600 dark:text-amber-200/95",children:z(O)})]}),l.jsxs("div",{className:"flex justify-between items-center text-sm",children:[l.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الحالي في الخانة:"}),l.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-slate-200",children:z(Q)})]}),l.jsxs("div",{className:"flex justify-between items-center text-sm",children:[l.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الفرق (ترحيل أو تعديل يدوي):"}),l.jsx("span",{className:`tabular-nums font-medium ${L>=0?"text-teal-600 dark:text-amber-400":"text-rose-600 dark:text-rose-400"}`,children:z(L)})]})]}),S.length>0&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-2",children:[l.jsxs("p",{className:"text-xs font-cairo text-stone-500 dark:text-slate-400 mb-1",children:[S.length," عملية من الإكسل"]}),S.map((q,Se)=>l.jsxs("div",{className:"py-2 border-b border-stone-200 dark:border-white/5",children:[l.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm text-stone-800 dark:text-slate-300",children:[l.jsx("div",{className:"flex flex-col items-start gap-0.5 min-w-0",children:q.employeeName?l.jsx("span",{className:"text-xs text-stone-500 font-cairo",children:q.employeeName}):null}),l.jsx("span",{className:"tabular-nums font-medium text-teal-600 dark:text-amber-200/95 shrink-0",children:z(q.amount)})]}),q.purpose&&l.jsx("p",{className:"text-xs font-cairo text-stone-600 dark:text-amber-200/80 mt-1 pr-0 border-t border-stone-300 dark:border-amber-500/20 pt-1",children:q.purpose})]},Se))]}),l.jsxs("div",{className:"p-4 pt-2 border-t border-stone-300 dark:border-amber-500/30 flex justify-between items-center bg-stone-100 dark:bg-slate-900/50",children:[l.jsx("span",{className:"font-bold text-stone-800 dark:text-slate-200",children:"إجمالي الإكسل"}),l.jsx("span",{className:"tabular-nums font-bold text-teal-600 dark:text-amber-400",children:z(O)})]})]}),l.jsx("div",{className:"p-3",children:l.jsx("button",{type:"button",onClick:()=>Re(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-500 hover:bg-teal-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white dark:text-slate-200 transition",children:"إغلاق"})})]})})})(),Pe&&ot.length>0&&(()=>{const k=ot.map(C=>{let S=0,O=0;if(xe)for(const H of["mada","visa","mastercard","bankTransfer"]){const Q=xe[H]??[];for(const L of Q)(L.employeeName??"").trim()===C&&(S+=1,O+=L.amount)}return{name:C,count:S,total:O}});return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"employee-names-title",onClick:()=>yt(!1),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:C=>C.stopPropagation(),children:[l.jsx("h2",{id:"employee-names-title",className:"text-base font-bold text-teal-700 dark:text-amber-400 p-4 pb-2 border-b border-white/10",children:"أسماء الموظفين في العمليات المستوردة"}),l.jsx("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-1.5",children:k.map((C,S)=>l.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm text-slate-300 py-2 px-3 rounded-lg bg-slate-900/50 border border-white/5 font-cairo",children:[l.jsx("span",{className:"font-medium text-slate-200",children:C.name}),l.jsxs("span",{className:"tabular-nums text-teal-600 dark:text-amber-200/90 text-xs",children:[C.count," عملية — الإجمالي: ",z(C.total)]})]},S))}),l.jsx("div",{className:"p-3 border-t border-white/10",children:l.jsx("button",{type:"button",onClick:()=>yt(!1),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إغلاق"})})]})})})(),We&&(()=>{const{type:k,row:C}=We,S=C.cash??0,O=C.sentToTreasury??0,H=C.expenses??0,Q=C.expenseCompensation??0,L=Math.max(0,H-Q),ne=C.programBalanceCash??0,te=S+O+L,q=Ws(C),Se=C.mada+C.visa+C.mastercard,ut=C.programBalanceBank??0,De=zs(C),zt=k==="cash",vt=zt?"شرح انحراف الكاش":"شرح انحراف البنك",Wt=q!==0&&De!==0&&q>0!=De>0,dt=Math.abs(Math.abs(q)-Math.abs(De))<=$g,Fe=Wt&&dt,Yt=Fe?Math.abs(q):0;return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"variance-explanation-title",onClick:()=>_t(null),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:Rt=>Rt.stopPropagation(),children:[l.jsx("h2",{id:"variance-explanation-title",className:"text-base font-bold text-teal-800 dark:text-amber-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:vt}),l.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-4 space-y-3 text-sm text-stone-800 dark:text-slate-300",children:[zt?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-800 dark:text-slate-200 font-semibold text-teal-800 dark:text-teal-300",children:"انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش"}),l.jsxs("ul",{className:"space-y-1.5 list-none",children:[l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"كاش"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(S)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مرسل للخزنة"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(O)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مصروفات"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(H)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"تعويض مصروفات"}),l.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",z(Q)]})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5",children:[l.jsx("span",{children:"مصروفات فعّالة (صافي)"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(L)})]}),l.jsxs("li",{className:"flex justify-between gap-2 font-medium",children:[l.jsx("span",{children:"كاش + مرسل للخزنة + مصروفات فعّالة"}),l.jsx("span",{className:"tabular-nums font-bold text-teal-800 dark:text-teal-300",children:z(te)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"رصيد البرنامج كاش"}),l.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",z(ne)]})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-teal-400 dark:border-amber-500/30 pt-2 font-bold text-teal-800 dark:text-amber-300",children:[l.jsx("span",{children:"انحراف الكاش"}),l.jsxs("span",{className:"tabular-nums",children:[q>0?"+":"",z(q)]})]})]}),l.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:q>0?"زيادة: الكاش الفعلي (أو المرسل + المصروف الفعلي) أكبر من رصيد البرنامج.":q<0?"عجز: رصيد البرنامج كاش أكبر من المتوقّع من الكاش والمرسل والمصروف.":"لا يوجد انحراف."})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-800 dark:text-slate-200 font-semibold text-teal-800 dark:text-teal-300",children:"انحراف البنك = بنك نزيل − اجمالى الموازنه"}),l.jsxs("ul",{className:"space-y-1.5 list-none",children:[l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مدى"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(C.mada)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"فيزا"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(C.visa)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"ماستر كارد"}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(C.mastercard)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsxs("span",{children:["تحويل بنكي ",l.jsx("span",{className:"text-stone-500 dark:text-slate-500 text-[10px]",children:"(للعرض فقط)"})]}),l.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:z(C.bankTransfer)})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5 font-medium",children:[l.jsx("span",{children:"بنك نزيل (مدى+فيزا+ماستر)"}),l.jsx("span",{className:"tabular-nums font-bold text-teal-800 dark:text-teal-300",children:z(Se)})]}),l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"اجمالى الموازنه"}),l.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",z(ut)]})]}),l.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-teal-400 dark:border-amber-500/30 pt-2 font-bold text-teal-800 dark:text-amber-300",children:[l.jsx("span",{children:"انحراف البنك"}),l.jsxs("span",{className:"tabular-nums",children:[De>0?"+":"",z(De)]})]})]}),l.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:De>0?"زيادة: بنك نزيل أكبر من اجمالى الموازنه المدخل.":De<0?"عجز: اجمالى الموازنه أكبر من بنك نزيل.":"لا يوجد انحراف."})]}),Fe&&l.jsxs("div",{className:"mt-3 p-3 rounded-xl border-2 border-teal-400/60 dark:border-amber-500/30 bg-teal-50 dark:bg-amber-900/20 text-teal-800 dark:text-amber-200 text-sm font-medium",children:["تنبيه: قد تكون سندات بقيمة ",l.jsx("strong",{children:Yt.toLocaleString("ar-SA",{minimumFractionDigits:2})})," ريال دخلت في خانة خاطئة (نقداً ↔ شبكة). راجع تحويل المبلغ بين الكاش وبنك نزيل."]})]}),l.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/10",children:l.jsx("button",{type:"button",onClick:()=>_t(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),Tt&&(()=>{const{cashVar:k,bankVar:C}=Tt,S=k!==0?k>0?"زيادة في صندوق الكاش — راجع الرصيد الفعلي":"عجز في صندوق الكاش — راجع الكاش والرصيد والمصروف":"",O=C!==0?C>0?"زيادة في البنك — راجع إدخالات مدى/فيزا/ماستر أو اجمالى الموازنه":"عجز في البنك — راجع بنك نزيل أو اجمالى الموازنه":"";return l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"close-variance-title",children:l.jsxs("div",{className:"rounded-2xl border-2 border-teal-300 dark:border-amber-500/30 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"close-variance-title",className:"text-lg font-bold text-teal-800 dark:text-amber-400 mb-3",children:"تنبيه: يوجد انحراف"}),l.jsxs("div",{className:"text-stone-800 dark:text-slate-300 text-sm leading-relaxed mb-4 space-y-2",children:[k!==0&&l.jsxs("p",{className:"block",children:[l.jsx("span",{className:"font-medium",children:"انحراف الكاش: "}),l.jsxs("span",{className:"font-bold tabular-nums text-teal-700 dark:text-teal-400",children:[k>0?"+":"",z(k)]}),S&&l.jsx("span",{className:"block text-stone-600 dark:text-amber-200/90 text-xs mt-0.5",children:S})]}),C!==0&&l.jsxs("p",{className:"block",children:[l.jsx("span",{className:"font-medium",children:"انحراف البنك: "}),l.jsxs("span",{className:"font-bold tabular-nums text-teal-700 dark:text-teal-400",children:[C>0?"+":"",z(C)]}),O&&l.jsx("span",{className:"block text-stone-600 dark:text-amber-200/90 text-xs mt-0.5",children:O})]}),l.jsx("p",{className:"pt-2 text-stone-700 dark:text-slate-200",children:"هل تريد الإغلاق مع هذا الانحراف؟"})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:At,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، إغلاق الشفت"}),l.jsx("button",{type:"button",onClick:os,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا، متابعة التعديل"})]})]})})})(),v&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"transfer-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsxs("h2",{id:"transfer-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:["ترحيل إلى ",qt(v.field)]}),l.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد ترحيل الرقم الجديد وهو ",l.jsx("span",{className:"font-bold text-white tabular-nums",children:z(v.amount)}),"؟ يوجد رقم في الخانة وهو ",l.jsx("span",{className:"font-bold text-white tabular-nums",children:z(v.currentValue)}),"."]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:ms,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:fs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),x&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-transfer-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"bank-transfer-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:"ترحيل العمليات البنكية"}),l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"هل تريد ترحيل الأرقام الجديدة؟ توجد قيم في الخانات:"}),l.jsxs("ul",{className:"text-sm text-stone-700 dark:text-slate-300 space-y-1.5 mb-4",children:[x.mada>0&&l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"مدى:"}),l.jsxs("span",{className:"tabular-nums",children:["مرحّل ",l.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:z(x.mada)})," — في الخانة ",l.jsx("strong",{children:z(x.currentMada)})]})]}),x.visa>0&&l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"فيزا:"}),l.jsxs("span",{className:"tabular-nums",children:["مرحّل ",l.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:z(x.visa)})," — في الخانة ",l.jsx("strong",{children:z(x.currentVisa)})]})]}),x.mastercard>0&&l.jsxs("li",{className:"flex justify-between gap-2",children:[l.jsx("span",{children:"ماستر:"}),l.jsxs("span",{className:"tabular-nums",children:["مرحّل ",l.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:z(x.mastercard)})," — في الخانة ",l.jsx("strong",{children:z(x.currentMaster)})]})]})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:ds,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:hs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),rt&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-edit-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsxs("h2",{id:"bank-edit-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:["تعديل خانة ",qt(rt.field)]}),l.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد تعديل الرقم من ",l.jsx("span",{className:"font-bold tabular-nums",children:z(rt.oldValue)})," إلى ",l.jsx("span",{className:"font-bold tabular-nums text-teal-600 dark:text-amber-400",children:z(rt.newValue)}),"؟"]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:wn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:kn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),It&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"clear-row-confirm-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"clear-row-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:"إفراغ الصف"}),l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد إفراغ كل المدخلات في هذا الصف؟ (كاش، مدى، فيزا، ماستر، اجمالى الموازنه، مصروفات، وغيرها)"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:is,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:bn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),fe&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"expense-modal-title",onClick:()=>Bt(null),children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-lg w-full max-h-[85vh] flex flex-col font-cairo cursor-auto",onClick:k=>k.stopPropagation(),onKeyDown:k=>{k.key==="Enter"&&!fe.readOnly&&(k.preventDefault(),_r())},children:[l.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[l.jsx("h2",{id:"expense-modal-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400",children:fe.readOnly?"تفاصيل المصروفات":"تصنيف المبلغ المصروف"}),l.jsx("button",{type:"button",onClick:()=>Bt(null),className:"p-2 rounded-lg text-stone-500 hover:text-white hover:bg-white/10 transition","aria-label":"إغلاق",children:l.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),!fe.readOnly&&l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-500 text-sm px-4 pt-2",children:"أدخل تفاصيل المصروف (مثال: 10 ريال كتب، 10 ريال مسطرة)"}),(fe.carriedCount??0)>0&&l.jsx("p",{className:"text-stone-600 dark:text-amber-200/80 text-xs px-4 pt-0.5 font-cairo",children:"البنود المرحّلة للعرض فقط — يمكنك إضافة تصنيف ومبلغ جديد فقط، ويُحدَّث المجموع وخانة المصروفات تلقائياً."})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[!fe.readOnly&&fe.items.length>0&&l.jsxs("div",{className:"flex gap-2 items-center pb-0.5",children:[l.jsx("span",{className:"flex-1 text-xs font-medium text-stone-700 font-cairo",children:"بند المصروف"}),l.jsx("span",{className:"w-24 text-xs font-medium text-stone-700 font-cairo text-center",children:"مبلغ المصروف"}),l.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}),fe.items.map((k,C)=>{const S=fe.carriedCount??0,O=!fe.readOnly&&C<S;return l.jsx("div",{className:"flex gap-2 items-center",children:fe.readOnly||O?l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"w-24 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm text-center tabular-nums",children:z(Number(k.amount)||0)}),l.jsxs("span",{className:"flex-1 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm font-cairo",children:[k.description||"—",O&&l.jsx("span",{className:"mr-1 text-[10px] text-stone-600 font-cairo",title:"من الشفت السابق",children:" (مرحّل)"})]}),!fe.readOnly&&O?l.jsx("button",{type:"button",onClick:()=>Ci(fe.rowId,C),className:"shrink-0 w-8 h-8 flex items-center justify-center rounded-lg border border-red-500/20 text-slate-400 hover:text-red-400 hover:border-red-500/40",title:"حذف البند المرحّل (يتطلب كود أدمن)","aria-label":"حذف بند مرحّل",children:l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}):l.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}):l.jsxs(l.Fragment,{children:[(()=>{const H=Ke.current[C]!==void 0?Ke.current[C]:String(k.amount??""),Q=(Number(String(H).replace(/,/g,""))||0)>0,L=!String(k.description||"").trim(),ne=Q&&L,te=rs===C;return l.jsx("input",{ref:q=>{!q||C!==S||fe.readOnly||Fr.current===fe.rowId||(Fr.current=fe.rowId,q.focus())},type:"text",tabIndex:C===S?0:-1,value:k.description,onChange:q=>{gn(C,"description",q.target.value),rs===C&&pn(null)},onKeyDown:q=>{q.key==="Enter"&&(q.preventDefault(),_r())},placeholder:Q?"الوصف إلزامي":"الوصف",title:Q?"الوصف إلزامي عند وجود مبلغ":void 0,"aria-required":Q,className:`flex-1 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 dark:focus:border-amber-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-amber-500/25 ${ne?"border-teal-500 dark:border-amber-500/50 ring-1 ring-teal-500/25":"border-stone-300 dark:border-amber-500/25"} ${te?"expense-description-pulse":""}`})})(),l.jsx("input",{type:"text",inputMode:"decimal",tabIndex:-1,dir:"ltr",value:Sr(Ke.current[C]!==void 0?Ke.current[C]:String(k.amount??"")),onChange:H=>{let Q=Sr(H.target.value).replace(/[^\d.]/g,"");const L=Q.indexOf(".");L>=0&&(Q=Q.slice(0,L+1)+Q.slice(L+1).replace(/\./g,"")),Ke.current[C]=Q,gn(C,"amount",Q)},onKeyDown:H=>{H.key==="Enter"&&(H.preventDefault(),_r())},placeholder:"مبلغ",className:"cashbox-input w-24 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border border-stone-300 dark:border-amber-500/25 text-stone-900 dark:text-white text-sm text-center focus:border-teal-500/50 dark:focus:border-amber-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-amber-500/25"}),l.jsx("button",{type:"button",tabIndex:-1,onClick:()=>yr(C),disabled:fe.items.length<=1,className:"p-2 rounded-lg text-stone-500 hover:text-red-400 hover:bg-red-500/20 disabled:opacity-40 disabled:pointer-events-none transition","aria-label":"حذف السطر",title:"حذف",children:l.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})},C)})]}),l.jsxs("div",{className:"p-4 border-t border-white/10 flex flex-wrap items-center gap-3",children:[!fe.readOnly&&l.jsxs("button",{type:"button",tabIndex:-1,onClick:br,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium bg-teal-100 text-teal-700 border-2 border-teal-400 hover:bg-teal-200 transition",children:[l.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:l.jsx("path",{d:"M12 5v14M5 12h14"})}),"إضافة سطر"]}),l.jsx("div",{className:"flex-1"}),fe.readOnly?l.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",l.jsx("span",{className:"font-bold text-teal-700 dark:text-amber-400 tabular-nums",children:z(fe.items.reduce((k,C)=>k+(Number(C.amount)||0),0))})]}):l.jsxs("div",{className:"flex flex-col items-end gap-2",children:[l.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",l.jsx("span",{className:"font-bold text-teal-700 dark:text-amber-400 tabular-nums",children:z(fe.items.reduce((k,C)=>k+(Number(C.amount)||0),0))})]}),l.jsx("button",{type:"button",onClick:_r,onKeyDown:k=>{(k.key==="Enter"||k.key===" "||k.key==="Tab")&&(k.preventDefault(),_r())},className:"px-4 py-2 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-slate-800 focus:shadow-[0_0_16px_rgba(16,185,129,0.4)]",children:"تعديل مبلغ المصروفات"})]})]})]})}),ge&&l.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-carried-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"delete-carried-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:ge.step==="confirm"?"حذف بند مرحّل":"كود الأدمن"}),ge.step==="confirm"?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف هذا البند المرحّل؟ يتطلب إدخال كود الأدمن في الخطوة التالية."}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:Ni,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:()=>{et(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),lt&&l.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),l.jsxs("div",{className:"relative mb-4",children:[l.jsx("input",{type:qe?"text":"password",value:Ne,onChange:k=>{ve(k.target.value),ke(!1)},onKeyDown:k=>{k.key==="Enter"&&$t(),k.key==="Escape"&&(et(null),ve(""),ke(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border text-white text-sm font-cairo focus:ring-1 focus:ring-amber-500/25 ${lt?"border-red-500 dark:border-red-400":"border-white/10 focus:border-amber-500/50"}`,autoFocus:!0}),l.jsx("button",{type:"button",onClick:()=>ze(k=>!k),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":qe?"إخفاء الكود":"إظهار الكود",children:qe?l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),l.jsx("path",{d:"M1 1l22 22"})]}):l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:$t,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),l.jsx("button",{type:"button",onClick:()=>{et(null),ve(""),ze(!1),ke(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),me&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"delete-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:me.step==="confirm"?"حذف الصف":"كود الأدمن"}),me.step==="confirm"?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف الصف؟"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:Ur,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:()=>Ce(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),lt&&l.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),l.jsxs("div",{className:"relative mb-4",children:[l.jsx("input",{type:qe?"text":"password",value:Ne,onChange:k=>{ve(k.target.value),ke(!1)},onKeyDown:k=>{k.key==="Enter"&&_n(),k.key==="Escape"&&(Ce(null),ve(""),ke(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border text-white text-sm font-cairo focus:ring-1 focus:ring-amber-500/25 ${lt?"border-red-500 dark:border-red-400":"border-white/10 focus:border-amber-500/50"}`,autoFocus:!0}),l.jsx("button",{type:"button",onClick:()=>ze(k=>!k),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":qe?"إخفاء الكود":"إظهار الكود",title:qe?"إخفاء":"إظهار",children:qe?l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),l.jsx("path",{d:"M1 1l22 22"})]}):l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:_n,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),l.jsx("button",{type:"button",onClick:()=>{Ce(null),ve(""),ze(!1),ke(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),Ee&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-all-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"delete-all-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:Ee.step==="confirm"?"حذف كل التقفيلات المغلقة":"كود الأدمن"}),Ee.step==="confirm"?l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف كل التقفيلات المغلقة؟"}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:vr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),l.jsx("button",{type:"button",onClick:()=>Ze(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),lt&&l.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),l.jsxs("div",{className:"relative mb-4",children:[l.jsx("input",{type:qe?"text":"password",value:Ne,onChange:k=>{ve(k.target.value),ke(!1)},onKeyDown:k=>{k.key==="Enter"&&Nt(),k.key==="Escape"&&(Ze(null),ve(""),ke(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border text-white text-sm font-cairo focus:ring-1 focus:ring-amber-500/25 ${lt?"border-red-500 dark:border-red-400":"border-white/10 focus:border-amber-500/50"}`,autoFocus:!0}),l.jsx("button",{type:"button",onClick:()=>ze(k=>!k),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":qe?"إخفاء الكود":"إظهار الكود",title:qe?"إخفاء":"إظهار",children:qe?l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),l.jsx("path",{d:"M1 1l22 22"})]}):l.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[l.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),l.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:Nt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),l.jsx("button",{type:"button",onClick:()=>{Ze(null),ve(""),ze(!1),ke(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),u&&l.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"switch-branch-dialog-title",children:l.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[l.jsx("h2",{id:"switch-branch-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:"تغيير الفرع"}),l.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد الانتقال إلى فرع ",Nn[u],"؟"]}),l.jsxs("div",{className:"flex gap-3",children:[l.jsx("button",{type:"button",onClick:()=>{n(u),h(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، الانتقال"}),l.jsx("button",{type:"button",onClick:()=>h(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})})]})}const Wg=["cash","sentToTreasury","expenseCompensation","expenses","mada","visa","mastercard","bankTransfer","programBalanceCash","programBalanceBank"],to="cashbox_name",Ms="cashbox_branch",Ao="cashbox_session_start",Hg=6*60*60*1e3;function Gg(r){return r==="corniche"||r==="andalusia"}function nc(){const r=sessionStorage.getItem(Ao);if(!r)return!0;const e=parseInt(r,10);return Number.isNaN(e)?!0:Date.now()-e>=Hg}function Kg(){const[r,e]=A.useState(null),[t,n]=A.useState("corniche"),[s,o]=A.useState(!1),[a,u]=A.useState("dark");A.useEffect(()=>{const E=sessionStorage.getItem(to),I=sessionStorage.getItem(Ms);E!=null&&E.trim()&&Gg(I)&&!nc()&&(e(E.trim()),n(I));const P=Bg();u(P),Io(P),o(!0)},[]),A.useEffect(()=>{const E=I=>u(I.detail);return window.addEventListener("cashbox-theme-change",E),()=>window.removeEventListener("cashbox-theme-change",E)},[]),A.useEffect(()=>{Io(a)},[a]),A.useEffect(()=>{if(!r)return;const I=setInterval(()=>{nc()&&m()},6e4);return()=>clearInterval(I)},[r,m]);const h=(E,I)=>{sessionStorage.setItem(to,E),sessionStorage.setItem(Ms,I),sessionStorage.setItem(Ao,Date.now().toString()),e(E),n(I)},m=A.useCallback(()=>{sessionStorage.removeItem(to),sessionStorage.removeItem(Ms),sessionStorage.removeItem(Ao),e(null),n("corniche")},[]),f=E=>{sessionStorage.setItem(Ms,E),n(E)};if(!s)return l.jsx("div",{className:"min-h-screen page-bg-warm dark:bg-slate-900 flex items-center justify-center",children:l.jsx("div",{className:"text-slate-700 dark:text-slate-500 font-cairo",children:"جاري التحميل..."})});const b=()=>id();return r?l.jsx(zg,{name:r,branch:t,onExit:m,onSwitchBranch:f,theme:a,onToggleTheme:b},t):l.jsx(kd,{onEnter:h})}ro.createRoot(document.getElementById("root")).render(l.jsx(hd.StrictMode,{children:l.jsx(Kg,{})}));
