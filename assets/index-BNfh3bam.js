import{r as I,a as bn,R as xd}from"./vendor-react-wGySg1uH.js";import{r as bd,u as dn}from"./vendor-xlsx-DLNWaC59.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();var uc={exports:{}},pi={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yd=I,_d=Symbol.for("react.element"),wd=Symbol.for("react.fragment"),vd=Object.prototype.hasOwnProperty,kd=yd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ed={key:!0,ref:!0,__self:!0,__source:!0};function dc(n,e,t){var r,s={},o=null,l=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)vd.call(e,r)&&!Ed.hasOwnProperty(r)&&(s[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:_d,type:n,key:o,ref:l,props:s,_owner:kd.current}}pi.Fragment=wd;pi.jsx=dc;pi.jsxs=dc;uc.exports=pi;var a=uc.exports,ao={},Fa=bn;ao.createRoot=Fa.createRoot,ao.hydrateRoot=Fa.hydrateRoot;const Td=/^[\p{L}\s]*$/u;function Id(n){return Td.test(n)&&n.length>0&&new RegExp("\\p{L}","u").test(n)}const Ad=[{id:"corniche",label:"الكورنيش"},{id:"andalusia",label:"الأندلس"}];function Cd({onEnter:n}){const[e,t]=I.useState(""),[r,s]=I.useState("corniche"),[o,l]=I.useState(""),u=Id(e.trim());function h(m){const g=m.target.value;/\d/.test(g)||(t(g),l(""))}function f(m){m.preventDefault();const g=e.trim();if(/\d/.test(g)){l("الاسم حروف فقط — بدون أرقام");return}if(!new RegExp("\\p{L}","u").test(g)){l("أدخل اسمك (حروف فقط)");return}l(""),n(g,r)}return a.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-br from-[#f4ebe0] via-[#f8f3ed] to-[#efe6dc] dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex flex-col items-center justify-center p-4 sm:p-6 safe-top safe-bottom",children:a.jsxs("div",{className:"w-full max-w-[95vw] sm:max-w-md bg-stone-50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl sm:rounded-3xl border border-stone-300 dark:border-white/20 shadow-xl dark:shadow-2xl p-5 sm:p-8",children:[a.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-primary-500 font-cairo mb-2",children:"أهلاً بك"}),a.jsx("p",{className:"text-sm sm:text-base text-stone-700 dark:text-slate-400 font-cairo",children:"اكتب اسمك للدخول"})]}),a.jsxs("form",{onSubmit:f,className:"space-y-4 sm:space-y-5",children:[o&&a.jsx("div",{className:"p-3 rounded-xl bg-red-50 dark:bg-red-500/20 border border-red-200 dark:border-red-500/40 text-red-700 dark:text-red-300 text-sm font-cairo",children:o}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الاسم (حروف فقط)"}),a.jsx("input",{id:"name",type:"text",value:e,onChange:h,placeholder:"أدخل اسمك",className:"w-full px-4 py-3 rounded-xl bg-stone-100 dark:bg-slate-900/80 border border-stone-300 dark:border-white/20 text-stone-900 dark:text-white placeholder-stone-500 dark:placeholder-slate-500 focus:border-primary-500/50 focus:ring-1 focus:ring-primary-500/25 focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-900 font-cairo",autoComplete:"off",autoFocus:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الفرع"}),a.jsx("div",{className:"flex gap-2",children:Ad.map(m=>a.jsx("button",{type:"button",onClick:()=>s(m.id),className:`flex-1 py-3 rounded-xl font-cairo font-semibold text-sm border-2 transition ${r===m.id?"bg-primary-500 border-primary-600 text-white dark:bg-amber-500/30 dark:border-amber-500/50 dark:text-amber-200":"bg-stone-100 dark:bg-slate-900/80 border-stone-300 dark:border-white/20 text-stone-700 dark:text-slate-300 hover:border-primary-400 dark:hover:border-amber-500/40"}`,children:m.label},m.id))})]}),a.jsx("button",{type:"submit",disabled:!u,className:"w-full py-3 sm:py-3.5 rounded-xl font-bold font-cairo text-sm sm:text-base bg-primary-500 hover:bg-primary-600 text-white disabled:opacity-40 disabled:cursor-not-allowed transition focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none min-h-[44px] touch-manipulation",children:"دخول"})]})]})})}const Nd="modulepreload",Rd=function(n){return"/cashbox/"+n},Ba={},Sd=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(t.map(h=>{if(h=Rd(h),h in Ba)return;Ba[h]=!0;const f=h.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${m}`))return;const g=document.createElement("link");if(g.rel=f?"stylesheet":Nd,f||(g.as="script"),g.crossOrigin="",g.href=h,u&&g.setAttribute("nonce",u),document.head.appendChild(g),f)return new Promise((E,C)=>{g.addEventListener("load",E),g.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return s.then(l=>{for(const u of l||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})},jd=()=>{};var $a={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hc=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Pd=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],l=n[t++],u=n[t++],h=((s&7)<<18|(o&63)<<12|(l&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[t++],l=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|l&63)}}return e.join("")},fc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],l=s+1<n.length,u=l?n[s+1]:0,h=s+2<n.length,f=h?n[s+2]:0,m=o>>2,g=(o&3)<<4|u>>4;let E=(u&15)<<2|f>>6,C=f&63;h||(C=64,l||(E=64)),r.push(t[m],t[g],t[E],t[C])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(hc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Pd(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],u=s<n.length?t[n.charAt(s)]:0;++s;const f=s<n.length?t[n.charAt(s)]:64;++s;const g=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||u==null||f==null||g==null)throw new Vd;const E=o<<2|u>>4;if(r.push(E),f!==64){const C=u<<4&240|f>>2;if(r.push(C),g!==64){const j=f<<6&192|g;r.push(j)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Vd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Dd=function(n){const e=hc(n);return fc.encodeByteArray(e,!0)},Xs=function(n){return Dd(n).replace(/\./g,"")},Md=function(n){try{return fc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ld(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Od=()=>Ld().__FIREBASE_DEFAULTS__,Fd=()=>{if(typeof process>"u"||typeof $a>"u")return;const n=$a.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Bd=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Md(n[1]);return e&&JSON.parse(e)},Po=()=>{try{return jd()||Od()||Fd()||Bd()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},$d=n=>{var e,t;return(t=(e=Po())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},Ud=n=>{const e=$d(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},mc=()=>{var n;return(n=Po())==null?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vo(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function zd(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const l={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Xs(JSON.stringify(t)),Xs(JSON.stringify(l)),""].join(".")}const Kr={};function Hd(){const n={prod:[],emulator:[]};for(const e of Object.keys(Kr))Kr[e]?n.emulator.push(e):n.prod.push(e);return n}function Gd(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let Ua=!1;function Kd(n,e){if(typeof window>"u"||typeof document>"u"||!Vo(window.location.host)||Kr[n]===e||Kr[n]||Ua)return;Kr[n]=e;function t(E){return`__firebase__banner__${E}`}const r="__firebase__banner",o=Hd().prod.length>0;function l(){const E=document.getElementById(r);E&&E.remove()}function u(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function h(E,C){E.setAttribute("width","24"),E.setAttribute("id",C),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function f(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Ua=!0,l()},E}function m(E,C){E.setAttribute("id",C),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function g(){const E=Gd(r),C=t("text"),j=document.getElementById(C)||document.createElement("span"),L=t("learnmore"),V=document.getElementById(L)||document.createElement("a"),O=t("preprendIcon"),$=document.getElementById(O)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const H=E.element;u(H),m(V,L);const Y=f();h($,O),H.append($,j,V,Y),document.body.appendChild(H)}o?(j.innerText="Preview backend disconnected.",$.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):($.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,j.innerText="Preview backend running in this workspace."),j.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Yd(){var e;const n=(e=Po())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Jd(){return!Yd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xd(){try{return typeof indexedDB=="object"}catch{return!1}}function Zd(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)==null?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh="FirebaseError";class vr extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=eh,Object.setPrototypeOf(this,vr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,pc.prototype.create)}}class pc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],l=o?th(o,r):"Error",u=`${this.serviceName}: ${l} (${s}).`;return new vr(s,u,r)}}function th(n,e){return n.replace(nh,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const nh=/\{\$([^}]+)}/g;function Zs(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const o=n[s],l=e[s];if(qa(o)&&qa(l)){if(!Zs(o,l))return!1}else if(o!==l)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function qa(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(n){return n&&n._delegate?n._delegate:n}class Zr{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pn="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new qd;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ih(e))try{this.getOrInitializeService({instanceIdentifier:Pn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(e=Pn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Pn){return this.instances.has(e)}getOptions(e=Pn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[o,l]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&l.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:sh(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Pn){return this.component?this.component.multipleInstances?e:Pn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sh(n){return n===Pn?void 0:n}function ih(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new rh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ye;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ye||(ye={}));const ah={debug:ye.DEBUG,verbose:ye.VERBOSE,info:ye.INFO,warn:ye.WARN,error:ye.ERROR,silent:ye.SILENT},lh=ye.INFO,ch={[ye.DEBUG]:"log",[ye.VERBOSE]:"log",[ye.INFO]:"info",[ye.WARN]:"warn",[ye.ERROR]:"error"},uh=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=ch[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class gc{constructor(e){this.name=e,this._logLevel=lh,this._logHandler=uh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ye))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ah[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ye.DEBUG,...e),this._logHandler(this,ye.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ye.VERBOSE,...e),this._logHandler(this,ye.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ye.INFO,...e),this._logHandler(this,ye.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ye.WARN,...e),this._logHandler(this,ye.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ye.ERROR,...e),this._logHandler(this,ye.ERROR,...e)}}const dh=(n,e)=>e.some(t=>n instanceof t);let za,Wa;function hh(){return za||(za=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fh(){return Wa||(Wa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xc=new WeakMap,lo=new WeakMap,bc=new WeakMap,Hi=new WeakMap,Do=new WeakMap;function mh(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",l)},o=()=>{t(fn(n.result)),s()},l=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",l)});return e.then(t=>{t instanceof IDBCursor&&xc.set(t,n)}).catch(()=>{}),Do.set(e,n),e}function ph(n){if(lo.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",l),n.removeEventListener("abort",l)},o=()=>{t(),s()},l=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",l),n.addEventListener("abort",l)});lo.set(n,e)}let co={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return lo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||bc.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return fn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function gh(n){co=n(co)}function xh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Gi(this),e,...t);return bc.set(r,e.sort?e.sort():[e]),fn(r)}:fh().includes(n)?function(...e){return n.apply(Gi(this),e),fn(xc.get(this))}:function(...e){return fn(n.apply(Gi(this),e))}}function bh(n){return typeof n=="function"?xh(n):(n instanceof IDBTransaction&&ph(n),dh(n,hh())?new Proxy(n,co):n)}function fn(n){if(n instanceof IDBRequest)return mh(n);if(Hi.has(n))return Hi.get(n);const e=bh(n);return e!==n&&(Hi.set(n,e),Do.set(e,n)),e}const Gi=n=>Do.get(n);function yh(n,e,{blocked:t,upgrade:r,blocking:s,terminated:o}={}){const l=indexedDB.open(n,e),u=fn(l);return r&&l.addEventListener("upgradeneeded",h=>{r(fn(l.result),h.oldVersion,h.newVersion,fn(l.transaction),h)}),t&&l.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",f=>s(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const _h=["get","getKey","getAll","getAllKeys","count"],wh=["put","add","delete","clear"],Ki=new Map;function Ha(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ki.get(e))return Ki.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=wh.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||_h.includes(t)))return;const o=async function(l,...u){const h=this.transaction(l,s?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),s&&h.done]))[0]};return Ki.set(e,o),o}gh(n=>({...n,get:(e,t,r)=>Ha(e,t)||n.get(e,t,r),has:(e,t)=>!!Ha(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(kh(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function kh(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const uo="@firebase/app",Ga="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const en=new gc("@firebase/app"),Eh="@firebase/app-compat",Th="@firebase/analytics-compat",Ih="@firebase/analytics",Ah="@firebase/app-check-compat",Ch="@firebase/app-check",Nh="@firebase/auth",Rh="@firebase/auth-compat",Sh="@firebase/database",jh="@firebase/data-connect",Ph="@firebase/database-compat",Vh="@firebase/functions",Dh="@firebase/functions-compat",Mh="@firebase/installations",Lh="@firebase/installations-compat",Oh="@firebase/messaging",Fh="@firebase/messaging-compat",Bh="@firebase/performance",$h="@firebase/performance-compat",Uh="@firebase/remote-config",qh="@firebase/remote-config-compat",zh="@firebase/storage",Wh="@firebase/storage-compat",Hh="@firebase/firestore",Gh="@firebase/ai",Kh="@firebase/firestore-compat",Qh="firebase",Yh="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ho="[DEFAULT]",Jh={[uo]:"fire-core",[Eh]:"fire-core-compat",[Ih]:"fire-analytics",[Th]:"fire-analytics-compat",[Ch]:"fire-app-check",[Ah]:"fire-app-check-compat",[Nh]:"fire-auth",[Rh]:"fire-auth-compat",[Sh]:"fire-rtdb",[jh]:"fire-data-connect",[Ph]:"fire-rtdb-compat",[Vh]:"fire-fn",[Dh]:"fire-fn-compat",[Mh]:"fire-iid",[Lh]:"fire-iid-compat",[Oh]:"fire-fcm",[Fh]:"fire-fcm-compat",[Bh]:"fire-perf",[$h]:"fire-perf-compat",[Uh]:"fire-rc",[qh]:"fire-rc-compat",[zh]:"fire-gcs",[Wh]:"fire-gcs-compat",[Hh]:"fire-fst",[Kh]:"fire-fst-compat",[Gh]:"fire-vertex","fire-js":"fire-js",[Qh]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ei=new Map,Xh=new Map,fo=new Map;function Ka(n,e){try{n.container.addComponent(e)}catch(t){en.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ti(n){const e=n.name;if(fo.has(e))return en.debug(`There were multiple attempts to register component ${e}.`),!1;fo.set(e,n);for(const t of ei.values())Ka(t,n);for(const t of Xh.values())Ka(t,n);return!0}function Zh(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ef(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mn=new pc("app","Firebase",tf);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Zr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rf=Yh;function yc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:ho,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw mn.create("bad-app-name",{appName:String(s)});if(t||(t=mc()),!t)throw mn.create("no-options");const o=ei.get(s);if(o){if(Zs(t,o.options)&&Zs(r,o.config))return o;throw mn.create("duplicate-app",{appName:s})}const l=new oh(s);for(const h of fo.values())l.addComponent(h);const u=new nf(t,r,l);return ei.set(s,u),u}function sf(n=ho){const e=ei.get(n);if(!e&&n===ho&&mc())return yc();if(!e)throw mn.create("no-app",{appName:n});return e}function cr(n,e,t){let r=Jh[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const l=[`Unable to register library "${r}" with version "${e}":`];s&&l.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),en.warn(l.join(" "));return}ti(new Zr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const of="firebase-heartbeat-database",af=1,es="firebase-heartbeat-store";let Qi=null;function _c(){return Qi||(Qi=yh(of,af,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(es)}catch(t){console.warn(t)}}}}).catch(n=>{throw mn.create("idb-open",{originalErrorMessage:n.message})})),Qi}async function lf(n){try{const t=(await _c()).transaction(es),r=await t.objectStore(es).get(wc(n));return await t.done,r}catch(e){if(e instanceof vr)en.warn(e.message);else{const t=mn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});en.warn(t.message)}}}async function Qa(n,e){try{const r=(await _c()).transaction(es,"readwrite");await r.objectStore(es).put(e,wc(n)),await r.done}catch(t){if(t instanceof vr)en.warn(t.message);else{const r=mn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});en.warn(r.message)}}}function wc(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cf=1024,uf=30;class df{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ff(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ya();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(l=>l.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>uf){const l=mf(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(l,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){en.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ya(),{heartbeatsToSend:r,unsentEntries:s}=hf(this._heartbeatsCache.heartbeats),o=Xs(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return en.warn(t),""}}}function Ya(){return new Date().toISOString().substring(0,10)}function hf(n,e=cf){const t=[];let r=n.slice();for(const s of n){const o=t.find(l=>l.agent===s.agent);if(o){if(o.dates.push(s.date),Ja(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Ja(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class ff{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Xd()?Zd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await lf(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Qa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Qa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Ja(n){return Xs(JSON.stringify({version:2,heartbeats:n})).length}function mf(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pf(n){ti(new Zr("platform-logger",e=>new vh(e),"PRIVATE")),ti(new Zr("heartbeat",e=>new df(e),"PRIVATE")),cr(uo,Ga,n),cr(uo,Ga,"esm2020"),cr("fire-js","")}pf("");var Xa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var pn,vc;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,x){function _(){}_.prototype=x.prototype,v.F=x.prototype,v.prototype=new _,v.prototype.constructor=v,v.D=function(w,k,A){for(var y=Array(arguments.length-2),F=2;F<arguments.length;F++)y[F-2]=arguments[F];return x.prototype[k].apply(w,y)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,x,_){_||(_=0);const w=Array(16);if(typeof x=="string")for(var k=0;k<16;++k)w[k]=x.charCodeAt(_++)|x.charCodeAt(_++)<<8|x.charCodeAt(_++)<<16|x.charCodeAt(_++)<<24;else for(k=0;k<16;++k)w[k]=x[_++]|x[_++]<<8|x[_++]<<16|x[_++]<<24;x=v.g[0],_=v.g[1],k=v.g[2];let A=v.g[3],y;y=x+(A^_&(k^A))+w[0]+3614090360&4294967295,x=_+(y<<7&4294967295|y>>>25),y=A+(k^x&(_^k))+w[1]+3905402710&4294967295,A=x+(y<<12&4294967295|y>>>20),y=k+(_^A&(x^_))+w[2]+606105819&4294967295,k=A+(y<<17&4294967295|y>>>15),y=_+(x^k&(A^x))+w[3]+3250441966&4294967295,_=k+(y<<22&4294967295|y>>>10),y=x+(A^_&(k^A))+w[4]+4118548399&4294967295,x=_+(y<<7&4294967295|y>>>25),y=A+(k^x&(_^k))+w[5]+1200080426&4294967295,A=x+(y<<12&4294967295|y>>>20),y=k+(_^A&(x^_))+w[6]+2821735955&4294967295,k=A+(y<<17&4294967295|y>>>15),y=_+(x^k&(A^x))+w[7]+4249261313&4294967295,_=k+(y<<22&4294967295|y>>>10),y=x+(A^_&(k^A))+w[8]+1770035416&4294967295,x=_+(y<<7&4294967295|y>>>25),y=A+(k^x&(_^k))+w[9]+2336552879&4294967295,A=x+(y<<12&4294967295|y>>>20),y=k+(_^A&(x^_))+w[10]+4294925233&4294967295,k=A+(y<<17&4294967295|y>>>15),y=_+(x^k&(A^x))+w[11]+2304563134&4294967295,_=k+(y<<22&4294967295|y>>>10),y=x+(A^_&(k^A))+w[12]+1804603682&4294967295,x=_+(y<<7&4294967295|y>>>25),y=A+(k^x&(_^k))+w[13]+4254626195&4294967295,A=x+(y<<12&4294967295|y>>>20),y=k+(_^A&(x^_))+w[14]+2792965006&4294967295,k=A+(y<<17&4294967295|y>>>15),y=_+(x^k&(A^x))+w[15]+1236535329&4294967295,_=k+(y<<22&4294967295|y>>>10),y=x+(k^A&(_^k))+w[1]+4129170786&4294967295,x=_+(y<<5&4294967295|y>>>27),y=A+(_^k&(x^_))+w[6]+3225465664&4294967295,A=x+(y<<9&4294967295|y>>>23),y=k+(x^_&(A^x))+w[11]+643717713&4294967295,k=A+(y<<14&4294967295|y>>>18),y=_+(A^x&(k^A))+w[0]+3921069994&4294967295,_=k+(y<<20&4294967295|y>>>12),y=x+(k^A&(_^k))+w[5]+3593408605&4294967295,x=_+(y<<5&4294967295|y>>>27),y=A+(_^k&(x^_))+w[10]+38016083&4294967295,A=x+(y<<9&4294967295|y>>>23),y=k+(x^_&(A^x))+w[15]+3634488961&4294967295,k=A+(y<<14&4294967295|y>>>18),y=_+(A^x&(k^A))+w[4]+3889429448&4294967295,_=k+(y<<20&4294967295|y>>>12),y=x+(k^A&(_^k))+w[9]+568446438&4294967295,x=_+(y<<5&4294967295|y>>>27),y=A+(_^k&(x^_))+w[14]+3275163606&4294967295,A=x+(y<<9&4294967295|y>>>23),y=k+(x^_&(A^x))+w[3]+4107603335&4294967295,k=A+(y<<14&4294967295|y>>>18),y=_+(A^x&(k^A))+w[8]+1163531501&4294967295,_=k+(y<<20&4294967295|y>>>12),y=x+(k^A&(_^k))+w[13]+2850285829&4294967295,x=_+(y<<5&4294967295|y>>>27),y=A+(_^k&(x^_))+w[2]+4243563512&4294967295,A=x+(y<<9&4294967295|y>>>23),y=k+(x^_&(A^x))+w[7]+1735328473&4294967295,k=A+(y<<14&4294967295|y>>>18),y=_+(A^x&(k^A))+w[12]+2368359562&4294967295,_=k+(y<<20&4294967295|y>>>12),y=x+(_^k^A)+w[5]+4294588738&4294967295,x=_+(y<<4&4294967295|y>>>28),y=A+(x^_^k)+w[8]+2272392833&4294967295,A=x+(y<<11&4294967295|y>>>21),y=k+(A^x^_)+w[11]+1839030562&4294967295,k=A+(y<<16&4294967295|y>>>16),y=_+(k^A^x)+w[14]+4259657740&4294967295,_=k+(y<<23&4294967295|y>>>9),y=x+(_^k^A)+w[1]+2763975236&4294967295,x=_+(y<<4&4294967295|y>>>28),y=A+(x^_^k)+w[4]+1272893353&4294967295,A=x+(y<<11&4294967295|y>>>21),y=k+(A^x^_)+w[7]+4139469664&4294967295,k=A+(y<<16&4294967295|y>>>16),y=_+(k^A^x)+w[10]+3200236656&4294967295,_=k+(y<<23&4294967295|y>>>9),y=x+(_^k^A)+w[13]+681279174&4294967295,x=_+(y<<4&4294967295|y>>>28),y=A+(x^_^k)+w[0]+3936430074&4294967295,A=x+(y<<11&4294967295|y>>>21),y=k+(A^x^_)+w[3]+3572445317&4294967295,k=A+(y<<16&4294967295|y>>>16),y=_+(k^A^x)+w[6]+76029189&4294967295,_=k+(y<<23&4294967295|y>>>9),y=x+(_^k^A)+w[9]+3654602809&4294967295,x=_+(y<<4&4294967295|y>>>28),y=A+(x^_^k)+w[12]+3873151461&4294967295,A=x+(y<<11&4294967295|y>>>21),y=k+(A^x^_)+w[15]+530742520&4294967295,k=A+(y<<16&4294967295|y>>>16),y=_+(k^A^x)+w[2]+3299628645&4294967295,_=k+(y<<23&4294967295|y>>>9),y=x+(k^(_|~A))+w[0]+4096336452&4294967295,x=_+(y<<6&4294967295|y>>>26),y=A+(_^(x|~k))+w[7]+1126891415&4294967295,A=x+(y<<10&4294967295|y>>>22),y=k+(x^(A|~_))+w[14]+2878612391&4294967295,k=A+(y<<15&4294967295|y>>>17),y=_+(A^(k|~x))+w[5]+4237533241&4294967295,_=k+(y<<21&4294967295|y>>>11),y=x+(k^(_|~A))+w[12]+1700485571&4294967295,x=_+(y<<6&4294967295|y>>>26),y=A+(_^(x|~k))+w[3]+2399980690&4294967295,A=x+(y<<10&4294967295|y>>>22),y=k+(x^(A|~_))+w[10]+4293915773&4294967295,k=A+(y<<15&4294967295|y>>>17),y=_+(A^(k|~x))+w[1]+2240044497&4294967295,_=k+(y<<21&4294967295|y>>>11),y=x+(k^(_|~A))+w[8]+1873313359&4294967295,x=_+(y<<6&4294967295|y>>>26),y=A+(_^(x|~k))+w[15]+4264355552&4294967295,A=x+(y<<10&4294967295|y>>>22),y=k+(x^(A|~_))+w[6]+2734768916&4294967295,k=A+(y<<15&4294967295|y>>>17),y=_+(A^(k|~x))+w[13]+1309151649&4294967295,_=k+(y<<21&4294967295|y>>>11),y=x+(k^(_|~A))+w[4]+4149444226&4294967295,x=_+(y<<6&4294967295|y>>>26),y=A+(_^(x|~k))+w[11]+3174756917&4294967295,A=x+(y<<10&4294967295|y>>>22),y=k+(x^(A|~_))+w[2]+718787259&4294967295,k=A+(y<<15&4294967295|y>>>17),y=_+(A^(k|~x))+w[9]+3951481745&4294967295,v.g[0]=v.g[0]+x&4294967295,v.g[1]=v.g[1]+(k+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+k&4294967295,v.g[3]=v.g[3]+A&4294967295}r.prototype.v=function(v,x){x===void 0&&(x=v.length);const _=x-this.blockSize,w=this.C;let k=this.h,A=0;for(;A<x;){if(k==0)for(;A<=_;)s(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<x;)if(w[k++]=v.charCodeAt(A++),k==this.blockSize){s(this,w),k=0;break}}else for(;A<x;)if(w[k++]=v[A++],k==this.blockSize){s(this,w),k=0;break}}this.h=k,this.o+=x},r.prototype.A=function(){var v=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);v[0]=128;for(var x=1;x<v.length-8;++x)v[x]=0;x=this.o*8;for(var _=v.length-8;_<v.length;++_)v[_]=x&255,x/=256;for(this.v(v),v=Array(16),x=0,_=0;_<4;++_)for(let w=0;w<32;w+=8)v[x++]=this.g[_]>>>w&255;return v};function o(v,x){var _=u;return Object.prototype.hasOwnProperty.call(_,v)?_[v]:_[v]=x(v)}function l(v,x){this.h=x;const _=[];let w=!0;for(let k=v.length-1;k>=0;k--){const A=v[k]|0;w&&A==x||(_[k]=A,w=!1)}this.g=_}var u={};function h(v){return-128<=v&&v<128?o(v,function(x){return new l([x|0],x<0?-1:0)}):new l([v|0],v<0?-1:0)}function f(v){if(isNaN(v)||!isFinite(v))return g;if(v<0)return V(f(-v));const x=[];let _=1;for(let w=0;v>=_;w++)x[w]=v/_|0,_*=4294967296;return new l(x,0)}function m(v,x){if(v.length==0)throw Error("number format error: empty string");if(x=x||10,x<2||36<x)throw Error("radix out of range: "+x);if(v.charAt(0)=="-")return V(m(v.substring(1),x));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=f(Math.pow(x,8));let w=g;for(let A=0;A<v.length;A+=8){var k=Math.min(8,v.length-A);const y=parseInt(v.substring(A,A+k),x);k<8?(k=f(Math.pow(x,k)),w=w.j(k).add(f(y))):(w=w.j(_),w=w.add(f(y)))}return w}var g=h(0),E=h(1),C=h(16777216);n=l.prototype,n.m=function(){if(L(this))return-V(this).m();let v=0,x=1;for(let _=0;_<this.g.length;_++){const w=this.i(_);v+=(w>=0?w:4294967296+w)*x,x*=4294967296}return v},n.toString=function(v){if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(j(this))return"0";if(L(this))return"-"+V(this).toString(v);const x=f(Math.pow(v,6));var _=this;let w="";for(;;){const k=Y(_,x).g;_=O(_,k.j(x));let A=((_.g.length>0?_.g[0]:_.h)>>>0).toString(v);if(_=k,j(_))return A+w;for(;A.length<6;)A="0"+A;w=A+w}},n.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h};function j(v){if(v.h!=0)return!1;for(let x=0;x<v.g.length;x++)if(v.g[x]!=0)return!1;return!0}function L(v){return v.h==-1}n.l=function(v){return v=O(this,v),L(v)?-1:j(v)?0:1};function V(v){const x=v.g.length,_=[];for(let w=0;w<x;w++)_[w]=~v.g[w];return new l(_,~v.h).add(E)}n.abs=function(){return L(this)?V(this):this},n.add=function(v){const x=Math.max(this.g.length,v.g.length),_=[];let w=0;for(let k=0;k<=x;k++){let A=w+(this.i(k)&65535)+(v.i(k)&65535),y=(A>>>16)+(this.i(k)>>>16)+(v.i(k)>>>16);w=y>>>16,A&=65535,y&=65535,_[k]=y<<16|A}return new l(_,_[_.length-1]&-2147483648?-1:0)};function O(v,x){return v.add(V(x))}n.j=function(v){if(j(this)||j(v))return g;if(L(this))return L(v)?V(this).j(V(v)):V(V(this).j(v));if(L(v))return V(this.j(V(v)));if(this.l(C)<0&&v.l(C)<0)return f(this.m()*v.m());const x=this.g.length+v.g.length,_=[];for(var w=0;w<2*x;w++)_[w]=0;for(w=0;w<this.g.length;w++)for(let k=0;k<v.g.length;k++){const A=this.i(w)>>>16,y=this.i(w)&65535,F=v.i(k)>>>16,Z=v.i(k)&65535;_[2*w+2*k]+=y*Z,$(_,2*w+2*k),_[2*w+2*k+1]+=A*Z,$(_,2*w+2*k+1),_[2*w+2*k+1]+=y*F,$(_,2*w+2*k+1),_[2*w+2*k+2]+=A*F,$(_,2*w+2*k+2)}for(v=0;v<x;v++)_[v]=_[2*v+1]<<16|_[2*v];for(v=x;v<2*x;v++)_[v]=0;return new l(_,0)};function $(v,x){for(;(v[x]&65535)!=v[x];)v[x+1]+=v[x]>>>16,v[x]&=65535,x++}function H(v,x){this.g=v,this.h=x}function Y(v,x){if(j(x))throw Error("division by zero");if(j(v))return new H(g,g);if(L(v))return x=Y(V(v),x),new H(V(x.g),V(x.h));if(L(x))return x=Y(v,V(x)),new H(V(x.g),x.h);if(v.g.length>30){if(L(v)||L(x))throw Error("slowDivide_ only works with positive integers.");for(var _=E,w=x;w.l(v)<=0;)_=z(_),w=z(w);var k=te(_,1),A=te(w,1);for(w=te(w,2),_=te(_,2);!j(w);){var y=A.add(w);y.l(v)<=0&&(k=k.add(_),A=y),w=te(w,1),_=te(_,1)}return x=O(v,k.j(x)),new H(k,x)}for(k=g;v.l(x)>=0;){for(_=Math.max(1,Math.floor(v.m()/x.m())),w=Math.ceil(Math.log(_)/Math.LN2),w=w<=48?1:Math.pow(2,w-48),A=f(_),y=A.j(x);L(y)||y.l(v)>0;)_-=w,A=f(_),y=A.j(x);j(A)&&(A=E),k=k.add(A),v=O(v,y)}return new H(k,v)}n.B=function(v){return Y(this,v).h},n.and=function(v){const x=Math.max(this.g.length,v.g.length),_=[];for(let w=0;w<x;w++)_[w]=this.i(w)&v.i(w);return new l(_,this.h&v.h)},n.or=function(v){const x=Math.max(this.g.length,v.g.length),_=[];for(let w=0;w<x;w++)_[w]=this.i(w)|v.i(w);return new l(_,this.h|v.h)},n.xor=function(v){const x=Math.max(this.g.length,v.g.length),_=[];for(let w=0;w<x;w++)_[w]=this.i(w)^v.i(w);return new l(_,this.h^v.h)};function z(v){const x=v.g.length+1,_=[];for(let w=0;w<x;w++)_[w]=v.i(w)<<1|v.i(w-1)>>>31;return new l(_,v.h)}function te(v,x){const _=x>>5;x%=32;const w=v.g.length-_,k=[];for(let A=0;A<w;A++)k[A]=x>0?v.i(A+_)>>>x|v.i(A+_+1)<<32-x:v.i(A+_);return new l(k,v.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,vc=r,l.prototype.add=l.prototype.add,l.prototype.multiply=l.prototype.j,l.prototype.modulo=l.prototype.B,l.prototype.compare=l.prototype.l,l.prototype.toNumber=l.prototype.m,l.prototype.toString=l.prototype.toString,l.prototype.getBits=l.prototype.i,l.fromNumber=f,l.fromString=m,pn=l}).apply(typeof Xa<"u"?Xa:typeof self<"u"?self:typeof window<"u"?window:{});var js=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kc,Ur,Ec,qs,mo,Tc,Ic,Ac;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof js=="object"&&js];for(var c=0;c<i.length;++c){var d=i[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=t(this);function s(i,c){if(c)e:{var d=r;i=i.split(".");for(var p=0;p<i.length-1;p++){var N=i[p];if(!(N in d))break e;d=d[N]}i=i[i.length-1],p=d[i],c=c(p),c!=p&&c!=null&&e(d,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var d=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&d.push([p,c[p]]);return d}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},l=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,d){return i.call.apply(i.bind,arguments)}function f(i,c,d){return f=h,f.apply(null,arguments)}function m(i,c){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),i.apply(this,p)}}function g(i,c){function d(){}d.prototype=c.prototype,i.Z=c.prototype,i.prototype=new d,i.prototype.constructor=i,i.Ob=function(p,N,S){for(var q=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)q[fe-2]=arguments[fe];return c.prototype[N].apply(p,q)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function C(i){const c=i.length;if(c>0){const d=Array(c);for(let p=0;p<c;p++)d[p]=i[p];return d}return[]}function j(i,c){for(let p=1;p<arguments.length;p++){const N=arguments[p];var d=typeof N;if(d=d!="object"?d:N?Array.isArray(N)?"array":d:"null",d=="array"||d=="object"&&typeof N.length=="number"){d=i.length||0;const S=N.length||0;i.length=d+S;for(let q=0;q<S;q++)i[d+q]=N[q]}else i.push(N)}}class L{constructor(c,d){this.i=c,this.j=d,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function V(i){l.setTimeout(()=>{throw i},0)}function O(){var i=v;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class ${constructor(){this.h=this.g=null}add(c,d){const p=H.get();p.set(c,d),this.h?this.h.next=p:this.g=p,this.h=p}}var H=new L(()=>new Y,i=>i.reset());class Y{constructor(){this.next=this.g=this.h=null}set(c,d){this.h=c,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let z,te=!1,v=new $,x=()=>{const i=Promise.resolve(void 0);z=()=>{i.then(_)}};function _(){for(var i;i=O();){try{i.h.call(i.g)}catch(d){V(d)}var c=H;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}te=!1}function w(){this.u=this.u,this.C=this.C}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function k(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}k.prototype.h=function(){this.defaultPrevented=!0};var A=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const d=()=>{};l.addEventListener("test",d,c),l.removeEventListener("test",d,c)}catch{}return i}();function y(i){return/^[\s\xa0]*$/.test(i)}function F(i,c){k.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}g(F,k),F.prototype.init=function(i,c){const d=this.type=i.type,p=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(d=="mouseover"?c=i.fromElement:d=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&F.Z.h.call(this)},F.prototype.h=function(){F.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var Z="closure_listenable_"+(Math.random()*1e6|0),B=0;function ee(i,c,d,p,N){this.listener=i,this.proxy=null,this.src=c,this.type=d,this.capture=!!p,this.ha=N,this.key=++B,this.da=this.fa=!1}function le(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function he(i,c,d){for(const p in i)c.call(d,i[p],p,i)}function xe(i,c){for(const d in i)c.call(void 0,i[d],d,i)}function me(i){const c={};for(const d in i)c[d]=i[d];return c}const ke="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qe(i,c){let d,p;for(let N=1;N<arguments.length;N++){p=arguments[N];for(d in p)i[d]=p[d];for(let S=0;S<ke.length;S++)d=ke[S],Object.prototype.hasOwnProperty.call(p,d)&&(i[d]=p[d])}}function Ce(i){this.src=i,this.g={},this.h=0}Ce.prototype.add=function(i,c,d,p,N){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const q=nt(i,c,p,N);return q>-1?(c=i[q],d||(c.fa=!1)):(c=new ee(c,this.src,S,!!p,N),c.fa=d,i.push(c)),c};function Ne(i,c){const d=c.type;if(d in i.g){var p=i.g[d],N=Array.prototype.indexOf.call(p,c,void 0),S;(S=N>=0)&&Array.prototype.splice.call(p,N,1),S&&(le(c),i.g[d].length==0&&(delete i.g[d],i.h--))}}function nt(i,c,d,p){for(let N=0;N<i.length;++N){const S=i[N];if(!S.da&&S.listener==c&&S.capture==!!d&&S.ha==p)return N}return-1}var pt="closure_lm_"+(Math.random()*1e6|0),Ee={};function bt(i,c,d,p,N){if(Array.isArray(c)){for(let S=0;S<c.length;S++)bt(i,c[S],d,p,N);return null}return d=ct(d),i&&i[Z]?i.J(c,d,u(p)?!!p.capture:!1,N):Et(i,c,d,!1,p,N)}function Et(i,c,d,p,N,S){if(!c)throw Error("Invalid event type");const q=u(N)?!!N.capture:!!N;let fe=_e(i);if(fe||(i[pt]=fe=new Ce(i)),d=fe.add(c,d,p,q,S),d.proxy)return d;if(p=Yt(),d.proxy=p,p.src=i,p.listener=d,i.addEventListener)A||(N=q),N===void 0&&(N=!1),i.addEventListener(c.toString(),p,N);else if(i.attachEvent)i.attachEvent(X(c.toString()),p);else if(i.addListener&&i.removeListener)i.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function Yt(){function i(d){return c.call(i.src,i.listener,d)}const c=Tt;return i}function Xe(i,c,d,p,N){if(Array.isArray(c))for(var S=0;S<c.length;S++)Xe(i,c[S],d,p,N);else p=u(p)?!!p.capture:!!p,d=ct(d),i&&i[Z]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],d=nt(c,d,p,N),d>-1&&(le(c[d]),Array.prototype.splice.call(c,d,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=_e(i))&&(c=i.g[c.toString()],i=-1,c&&(i=nt(c,d,p,N)),(d=i>-1?c[i]:null)&&ot(d))}function ot(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[Z])Ne(c.i,i);else{var d=i.type,p=i.proxy;c.removeEventListener?c.removeEventListener(d,p,i.capture):c.detachEvent?c.detachEvent(X(d),p):c.addListener&&c.removeListener&&c.removeListener(p),(d=_e(c))?(Ne(d,i),d.h==0&&(d.src=null,c[pt]=null)):le(i)}}}function X(i){return i in Ee?Ee[i]:Ee[i]="on"+i}function Tt(i,c){if(i.da)i=!0;else{c=new F(c,this);const d=i.listener,p=i.ha||i.src;i.fa&&ot(i),i=d.call(p,c)}return i}function _e(i){return i=i[pt],i instanceof Ce?i:null}var je="__closure_events_fn_"+(Math.random()*1e9>>>0);function ct(i){return typeof i=="function"?i:(i[je]||(i[je]=function(c){return i.handleEvent(c)}),i[je])}function Re(){w.call(this),this.i=new Ce(this),this.M=this,this.G=null}g(Re,w),Re.prototype[Z]=!0,Re.prototype.removeEventListener=function(i,c,d,p){Xe(this,i,c,d,p)};function Be(i,c){var d,p=i.G;if(p)for(d=[];p;p=p.G)d.push(p);if(i=i.M,p=c.type||c,typeof c=="string")c=new k(c,i);else if(c instanceof k)c.target=c.target||i;else{var N=c;c=new k(p,i),Qe(c,N)}N=!0;let S,q;if(d)for(q=d.length-1;q>=0;q--)S=c.g=d[q],N=yt(S,p,!0,c)&&N;if(S=c.g=i,N=yt(S,p,!0,c)&&N,N=yt(S,p,!1,c)&&N,d)for(q=0;q<d.length;q++)S=c.g=d[q],N=yt(S,p,!1,c)&&N}Re.prototype.N=function(){if(Re.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const d=i.g[c];for(let p=0;p<d.length;p++)le(d[p]);delete i.g[c],i.h--}}this.G=null},Re.prototype.J=function(i,c,d,p){return this.i.add(String(i),c,!1,d,p)},Re.prototype.K=function(i,c,d,p){return this.i.add(String(i),c,!0,d,p)};function yt(i,c,d,p){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let N=!0;for(let S=0;S<c.length;++S){const q=c[S];if(q&&!q.da&&q.capture==d){const fe=q.listener,He=q.ha||q.src;q.fa&&Ne(i.i,q),N=fe.call(He,p)!==!1&&N}}return N&&!p.defaultPrevented}function Cr(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:l.setTimeout(i,c||0)}function Dt(i){i.g=Cr(()=>{i.g=null,i.i&&(i.i=!1,Dt(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Tn extends w{constructor(c,d){super(),this.m=c,this.l=d,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Dt(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pe(i){w.call(this),this.h=i,this.g={}}g(Pe,w);var $e=[];function _t(i){he(i.g,function(c,d){this.g.hasOwnProperty(d)&&ot(c)},i),i.g={}}Pe.prototype.N=function(){Pe.Z.N.call(this),_t(this)},Pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Mt=l.JSON.stringify,Hn=l.JSON.parse,Gn=class{stringify(i){return l.JSON.stringify(i,void 0)}parse(i){return l.JSON.parse(i,void 0)}};function Kn(){}function ut(){}var Jt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function we(){k.call(this,"d")}g(we,k);function It(){k.call(this,"c")}g(It,k);var Lt={},Nr=null;function Qn(){return Nr=Nr||new Re}Lt.Ia="serverreachability";function dt(i){k.call(this,Lt.Ia,i)}g(dt,k);function sn(i){const c=Qn();Be(c,new dt(c))}Lt.STAT_EVENT="statevent";function At(i,c){k.call(this,Lt.STAT_EVENT,i),this.stat=c}g(At,k);function We(i){const c=Qn();Be(c,new At(c,i))}Lt.Ja="timingevent";function se(i,c){k.call(this,Lt.Ja,i),this.size=c}g(se,k);function ht(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return l.setTimeout(function(){i()},c)}function Ot(){this.g=!0}Ot.prototype.ua=function(){this.g=!1};function Vi(i,c,d,p,N,S){i.info(function(){if(i.g)if(S){var q="",fe=S.split("&");for(let Ie=0;Ie<fe.length;Ie++){var He=fe[Ie].split("=");if(He.length>1){const Ye=He[0];He=He[1];const qt=Ye.split("_");q=qt.length>=2&&qt[1]=="type"?q+(Ye+"="+He+"&"):q+(Ye+"=redacted&")}}}else q=null;else q=S;return"XMLHTTP REQ ("+p+") [attempt "+N+"]: "+c+`
`+d+`
`+q})}function Di(i,c,d,p,N,S,q){i.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+N+"]: "+c+`
`+d+`
`+S+" "+q})}function on(i,c,d,p){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Mi(i,d)+(p?" "+p:"")})}function ms(i,c){i.info(function(){return"TIMEOUT: "+c})}Ot.prototype.info=function(){};function Mi(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var d=S[i];if(!(d.length<2)){var p=d[1];if(Array.isArray(p)&&!(p.length<1)){var N=p[0];if(N!="noop"&&N!="stop"&&N!="close")for(let q=1;q<p.length;q++)p[q]=""}}}}return Mt(S)}catch{return c}}var Yn={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ps={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},gs;function Jn(){}g(Jn,Kn),Jn.prototype.g=function(){return new XMLHttpRequest},gs=new Jn;function Ct(i){return encodeURIComponent(String(i))}function Li(i){var c=1;i=i.split(":");const d=[];for(;c>0&&i.length;)d.push(i.shift()),c--;return i.length&&d.push(i.join(":")),d}function Ft(i,c,d,p){this.j=i,this.i=c,this.l=d,this.S=p||1,this.V=new Pe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Rr}function Rr(){this.i=null,this.g="",this.h=!1}var xs={},Sr={};function Ve(i,c,d){i.M=1,i.A=Zn(wt(c)),i.u=d,i.R=!0,bs(i,null)}function bs(i,c){i.F=Date.now(),Nt(i),i.B=wt(i.A);var d=i.B,p=i.S;Array.isArray(p)||(p=[String(p)]),$t(d.i,"t",p),i.C=0,d=i.j.L,i.h=new Rr,i.g=Da(i.j,d?c:null,!i.u),i.P>0&&(i.O=new Tn(f(i.Y,i,i.g),i.P)),c=i.V,d=i.g,p=i.ba;var N="readystatechange";Array.isArray(N)||(N&&($e[0]=N.toString()),N=$e);for(let S=0;S<N.length;S++){const q=bt(d,N[S],p||c.handleEvent,!1,c.h||c);if(!q)break;c.g[q.key]=q}c=i.J?me(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),sn(),Vi(i.i,i.v,i.B,i.l,i.S,i.u)}Ft.prototype.ba=function(i){i=i.target;const c=this.O;c&&ln(i)==3?c.j():this.Y(i)},Ft.prototype.Y=function(i){try{if(i==this.g)e:{const fe=ln(this.g),He=this.g.ya(),Ie=this.g.ca();if(!(fe<3)&&(fe!=3||this.g&&(this.h.h||this.g.la()||Ea(this.g)))){this.K||fe!=4||He==7||(He==8||Ie<=0?sn(3):sn(2)),jr(this);var c=this.g.ca();this.X=c;var d=Oi(this);if(this.o=c==200,Di(this.i,this.v,this.B,this.l,this.S,fe,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,N=this.g;if((p=N.g?N.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(p)){var S=p;break t}}S=null}if(i=S)on(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Pr(this,i);else{this.o=!1,this.m=3,We(12),Xt(this),In(this);break e}}if(this.R){i=!0;let Ye;for(;!this.K&&this.C<d.length;)if(Ye=Fi(this,d),Ye==Sr){fe==4&&(this.m=4,We(14),i=!1),on(this.i,this.l,null,"[Incomplete Response]");break}else if(Ye==xs){this.m=4,We(15),on(this.i,this.l,d,"[Invalid Chunk]"),i=!1;break}else on(this.i,this.l,Ye,null),Pr(this,Ye);if(ys(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),fe!=4||d.length!=0||this.h.h||(this.m=1,We(16),i=!1),this.o=this.o&&i,!i)on(this.i,this.l,d,"[Invalid Chunked Response]"),Xt(this),In(this);else if(d.length>0&&!this.W){this.W=!0;var q=this.j;q.g==this&&q.aa&&!q.P&&(q.j.info("Great, no buffering proxy detected. Bytes received: "+d.length),zi(q),q.P=!0,We(11))}}else on(this.i,this.l,d,null),Pr(this,d);fe==4&&Xt(this),this.o&&!this.K&&(fe==4?Sa(this.j,this):(this.o=!1,Nt(this)))}else pd(this.g),c==400&&d.indexOf("Unknown SID")>0?(this.m=3,We(12)):(this.m=0,We(13)),Xt(this),In(this)}}}catch{}finally{}};function Oi(i){if(!ys(i))return i.g.la();const c=Ea(i.g);if(c==="")return"";let d="";const p=c.length,N=ln(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Xt(i),In(i),"";i.h.i=new l.TextDecoder}for(let S=0;S<p;S++)i.h.h=!0,d+=i.h.i.decode(c[S],{stream:!(N&&S==p-1)});return c.length=0,i.h.g+=d,i.C=0,i.h.g}function ys(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Fi(i,c){var d=i.C,p=c.indexOf(`
`,d);return p==-1?Sr:(d=Number(c.substring(d,p)),isNaN(d)?xs:(p+=1,p+d>c.length?Sr:(c=c.slice(p,p+d),i.C=p+d,c)))}Ft.prototype.cancel=function(){this.K=!0,Xt(this)};function Nt(i){i.T=Date.now()+i.H,_s(i,i.H)}function _s(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=ht(f(i.aa,i),c)}function jr(i){i.D&&(l.clearTimeout(i.D),i.D=null)}Ft.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(ms(this.i,this.B),this.M!=2&&(sn(),We(17)),Xt(this),this.m=2,In(this)):_s(this,this.T-i)};function In(i){i.j.I==0||i.K||Sa(i.j,i)}function Xt(i){jr(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,_t(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Pr(i,c){try{var d=i.j;if(d.I!=0&&(d.g==i||Xn(d.h,i))){if(!i.L&&Xn(d.h,i)&&d.I==3){try{var p=d.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var N=p;if(N[0]==0){e:if(!d.v){if(d.g)if(d.g.F+3e3<i.F)Ns(d),As(d);else break e;qi(d),We(18)}}else d.xa=N[1],0<d.xa-d.K&&N[2]<37500&&d.F&&d.A==0&&!d.C&&(d.C=ht(f(d.Va,d),6e3));vs(d.h)<=1&&d.ta&&(d.ta=void 0)}else Sn(d,11)}else if((i.L||d.g==i)&&Ns(d),!y(c))for(N=d.Ba.g.parse(c),c=0;c<N.length;c++){let Ie=N[c];const Ye=Ie[0];if(!(Ye<=d.K))if(d.K=Ye,Ie=Ie[1],d.I==2)if(Ie[0]=="c"){d.M=Ie[1],d.ba=Ie[2];const qt=Ie[3];qt!=null&&(d.ka=qt,d.j.info("VER="+d.ka));const jn=Ie[4];jn!=null&&(d.za=jn,d.j.info("SVER="+d.za));const cn=Ie[5];cn!=null&&typeof cn=="number"&&cn>0&&(p=1.5*cn,d.O=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;const un=i.g;if(un){const Ss=un.g?un.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ss){var S=p.h;S.g||Ss.indexOf("spdy")==-1&&Ss.indexOf("quic")==-1&&Ss.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Zt(S,S.h),S.h=null))}if(p.G){const Wi=un.g?un.g.getResponseHeader("X-HTTP-Session-Id"):null;Wi&&(p.wa=Wi,Te(p.J,p.G,Wi))}}d.I=3,d.l&&d.l.ra(),d.aa&&(d.T=Date.now()-i.F,d.j.info("Handshake RTT: "+d.T+"ms")),p=d;var q=i;if(p.na=Va(p,p.L?p.ba:null,p.W),q.L){at(p.h,q);var fe=q,He=p.O;He&&(fe.H=He),fe.D&&(jr(fe),Nt(fe)),p.g=q}else Na(p);d.i.length>0&&Cs(d)}else Ie[0]!="stop"&&Ie[0]!="close"||Sn(d,7);else d.I==3&&(Ie[0]=="stop"||Ie[0]=="close"?Ie[0]=="stop"?Sn(d,7):Ui(d):Ie[0]!="noop"&&d.l&&d.l.qa(Ie),d.A=0)}}sn(4)}catch{}}var Bi=class{constructor(i,c){this.g=i,this.map=c}};function Vr(i){this.l=i||10,l.PerformanceNavigationTiming?(i=l.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ws(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function vs(i){return i.h?1:i.g?i.g.size:0}function Xn(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Zt(i,c){i.g?i.g.add(c):i.h=c}function at(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Vr.prototype.cancel=function(){if(this.i=ks(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function ks(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const d of i.g.values())c=c.concat(d.G);return c}return C(i.i)}var Es=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $i(i,c){if(i){i=i.split("&");for(let d=0;d<i.length;d++){const p=i[d].indexOf("=");let N,S=null;p>=0?(N=i[d].substring(0,p),S=i[d].substring(p+1)):N=i[d],c(N,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Bt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Bt?(this.l=i.l,An(this,i.j),this.o=i.o,this.g=i.g,Cn(this,i.u),this.h=i.h,Dr(this,Ut(i.i)),this.m=i.m):i&&(c=String(i).match(Es))?(this.l=!1,An(this,c[1]||"",!0),this.o=b(c[2]||""),this.g=b(c[3]||"",!0),Cn(this,c[4]),this.h=b(c[5]||"",!0),Dr(this,c[6]||"",!0),this.m=b(c[7]||"")):(this.l=!1,this.i=new oe(null,this.l))}Bt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(T(c,M,!0),":");var d=this.g;return(d||c=="file")&&(i.push("//"),(c=this.o)&&i.push(T(c,M,!0),"@"),i.push(Ct(d).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.u,d!=null&&i.push(":",String(d))),(d=this.h)&&(this.g&&d.charAt(0)!="/"&&i.push("/"),i.push(T(d,d.charAt(0)=="/"?Q:U,!0))),(d=this.i.toString())&&i.push("?",d),(d=this.m)&&i.push("#",T(d,ie)),i.join("")},Bt.prototype.resolve=function(i){const c=wt(this);let d=!!i.j;d?An(c,i.j):d=!!i.o,d?c.o=i.o:d=!!i.g,d?c.g=i.g:d=i.u!=null;var p=i.h;if(d)Cn(c,i.u);else if(d=!!i.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var N=c.h.lastIndexOf("/");N!=-1&&(p=c.h.slice(0,N+1)+p)}if(N=p,N==".."||N==".")p="";else if(N.indexOf("./")!=-1||N.indexOf("/.")!=-1){p=N.lastIndexOf("/",0)==0,N=N.split("/");const S=[];for(let q=0;q<N.length;){const fe=N[q++];fe=="."?p&&q==N.length&&S.push(""):fe==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),p&&q==N.length&&S.push("")):(S.push(fe),p=!0)}p=S.join("/")}else p=N}return d?c.h=p:d=i.i.toString()!=="",d?Dr(c,Ut(i.i)):d=!!i.m,d&&(c.m=i.m),c};function wt(i){return new Bt(i)}function An(i,c,d){i.j=d?b(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function Cn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Dr(i,c,d){c instanceof oe?(i.i=c,Rt(i.i,i.l)):(d||(c=T(c,K)),i.i=new oe(c,i.l))}function Te(i,c,d){i.i.set(c,d)}function Zn(i){return Te(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function b(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function T(i,c,d){return typeof i=="string"?(i=encodeURI(i).replace(c,R),d&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function R(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var M=/[#\/\?@]/g,U=/[#\?:]/g,Q=/[#\?]/g,K=/[#\?@]/g,ie=/#/g;function oe(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function ne(i){i.g||(i.g=new Map,i.h=0,i.i&&$i(i.i,function(c,d){i.add(decodeURIComponent(c.replace(/\+/g," ")),d)}))}n=oe.prototype,n.add=function(i,c){ne(this),this.i=null,i=ft(this,i);let d=this.g.get(i);return d||this.g.set(i,d=[]),d.push(c),this.h+=1,this};function ae(i,c){ne(i),c=ft(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function De(i,c){return ne(i),c=ft(i,c),i.g.has(c)}n.forEach=function(i,c){ne(this),this.g.forEach(function(d,p){d.forEach(function(N){i.call(c,N,p,this)},this)},this)};function Me(i,c){ne(i);let d=[];if(typeof c=="string")De(i,c)&&(d=d.concat(i.g.get(ft(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)d=d.concat(i[c]);return d}n.set=function(i,c){return ne(this),this.i=null,i=ft(this,i),De(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Me(this,i),i.length>0?String(i[0]):c):c};function $t(i,c,d){ae(i,c),d.length>0&&(i.i=null,i.g.set(ft(i,c),C(d)),i.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var d=c[p];const N=Ct(d);d=Me(this,d);for(let S=0;S<d.length;S++){let q=N;d[S]!==""&&(q+="="+Ct(d[S])),i.push(q)}}return this.i=i.join("&")};function Ut(i){const c=new oe;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function ft(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function Rt(i,c){c&&!i.j&&(ne(i),i.i=null,i.g.forEach(function(d,p){const N=p.toLowerCase();p!=N&&(ae(this,p),$t(this,N,d))},i)),i.j=c}function gt(i,c){const d=new Ot;if(l.Image){const p=new Image;p.onload=m(lt,d,"TestLoadImage: loaded",!0,c,p),p.onerror=m(lt,d,"TestLoadImage: error",!1,c,p),p.onabort=m(lt,d,"TestLoadImage: abort",!1,c,p),p.ontimeout=m(lt,d,"TestLoadImage: timeout",!1,c,p),l.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=i}else c(!1)}function Nn(i,c){const d=new Ot,p=new AbortController,N=setTimeout(()=>{p.abort(),lt(d,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:p.signal}).then(S=>{clearTimeout(N),S.ok?lt(d,"TestPingServer: ok",!0,c):lt(d,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(N),lt(d,"TestPingServer: error",!1,c)})}function lt(i,c,d,p,N){try{N&&(N.onload=null,N.onerror=null,N.onabort=null,N.ontimeout=null),p(d)}catch{}}function er(){this.g=new Gn}function an(i){this.i=i.Sb||null,this.h=i.ab||!1}g(an,Kn),an.prototype.g=function(){return new tr(this.i,this.h)};function tr(i,c){Re.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(tr,Re),n=tr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Rn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||l).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,nr(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Rn(this)),this.g&&(this.readyState=3,Rn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof l.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ts(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ts(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?nr(this):Rn(this),this.readyState==3&&Ts(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,nr(this))},n.Na=function(i){this.g&&(this.response=i,nr(this))},n.ga=function(){this.g&&nr(this)};function nr(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Rn(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var d=c.next();!d.done;)d=d.value,i.push(d[0]+": "+d[1]),d=c.next();return i.join(`\r
`)};function Rn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(tr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Mr(i){let c="";return he(i,function(d,p){c+=p,c+=":",c+=d,c+=`\r
`}),c}function rr(i,c,d){e:{for(p in d){var p=!1;break e}p=!0}p||(d=Mr(d),typeof i=="string"?d!=null&&Ct(d):Te(i,c,d))}function Oe(i){Re.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(Oe,Re);var fd=/^https?$/i,md=["POST","PUT"];n=Oe.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():gs.g(),this.g.onreadystatechange=E(f(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){wa(this,S);return}if(i=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var N in p)d.set(N,p[N]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const S of p.keys())d.set(S,p.get(S));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(S=>S.toLowerCase()=="content-type"),N=l.FormData&&i instanceof l.FormData,!(Array.prototype.indexOf.call(md,c,void 0)>=0)||p||N||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,q]of d)this.g.setRequestHeader(S,q);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){wa(this,S)}};function wa(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,va(i),Is(i)}function va(i){i.A||(i.A=!0,Be(i,"complete"),Be(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Be(this,"complete"),Be(this,"abort"),Is(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Is(this,!0)),Oe.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ka(this):this.Xa())},n.Xa=function(){ka(this)};function ka(i){if(i.h&&typeof o<"u"){if(i.v&&ln(i)==4)setTimeout(i.Ca.bind(i),0);else if(Be(i,"readystatechange"),ln(i)==4){i.h=!1;try{const S=i.ca();e:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var d;if(!(d=c)){var p;if(p=S===0){let q=String(i.D).match(Es)[1]||null;!q&&l.self&&l.self.location&&(q=l.self.location.protocol.slice(0,-1)),p=!fd.test(q?q.toLowerCase():"")}d=p}if(d)Be(i,"complete"),Be(i,"success");else{i.o=6;try{var N=ln(i)>2?i.g.statusText:""}catch{N=""}i.l=N+" ["+i.ca()+"]",va(i)}}finally{Is(i)}}}}function Is(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const d=i.g;i.g=null,c||Be(i,"ready");try{d.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ln(i){return i.g?i.g.readyState:0}n.ca=function(){try{return ln(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Hn(c)}};function Ea(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function pd(i){const c={};i=(i.g&&ln(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<i.length;p++){if(y(i[p]))continue;var d=Li(i[p]);const N=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();const S=c[N]||[];c[N]=S,S.push(d)}xe(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Lr(i,c,d){return d&&d.internalChannelParams&&d.internalChannelParams[i]||c}function Ta(i){this.za=0,this.i=[],this.j=new Ot,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Lr("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Lr("baseRetryDelayMs",5e3,i),this.Za=Lr("retryDelaySeedMs",1e4,i),this.Ta=Lr("forwardChannelMaxRetries",2,i),this.va=Lr("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Vr(i&&i.concurrentRequestLimit),this.Ba=new er,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Ta.prototype,n.ka=8,n.I=1,n.connect=function(i,c,d,p){We(0),this.W=i,this.H=c||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.J=Va(this,null,this.W),Cs(this)};function Ui(i){if(Ia(i),i.I==3){var c=i.V++,d=wt(i.J);if(Te(d,"SID",i.M),Te(d,"RID",c),Te(d,"TYPE","terminate"),Or(i,d),c=new Ft(i,i.j,c),c.M=2,c.A=Zn(wt(d)),d=!1,l.navigator&&l.navigator.sendBeacon)try{d=l.navigator.sendBeacon(c.A.toString(),"")}catch{}!d&&l.Image&&(new Image().src=c.A,d=!0),d||(c.g=Da(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Nt(c)}Pa(i)}function As(i){i.g&&(zi(i),i.g.cancel(),i.g=null)}function Ia(i){As(i),i.v&&(l.clearTimeout(i.v),i.v=null),Ns(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&l.clearTimeout(i.m),i.m=null)}function Cs(i){if(!ws(i.h)&&!i.m){i.m=!0;var c=i.Ea;z||x(),te||(z(),te=!0),v.add(c,i),i.D=0}}function gd(i,c){return vs(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=ht(f(i.Ea,i,c),ja(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const N=new Ft(this,this.j,i);let S=this.o;if(this.U&&(S?(S=me(S),Qe(S,this.U)):S=this.U),this.u!==null||this.R||(N.J=S,S=null),this.S)e:{for(var c=0,d=0;d<this.i.length;d++){t:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=d;break e}if(c===4096||d===this.i.length-1){c=d+1;break e}}c=1e3}else c=1e3;c=Ca(this,N,c),d=wt(this.J),Te(d,"RID",i),Te(d,"CVER",22),this.G&&Te(d,"X-HTTP-Session-Id",this.G),Or(this,d),S&&(this.R?c="headers="+Ct(Mr(S))+"&"+c:this.u&&rr(d,this.u,S)),Zt(this.h,N),this.Ra&&Te(d,"TYPE","init"),this.S?(Te(d,"$req",c),Te(d,"SID","null"),N.U=!0,Ve(N,d,null)):Ve(N,d,c),this.I=2}}else this.I==3&&(i?Aa(this,i):this.i.length==0||ws(this.h)||Aa(this))};function Aa(i,c){var d;c?d=c.l:d=i.V++;const p=wt(i.J);Te(p,"SID",i.M),Te(p,"RID",d),Te(p,"AID",i.K),Or(i,p),i.u&&i.o&&rr(p,i.u,i.o),d=new Ft(i,i.j,d,i.D+1),i.u===null&&(d.J=i.o),c&&(i.i=c.G.concat(i.i)),c=Ca(i,d,1e3),d.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Zt(i.h,d),Ve(d,p,c)}function Or(i,c){i.H&&he(i.H,function(d,p){Te(c,p,d)}),i.l&&he({},function(d,p){Te(c,p,d)})}function Ca(i,c,d){d=Math.min(i.i.length,d);const p=i.l?f(i.l.Ka,i.l,i):null;e:{var N=i.i;let fe=-1;for(;;){const He=["count="+d];fe==-1?d>0?(fe=N[0].g,He.push("ofs="+fe)):fe=0:He.push("ofs="+fe);let Ie=!0;for(let Ye=0;Ye<d;Ye++){var S=N[Ye].g;const qt=N[Ye].map;if(S-=fe,S<0)fe=Math.max(0,N[Ye].g-100),Ie=!1;else try{S="req"+S+"_"||"";try{var q=qt instanceof Map?qt:Object.entries(qt);for(const[jn,cn]of q){let un=cn;u(cn)&&(un=Mt(cn)),He.push(S+jn+"="+encodeURIComponent(un))}}catch(jn){throw He.push(S+"type="+encodeURIComponent("_badmap")),jn}}catch{p&&p(qt)}}if(Ie){q=He.join("&");break e}}q=void 0}return i=i.i.splice(0,d),c.G=i,q}function Na(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;z||x(),te||(z(),te=!0),v.add(c,i),i.A=0}}function qi(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=ht(f(i.Da,i),ja(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Ra(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=ht(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,We(10),As(this),Ra(this))};function zi(i){i.B!=null&&(l.clearTimeout(i.B),i.B=null)}function Ra(i){i.g=new Ft(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=wt(i.na);Te(c,"RID","rpc"),Te(c,"SID",i.M),Te(c,"AID",i.K),Te(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&Te(c,"TO",i.ia),Te(c,"TYPE","xmlhttp"),Or(i,c),i.u&&i.o&&rr(c,i.u,i.o),i.O&&(i.g.H=i.O);var d=i.g;i=i.ba,d.M=1,d.A=Zn(wt(c)),d.u=null,d.R=!0,bs(d,i)}n.Va=function(){this.C!=null&&(this.C=null,As(this),qi(this),We(19))};function Ns(i){i.C!=null&&(l.clearTimeout(i.C),i.C=null)}function Sa(i,c){var d=null;if(i.g==c){Ns(i),zi(i),i.g=null;var p=2}else if(Xn(i.h,c))d=c.G,at(i.h,c),p=1;else return;if(i.I!=0){if(c.o)if(p==1){d=c.u?c.u.length:0,c=Date.now()-c.F;var N=i.D;p=Qn(),Be(p,new se(p,d)),Cs(i)}else Na(i);else if(N=c.m,N==3||N==0&&c.X>0||!(p==1&&gd(i,c)||p==2&&qi(i)))switch(d&&d.length>0&&(c=i.h,c.i=c.i.concat(d)),N){case 1:Sn(i,5);break;case 4:Sn(i,10);break;case 3:Sn(i,6);break;default:Sn(i,2)}}}function ja(i,c){let d=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(d*=2),d*c}function Sn(i,c){if(i.j.info("Error code "+c),c==2){var d=f(i.bb,i),p=i.Ua;const N=!p;p=new Bt(p||"//www.google.com/images/cleardot.gif"),l.location&&l.location.protocol=="http"||An(p,"https"),Zn(p),N?gt(p.toString(),d):Nn(p.toString(),d)}else We(2);i.I=0,i.l&&i.l.pa(c),Pa(i),Ia(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),We(2)):(this.j.info("Failed to ping google.com"),We(1))};function Pa(i){if(i.I=0,i.ja=[],i.l){const c=ks(i.h);(c.length!=0||i.i.length!=0)&&(j(i.ja,c),j(i.ja,i.i),i.h.i.length=0,C(i.i),i.i.length=0),i.l.oa()}}function Va(i,c,d){var p=d instanceof Bt?wt(d):new Bt(d);if(p.g!="")c&&(p.g=c+"."+p.g),Cn(p,p.u);else{var N=l.location;p=N.protocol,c=c?c+"."+N.hostname:N.hostname,N=+N.port;const S=new Bt(null);p&&An(S,p),c&&(S.g=c),N&&Cn(S,N),d&&(S.h=d),p=S}return d=i.G,c=i.wa,d&&c&&Te(p,d,c),Te(p,"VER",i.ka),Or(i,p),p}function Da(i,c,d){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new Oe(new an({ab:d})):new Oe(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ma(){}n=Ma.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Rs(){}Rs.prototype.g=function(i,c){return new xt(i,c)};function xt(i,c){Re.call(this),this.g=new Ta(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!y(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!y(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new sr(this)}g(xt,Re),xt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xt.prototype.close=function(){Ui(this.g)},xt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var d={};d.__data__=i,i=d}else this.v&&(d={},d.__data__=Mt(i),i=d);c.i.push(new Bi(c.Ya++,i)),c.I==3&&Cs(c)},xt.prototype.N=function(){this.g.l=null,delete this.j,Ui(this.g),delete this.g,xt.Z.N.call(this)};function La(i){we.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const d in c){i=d;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}g(La,we);function Oa(){It.call(this),this.status=1}g(Oa,It);function sr(i){this.g=i}g(sr,Ma),sr.prototype.ra=function(){Be(this.g,"a")},sr.prototype.qa=function(i){Be(this.g,new La(i))},sr.prototype.pa=function(i){Be(this.g,new Oa)},sr.prototype.oa=function(){Be(this.g,"b")},Rs.prototype.createWebChannel=Rs.prototype.g,xt.prototype.send=xt.prototype.o,xt.prototype.open=xt.prototype.m,xt.prototype.close=xt.prototype.close,Ac=function(){return new Rs},Ic=function(){return Qn()},Tc=Lt,mo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Yn.NO_ERROR=0,Yn.TIMEOUT=8,Yn.HTTP_ERROR=6,qs=Yn,ps.COMPLETE="complete",Ec=ps,ut.EventType=Jt,Jt.OPEN="a",Jt.CLOSE="b",Jt.ERROR="c",Jt.MESSAGE="d",Re.prototype.listen=Re.prototype.J,Ur=ut,Oe.prototype.listenOnce=Oe.prototype.K,Oe.prototype.getLastError=Oe.prototype.Ha,Oe.prototype.getLastErrorCode=Oe.prototype.ya,Oe.prototype.getStatus=Oe.prototype.ca,Oe.prototype.getResponseJson=Oe.prototype.La,Oe.prototype.getResponseText=Oe.prototype.la,Oe.prototype.send=Oe.prototype.ea,Oe.prototype.setWithCredentials=Oe.prototype.Fa,kc=Oe}).apply(typeof js<"u"?js:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class st{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}st.UNAUTHENTICATED=new st(null),st.GOOGLE_CREDENTIALS=new st("google-credentials-uid"),st.FIRST_PARTY=new st("first-party-uid"),st.MOCK_USER=new st("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kr="12.9.0";function gf(n){kr=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn=new gc("@firebase/firestore");function ir(){return Mn.logLevel}function J(n,...e){if(Mn.logLevel<=ye.DEBUG){const t=e.map(Mo);Mn.debug(`Firestore (${kr}): ${n}`,...t)}}function tn(n,...e){if(Mn.logLevel<=ye.ERROR){const t=e.map(Mo);Mn.error(`Firestore (${kr}): ${n}`,...t)}}function Ln(n,...e){if(Mn.logLevel<=ye.WARN){const t=e.map(Mo);Mn.warn(`Firestore (${kr}): ${n}`,...t)}}function Mo(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ce(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Cc(n,r,t)}function Cc(n,e,t){let r=`FIRESTORE (${kr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw tn(r),new Error(r)}function ve(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||Cc(e,s,r)}function de(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends vr{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class xf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(st.UNAUTHENTICATED))}shutdown(){}}class bf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class yf{constructor(e){this.t=e,this.currentUser=st.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ve(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let o=new gn;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new gn,e.enqueueRetryable(()=>s(this.currentUser))};const l=()=>{const h=o;e.enqueueRetryable(async()=>{await h.promise,await s(this.currentUser)})},u=h=>{J("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),l())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(J("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new gn)}},0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(J("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ve(typeof r.accessToken=="string",31837,{l:r}),new Nc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ve(e===null||typeof e=="string",2055,{h:e}),new st(e)}}class _f{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=st.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class wf{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new _f(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(st.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Za{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vf{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ef(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ve(this.o===void 0,3512);const r=o=>{o.error!=null&&J("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const l=o.token!==this.m;return this.m=o.token,J("FirebaseAppCheckTokenProvider",`Received ${l?"new":"existing"} token.`),l?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};const s=o=>{J("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):J("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Za(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ve(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Za(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kf(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=kf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<t&&(r+=e.charAt(s[o]%62))}return r}}function pe(n,e){return n<e?-1:n>e?1:0}function po(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),o=e.charAt(r);if(s!==o)return Yi(s)===Yi(o)?pe(s,o):Yi(s)?1:-1}return pe(n.length,e.length)}const Ef=55296,Tf=57343;function Yi(n){const e=n.charCodeAt(0);return e>=Ef&&e<=Tf}function pr(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const el="__name__";class zt{constructor(e,t,r){t===void 0?t=0:t>e.length&&ce(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&ce(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return zt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof zt?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const o=zt.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return pe(e.length,t.length)}static compareSegments(e,t){const r=zt.isNumericId(e),s=zt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?zt.extractNumericId(e).compare(zt.extractNumericId(t)):po(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return pn.fromString(e.substring(4,e.length-2))}}class Ae extends zt{construct(e,t,r){return new Ae(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new W(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new Ae(t)}static emptyPath(){return new Ae([])}}const If=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class et extends zt{construct(e,t,r){return new et(e,t,r)}static isValidIdentifier(e){return If.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),et.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===el}static keyField(){return new et([el])}static fromServerFormat(e){const t=[];let r="",s=0;const o=()=>{if(r.length===0)throw new W(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let l=!1;for(;s<e.length;){const u=e[s];if(u==="\\"){if(s+1===e.length)throw new W(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new W(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,s+=2}else u==="`"?(l=!l,s++):u!=="."||l?(r+=u,s++):(o(),s++)}if(o(),l)throw new W(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new et(t)}static emptyPath(){return new et([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.path=e}static fromPath(e){return new re(Ae.fromString(e))}static fromName(e){return new re(Ae.fromString(e).popFirst(5))}static empty(){return new re(Ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new Ae(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(n,e,t){if(!t)throw new W(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Af(n,e,t,r){if(e===!0&&r===!0)throw new W(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function tl(n){if(!re.isDocumentKey(n))throw new W(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function nl(n){if(re.isDocumentKey(n))throw new W(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Sc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function gi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":ce(12329,{type:typeof n})}function gr(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new W(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=gi(n);throw new W(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Cf(n,e){if(e<=0)throw new W(P.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ze(n,e){const t={typeString:n};return e&&(t.value=e),t}function cs(n,e){if(!Sc(n))throw new W(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const l=n[r];if(s&&typeof l!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&l!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new W(P.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl=-62135596800,sl=1e6;class Se{static now(){return Se.fromMillis(Date.now())}static fromDate(e){return Se.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*sl);return new Se(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new W(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new W(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<rl)throw new W(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new W(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/sl}_compareTo(e){return this.seconds===e.seconds?pe(this.nanoseconds,e.nanoseconds):pe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Se._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cs(e,Se._jsonSchema))return new Se(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-rl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Se._jsonSchemaVersion="firestore/timestamp/1.0",Se._jsonSchema={type:ze("string",Se._jsonSchemaVersion),seconds:ze("number"),nanoseconds:ze("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{static fromTimestamp(e){return new ue(e)}static min(){return new ue(new Se(0,0))}static max(){return new ue(new Se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts=-1;function Nf(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=ue.fromTimestamp(r===1e9?new Se(t+1,0):new Se(t,r));return new yn(s,re.empty(),e)}function Rf(n){return new yn(n.readTime,n.key,ts)}class yn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new yn(ue.min(),re.empty(),ts)}static max(){return new yn(ue.max(),re.empty(),ts)}}function Sf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=re.comparator(n.documentKey,e.documentKey),t!==0?t:pe(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Pf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Er(n){if(n.code!==P.FAILED_PRECONDITION||n.message!==jf)throw n;J("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ce(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):D.reject(t)}static resolve(e){return new D((t,r)=>{t(e)})}static reject(e){return new D((t,r)=>{r(e)})}static waitFor(e){return new D((t,r)=>{let s=0,o=0,l=!1;e.forEach(u=>{++s,u.next(()=>{++o,l&&o===s&&t()},h=>r(h))}),l=!0,o===s&&t()})}static or(e){let t=D.resolve(!1);for(const r of e)t=t.next(s=>s?D.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,o)=>{r.push(t.call(this,s,o))}),this.waitFor(r)}static mapArray(e,t){return new D((r,s)=>{const o=e.length,l=new Array(o);let u=0;for(let h=0;h<o;h++){const f=h;t(e[f]).next(m=>{l[f]=m,++u,u===o&&r(l)},m=>s(m))}})}static doWhile(e,t){return new D((r,s)=>{const o=()=>{e()===!0?t().next(()=>{o()},s):r()};o()})}}function Vf(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Tr(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}xi.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo=-1;function bi(n){return n==null}function ni(n){return n===0&&1/n==-1/0}function Df(n){return typeof n=="number"&&Number.isInteger(n)&&!ni(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc="";function Mf(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=il(e)),e=Lf(n.get(t),e);return il(e)}function Lf(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case jc:t+="";break;default:t+=o}}return t}function il(n){return n+jc+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Bn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Pc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Le{constructor(e,t){this.comparator=e,this.root=t||Ze.EMPTY}insert(e,t){return new Le(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ze.BLACK,null,null))}remove(e){return new Le(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ze.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ps(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ps(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ps(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ps(this.root,e,this.comparator,!0)}}class Ps{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ze{constructor(e,t,r,s,o){this.key=e,this.value=t,this.color=r??Ze.RED,this.left=s??Ze.EMPTY,this.right=o??Ze.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,o){return new Ze(e??this.key,t??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const o=r(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,r),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ze.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ze.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ze.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ze.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ce(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ce(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ce(27949);return e+(this.isRed()?0:1)}}Ze.EMPTY=null,Ze.RED=!0,Ze.BLACK=!1;Ze.EMPTY=new class{constructor(){this.size=0}get key(){throw ce(57766)}get value(){throw ce(16141)}get color(){throw ce(16727)}get left(){throw ce(29726)}get right(){throw ce(36894)}copy(e,t,r,s,o){return this}insert(e,t,r){return new Ze(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e){this.comparator=e,this.data=new Le(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new al(this.data.getIterator())}getIteratorFrom(e){return new al(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ke)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ke(this.comparator);return t.data=e,t}}class al{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new jt([])}unionWith(e){let t=new Ke(et.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new jt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return pr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Vc("Invalid base64 string: "+o):o}}(e);return new tt(t)}static fromUint8Array(e){const t=function(s){let o="";for(let l=0;l<s.length;++l)o+=String.fromCharCode(s[l]);return o}(e);return new tt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tt.EMPTY_BYTE_STRING=new tt("");const Of=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _n(n){if(ve(!!n,39018),typeof n=="string"){let e=0;const t=Of.exec(n);if(ve(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Fe(n.seconds),nanos:Fe(n.nanos)}}function Fe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function wn(n){return typeof n=="string"?tt.fromBase64String(n):tt.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc="server_timestamp",Mc="__type__",Lc="__previous_value__",Oc="__local_write_time__";function yi(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Mc])==null?void 0:r.stringValue)===Dc}function _i(n){const e=n.mapValue.fields[Lc];return yi(e)?_i(e):e}function ns(n){const e=_n(n.mapValue.fields[Oc].timestampValue);return new Se(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e,t,r,s,o,l,u,h,f,m,g){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=l,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=f,this.isUsingEmulator=m,this.apiKey=g}}const ri="(default)";class rs{constructor(e,t){this.projectId=e,this.database=t||ri}static empty(){return new rs("","")}get isDefaultDatabase(){return this.database===ri}isEqual(e){return e instanceof rs&&e.projectId===this.projectId&&e.database===this.database}}function Bf(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new W(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rs(n.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fc="__type__",$f="__max__",Vs={mapValue:{}},Bc="__vector__",si="value";function vn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?yi(n)?4:qf(n)?9007199254740991:Uf(n)?10:11:ce(28295,{value:n})}function Qt(n,e){if(n===e)return!0;const t=vn(n);if(t!==vn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ns(n).isEqual(ns(e));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const l=_n(s.timestampValue),u=_n(o.timestampValue);return l.seconds===u.seconds&&l.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,o){return wn(s.bytesValue).isEqual(wn(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,o){return Fe(s.geoPointValue.latitude)===Fe(o.geoPointValue.latitude)&&Fe(s.geoPointValue.longitude)===Fe(o.geoPointValue.longitude)}(n,e);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return Fe(s.integerValue)===Fe(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const l=Fe(s.doubleValue),u=Fe(o.doubleValue);return l===u?ni(l)===ni(u):isNaN(l)&&isNaN(u)}return!1}(n,e);case 9:return pr(n.arrayValue.values||[],e.arrayValue.values||[],Qt);case 10:case 11:return function(s,o){const l=s.mapValue.fields||{},u=o.mapValue.fields||{};if(ol(l)!==ol(u))return!1;for(const h in l)if(l.hasOwnProperty(h)&&(u[h]===void 0||!Qt(l[h],u[h])))return!1;return!0}(n,e);default:return ce(52216,{left:n})}}function ss(n,e){return(n.values||[]).find(t=>Qt(t,e))!==void 0}function xr(n,e){if(n===e)return 0;const t=vn(n),r=vn(e);if(t!==r)return pe(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return pe(n.booleanValue,e.booleanValue);case 2:return function(o,l){const u=Fe(o.integerValue||o.doubleValue),h=Fe(l.integerValue||l.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return ll(n.timestampValue,e.timestampValue);case 4:return ll(ns(n),ns(e));case 5:return po(n.stringValue,e.stringValue);case 6:return function(o,l){const u=wn(o),h=wn(l);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(o,l){const u=o.split("/"),h=l.split("/");for(let f=0;f<u.length&&f<h.length;f++){const m=pe(u[f],h[f]);if(m!==0)return m}return pe(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,l){const u=pe(Fe(o.latitude),Fe(l.latitude));return u!==0?u:pe(Fe(o.longitude),Fe(l.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return cl(n.arrayValue,e.arrayValue);case 10:return function(o,l){var E,C,j,L;const u=o.fields||{},h=l.fields||{},f=(E=u[si])==null?void 0:E.arrayValue,m=(C=h[si])==null?void 0:C.arrayValue,g=pe(((j=f==null?void 0:f.values)==null?void 0:j.length)||0,((L=m==null?void 0:m.values)==null?void 0:L.length)||0);return g!==0?g:cl(f,m)}(n.mapValue,e.mapValue);case 11:return function(o,l){if(o===Vs.mapValue&&l===Vs.mapValue)return 0;if(o===Vs.mapValue)return 1;if(l===Vs.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),f=l.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let g=0;g<h.length&&g<m.length;++g){const E=po(h[g],m[g]);if(E!==0)return E;const C=xr(u[h[g]],f[m[g]]);if(C!==0)return C}return pe(h.length,m.length)}(n.mapValue,e.mapValue);default:throw ce(23264,{he:t})}}function ll(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return pe(n,e);const t=_n(n),r=_n(e),s=pe(t.seconds,r.seconds);return s!==0?s:pe(t.nanos,r.nanos)}function cl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const o=xr(t[s],r[s]);if(o)return o}return pe(t.length,r.length)}function br(n){return go(n)}function go(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=_n(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return wn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const o of t.values||[])s?s=!1:r+=",",r+=go(o);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const l of r)o?o=!1:s+=",",s+=`${l}:${go(t.fields[l])}`;return s+"}"}(n.mapValue):ce(61005,{value:n})}function zs(n){switch(vn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_i(n);return e?16+zs(e):16;case 5:return 2*n.stringValue.length;case 6:return wn(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,o)=>s+zs(o),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Bn(r.fields,(o,l)=>{s+=o.length+zs(l)}),s}(n.mapValue);default:throw ce(13486,{value:n})}}function ii(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function xo(n){return!!n&&"integerValue"in n}function Fo(n){return!!n&&"arrayValue"in n}function ul(n){return!!n&&"nullValue"in n}function dl(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ws(n){return!!n&&"mapValue"in n}function Uf(n){var t,r;return((r=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Fc])==null?void 0:r.stringValue)===Bc}function Qr(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Bn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Qr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qr(n.arrayValue.values[t]);return e}return{...n}}function qf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===$f}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e){this.value=e}static empty(){return new vt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qr(t)}setAll(e){let t=et.emptyPath(),r={},s=[];e.forEach((l,u)=>{if(!t.isImmediateParentOf(u)){const h=this.getFieldsMap(t);this.applyChanges(h,r,s),r={},s=[],t=u.popLast()}l?r[u.lastSegment()]=Qr(l):s.push(u.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,r,s)}delete(e){const t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Qt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];Ws(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Bn(t,(s,o)=>e[s]=o);for(const s of r)delete e[s]}clone(){return new vt(Qr(this.value))}}function $c(n){const e=[];return Bn(n.fields,(t,r)=>{const s=new et([t]);if(Ws(r)){const o=$c(r.mapValue).fields;if(o.length===0)e.push(s);else for(const l of o)e.push(s.child(l))}else e.push(s)}),new jt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e,t,r,s,o,l,u){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=o,this.data=l,this.documentState=u}static newInvalidDocument(e){return new it(e,0,ue.min(),ue.min(),ue.min(),vt.empty(),0)}static newFoundDocument(e,t,r,s){return new it(e,1,t,ue.min(),r,s,0)}static newNoDocument(e,t){return new it(e,2,t,ue.min(),ue.min(),vt.empty(),0)}static newUnknownDocument(e,t){return new it(e,3,t,ue.min(),ue.min(),vt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ue.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ue.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof it&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new it(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e,t){this.position=e,this.inclusive=t}}function hl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const o=e[s],l=n.position[s];if(o.field.isKeyField()?r=re.comparator(re.fromName(l.referenceValue),t.key):r=xr(l,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function fl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Qt(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e,t="asc"){this.field=e,this.dir=t}}function zf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{}class qe extends Uc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Hf(e,t,r):t==="array-contains"?new Qf(e,r):t==="in"?new Yf(e,r):t==="not-in"?new Jf(e,r):t==="array-contains-any"?new Xf(e,r):new qe(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Gf(e,r):new Kf(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(xr(t,this.value)):t!==null&&vn(this.value)===vn(t)&&this.matchesComparison(xr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ce(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vt extends Uc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Vt(e,t)}matches(e){return qc(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function qc(n){return n.op==="and"}function zc(n){return Wf(n)&&qc(n)}function Wf(n){for(const e of n.filters)if(e instanceof Vt)return!1;return!0}function bo(n){if(n instanceof qe)return n.field.canonicalString()+n.op.toString()+br(n.value);if(zc(n))return n.filters.map(e=>bo(e)).join(",");{const e=n.filters.map(t=>bo(t)).join(",");return`${n.op}(${e})`}}function Wc(n,e){return n instanceof qe?function(r,s){return s instanceof qe&&r.op===s.op&&r.field.isEqual(s.field)&&Qt(r.value,s.value)}(n,e):n instanceof Vt?function(r,s){return s instanceof Vt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((o,l,u)=>o&&Wc(l,s.filters[u]),!0):!1}(n,e):void ce(19439)}function Hc(n){return n instanceof qe?function(t){return`${t.field.canonicalString()} ${t.op} ${br(t.value)}`}(n):n instanceof Vt?function(t){return t.op.toString()+" {"+t.getFilters().map(Hc).join(" ,")+"}"}(n):"Filter"}class Hf extends qe{constructor(e,t,r){super(e,t,r),this.key=re.fromName(r.referenceValue)}matches(e){const t=re.comparator(e.key,this.key);return this.matchesComparison(t)}}class Gf extends qe{constructor(e,t){super(e,"in",t),this.keys=Gc("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Kf extends qe{constructor(e,t){super(e,"not-in",t),this.keys=Gc("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Gc(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(r=>re.fromName(r.referenceValue))}class Qf extends qe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Fo(t)&&ss(t.arrayValue,this.value)}}class Yf extends qe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ss(this.value.arrayValue,t)}}class Jf extends qe{constructor(e,t){super(e,"not-in",t)}matches(e){if(ss(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ss(this.value.arrayValue,t)}}class Xf extends qe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Fo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>ss(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(e,t=null,r=[],s=[],o=null,l=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=l,this.endAt=u,this.Te=null}}function ml(n,e=null,t=[],r=[],s=null,o=null,l=null){return new Zf(n,e,t,r,s,o,l)}function Bo(n){const e=de(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>bo(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(o){return o.field.canonicalString()+o.dir}(r)).join(","),bi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>br(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>br(r)).join(",")),e.Te=t}return e.Te}function $o(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!zf(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Wc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!fl(n.startAt,e.startAt)&&fl(n.endAt,e.endAt)}function yo(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e,t=null,r=[],s=[],o=null,l="F",u=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=l,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function em(n,e,t,r,s,o,l,u){return new $n(n,e,t,r,s,o,l,u)}function Kc(n){return new $n(n)}function pl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function tm(n){return re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Uo(n){return n.collectionGroup!==null}function ur(n){const e=de(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(l){let u=new Ke(et.comparator);return l.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(u=u.add(f.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new is(o,r))}),t.has(et.keyField().canonicalString())||e.Ie.push(new is(et.keyField(),r))}return e.Ie}function Wt(n){const e=de(n);return e.Ee||(e.Ee=nm(e,ur(n))),e.Ee}function nm(n,e){if(n.limitType==="F")return ml(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const o=s.dir==="desc"?"asc":"desc";return new is(s.field,o)});const t=n.endAt?new yr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new yr(n.startAt.position,n.startAt.inclusive):null;return ml(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function _o(n,e){const t=n.filters.concat([e]);return new $n(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function rm(n,e){const t=n.explicitOrderBy.concat([e]);return new $n(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function oi(n,e,t){return new $n(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function sm(n,e){return new $n(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function wi(n,e){return $o(Wt(n),Wt(e))&&n.limitType===e.limitType}function Qc(n){return`${Bo(Wt(n))}|lt:${n.limitType}`}function or(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>Hc(s)).join(", ")}]`),bi(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(l){return`${l.field.canonicalString()} (${l.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>br(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>br(s)).join(",")),`Target(${r})`}(Wt(n))}; limitType=${n.limitType})`}function vi(n,e){return e.isFoundDocument()&&function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):re.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)}(n,e)&&function(r,s){for(const o of ur(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(l,u,h){const f=hl(l,u,h);return l.inclusive?f<=0:f<0}(r.startAt,ur(r),s)||r.endAt&&!function(l,u,h){const f=hl(l,u,h);return l.inclusive?f>=0:f>0}(r.endAt,ur(r),s))}(n,e)}function im(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Yc(n){return(e,t)=>{let r=!1;for(const s of ur(n)){const o=om(s,e,t);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function om(n,e,t){const r=n.field.isKeyField()?re.comparator(e.key,t.key):function(o,l,u){const h=l.data.field(o),f=u.data.field(o);return h!==null&&f!==null?xr(h,f):ce(42886)}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return ce(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Bn(this.inner,(t,r)=>{for(const[s,o]of r)e(s,o)})}isEmpty(){return Pc(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const am=new Le(re.comparator);function nn(){return am}const Jc=new Le(re.comparator);function qr(...n){let e=Jc;for(const t of n)e=e.insert(t.key,t);return e}function Xc(n){let e=Jc;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Vn(){return Yr()}function Zc(){return Yr()}function Yr(){return new Un(n=>n.toString(),(n,e)=>n.isEqual(e))}const lm=new Le(re.comparator),cm=new Ke(re.comparator);function ge(...n){let e=cm;for(const t of n)e=e.add(t);return e}const um=new Ke(pe);function dm(){return um}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qo(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ni(e)?"-0":e}}function eu(n){return{integerValue:""+n}}function hm(n,e){return Df(e)?eu(e):qo(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(){this._=void 0}}function fm(n,e,t){return n instanceof ai?function(s,o){const l={fields:{[Mc]:{stringValue:Dc},[Oc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&yi(o)&&(o=_i(o)),o&&(l.fields[Lc]=o),{mapValue:l}}(t,e):n instanceof os?nu(n,e):n instanceof as?ru(n,e):function(s,o){const l=tu(s,o),u=gl(l)+gl(s.Ae);return xo(l)&&xo(s.Ae)?eu(u):qo(s.serializer,u)}(n,e)}function mm(n,e,t){return n instanceof os?nu(n,e):n instanceof as?ru(n,e):t}function tu(n,e){return n instanceof li?function(r){return xo(r)||function(o){return!!o&&"doubleValue"in o}(r)}(e)?e:{integerValue:0}:null}class ai extends ki{}class os extends ki{constructor(e){super(),this.elements=e}}function nu(n,e){const t=su(e);for(const r of n.elements)t.some(s=>Qt(s,r))||t.push(r);return{arrayValue:{values:t}}}class as extends ki{constructor(e){super(),this.elements=e}}function ru(n,e){let t=su(e);for(const r of n.elements)t=t.filter(s=>!Qt(s,r));return{arrayValue:{values:t}}}class li extends ki{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function gl(n){return Fe(n.integerValue||n.doubleValue)}function su(n){return Fo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function pm(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof os&&s instanceof os||r instanceof as&&s instanceof as?pr(r.elements,s.elements,Qt):r instanceof li&&s instanceof li?Qt(r.Ae,s.Ae):r instanceof ai&&s instanceof ai}(n.transform,e.transform)}class gm{constructor(e,t){this.version=e,this.transformResults=t}}class Ht{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ht}static exists(e){return new Ht(void 0,e)}static updateTime(e){return new Ht(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Ei{}function iu(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new zo(n.key,Ht.none()):new us(n.key,n.data,Ht.none());{const t=n.data,r=vt.empty();let s=new Ke(et.comparator);for(let o of e.fields)if(!s.has(o)){let l=t.field(o);l===null&&o.length>1&&(o=o.popLast(),l=t.field(o)),l===null?r.delete(o):r.set(o,l),s=s.add(o)}return new qn(n.key,r,new jt(s.toArray()),Ht.none())}}function xm(n,e,t){n instanceof us?function(s,o,l){const u=s.value.clone(),h=bl(s.fieldTransforms,o,l.transformResults);u.setAll(h),o.convertToFoundDocument(l.version,u).setHasCommittedMutations()}(n,e,t):n instanceof qn?function(s,o,l){if(!Hs(s.precondition,o))return void o.convertToUnknownDocument(l.version);const u=bl(s.fieldTransforms,o,l.transformResults),h=o.data;h.setAll(ou(s)),h.setAll(u),o.convertToFoundDocument(l.version,h).setHasCommittedMutations()}(n,e,t):function(s,o,l){o.convertToNoDocument(l.version).setHasCommittedMutations()}(0,e,t)}function Jr(n,e,t,r){return n instanceof us?function(o,l,u,h){if(!Hs(o.precondition,l))return u;const f=o.value.clone(),m=yl(o.fieldTransforms,h,l);return f.setAll(m),l.convertToFoundDocument(l.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof qn?function(o,l,u,h){if(!Hs(o.precondition,l))return u;const f=yl(o.fieldTransforms,h,l),m=l.data;return m.setAll(ou(o)),m.setAll(f),l.convertToFoundDocument(l.version,m).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(g=>g.field))}(n,e,t,r):function(o,l,u){return Hs(o.precondition,l)?(l.convertToNoDocument(l.version).setHasLocalMutations(),null):u}(n,e,t)}function bm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),o=tu(r.transform,s||null);o!=null&&(t===null&&(t=vt.empty()),t.set(r.field,o))}return t||null}function xl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&pr(r,s,(o,l)=>pm(o,l))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class us extends Ei{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class qn extends Ei{constructor(e,t,r,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function ou(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function bl(n,e,t){const r=new Map;ve(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let s=0;s<t.length;s++){const o=n[s],l=o.transform,u=e.data.field(o.field);r.set(o.field,mm(l,u,t[s]))}return r}function yl(n,e,t){const r=new Map;for(const s of n){const o=s.transform,l=t.data.field(s.field);r.set(s.field,fm(o,l,e))}return r}class zo extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ym extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _m{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&xm(o,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Jr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Jr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Zc();return this.mutations.forEach(s=>{const o=e.get(s.key),l=o.overlayedDocument;let u=this.applyToLocalView(l,o.mutatedFields);u=t.has(s.key)?null:u;const h=iu(l,u);h!==null&&r.set(s.key,h),l.isValidDocument()||l.convertToNoDocument(ue.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ge())}isEqual(e){return this.batchId===e.batchId&&pr(this.mutations,e.mutations,(t,r)=>xl(t,r))&&pr(this.baseMutations,e.baseMutations,(t,r)=>xl(t,r))}}class Wo{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){ve(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return lm}();const o=e.mutations;for(let l=0;l<o.length;l++)s=s.insert(o[l].key,r[l].version);return new Wo(e,t,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ue,be;function km(n){switch(n){case P.OK:return ce(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return ce(15467,{code:n})}}function au(n){if(n===void 0)return tn("GRPC error has no .code"),P.UNKNOWN;switch(n){case Ue.OK:return P.OK;case Ue.CANCELLED:return P.CANCELLED;case Ue.UNKNOWN:return P.UNKNOWN;case Ue.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case Ue.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case Ue.INTERNAL:return P.INTERNAL;case Ue.UNAVAILABLE:return P.UNAVAILABLE;case Ue.UNAUTHENTICATED:return P.UNAUTHENTICATED;case Ue.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case Ue.NOT_FOUND:return P.NOT_FOUND;case Ue.ALREADY_EXISTS:return P.ALREADY_EXISTS;case Ue.PERMISSION_DENIED:return P.PERMISSION_DENIED;case Ue.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case Ue.ABORTED:return P.ABORTED;case Ue.OUT_OF_RANGE:return P.OUT_OF_RANGE;case Ue.UNIMPLEMENTED:return P.UNIMPLEMENTED;case Ue.DATA_LOSS:return P.DATA_LOSS;default:return ce(39323,{code:n})}}(be=Ue||(Ue={}))[be.OK=0]="OK",be[be.CANCELLED=1]="CANCELLED",be[be.UNKNOWN=2]="UNKNOWN",be[be.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",be[be.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",be[be.NOT_FOUND=5]="NOT_FOUND",be[be.ALREADY_EXISTS=6]="ALREADY_EXISTS",be[be.PERMISSION_DENIED=7]="PERMISSION_DENIED",be[be.UNAUTHENTICATED=16]="UNAUTHENTICATED",be[be.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",be[be.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",be[be.ABORTED=10]="ABORTED",be[be.OUT_OF_RANGE=11]="OUT_OF_RANGE",be[be.UNIMPLEMENTED=12]="UNIMPLEMENTED",be[be.INTERNAL=13]="INTERNAL",be[be.UNAVAILABLE=14]="UNAVAILABLE",be[be.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Em(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm=new pn([4294967295,4294967295],0);function _l(n){const e=Em().encode(n),t=new vc;return t.update(e),new Uint8Array(t.digest())}function wl(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new pn([t,r],0),new pn([s,o],0)]}class Ho{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new zr(`Invalid padding: ${t}`);if(r<0)throw new zr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new zr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new zr(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=pn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(pn.fromNumber(r)));return s.compare(Tm)===1&&(s=new pn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=_l(e),[r,s]=wl(t);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);if(!this.we(l))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),l=new Ho(o,s,t);return r.forEach(u=>l.insert(u)),l}insert(e){if(this.ge===0)return;const t=_l(e),[r,s]=wl(t);for(let o=0;o<this.hashCount;o++){const l=this.ye(r,s,o);this.be(l)}}be(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class zr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e,t,r,s,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,ds.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Ti(ue.min(),s,new Le(pe),nn(),ge())}}class ds{constructor(e,t,r,s,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new ds(r,t,ge(),ge(),ge())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,t,r,s){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=s}}class lu{constructor(e,t){this.targetId=e,this.Ce=t}}class cu{constructor(e,t,r=tt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class vl{constructor(){this.ve=0,this.Fe=kl(),this.Me=tt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ge(),t=ge(),r=ge();return this.Fe.forEach((s,o)=>{switch(o){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:ce(38017,{changeType:o})}}),new ds(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=kl()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ve(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Im{constructor(e){this.Ge=e,this.ze=new Map,this.je=nn(),this.He=Ds(),this.Je=Ds(),this.Ze=new Le(pe)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ce(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((r,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const o=s.target;if(yo(o))if(r===0){const l=new re(o.path);this.et(t,l,it.newNoDocument(l,ue.min()))}else ve(r===1,20013,{expectedCount:r});else{const l=this._t(t);if(l!==r){const u=this.ut(e),h=u?this.ct(u,e,l):1;if(h!==0){this.it(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=t;let l,u;try{l=wn(r).toUint8Array()}catch(h){if(h instanceof Vc)return Ln("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Ho(l,s,o)}catch(h){return Ln(h instanceof zr?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach(o=>{const l=this.Ge.ht(),u=`projects/${l.projectId}/databases/${l.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((o,l)=>{const u=this.ot(l);if(u){if(o.current&&yo(u.target)){const h=new re(u.target.path);this.It(h).has(l)||this.Et(l,h)||this.et(l,h,it.newNoDocument(h,e))}o.Be&&(t.set(l,o.ke()),o.Ke())}});let r=ge();this.Je.forEach((o,l)=>{let u=!0;l.forEachWhile(h=>{const f=this.ot(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.je.forEach((o,l)=>l.setReadTime(e));const s=new Ti(e,t,this.Ze,this.je,r);return this.je=nn(),this.He=Ds(),this.Je=Ds(),this.Ze=new Le(pe),s}Ye(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.qe(t,1):s.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new vl,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Ke(pe),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Ke(pe),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||J("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new vl),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ds(){return new Le(re.comparator)}function kl(){return new Le(re.comparator)}const Am={asc:"ASCENDING",desc:"DESCENDING"},Cm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Nm={and:"AND",or:"OR"};class Rm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function wo(n,e){return n.useProto3Json||bi(e)?e:{value:e}}function ci(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function uu(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Sm(n,e){return ci(n,e.toTimestamp())}function Gt(n){return ve(!!n,49232),ue.fromTimestamp(function(t){const r=_n(t);return new Se(r.seconds,r.nanos)}(n))}function Go(n,e){return vo(n,e).canonicalString()}function vo(n,e){const t=function(s){return new Ae(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function du(n){const e=Ae.fromString(n);return ve(gu(e),10190,{key:e.toString()}),e}function ko(n,e){return Go(n.databaseId,e.path)}function Ji(n,e){const t=du(e);if(t.get(1)!==n.databaseId.projectId)throw new W(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new W(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new re(fu(t))}function hu(n,e){return Go(n.databaseId,e)}function jm(n){const e=du(n);return e.length===4?Ae.emptyPath():fu(e)}function Eo(n){return new Ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fu(n){return ve(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function El(n,e,t){return{name:ko(n,e),fields:t.value.mapValue.fields}}function Pm(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:ce(39313,{state:f})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],o=function(f,m){return f.useProto3Json?(ve(m===void 0||typeof m=="string",58123),tt.fromBase64String(m||"")):(ve(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),tt.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),l=e.targetChange.cause,u=l&&function(f){const m=f.code===void 0?P.UNKNOWN:au(f.code);return new W(m,f.message||"")}(l);t=new cu(r,s,o,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ji(n,r.document.name),o=Gt(r.document.updateTime),l=r.document.createTime?Gt(r.document.createTime):ue.min(),u=new vt({mapValue:{fields:r.document.fields}}),h=it.newFoundDocument(s,o,l,u),f=r.targetIds||[],m=r.removedTargetIds||[];t=new Gs(f,m,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ji(n,r.document),o=r.readTime?Gt(r.readTime):ue.min(),l=it.newNoDocument(s,o),u=r.removedTargetIds||[];t=new Gs([],u,l.key,l)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ji(n,r.document),o=r.removedTargetIds||[];t=new Gs([],o,s,null)}else{if(!("filter"in e))return ce(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,l=new vm(s,o),u=r.targetId;t=new lu(u,l)}}return t}function Vm(n,e){let t;if(e instanceof us)t={update:El(n,e.key,e.value)};else if(e instanceof zo)t={delete:ko(n,e.key)};else if(e instanceof qn)t={update:El(n,e.key,e.data),updateMask:qm(e.fieldMask)};else{if(!(e instanceof ym))return ce(16599,{dt:e.type});t={verify:ko(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(o,l){const u=l.transform;if(u instanceof ai)return{fieldPath:l.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof os)return{fieldPath:l.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof as)return{fieldPath:l.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof li)return{fieldPath:l.field.canonicalString(),increment:u.Ae};throw ce(20930,{transform:l.transform})}(0,r))),e.precondition.isNone||(t.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Sm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:ce(27497)}(n,e.precondition)),t}function Dm(n,e){return n&&n.length>0?(ve(e!==void 0,14353),n.map(t=>function(s,o){let l=s.updateTime?Gt(s.updateTime):Gt(o);return l.isEqual(ue.min())&&(l=Gt(o)),new gm(l,s.transformResults||[])}(t,e))):[]}function Mm(n,e){return{documents:[hu(n,e.path)]}}function Lm(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=hu(n,s);const o=function(f){if(f.length!==0)return pu(Vt.create(f,"and"))}(e.filters);o&&(t.structuredQuery.where=o);const l=function(f){if(f.length!==0)return f.map(m=>function(E){return{field:ar(E.field),direction:Bm(E.dir)}}(m))}(e.orderBy);l&&(t.structuredQuery.orderBy=l);const u=wo(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(f){return{before:f.inclusive,values:f.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(f){return{before:!f.inclusive,values:f.position}}(e.endAt)),{ft:t,parent:s}}function Om(n){let e=jm(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){ve(r===1,65062);const m=t.from[0];m.allDescendants?s=m.collectionId:e=e.child(m.collectionId)}let o=[];t.where&&(o=function(g){const E=mu(g);return E instanceof Vt&&zc(E)?E.getFilters():[E]}(t.where));let l=[];t.orderBy&&(l=function(g){return g.map(E=>function(j){return new is(lr(j.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(E))}(t.orderBy));let u=null;t.limit&&(u=function(g){let E;return E=typeof g=="object"?g.value:g,bi(E)?null:E}(t.limit));let h=null;t.startAt&&(h=function(g){const E=!!g.before,C=g.values||[];return new yr(C,E)}(t.startAt));let f=null;return t.endAt&&(f=function(g){const E=!g.before,C=g.values||[];return new yr(C,E)}(t.endAt)),em(e,s,l,o,u,"F",h,f)}function Fm(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ce(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function mu(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=lr(t.unaryFilter.field);return qe.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=lr(t.unaryFilter.field);return qe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=lr(t.unaryFilter.field);return qe.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const l=lr(t.unaryFilter.field);return qe.create(l,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ce(61313);default:return ce(60726)}}(n):n.fieldFilter!==void 0?function(t){return qe.create(lr(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ce(58110);default:return ce(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Vt.create(t.compositeFilter.filters.map(r=>mu(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ce(1026)}}(t.compositeFilter.op))}(n):ce(30097,{filter:n})}function Bm(n){return Am[n]}function $m(n){return Cm[n]}function Um(n){return Nm[n]}function ar(n){return{fieldPath:n.canonicalString()}}function lr(n){return et.fromServerFormat(n.fieldPath)}function pu(n){return n instanceof qe?function(t){if(t.op==="=="){if(dl(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NAN"}};if(ul(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(dl(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NOT_NAN"}};if(ul(t.value))return{unaryFilter:{field:ar(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ar(t.field),op:$m(t.op),value:t.value}}}(n):n instanceof Vt?function(t){const r=t.getFilters().map(s=>pu(s));return r.length===1?r[0]:{compositeFilter:{op:Um(t.op),filters:r}}}(n):ce(54877,{filter:n})}function qm(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function gu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function xu(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,t,r,s,o=ue.min(),l=ue.min(),u=tt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=l,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new hn(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new hn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{constructor(e){this.yt=e}}function Wm(n){const e=Om({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?oi(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hm{constructor(){this.Sn=new Gm}addToCollectionParentIndex(e,t){return this.Sn.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}deleteAllFieldIndexes(e){return D.resolve()}createTargetIndexes(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(yn.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(yn.min())}updateCollectionGroup(e,t,r){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class Gm{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new Ke(Ae.comparator),o=!s.has(r);return this.index[t]=s.add(r),o}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Ke(Ae.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bu=41943040;class mt{static withCacheSize(e){return new mt(e,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mt.DEFAULT_COLLECTION_PERCENTILE=10,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mt.DEFAULT=new mt(bu,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mt.DISABLED=new mt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _r{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new _r(0)}static ar(){return new _r(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Il="LruGarbageCollector",Km=1048576;function Al([n,e],[t,r]){const s=pe(n,t);return s===0?pe(e,r):s}class Qm{constructor(e){this.Pr=e,this.buffer=new Ke(Al),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Al(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ym{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){J(Il,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Tr(t)?J(Il,"Ignoring IndexedDB error during garbage collection: ",t):await Er(t)}await this.Ar(3e5)})}}class Jm{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return D.resolve(xi.ce);const r=new Qm(t);return this.Vr.forEachTarget(e,s=>r.Er(s.sequenceNumber)).next(()=>this.Vr.mr(e,s=>r.Er(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(J("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(Tl)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(J("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Tl):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,s,o,l,u,h,f;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(J("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,l=Date.now(),this.nthSequenceNumber(e,s))).next(g=>(r=g,u=Date.now(),this.removeTargets(e,r,t))).next(g=>(o=g,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(g=>(f=Date.now(),ir()<=ye.DEBUG&&J("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${l-m}ms
	Determined least recently used ${s} in `+(u-l)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${g} documents in `+(f-h)+`ms
Total Duration: ${f-m}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:g})))}}function Xm(n,e){return new Jm(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(){this.changes=new Un(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,it.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?D.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Jr(r.mutation,s,jt.empty(),Se.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ge()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ge()){const s=Vn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(o=>{let l=qr();return o.forEach((u,h)=>{l=l.insert(u,h.overlayedDocument)}),l}))}getOverlayedDocuments(e,t){const r=Vn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ge()))}populateOverlays(e,t,r){const s=[];return r.forEach(o=>{t.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(e,s).next(o=>{o.forEach((l,u)=>{t.set(l,u)})})}computeViews(e,t,r,s){let o=nn();const l=Yr(),u=function(){return Yr()}();return t.forEach((h,f)=>{const m=r.get(f.key);s.has(f.key)&&(m===void 0||m.mutation instanceof qn)?o=o.insert(f.key,f):m!==void 0?(l.set(f.key,m.mutation.getFieldMask()),Jr(m.mutation,f,m.mutation.getFieldMask(),Se.now())):l.set(f.key,jt.empty())}),this.recalculateAndSaveOverlays(e,o).next(h=>(h.forEach((f,m)=>l.set(f,m)),t.forEach((f,m)=>u.set(f,new e0(m,l.get(f)??null))),u))}recalculateAndSaveOverlays(e,t){const r=Yr();let s=new Le((l,u)=>l-u),o=ge();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(l=>{for(const u of l)u.keys().forEach(h=>{const f=t.get(h);if(f===null)return;let m=r.get(h)||jt.empty();m=u.applyToLocalView(f,m),r.set(h,m);const g=(s.get(u.batchId)||ge()).add(h);s=s.insert(u.batchId,g)})}).next(()=>{const l=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),f=h.key,m=h.value,g=Zc();m.forEach(E=>{if(!o.has(E)){const C=iu(t.get(E),r.get(E));C!==null&&g.set(E,C),o=o.add(E)}}),l.push(this.documentOverlayCache.saveOverlays(e,f,g))}return D.waitFor(l)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return tm(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Uo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(o=>{const l=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-o.size):D.resolve(Vn());let u=ts,h=o;return l.next(f=>D.forEach(f,(m,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),o.get(m)?D.resolve():this.remoteDocumentCache.getEntry(e,m).next(E=>{h=h.insert(m,E)}))).next(()=>this.populateOverlays(e,f,o)).next(()=>this.computeViews(e,h,f,ge())).next(m=>({batchId:u,changes:Xc(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new re(t)).next(r=>{let s=qr();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const o=t.collectionGroup;let l=qr();return this.indexManager.getCollectionParents(e,o).next(u=>D.forEach(u,h=>{const f=function(g,E){return new $n(E,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,h.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,r,s).next(m=>{m.forEach((g,E)=>{l=l.insert(g,E)})})}).next(()=>l))}getDocumentsMatchingCollectionQuery(e,t,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(l=>(o=l,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,s))).next(l=>{o.forEach((h,f)=>{const m=f.getKey();l.get(m)===null&&(l=l.insert(m,it.newInvalidDocument(m)))});let u=qr();return l.forEach((h,f)=>{const m=o.get(h);m!==void 0&&Jr(m.mutation,f,jt.empty(),Se.now()),vi(t,f)&&(u=u.insert(h,f))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return D.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:Gt(s.createTime)}}(t)),D.resolve()}getNamedQuery(e,t){return D.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,function(s){return{name:s.name,query:Wm(s.bundledQuery),readTime:Gt(s.readTime)}}(t)),D.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(){this.overlays=new Le(re.comparator),this.Lr=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Vn();return D.forEach(t,s=>this.getOverlay(e,s).next(o=>{o!==null&&r.set(s,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,o)=>{this.bt(e,t,o)}),D.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Lr.get(r);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Lr.delete(r)),D.resolve()}getOverlaysForCollection(e,t,r){const s=Vn(),o=t.length+1,l=new re(t.child("")),u=this.overlays.getIteratorFrom(l);for(;u.hasNext();){const h=u.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return D.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let o=new Le((f,m)=>f-m);const l=this.overlays.getIterator();for(;l.hasNext();){const f=l.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let m=o.get(f.largestBatchId);m===null&&(m=Vn(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const u=Vn(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,m)=>u.set(f,m)),!(u.size()>=s)););return D.resolve(u)}bt(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const l=this.Lr.get(s.largestBatchId).delete(r.key);this.Lr.set(s.largestBatchId,l)}this.overlays=this.overlays.insert(r.key,new wm(t,r));let o=this.Lr.get(t);o===void 0&&(o=ge(),this.Lr.set(t,o)),this.Lr.set(t,o.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s0{constructor(){this.sessionToken=tt.EMPTY_BYTE_STRING}getSessionToken(e){return D.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,D.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(){this.kr=new Ke(Je.Kr),this.qr=new Ke(Je.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const r=new Je(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new Je(e,t))}Qr(e,t){e.forEach(r=>this.removeReference(r,t))}Gr(e){const t=new re(new Ae([])),r=new Je(t,e),s=new Je(t,e+1),o=[];return this.qr.forEachInRange([r,s],l=>{this.Wr(l),o.push(l.key)}),o}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new re(new Ae([])),r=new Je(t,e),s=new Je(t,e+1);let o=ge();return this.qr.forEachInRange([r,s],l=>{o=o.add(l.key)}),o}containsKey(e){const t=new Je(e,0),r=this.kr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Je{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return re.comparator(e.key,t.key)||pe(e.Hr,t.Hr)}static Ur(e,t){return pe(e.Hr,t.Hr)||re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Ke(Je.Kr)}checkEmpty(e){return D.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const l=new _m(o,t,r,s);this.mutationQueue.push(l);for(const u of s)this.Jr=this.Jr.add(new Je(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return D.resolve(l)}lookupMutationBatch(e,t){return D.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Xr(r),o=s<0?0:s;return D.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(this.mutationQueue.length===0?Oo:this.Yn-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Je(t,0),s=new Je(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([r,s],l=>{const u=this.Zr(l.Hr);o.push(u)}),D.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ke(pe);return t.forEach(s=>{const o=new Je(s,0),l=new Je(s,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,l],u=>{r=r.add(u.Hr)})}),D.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let o=r;re.isDocumentKey(o)||(o=o.child(""));const l=new Je(new re(o),0);let u=new Ke(pe);return this.Jr.forEachWhile(h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===s&&(u=u.add(h.Hr)),!0)},l),D.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach(r=>{const s=this.Zr(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ve(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Jr;return D.forEach(t.mutations,s=>{const o=new Je(s.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){const r=new Je(t,0),s=this.Jr.firstAfterOrEqual(r);return D.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,D.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(e){this.ti=e,this.docs=function(){return new Le(re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),o=s?s.size:0,l=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:l}),this.size+=l-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return D.resolve(r?r.document.mutableCopy():it.newInvalidDocument(t))}getEntries(e,t){let r=nn();return t.forEach(s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():it.newInvalidDocument(s))}),D.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let o=nn();const l=t.path,u=new re(l.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:f,value:{document:m}}=h.getNext();if(!l.isPrefixOf(f.path))break;f.path.length>l.length+1||Sf(Rf(m),r)<=0||(s.has(m.key)||vi(t,m))&&(o=o.insert(m.key,m.mutableCopy()))}return D.resolve(o)}getAllFromCollectionGroup(e,t,r,s){ce(9500)}ni(e,t){return D.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new a0(this)}getSize(e){return D.resolve(this.size)}}class a0 extends Zm{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Mr.addEntry(e,s)):this.Mr.removeEntry(r)}),D.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{constructor(e){this.persistence=e,this.ri=new Un(t=>Bo(t),$o),this.lastRemoteSnapshotVersion=ue.min(),this.highestTargetId=0,this.ii=0,this.si=new Ko,this.targetCount=0,this.oi=_r._r()}forEachTarget(e,t){return this.ri.forEach((r,s)=>t(s)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),D.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new _r(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.lr(t),D.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,r){let s=0;const o=[];return this.ri.forEach((l,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ri.delete(l),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),s++)}),D.waitFor(o).next(()=>s)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const r=this.ri.get(t)||null;return D.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),D.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach(l=>{o.push(s.markPotentiallyOrphaned(e,l))}),D.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),D.resolve()}getMatchingKeysForTargetId(e,t){const r=this.si.jr(t);return D.resolve(r)}containsKey(e,t){return D.resolve(this.si.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu{constructor(e,t){this._i={},this.overlays={},this.ai=new xi(0),this.ui=!1,this.ui=!0,this.ci=new s0,this.referenceDelegate=e(this),this.li=new l0(this),this.indexManager=new Hm,this.remoteDocumentCache=function(s){return new o0(s)}(r=>this.referenceDelegate.hi(r)),this.serializer=new zm(t),this.Pi=new n0(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new r0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new i0(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){J("MemoryPersistence","Starting transaction:",e);const s=new c0(this.ai.next());return this.referenceDelegate.Ti(),r(s).next(o=>this.referenceDelegate.Ii(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ei(e,t){return D.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class c0 extends Pf{constructor(e){super(),this.currentSequenceNumber=e}}class Qo{constructor(e){this.persistence=e,this.Ri=new Ko,this.Ai=null}static Vi(e){return new Qo(e)}get di(){if(this.Ai)return this.Ai;throw ce(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),D.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),D.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(s=>this.di.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.di.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.di,r=>{const s=re.fromPath(r);return this.mi(e,s).next(o=>{o||t.removeEntry(s,ue.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(r=>{r?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return D.or([()=>D.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ui{constructor(e,t){this.persistence=e,this.fi=new Un(r=>Mf(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=Xm(this,t)}static Vi(e,t){return new ui(e,t)}Ti(){}Ii(e){return D.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}pr(e){let t=0;return this.mr(e,r=>{t++}).next(()=>t)}mr(e,t){return D.forEach(this.fi,(r,s)=>this.wr(e,r,s).next(o=>o?D.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ni(e,l=>this.wr(e,l,t).next(u=>{u||(r++,o.removeEntry(l,ue.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),D.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),D.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),D.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=zs(e.data.value)),t}wr(e,t,r){return D.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.fi.get(t);return D.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=s}static Es(e,t){let r=ge(),s=ge();for(const o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Yo(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return Jd()?8:Vf(Qd())>0?6:4}()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const o={result:null};return this.gs(e,t).next(l=>{o.result=l}).next(()=>{if(!o.result)return this.ps(e,t,s,r).next(l=>{o.result=l})}).next(()=>{if(o.result)return;const l=new u0;return this.ys(e,t,l).next(u=>{if(o.result=u,this.As)return this.ws(e,t,l,u.size)})}).next(()=>o.result)}ws(e,t,r,s){return r.documentReadCount<this.Vs?(ir()<=ye.DEBUG&&J("QueryEngine","SDK will not create cache indexes for query:",or(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),D.resolve()):(ir()<=ye.DEBUG&&J("QueryEngine","Query:",or(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ds*s?(ir()<=ye.DEBUG&&J("QueryEngine","The SDK decides to create cache indexes for query:",or(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Wt(t))):D.resolve())}gs(e,t){if(pl(t))return D.resolve(null);let r=Wt(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=oi(t,null,"F"),r=Wt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{const l=ge(...o);return this.fs.getDocuments(e,l).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{const f=this.bs(t,u);return this.Ss(t,f,l,h.readTime)?this.gs(e,oi(t,null,"F")):this.Ds(e,f,t,h)}))})))}ps(e,t,r,s){return pl(t)||s.isEqual(ue.min())?D.resolve(null):this.fs.getDocuments(e,r).next(o=>{const l=this.bs(t,o);return this.Ss(t,l,r,s)?D.resolve(null):(ir()<=ye.DEBUG&&J("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),or(t)),this.Ds(e,l,t,Nf(s,ts)).next(u=>u))})}bs(e,t){let r=new Ke(Yc(e));return t.forEach((s,o)=>{vi(e,o)&&(r=r.add(o))}),r}Ss(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}ys(e,t,r){return ir()<=ye.DEBUG&&J("QueryEngine","Using full collection scan to execute query:",or(t)),this.fs.getDocumentsMatchingQuery(e,t,yn.min(),r)}Ds(e,t,r,s){return this.fs.getDocumentsMatchingQuery(e,r,s).next(o=>(t.forEach(l=>{o=o.insert(l.key,l)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jo="LocalStore",h0=3e8;class f0{constructor(e,t,r,s){this.persistence=e,this.Cs=t,this.serializer=s,this.vs=new Le(pe),this.Fs=new Un(o=>Bo(o),$o),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new t0(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}function m0(n,e,t,r){return new f0(n,e,t,r)}async function _u(n,e){const t=de(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(o=>(s=o,t.Os(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{const l=[],u=[];let h=ge();for(const f of s){l.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}for(const f of o){u.push(f.batchId);for(const m of f.mutations)h=h.add(m.key)}return t.localDocuments.getDocuments(r,h).next(f=>({Ns:f,removedBatchIds:l,addedBatchIds:u}))})})}function p0(n,e){const t=de(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return function(u,h,f,m){const g=f.batch,E=g.keys();let C=D.resolve();return E.forEach(j=>{C=C.next(()=>m.getEntry(h,j)).next(L=>{const V=f.docVersions.get(j);ve(V!==null,48541),L.version.compareTo(V)<0&&(g.applyToRemoteDocument(L,f),L.isValidDocument()&&(L.setReadTime(f.commitVersion),m.addEntry(L)))})}),C.next(()=>u.mutationQueue.removeMutationBatch(h,g))}(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=ge();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function wu(n){const e=de(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function g0(n,e){const t=de(n),r=e.snapshotVersion;let s=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const l=t.xs.newChangeBuffer({trackRemovals:!0});s=t.vs;const u=[];e.targetChanges.forEach((m,g)=>{const E=s.get(g);if(!E)return;u.push(t.li.removeMatchingKeys(o,m.removedDocuments,g).next(()=>t.li.addMatchingKeys(o,m.addedDocuments,g)));let C=E.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?C=C.withResumeToken(tt.EMPTY_BYTE_STRING,ue.min()).withLastLimboFreeSnapshotVersion(ue.min()):m.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(m.resumeToken,r)),s=s.insert(g,C),function(L,V,O){return L.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=h0?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0}(E,C,m)&&u.push(t.li.updateTargetData(o,C))});let h=nn(),f=ge();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,m))}),u.push(x0(o,l,e.documentUpdates).next(m=>{h=m.Bs,f=m.Ls})),!r.isEqual(ue.min())){const m=t.li.getLastRemoteSnapshotVersion(o).next(g=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(m)}return D.waitFor(u).next(()=>l.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,h,f)).next(()=>h)}).then(o=>(t.vs=s,o))}function x0(n,e,t){let r=ge(),s=ge();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let l=nn();return t.forEach((u,h)=>{const f=o.get(u);h.isFoundDocument()!==f.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(ue.min())?(e.removeEntry(u,h.readTime),l=l.insert(u,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),l=l.insert(u,h)):J(Jo,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",h.version)}),{Bs:l,Ls:s}})}function b0(n,e){const t=de(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Oo),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function y0(n,e){const t=de(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.li.getTargetData(r,e).next(o=>o?(s=o,D.resolve(s)):t.li.allocateTargetId(r).next(l=>(s=new hn(e,l,"TargetPurposeListen",r.currentSequenceNumber),t.li.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.vs.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.vs=t.vs.insert(r.targetId,r),t.Fs.set(e,r.targetId)),r})}async function To(n,e,t){const r=de(n),s=r.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",o,l=>r.persistence.referenceDelegate.removeTarget(l,s))}catch(l){if(!Tr(l))throw l;J(Jo,`Failed to update sequence numbers for target ${e}: ${l}`)}r.vs=r.vs.remove(e),r.Fs.delete(s.target)}function Cl(n,e,t){const r=de(n);let s=ue.min(),o=ge();return r.persistence.runTransaction("Execute query","readwrite",l=>function(h,f,m){const g=de(h),E=g.Fs.get(m);return E!==void 0?D.resolve(g.vs.get(E)):g.li.getTargetData(f,m)}(r,l,Wt(e)).next(u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.li.getMatchingKeysForTargetId(l,u.targetId).next(h=>{o=h})}).next(()=>r.Cs.getDocumentsMatchingQuery(l,e,t?s:ue.min(),t?o:ge())).next(u=>(_0(r,im(e),u),{documents:u,ks:o})))}function _0(n,e,t){let r=n.Ms.get(e)||ue.min();t.forEach((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.Ms.set(e,r)}class Nl{constructor(){this.activeTargetIds=dm()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class w0{constructor(){this.vo=new Nl,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Nl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rl="ConnectivityMonitor";class Sl{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){J(Rl,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){J(Rl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ms=null;function Io(){return Ms===null?Ms=function(){return 268435456+Math.round(2147483648*Math.random())}():Ms++,"0x"+Ms.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xi="RestConnection",k0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class E0{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${s}`,this.$o=this.databaseId.database===ri?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Wo(e,t,r,s,o){const l=Io(),u=this.Qo(e,t.toUriEncodedString());J(Xi,`Sending RPC '${e}' ${l}:`,u,r);const h={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(h,s,o);const{host:f}=new URL(u),m=Vo(f);return this.zo(e,u,h,r,m).then(g=>(J(Xi,`Received RPC '${e}' ${l}: `,g),g),g=>{throw Ln(Xi,`RPC '${e}' ${l} failed with error: `,g,"url: ",u,"request:",r),g})}jo(e,t,r,s,o,l){return this.Wo(e,t,r,s,o)}Go(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+kr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,o)=>e[o]=s),r&&r.headers.forEach((s,o)=>e[o]=s)}Qo(e,t){const r=k0[e];let s=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(s=`${s}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),s}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T0{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rt="WebChannelConnection",Fr=(n,e,t)=>{n.listen(e,r=>{try{t(r)}catch(s){setTimeout(()=>{throw s},0)}})};class dr extends E0{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!dr.c_){const e=Ic();Fr(e,Tc.STAT_EVENT,t=>{t.stat===mo.PROXY?J(rt,"STAT_EVENT: detected buffering proxy"):t.stat===mo.NOPROXY&&J(rt,"STAT_EVENT: detected no buffering proxy")}),dr.c_=!0}}zo(e,t,r,s,o){const l=Io();return new Promise((u,h)=>{const f=new kc;f.setWithCredentials(!0),f.listenOnce(Ec.COMPLETE,()=>{try{switch(f.getLastErrorCode()){case qs.NO_ERROR:const g=f.getResponseJson();J(rt,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(g)),u(g);break;case qs.TIMEOUT:J(rt,`RPC '${e}' ${l} timed out`),h(new W(P.DEADLINE_EXCEEDED,"Request time out"));break;case qs.HTTP_ERROR:const E=f.getStatus();if(J(rt,`RPC '${e}' ${l} failed with status:`,E,"response text:",f.getResponseText()),E>0){let C=f.getResponseJson();Array.isArray(C)&&(C=C[0]);const j=C==null?void 0:C.error;if(j&&j.status&&j.message){const L=function(O){const $=O.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf($)>=0?$:P.UNKNOWN}(j.status);h(new W(L,j.message))}else h(new W(P.UNKNOWN,"Server responded with status "+f.getStatus()))}else h(new W(P.UNAVAILABLE,"Connection failed."));break;default:ce(9055,{l_:e,streamId:l,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{J(rt,`RPC '${e}' ${l} completed.`)}});const m=JSON.stringify(s);J(rt,`RPC '${e}' ${l} sending request:`,s),f.send(t,"POST",m,r,15)})}T_(e,t,r){const s=Io(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],l=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(u.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=o.join("");J(rt,`Creating RPC '${e}' stream ${s}: ${f}`,u);const m=l.createWebChannel(f,u);this.I_(m);let g=!1,E=!1;const C=new T0({Ho:j=>{E?J(rt,`Not sending because RPC '${e}' stream ${s} is closed:`,j):(g||(J(rt,`Opening RPC '${e}' stream ${s} transport.`),m.open(),g=!0),J(rt,`RPC '${e}' stream ${s} sending:`,j),m.send(j))},Jo:()=>m.close()});return Fr(m,Ur.EventType.OPEN,()=>{E||(J(rt,`RPC '${e}' stream ${s} transport opened.`),C.i_())}),Fr(m,Ur.EventType.CLOSE,()=>{E||(E=!0,J(rt,`RPC '${e}' stream ${s} transport closed`),C.o_(),this.E_(m))}),Fr(m,Ur.EventType.ERROR,j=>{E||(E=!0,Ln(rt,`RPC '${e}' stream ${s} transport errored. Name:`,j.name,"Message:",j.message),C.o_(new W(P.UNAVAILABLE,"The operation could not be completed")))}),Fr(m,Ur.EventType.MESSAGE,j=>{var L;if(!E){const V=j.data[0];ve(!!V,16349);const O=V,$=(O==null?void 0:O.error)||((L=O[0])==null?void 0:L.error);if($){J(rt,`RPC '${e}' stream ${s} received error:`,$);const H=$.status;let Y=function(v){const x=Ue[v];if(x!==void 0)return au(x)}(H),z=$.message;H==="NOT_FOUND"&&z.includes("database")&&z.includes("does not exist")&&z.includes(this.databaseId.database)&&Ln(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),Y===void 0&&(Y=P.INTERNAL,z="Unknown error status: "+H+" with message "+$.message),E=!0,C.o_(new W(Y,z)),m.close()}else J(rt,`RPC '${e}' stream ${s} received:`,V),C.__(V)}}),dr.u_(),setTimeout(()=>{C.s_()},0),C}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Ac()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I0(n){return new dr(n)}function Zi(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(n){return new Rm(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */dr.c_=!1;class vu{constructor(e,t,r=1e3,s=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=s,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&J("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jl="PersistentStream";class ku{constructor(e,t,r,s,o,l,u,h){this.Ci=e,this.b_=r,this.S_=s,this.connection=o,this.authCredentialsProvider=l,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new vu(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(tn(t.toString()),tn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===t&&this.G_(r,s)},r=>{e(()=>{const s=new W(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,t){const r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.H_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return J(jl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(J(jl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class A0 extends ku{constructor(e,t,r,s,o,l){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,l),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=Pm(this.serializer,e),r=function(o){if(!("targetChange"in o))return ue.min();const l=o.targetChange;return l.targetIds&&l.targetIds.length?ue.min():l.readTime?Gt(l.readTime):ue.min()}(e);return this.listener.J_(t,r)}Z_(e){const t={};t.database=Eo(this.serializer),t.addTarget=function(o,l){let u;const h=l.target;if(u=yo(h)?{documents:Mm(o,h)}:{query:Lm(o,h).ft},u.targetId=l.targetId,l.resumeToken.approximateByteSize()>0){u.resumeToken=uu(o,l.resumeToken);const f=wo(o,l.expectedCount);f!==null&&(u.expectedCount=f)}else if(l.snapshotVersion.compareTo(ue.min())>0){u.readTime=ci(o,l.snapshotVersion.toTimestamp());const f=wo(o,l.expectedCount);f!==null&&(u.expectedCount=f)}return u}(this.serializer,e);const r=Fm(this.serializer,e);r&&(t.labels=r),this.K_(t)}X_(e){const t={};t.database=Eo(this.serializer),t.removeTarget=e,this.K_(t)}}class C0 extends ku{constructor(e,t,r,s,o,l){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,l),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return ve(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ve(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ve(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=Dm(e.writeResults,e.commitTime),r=Gt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=Eo(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Vm(this.serializer,r))};this.K_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{}class R0 extends N0{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new W(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Wo(e,vo(t,r),s,o,l)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new W(P.UNKNOWN,o.toString())})}jo(e,t,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,u])=>this.connection.jo(e,vo(t,r),s,l,u,o)).catch(l=>{throw l.name==="FirebaseError"?(l.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new W(P.UNKNOWN,l.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function S0(n,e,t,r){return new R0(n,e,t,r)}class j0{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tn(t),this.aa=!1):J("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On="RemoteStore";class P0{constructor(e,t,r,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo(l=>{r.enqueueAndForget(async()=>{zn(this)&&(J(On,"Restarting streams for network reachability change."),await async function(h){const f=de(h);f.Ea.add(4),await hs(f),f.Va.set("Unknown"),f.Ea.delete(4),await Ai(f)}(this))})}),this.Va=new j0(r,s)}}async function Ai(n){if(zn(n))for(const e of n.Ra)await e(!0)}async function hs(n){for(const e of n.Ra)await e(!1)}function Eu(n,e){const t=de(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),ta(t)?ea(t):Ir(t).O_()&&Zo(t,e))}function Xo(n,e){const t=de(n),r=Ir(t);t.Ia.delete(e),r.O_()&&Tu(t,e),t.Ia.size===0&&(r.O_()?r.L_():zn(t)&&t.Va.set("Unknown"))}function Zo(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ue.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ir(n).Z_(e)}function Tu(n,e){n.da.$e(e),Ir(n).X_(e)}function ea(n){n.da=new Im({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Ir(n).start(),n.Va.ua()}function ta(n){return zn(n)&&!Ir(n).x_()&&n.Ia.size>0}function zn(n){return de(n).Ea.size===0}function Iu(n){n.da=void 0}async function V0(n){n.Va.set("Online")}async function D0(n){n.Ia.forEach((e,t)=>{Zo(n,e)})}async function M0(n,e){Iu(n),ta(n)?(n.Va.ha(e),ea(n)):n.Va.set("Unknown")}async function L0(n,e,t){if(n.Va.set("Online"),e instanceof cu&&e.state===2&&e.cause)try{await async function(s,o){const l=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,l),s.Ia.delete(u),s.da.removeTarget(u))}(n,e)}catch(r){J(On,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await di(n,r)}else if(e instanceof Gs?n.da.Xe(e):e instanceof lu?n.da.st(e):n.da.tt(e),!t.isEqual(ue.min()))try{const r=await wu(n.localStore);t.compareTo(r)>=0&&await function(o,l){const u=o.da.Tt(l);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=o.Ia.get(f);m&&o.Ia.set(f,m.withResumeToken(h.resumeToken,l))}}),u.targetMismatches.forEach((h,f)=>{const m=o.Ia.get(h);if(!m)return;o.Ia.set(h,m.withResumeToken(tt.EMPTY_BYTE_STRING,m.snapshotVersion)),Tu(o,h);const g=new hn(m.target,h,f,m.sequenceNumber);Zo(o,g)}),o.remoteSyncer.applyRemoteEvent(u)}(n,t)}catch(r){J(On,"Failed to raise snapshot:",r),await di(n,r)}}async function di(n,e,t){if(!Tr(e))throw e;n.Ea.add(1),await hs(n),n.Va.set("Offline"),t||(t=()=>wu(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{J(On,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ai(n)})}function Au(n,e){return e().catch(t=>di(n,t,e))}async function Ci(n){const e=de(n),t=kn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Oo;for(;O0(e);)try{const s=await b0(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,F0(e,s)}catch(s){await di(e,s)}Cu(e)&&Nu(e)}function O0(n){return zn(n)&&n.Ta.length<10}function F0(n,e){n.Ta.push(e);const t=kn(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Cu(n){return zn(n)&&!kn(n).x_()&&n.Ta.length>0}function Nu(n){kn(n).start()}async function B0(n){kn(n).ra()}async function $0(n){const e=kn(n);for(const t of n.Ta)e.ea(t.mutations)}async function U0(n,e,t){const r=n.Ta.shift(),s=Wo.from(r,e,t);await Au(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Ci(n)}async function q0(n,e){e&&kn(n).Y_&&await async function(r,s){if(function(l){return km(l)&&l!==P.ABORTED}(s.code)){const o=r.Ta.shift();kn(r).B_(),await Au(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),await Ci(r)}}(n,e),Cu(n)&&Nu(n)}async function Pl(n,e){const t=de(n);t.asyncQueue.verifyOperationInProgress(),J(On,"RemoteStore received new credentials");const r=zn(t);t.Ea.add(3),await hs(t),r&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ai(t)}async function z0(n,e){const t=de(n);e?(t.Ea.delete(2),await Ai(t)):e||(t.Ea.add(2),await hs(t),t.Va.set("Unknown"))}function Ir(n){return n.ma||(n.ma=function(t,r,s){const o=de(t);return o.sa(),new A0(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:V0.bind(null,n),Yo:D0.bind(null,n),t_:M0.bind(null,n),J_:L0.bind(null,n)}),n.Ra.push(async e=>{e?(n.ma.B_(),ta(n)?ea(n):n.Va.set("Unknown")):(await n.ma.stop(),Iu(n))})),n.ma}function kn(n){return n.fa||(n.fa=function(t,r,s){const o=de(t);return o.sa(),new C0(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:B0.bind(null,n),t_:q0.bind(null,n),ta:$0.bind(null,n),na:U0.bind(null,n)}),n.Ra.push(async e=>{e?(n.fa.B_(),await Ci(n)):(await n.fa.stop(),n.Ta.length>0&&(J(On,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,t,r,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new gn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(l=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,o){const l=Date.now()+r,u=new na(e,t,l,s,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new W(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ra(n,e){if(tn("AsyncQueue",`${e}: ${n}`),Tr(n))return new W(P.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{static emptySet(e){return new hr(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||re.comparator(t.key,r.key):(t,r)=>re.comparator(t.key,r.key),this.keyedMap=qr(),this.sortedSet=new Le(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new hr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(){this.ga=new Le(re.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ce(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class wr{constructor(e,t,r,s,o,l,u,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=l,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,s,o){const l=[];return t.forEach(u=>{l.push({type:0,doc:u})}),new wr(e,t,hr.emptySet(t),l,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class H0{constructor(){this.queries=Dl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=de(t),o=s.queries;s.queries=Dl(),o.forEach((l,u)=>{for(const h of u.ba)h.onError(r)})})(this,new W(P.ABORTED,"Firestore shutting down"))}}function Dl(){return new Un(n=>Qc(n),wi)}async function G0(n,e){const t=de(n);let r=3;const s=e.query;let o=t.queries.get(s);o?!o.Sa()&&e.Da()&&(r=2):(o=new W0,r=e.Da()?0:1);try{switch(r){case 0:o.wa=await t.onListen(s,!0);break;case 1:o.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(l){const u=ra(l,`Initialization of query '${or(e.query)}' failed`);return void e.onError(u)}t.queries.set(s,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&sa(t)}async function K0(n,e){const t=de(n),r=e.query;let s=3;const o=t.queries.get(r);if(o){const l=o.ba.indexOf(e);l>=0&&(o.ba.splice(l,1),o.ba.length===0?s=e.Da()?0:1:!o.Sa()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function Q0(n,e){const t=de(n);let r=!1;for(const s of e){const o=s.query,l=t.queries.get(o);if(l){for(const u of l.ba)u.Fa(s)&&(r=!0);l.wa=s}}r&&sa(t)}function Y0(n,e,t){const r=de(n),s=r.queries.get(e);if(s)for(const o of s.ba)o.onError(t);r.queries.delete(e)}function sa(n){n.Ca.forEach(e=>{e.next()})}var Ao,Ml;(Ml=Ao||(Ao={})).Ma="default",Ml.Cache="cache";class J0{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new wr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.Ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=wr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ao.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru{constructor(e){this.key=e}}class Su{constructor(e){this.key=e}}class X0{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ge(),this.mutatedKeys=ge(),this.eu=Yc(e),this.tu=new hr(this.eu)}get nu(){return this.Za}ru(e,t){const r=t?t.iu:new Vl,s=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,l=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,f=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((m,g)=>{const E=s.get(m),C=vi(this.query,g)?g:null,j=!!E&&this.mutatedKeys.has(E.key),L=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let V=!1;E&&C?E.data.isEqual(C.data)?j!==L&&(r.track({type:3,doc:C}),V=!0):this.su(E,C)||(r.track({type:2,doc:C}),V=!0,(h&&this.eu(C,h)>0||f&&this.eu(C,f)<0)&&(u=!0)):!E&&C?(r.track({type:0,doc:C}),V=!0):E&&!C&&(r.track({type:1,doc:E}),V=!0,(h||f)&&(u=!0)),V&&(C?(l=l.add(C),o=L?o.add(m):o.delete(m)):(l=l.delete(m),o=o.delete(m)))}),this.query.limit!==null)for(;l.size>this.query.limit;){const m=this.query.limitType==="F"?l.last():l.first();l=l.delete(m.key),o=o.delete(m.key),r.track({type:1,doc:m})}return{tu:l,iu:r,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const l=e.iu.ya();l.sort((m,g)=>function(C,j){const L=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ce(20277,{Vt:V})}};return L(C)-L(j)}(m.type,g.type)||this.eu(m.doc,g.doc)),this.ou(r),s=s??!1;const u=t&&!s?this._u():[],h=this.Ya.size===0&&this.current&&!s?1:0,f=h!==this.Xa;return this.Xa=h,l.length!==0||f?{snapshot:new wr(this.query,e.tu,o,l,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Vl,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Za=this.Za.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Za=this.Za.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ge(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Ya=this.Ya.add(r.key))});const t=[];return e.forEach(r=>{this.Ya.has(r)||t.push(new Su(r))}),this.Ya.forEach(r=>{e.has(r)||t.push(new Ru(r))}),t}cu(e){this.Za=e.ks,this.Ya=ge();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return wr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ia="SyncEngine";class Z0{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ep{constructor(e){this.key=e,this.hu=!1}}class tp{constructor(e,t,r,s,o,l){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=l,this.Pu={},this.Tu=new Un(u=>Qc(u),wi),this.Iu=new Map,this.Eu=new Set,this.Ru=new Le(re.comparator),this.Au=new Map,this.Vu=new Ko,this.du={},this.mu=new Map,this.fu=_r.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function np(n,e,t=!0){const r=Lu(n);let s;const o=r.Tu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await ju(r,e,t,!0),s}async function rp(n,e){const t=Lu(n);await ju(t,e,!0,!1)}async function ju(n,e,t,r){const s=await y0(n.localStore,Wt(e)),o=s.targetId,l=n.sharedClientState.addLocalQueryTarget(o,t);let u;return r&&(u=await sp(n,e,o,l==="current",s.resumeToken)),n.isPrimaryClient&&t&&Eu(n.remoteStore,s),u}async function sp(n,e,t,r,s){n.pu=(g,E,C)=>async function(L,V,O,$){let H=V.view.ru(O);H.Ss&&(H=await Cl(L.localStore,V.query,!1).then(({documents:v})=>V.view.ru(v,H)));const Y=$&&$.targetChanges.get(V.targetId),z=$&&$.targetMismatches.get(V.targetId)!=null,te=V.view.applyChanges(H,L.isPrimaryClient,Y,z);return Ol(L,V.targetId,te.au),te.snapshot}(n,g,E,C);const o=await Cl(n.localStore,e,!0),l=new X0(e,o.ks),u=l.ru(o.documents),h=ds.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),f=l.applyChanges(u,n.isPrimaryClient,h);Ol(n,t,f.au);const m=new Z0(e,t,l);return n.Tu.set(e,m),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),f.snapshot}async function ip(n,e,t){const r=de(n),s=r.Tu.get(e),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter(l=>!wi(l,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await To(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&Xo(r.remoteStore,s.targetId),Co(r,s.targetId)}).catch(Er)):(Co(r,s.targetId),await To(r.localStore,s.targetId,!0))}async function op(n,e){const t=de(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Xo(t.remoteStore,r.targetId))}async function ap(n,e,t){const r=mp(n);try{const s=await function(l,u){const h=de(l),f=Se.now(),m=u.reduce((C,j)=>C.add(j.key),ge());let g,E;return h.persistence.runTransaction("Locally write mutations","readwrite",C=>{let j=nn(),L=ge();return h.xs.getEntries(C,m).next(V=>{j=V,j.forEach((O,$)=>{$.isValidDocument()||(L=L.add(O))})}).next(()=>h.localDocuments.getOverlayedDocuments(C,j)).next(V=>{g=V;const O=[];for(const $ of u){const H=bm($,g.get($.key).overlayedDocument);H!=null&&O.push(new qn($.key,H,$c(H.value.mapValue),Ht.exists(!0)))}return h.mutationQueue.addMutationBatch(C,f,O,u)}).next(V=>{E=V;const O=V.applyToLocalDocumentSet(g,L);return h.documentOverlayCache.saveOverlays(C,V.batchId,O)})}).then(()=>({batchId:E.batchId,changes:Xc(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(l,u,h){let f=l.du[l.currentUser.toKey()];f||(f=new Le(pe)),f=f.insert(u,h),l.du[l.currentUser.toKey()]=f}(r,s.batchId,t),await fs(r,s.changes),await Ci(r.remoteStore)}catch(s){const o=ra(s,"Failed to persist write");t.reject(o)}}async function Pu(n,e){const t=de(n);try{const r=await g0(t.localStore,e);e.targetChanges.forEach((s,o)=>{const l=t.Au.get(o);l&&(ve(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?l.hu=!0:s.modifiedDocuments.size>0?ve(l.hu,14607):s.removedDocuments.size>0&&(ve(l.hu,42227),l.hu=!1))}),await fs(t,r,e)}catch(r){await Er(r)}}function Ll(n,e,t){const r=de(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach((o,l)=>{const u=l.view.va(e);u.snapshot&&s.push(u.snapshot)}),function(l,u){const h=de(l);h.onlineState=u;let f=!1;h.queries.forEach((m,g)=>{for(const E of g.ba)E.va(u)&&(f=!0)}),f&&sa(h)}(r.eventManager,e),s.length&&r.Pu.J_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function lp(n,e,t){const r=de(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),o=s&&s.key;if(o){let l=new Le(re.comparator);l=l.insert(o,it.newNoDocument(o,ue.min()));const u=ge().add(o),h=new Ti(ue.min(),new Map,new Le(pe),l,u);await Pu(r,h),r.Ru=r.Ru.remove(o),r.Au.delete(e),oa(r)}else await To(r.localStore,e,!1).then(()=>Co(r,e,t)).catch(Er)}async function cp(n,e){const t=de(n),r=e.batch.batchId;try{const s=await p0(t.localStore,e);Du(t,r,null),Vu(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await fs(t,s)}catch(s){await Er(s)}}async function up(n,e,t){const r=de(n);try{const s=await function(l,u){const h=de(l);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,u).next(g=>(ve(g!==null,37113),m=g.keys(),h.mutationQueue.removeMutationBatch(f,g))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(r.localStore,e);Du(r,e,t),Vu(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await fs(r,s)}catch(s){await Er(s)}}function Vu(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Du(n,e,t){const r=de(n);let s=r.du[r.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),r.du[r.currentUser.toKey()]=s}}function Co(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach(r=>{n.Vu.containsKey(r)||Mu(n,r)})}function Mu(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Xo(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),oa(n))}function Ol(n,e,t){for(const r of t)r instanceof Ru?(n.Vu.addReference(r.key,e),dp(n,r)):r instanceof Su?(J(ia,"Document no longer in limbo: "+r.key),n.Vu.removeReference(r.key,e),n.Vu.containsKey(r.key)||Mu(n,r.key)):ce(19791,{wu:r})}function dp(n,e){const t=e.key,r=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(r)||(J(ia,"New document in limbo: "+t),n.Eu.add(r),oa(n))}function oa(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new re(Ae.fromString(e)),r=n.fu.next();n.Au.set(r,new ep(t)),n.Ru=n.Ru.insert(t,r),Eu(n.remoteStore,new hn(Wt(Kc(t.path)),r,"TargetPurposeLimboResolution",xi.ce))}}async function fs(n,e,t){const r=de(n),s=[],o=[],l=[];r.Tu.isEmpty()||(r.Tu.forEach((u,h)=>{l.push(r.pu(h,e,t).then(f=>{var m;if((f||t)&&r.isPrimaryClient){const g=f?!f.fromCache:(m=t==null?void 0:t.targetChanges.get(h.targetId))==null?void 0:m.current;r.sharedClientState.updateQueryState(h.targetId,g?"current":"not-current")}if(f){s.push(f);const g=Yo.Es(h.targetId,f);o.push(g)}}))}),await Promise.all(l),r.Pu.J_(s),await async function(h,f){const m=de(h);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>D.forEach(f,E=>D.forEach(E.Ts,C=>m.persistence.referenceDelegate.addReference(g,E.targetId,C)).next(()=>D.forEach(E.Is,C=>m.persistence.referenceDelegate.removeReference(g,E.targetId,C)))))}catch(g){if(!Tr(g))throw g;J(Jo,"Failed to update sequence numbers: "+g)}for(const g of f){const E=g.targetId;if(!g.fromCache){const C=m.vs.get(E),j=C.snapshotVersion,L=C.withLastLimboFreeSnapshotVersion(j);m.vs=m.vs.insert(E,L)}}}(r.localStore,o))}async function hp(n,e){const t=de(n);if(!t.currentUser.isEqual(e)){J(ia,"User change. New user:",e.toKey());const r=await _u(t.localStore,e);t.currentUser=e,function(o,l){o.mu.forEach(u=>{u.forEach(h=>{h.reject(new W(P.CANCELLED,l))})}),o.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await fs(t,r.Ns)}}function fp(n,e){const t=de(n),r=t.Au.get(e);if(r&&r.hu)return ge().add(r.key);{let s=ge();const o=t.Iu.get(e);if(!o)return s;for(const l of o){const u=t.Tu.get(l);s=s.unionWith(u.view.nu)}return s}}function Lu(n){const e=de(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Pu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=lp.bind(null,e),e.Pu.J_=Q0.bind(null,e.eventManager),e.Pu.yu=Y0.bind(null,e.eventManager),e}function mp(n){const e=de(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=cp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=up.bind(null,e),e}class hi{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ii(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return m0(this.persistence,new d0,e.initialUser,this.serializer)}Cu(e){return new yu(Qo.Vi,this.serializer)}Du(e){return new w0}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hi.provider={build:()=>new hi};class pp extends hi{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ve(this.persistence.referenceDelegate instanceof ui,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Ym(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?mt.withCacheSize(this.cacheSizeBytes):mt.DEFAULT;return new yu(r=>ui.Vi(r,t),this.serializer)}}class No{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ll(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=hp.bind(null,this.syncEngine),await z0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new H0}()}createDatastore(e){const t=Ii(e.databaseInfo.databaseId),r=I0(e.databaseInfo);return S0(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,o,l,u){return new P0(r,s,o,l,u)}(this.localStore,this.datastore,e.asyncQueue,t=>Ll(this.syncEngine,t,0),function(){return Sl.v()?new Sl:new v0}())}createSyncEngine(e,t){return function(s,o,l,u,h,f,m){const g=new tp(s,o,l,u,h,f);return m&&(g.gu=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const o=de(s);J(On,"RemoteStore shutting down."),o.Ea.add(5),await hs(o),o.Aa.shutdown(),o.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}No.provider={build:()=>new No};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const En="FirestoreClient";class xp{constructor(e,t,r,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=s,this.user=st.UNAUTHENTICATED,this.clientId=Lo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,async l=>{J(En,"Received user=",l.uid),await this.authCredentialListener(l),this.user=l}),this.appCheckCredentials.start(r,l=>(J(En,"Received new app check token=",l),this.appCheckCredentialListener(l,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new gn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=ra(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function eo(n,e){n.asyncQueue.verifyOperationInProgress(),J(En,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await _u(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Fl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await bp(n);J(En,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Pl(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Pl(e.remoteStore,s)),n._onlineComponents=e}async function bp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){J(En,"Using user provided OfflineComponentProvider");try{await eo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Ln("Error using user provided cache. Falling back to memory cache: "+t),await eo(n,new hi)}}else J(En,"Using default OfflineComponentProvider"),await eo(n,new pp(void 0));return n._offlineComponents}async function Ou(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(J(En,"Using user provided OnlineComponentProvider"),await Fl(n,n._uninitializedComponentsProvider._online)):(J(En,"Using default OnlineComponentProvider"),await Fl(n,new No))),n._onlineComponents}function yp(n){return Ou(n).then(e=>e.syncEngine)}async function _p(n){const e=await Ou(n),t=e.eventManager;return t.onListen=np.bind(null,e.syncEngine),t.onUnlisten=ip.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=rp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=op.bind(null,e.syncEngine),t}function wp(n,e,t={}){const r=new gn;return n.asyncQueue.enqueueAndForget(async()=>function(o,l,u,h,f){const m=new gp({next:E=>{m.Nu(),l.enqueueAndForget(()=>K0(o,g)),E.fromCache&&h.source==="server"?f.reject(new W(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(E)},error:E=>f.reject(E)}),g=new J0(u,m,{includeMetadataChanges:!0,Ka:!0});return G0(o,g)}(await _p(n),n.asyncQueue,e,t,r)),r.promise}function vp(n,e){const t=new gn;return n.asyncQueue.enqueueAndForget(async()=>ap(await yp(n),e,t)),t.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kp="ComponentProvider",Bl=new Map;function Ep(n,e,t,r,s){return new Ff(n,e,t,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,Fu(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bu="firestore.googleapis.com",$l=!0;class Ul{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new W(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Bu,this.ssl=$l}else this.host=e.host,this.ssl=e.ssl??$l;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=bu;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Km)throw new W(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Af("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Fu(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new W(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new W(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new W(P.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ni{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ul({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new W(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new W(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ul(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new xf;switch(r.type){case"firstParty":return new wf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new W(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Bl.get(t);r&&(J(kp,"Removing Datastore"),Bl.delete(t),r.terminate())}(this),Promise.resolve()}}function Tp(n,e,t,r={}){var f;n=gr(n,Ni);const s=Vo(e),o=n._getSettings(),l={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;s&&(zd(`https://${u}`),Kd("Firestore",!0)),o.host!==Bu&&o.host!==u&&Ln("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Zs(h,l)&&(n._setSettings(h),r.mockUserToken)){let m,g;if(typeof r.mockUserToken=="string")m=r.mockUserToken,g=st.MOCK_USER;else{m=Wd(r.mockUserToken,(f=n._app)==null?void 0:f.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new W(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new st(E)}n._authCredentials=new bf(new Nc(m,g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new rn(this.firestore,e,this._query)}}class Ge{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ge(this.firestore,e,this._key)}toJSON(){return{type:Ge._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(cs(t,Ge._jsonSchema))return new Ge(e,r||null,new re(Ae.fromString(t.referencePath)))}}Ge._jsonSchemaVersion="firestore/documentReference/1.0",Ge._jsonSchema={type:ze("string",Ge._jsonSchemaVersion),referencePath:ze("string")};class xn extends rn{constructor(e,t,r){super(e,t,Kc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ge(this.firestore,null,new re(e))}withConverter(e){return new xn(this.firestore,e,this._path)}}function Ip(n,e,...t){if(n=Dn(n),Rc("collection","path",e),n instanceof Ni){const r=Ae.fromString(e,...t);return nl(r),new xn(n,null,r)}{if(!(n instanceof Ge||n instanceof xn))throw new W(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return nl(r),new xn(n.firestore,null,r)}}function $u(n,e,...t){if(n=Dn(n),arguments.length===1&&(e=Lo.newId()),Rc("doc","path",e),n instanceof Ni){const r=Ae.fromString(e,...t);return tl(r),new Ge(n,null,new re(r))}{if(!(n instanceof Ge||n instanceof xn))throw new W(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Ae.fromString(e,...t));return tl(r),new Ge(n.firestore,n instanceof xn?n.converter:null,new re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ql="AsyncQueue";class zl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new vu(this,"async_queue_retry"),this._c=()=>{const r=Zi();r&&J(ql,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Zi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Zi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new gn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Tr(e))throw e;J(ql,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,tn("INTERNAL UNHANDLED ERROR: ",Wl(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=na.createAndSchedule(this,e,t,r,o=>this.hc(o));return this.tc.push(s),s}uc(){this.nc&&ce(47125,{Pc:Wl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Wl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Ri extends Ni{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new zl,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new zl(e),this._firestoreClient=void 0,await e}}}function Ap(n,e){const t=typeof n=="object"?n:sf(),r=typeof n=="string"?n:ri,s=Zh(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Ud("firestore");o&&Tp(s,...o)}return s}function Uu(n){if(n._terminated)throw new W(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Cp(n),n._firestoreClient}function Cp(n){var r,s,o,l;const e=n._freezeSettings(),t=Ep(n._databaseId,((r=n._app)==null?void 0:r.options.appId)||"",n._persistenceKey,(s=n._app)==null?void 0:s.options.apiKey,e);n._componentsProvider||(o=e.localCache)!=null&&o._offlineComponentProvider&&((l=e.localCache)!=null&&l._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new xp(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(h){const f=h==null?void 0:h._online.build();return{_offline:h==null?void 0:h._offline.build(f),_online:f}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new kt(tt.fromBase64String(e))}catch(t){throw new W(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new kt(tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:kt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cs(e,kt._jsonSchema))return kt.fromBase64String(e.bytes)}}kt._jsonSchemaVersion="firestore/bytes/1.0",kt._jsonSchema={type:ze("string",kt._jsonSchemaVersion),bytes:ze("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new W(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new W(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new W(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return pe(this._lat,e._lat)||pe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Kt._jsonSchemaVersion}}static fromJSON(e){if(cs(e,Kt._jsonSchema))return new Kt(e.latitude,e.longitude)}}Kt._jsonSchemaVersion="firestore/geoPoint/1.0",Kt._jsonSchema={type:ze("string",Kt._jsonSchemaVersion),latitude:ze("number"),longitude:ze("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Pt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cs(e,Pt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new Pt(e.vectorValues);throw new W(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Pt._jsonSchemaVersion="firestore/vectorValue/1.0",Pt._jsonSchema={type:ze("string",Pt._jsonSchemaVersion),vectorValues:ze("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Np=/^__.*__$/;class Rp{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new qn(e,this.data,this.fieldMask,t,this.fieldTransforms):new us(e,this.data,t,this.fieldTransforms)}}function Wu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ce(40011,{dataSource:n})}}class aa{constructor(e,t,r,s,o,l){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=l||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new aa({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){var s;const t=(s=this.path)==null?void 0:s.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return fi(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(Wu(this.dataSource)&&Np.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Sp{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ii(e)}createContext(e,t,r,s=!1){return new aa({dataSource:e,methodName:t,targetDoc:r,path:et.emptyPath(),arrayElement:!1,hasConverter:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function la(n){const e=n._freezeSettings(),t=Ii(n._databaseId);return new Sp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function jp(n,e,t,r,s,o={}){const l=n.createContext(o.merge||o.mergeFields?2:0,e,t,s);Qu("Data must be an object, but it was:",l,r);const u=Gu(r,l);let h,f;if(o.merge)h=new jt(l.fieldMask),f=l.fieldTransforms;else if(o.mergeFields){const m=[];for(const g of o.mergeFields){const E=Si(e,g,t);if(!l.contains(E))throw new W(P.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Dp(m,E)||m.push(E)}h=new jt(m),f=l.fieldTransforms.filter(g=>h.covers(g.field))}else h=null,f=l.fieldTransforms;return new Rp(new vt(u),h,f)}function Hu(n,e,t,r=!1){return ca(t,n.createContext(r?4:3,e))}function ca(n,e){if(Ku(n=Dn(n)))return Qu("Unsupported field value:",e,n),Gu(n,e);if(n instanceof zu)return function(r,s){if(!Wu(s.dataSource))throw s.createError(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.createError(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(r,s){const o=[];let l=0;for(const u of r){let h=ca(u,s.childContextForArray(l));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),l++}return{arrayValue:{values:o}}}(n,e)}return function(r,s){if((r=Dn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return hm(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Se.fromDate(r);return{timestampValue:ci(s.serializer,o)}}if(r instanceof Se){const o=new Se(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ci(s.serializer,o)}}if(r instanceof Kt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof kt)return{bytesValue:uu(s.serializer,r._byteString)};if(r instanceof Ge){const o=s.databaseId,l=r.firestore._databaseId;if(!l.isEqual(o))throw s.createError(`Document reference is for database ${l.projectId}/${l.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Go(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Pt)return function(l,u){const h=l instanceof Pt?l.toArray():l;return{mapValue:{fields:{[Fc]:{stringValue:Bc},[si]:{arrayValue:{values:h.map(m=>{if(typeof m!="number")throw u.createError("VectorValues must only contain numeric values.");return qo(u.serializer,m)})}}}}}}(r,s);if(xu(r))return r._toProto(s.serializer);throw s.createError(`Unsupported field value: ${gi(r)}`)}(n,e)}function Gu(n,e){const t={};return Pc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bn(n,(r,s)=>{const o=ca(s,e.childContextForField(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Ku(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Se||n instanceof Kt||n instanceof kt||n instanceof Ge||n instanceof zu||n instanceof Pt||xu(n))}function Qu(n,e,t){if(!Ku(t)||!Sc(t)){const r=gi(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function Si(n,e,t){if((e=Dn(e))instanceof qu)return e._internalPath;if(typeof e=="string")return Vp(n,e);throw fi("Field path arguments must be of type string or ",n,!1,void 0,t)}const Pp=new RegExp("[~\\*/\\[\\]]");function Vp(n,e,t){if(e.search(Pp)>=0)throw fi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new qu(...e.split("."))._internalPath}catch{throw fi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function fi(n,e,t,r,s){const o=r&&!r.isEmpty(),l=s!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||l)&&(h+=" (found",o&&(h+=` in field ${r}`),l&&(h+=` in document ${s}`),h+=")"),new W(P.INVALID_ARGUMENT,u+n+h)}function Dp(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{convertValue(e,t="none"){switch(vn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Fe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(wn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ce(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Bn(e,(s,o)=>{r[s]=this.convertValue(o,t)}),r}convertVectorValue(e){var r,s,o;const t=(o=(s=(r=e.fields)==null?void 0:r[si].arrayValue)==null?void 0:s.values)==null?void 0:o.map(l=>Fe(l.doubleValue));return new Pt(t)}convertGeoPoint(e){return new Kt(Fe(e.latitude),Fe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=_i(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ns(e));default:return null}}convertTimestamp(e){const t=_n(e);return new Se(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Ae.fromString(e);ve(gu(r),9688,{name:e});const s=new rs(r.get(1),r.get(3)),o=new re(r.popFirst(5));return s.isEqual(t)||tn(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp extends Mp{constructor(e){super(),this.firestore=e}convertBytes(e){return new kt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ge(this.firestore,null,t)}}const Hl="@firebase/firestore",Gl="4.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e,t,r,s,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ge(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Op(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const t=this._document.data.field(Si("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Op extends ua{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fp(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new W(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class da{}class ji extends da{}function Kl(n,e,...t){let r=[];e instanceof da&&r.push(e),r=r.concat(t),function(o){const l=o.filter(h=>h instanceof fa).length,u=o.filter(h=>h instanceof ha).length;if(l>1||l>0&&u>0)throw new W(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class ha extends ji{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ha(e,t,r)}_apply(e){const t=this._parse(e);return Yu(e._query,t),new rn(e.firestore,e.converter,_o(e._query,t))}_parse(e){const t=la(e.firestore);return function(o,l,u,h,f,m,g){let E;if(f.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new W(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Xl(g,m);const j=[];for(const L of g)j.push(Jl(h,o,L));E={arrayValue:{values:j}}}else E=Jl(h,o,g)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Xl(g,m),E=Hu(u,l,g,m==="in"||m==="not-in");return qe.create(f,m,E)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class fa extends da{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new fa(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Vt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,o){let l=s;const u=o.getFlattenedFilters();for(const h of u)Yu(l,h),l=_o(l,h)}(e._query,t),new rn(e.firestore,e.converter,_o(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ma extends ji{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ma(e,t)}_apply(e){const t=function(s,o,l){if(s.startAt!==null)throw new W(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new W(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new is(o,l)}(e._query,this._field,this._direction);return new rn(e.firestore,e.converter,rm(e._query,t))}}function Ql(n,e="asc"){const t=e,r=Si("orderBy",n);return ma._create(r,t)}class pa extends ji{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new pa(e,t,r)}_apply(e){return new rn(e.firestore,e.converter,oi(e._query,this._limit,this._limitType))}}function Yl(n){return Cf("limit",n),pa._create("limit",n,"F")}class ga extends ji{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ga(e,t,r)}_apply(e){const t=$p(e,this.type,this._docOrFields,this._inclusive);return new rn(e.firestore,e.converter,sm(e._query,t))}}function Bp(...n){return ga._create("startAfter",n,!1)}function $p(n,e,t,r){if(t[0]=Dn(t[0]),t[0]instanceof ua)return function(o,l,u,h,f){if(!h)throw new W(P.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const g of ur(o))if(g.field.isKeyField())m.push(ii(l,h.key));else{const E=h.data.field(g.field);if(yi(E))throw new W(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(E===null){const C=g.field.canonicalString();throw new W(P.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${C}' (used as the orderBy) does not exist.`)}m.push(E)}return new yr(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=la(n.firestore);return function(l,u,h,f,m,g){const E=l.explicitOrderBy;if(m.length>E.length)throw new W(P.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const C=[];for(let j=0;j<m.length;j++){const L=m[j];if(E[j].field.isKeyField()){if(typeof L!="string")throw new W(P.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof L}`);if(!Uo(l)&&L.indexOf("/")!==-1)throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${L}' contains a slash.`);const V=l.path.child(Ae.fromString(L));if(!re.isDocumentKey(V))throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const O=new re(V);C.push(ii(u,O))}else{const V=Hu(h,f,L);C.push(V)}}return new yr(C,g)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Jl(n,e,t){if(typeof(t=Dn(t))=="string"){if(t==="")throw new W(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Uo(e)&&t.indexOf("/")!==-1)throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Ae.fromString(t));if(!re.isDocumentKey(r))throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ii(n,new re(r))}if(t instanceof Ge)return ii(n,t._key);throw new W(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gi(t)}.`)}function Xl(n,e){if(!Array.isArray(n)||n.length===0)throw new W(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Yu(n,e){const t=function(s,o){for(const l of s)for(const u of l.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new W(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new W(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Up(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class Ls{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fr extends ua{constructor(e,t,r,s,o,l){super(e,t,r,s,l),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ks(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Si("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new W(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=fr._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}fr._jsonSchemaVersion="firestore/documentSnapshot/1.0",fr._jsonSchema={type:ze("string",fr._jsonSchemaVersion),bundleSource:ze("string","DocumentSnapshot"),bundleName:ze("string"),bundle:ze("string")};class Ks extends fr{data(e={}){return super.data(e)}}class mr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ls(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ks(this._firestore,this._userDataWriter,r.key,r,new Ls(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new W(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,o){if(s._snapshot.oldDocs.isEmpty()){let l=0;return s._snapshot.docChanges.map(u=>{const h=new Ks(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ls(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:l++}})}{let l=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{const h=new Ks(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Ls(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let f=-1,m=-1;return u.type!==0&&(f=l.indexOf(u.doc.key),l=l.delete(u.doc.key)),u.type!==1&&(l=l.add(u.doc),m=l.indexOf(u.doc.key)),{type:qp(u.type),doc:h,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new W(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=mr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Lo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function qp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ce(61501,{type:n})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mr._jsonSchemaVersion="firestore/querySnapshot/1.0",mr._jsonSchema={type:ze("string",mr._jsonSchemaVersion),bundleSource:ze("string","QuerySnapshot"),bundleName:ze("string"),bundle:ze("string")};function Ju(n){n=gr(n,rn);const e=gr(n.firestore,Ri),t=Uu(e),r=new Lp(e);return Fp(n._query),wp(t,n._query).then(s=>new mr(e,r,n,s))}function zp(n,e,t){n=gr(n,Ge);const r=gr(n.firestore,Ri),s=Up(n.converter,e),o=la(r);return Xu(r,[jp(o,"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Ht.none())])}function Wp(n){return Xu(gr(n.firestore,Ri),[new zo(n._key,Ht.none())])}function Xu(n,e){const t=Uu(n);return vp(t,e)}(function(e,t=!0){gf(rf),ti(new Zr("firestore",(r,{instanceIdentifier:s,options:o})=>{const l=r.getProvider("app").getImmediate(),u=new Ri(new yf(r.getProvider("auth-internal")),new vf(l,r.getProvider("app-check-internal")),Bf(l,s),l);return o={useFetchStreams:t,...o},u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),cr(Hl,Gl,e),cr(Hl,Gl,"esm2020")})();var Hp="firebase",Gp="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */cr(Hp,Gp,"app");const Kp={apiKey:"AIzaSyCXA8pqsLUjVKXr1ltz5gN7VaD-saqlF-g",authDomain:"box-elite.firebaseapp.com",projectId:"box-elite",storageBucket:"box-elite.firebasestorage.app",messagingSenderId:"133574833722",appId:"1:133574833722:web:310d172ecb6dc3a5bae703"},Qp=yc(Kp),xa=Ap(Qp);function Zu(n){return Ip(xa,"branches",n,"closedRows")}function Yp(n){return{id:n.id,employeeName:n.employeeName,cash:n.cash,sentToTreasury:n.sentToTreasury??0,expenseCompensation:n.expenseCompensation??0,expenses:n.expenses??0,carriedExpenseCount:n.carriedExpenseCount??0,expenseItems:n.expenseItems??[],mada:n.mada??0,visa:n.visa??0,mastercard:n.mastercard??0,bankTransfer:n.bankTransfer??0,programBalanceCash:n.programBalanceCash??0,programBalanceBank:n.programBalanceBank??0,variance:n.variance??0,status:"closed",notes:n.notes??"",closedAt:n.closedAt,createdAt:n.createdAt}}function ed(n){const e=Array.isArray(n.expenseItems)?n.expenseItems.filter(t=>typeof t.amount=="number"&&typeof t.description=="string"):[];return{id:String(n.id??""),employeeName:String(n.employeeName??""),cash:Number(n.cash??0),sentToTreasury:Number(n.sentToTreasury??0),expenseCompensation:Number(n.expenseCompensation??0),expenses:Number(n.expenses??0),carriedExpenseCount:Number(n.carriedExpenseCount??0),expenseItems:e,mada:Number(n.mada??0),visa:Number(n.visa??0),mastercard:Number(n.mastercard??0),bankTransfer:Number(n.bankTransfer??0),programBalanceCash:Number(n.programBalanceCash??0),programBalanceBank:Number(n.programBalanceBank??0),variance:Number(n.variance??0),status:"closed",notes:String(n.notes??""),closedAt:n.closedAt?String(n.closedAt):null,createdAt:String(n.createdAt??"")}}async function td(n,e){const t=$u(xa,"branches",n,"closedRows",e.id),r=Yp({...e,closedAt:e.closedAt??new Date().toISOString()});await zp(t,r)}async function nd(n,e=500){const t=Zu(n);return(await Ju(t)).docs.map(o=>ed(o.data())).sort((o,l)=>new Date((l.closedAt??"").toString()).getTime()-new Date((o.closedAt??"").toString()).getTime()).slice(0,e)}async function Qs(n,e,t){const r=Zu(n),s=t?Kl(r,Ql("closedAt","desc"),Yl(e+1),Bp(t)):Kl(r,Ql("closedAt","desc"),Yl(e+1)),l=(await Ju(s)).docs,u=l.length>e,h=u?l.slice(0,e):l,f=h.map(g=>ed(g.data())),m=h.length>0?h[h.length-1]:null;return{rows:f,lastDoc:m,hasMore:u}}async function rd(n,e){await Wp($u(xa,"branches",n,"closedRows",e))}const Jp=Object.freeze(Object.defineProperty({__proto__:null,addClosedRowToFirebase:td,deleteClosedRowFromFirebase:rd,getClosedRowsFromFirebase:nd,getClosedRowsPaginated:Qs},Symbol.toStringTag,{value:"Module"}));function sd(n){return`cashbox_rows_${n}`}function Xp(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function Zp(n){const e=n,t=Array.isArray(e.expenseItems)?e.expenseItems.filter(r=>typeof r.amount=="number"&&typeof r.description=="string"):[];return{...n,sentToTreasury:typeof e.sentToTreasury=="number"?e.sentToTreasury:0,expenseCompensation:typeof e.expenseCompensation=="number"?e.expenseCompensation:0,expenses:typeof n.expenses=="number"?n.expenses:0,carriedExpenseCount:typeof e.carriedExpenseCount=="number"&&e.carriedExpenseCount>=0?e.carriedExpenseCount:0,expenseItems:t,mastercard:typeof n.mastercard=="number"?n.mastercard:0,programBalanceCash:typeof n.programBalanceCash=="number"?n.programBalanceCash:0,programBalanceBank:typeof n.programBalanceBank=="number"?n.programBalanceBank:0}}function Ar(n){try{const e=sd(n);let t=localStorage.getItem(e);if(!t&&n==="corniche"){const s=localStorage.getItem("cashbox_rows");s&&(localStorage.setItem(e,s),localStorage.removeItem("cashbox_rows"),t=s)}return t?JSON.parse(t).filter(s=>s.status!=="closed").map(Zp):[]}catch{return[]}}function Pi(n,e){try{localStorage.setItem(sd(n),JSON.stringify(e.filter(t=>t.status!=="closed")))}catch{}}function Os(n){return Ar(n).sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())}function eg(n,e){return Ar(n).find(r=>r.id===e)??null}function id(n,e,t){const r=Ar(n),s=new Date().toISOString(),o=(t==null?void 0:t.expenses)??0,l=(t==null?void 0:t.expenseItems)??[],u=(t==null?void 0:t.carriedExpenseCount)??0;r.push({id:Xp(),employeeName:e,cash:0,sentToTreasury:0,expenseCompensation:0,expenses:o,carriedExpenseCount:u,expenseItems:l,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0,status:"active",notes:"",closedAt:null,createdAt:s}),Pi(n,r)}function St(n,e,t){const r=Ar(n),s=r.findIndex(o=>o.id===e);s!==-1&&(r[s]={...r[s],...t},Pi(n,r))}async function tg(n,e,t){const r=new Date().toISOString(),s={...t,status:"closed",closedAt:r};await td(n,s);const o=Ar(n).filter(l=>l.id!==e);Pi(n,o)}async function ng(n,e,t){if(t)await rd(n,e);else{const r=Ar(n).filter(s=>s.id!==e);Pi(n,r)}}async function rg(n){const{getClosedRowsFromFirebase:e,deleteClosedRowFromFirebase:t}=await Sd(async()=>{const{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}=await Promise.resolve().then(()=>Jp);return{getClosedRowsFromFirebase:s,deleteClosedRowFromFirebase:o}},void 0),r=await e(n);await Promise.all(r.map(s=>t(n,s.id)))}const sg="٠١٢٣٤٥٦٧٨٩",ig="0123456789";function od(n){let e="";for(let t=0;t<n.length;t++){const r=sg.indexOf(n[t]);e+=r>=0?ig[r]:n[t]}return e}function og(n){return n.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a/g,"").replace(/\u202b/g,"").replace(/\u202c/g,"").replace(/[\u0640\u066a]/g,"").replace(/\/\s*/g,"/").trim()}function ag(n){const e=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2})\s*([صم])/);if(!e)return null;const t=parseInt(e[2],10)-1,r=parseInt(e[3],10),s=parseInt(e[1],10);let o=parseInt(e[4],10);const l=parseInt(e[5],10),u=e[6];u==="م"&&o!==12&&(o+=12),u==="ص"&&o===12&&(o=0);const h=new Date(r,t,s,o,l,0,0);return isNaN(h.getTime())?null:h}function lg(n){let e=n.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(e){let t=parseInt(e[1],10);const r=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),l=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(o,l,u,t,r,0,0);return isNaN(h.getTime())?null:h}if(e=n.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{1,2})\/(\d{1,2})\/(\d{4})/),e){let t=parseInt(e[1],10);const r=parseInt(e[2],10),s=e[3],o=parseInt(e[4],10),l=parseInt(e[5],10)-1,u=parseInt(e[6],10);s==="م"&&t!==12&&(t+=12),s==="ص"&&t===12&&(t=0);const h=new Date(u,l,o,t,r,0,0);return isNaN(h.getTime())?null:h}return null}function Zl(n){const e=og((n||"").toString());if(!e)return null;const t=od(e);return lg(t)??ag(t)}const cg=32874,ug=52100;function dg(n){if(n instanceof Date)return isNaN(n.getTime())?null:n;if(typeof n=="number"&&Number.isFinite(n)){if(n<cg||n>ug)return null;const t=(n-25569)*86400*1e3,r=new Date(t);return isNaN(r.getTime())?null:r}return null}const hg="٫";function Ro(n){let e=(n||"").toString().trim();e=e.replace(/\s*SAR\s*/gi," ").replace(/\s*ر\.?\s*س\.?\s*/g," ").replace(/\s*ريال\s*(سعودي)?\s*/gi," ").trim();let r=od(e).replace(hg,".").replace(/[^\d.,\-]/g,"");if(!r)return 0;if(/^-?\d+,\d{1,3}$/.test(r)?r=r.replace(",","."):r=r.replace(/,/g,""),r.includes(".")){const l=r.split("."),u=l[l.length-1];u&&u.length===3&&/^\d+$/.test(u)&&(r=r.replace(/\./g,""))}const o=parseFloat(r);return Number.isFinite(o)?o:0}const ad={مدى:"mada",فيزا:"visa","ماستر كارد":"mastercard",ماستركارد:"mastercard","تحويل بنكي":"bankTransfer",تحويل:"bankTransfer"},fg=["شيك","أمريكان إكسبريس","امريكان اكسبريس","نقداً","نقدا","كاش"];function ld(n){const e=n.replace(/\s+/g," ").trim();return fg.some(t=>e===t||e.includes(t))}function mg(n,e,t){const r={...Wr},s={...Hr},o={mada:[],visa:[],mastercard:[],bankTransfer:[]},l=Math.min(n.length,500);for(let u=t;u<l;u++){const h=n[u];if(!h||!Array.isArray(h))continue;const f=Math.min(Math.max(h.length,4),120);let m=null,g=-1;for(let j=0;j<f;j++){const L=e?ls(e,h,u,j):(h[j]??"").toString().trim(),V=Wn(L);if(!V||ld(V))continue;const O=ad[V]??(V.includes("مدى")?"mada":null);if(O&&O!=="cash"){m=O,g=j;break}}if(m==null||m==="cash")continue;let E=0;for(let j=0;j<f;j++){if(j===g)continue;const L=e?ls(e,h,u,j):(h[j]??"").toString().trim(),V=Ro(L);if(V>0&&V<=cd){E=V;break}}if(E<=0)continue;const C=(h[g]??"").toString().trim();C.includes("إجمالي")||C.includes("مجموع")||C.includes("المجموع")||(r[m]+=E,s[m]+=1,o[m].push({date:new Date(0),amount:E,employeeName:void 0,purpose:void 0}))}return{sums:r,counts:s,details:o}}const Wr={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},Hr={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},to={mada:[],visa:[],mastercard:[],bankTransfer:[]};function Wn(n){let e=(n??"").toString();return e=e.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a|\u202b|\u202c/g,"").replace(/\u200b|\u200c|\u200d|\ufeff/g,"").replace(/\s+/g," "),e=e.replace(/SAR/gi,"").replace(/ر\.?\s*س\.?/g,"").replace(/ريال\s*(سعودي)?/g,""),e.trim()}function ls(n,e,t,r){const s=dn.encode_cell({r:t,c:r}),o=n[s];if(o!=null){if(typeof o.w=="string"&&o.w.trim())return o.w.trim();if(typeof o.v=="number"&&!Number.isNaN(o.v))return String(o.v);if(typeof o.v=="string")return o.v.trim()}return(e[r]??"").toString().trim()}function ba(n){const e=Wn(n);return e.includes("طريقةالدفع")||e.includes("طريقة الدفع")||e.includes("الدفع")&&e.length<30||e.includes("طريقة")&&(e.includes("دفع")||e.includes("الدفع"))}function ya(n){const e=Wn(n);return e.includes("المبلغ")||e.includes("قيمةالسند")||e.includes("قيمة السند")||e.includes("المقبوضات")||e.includes("مقبوضات")||e.includes("قبوضات")||e.includes("المصروفات")||e.includes("مصروفات")||e.includes("الصافي")||e.includes("صافي")||e.includes("مبلغ")||e.includes("قيمة")&&!e.includes("رقم")&&e.length<35}function Fs(n){const e=new Map;for(const s of Object.keys(n)){if(s.startsWith("!"))continue;const o=dn.decode_cell(s);if(o==null||typeof o.r!="number")continue;const l=o.r,u=o.c,h=n[s],f=h&&typeof h.w=="string"&&h.w.trim()||h&&typeof h.v=="string"&&h.v.trim()||(h&&typeof h.v=="number"&&!Number.isNaN(h.v)?String(h.v):"");e.has(l)||e.set(l,new Map),e.get(l).set(u,f)}const t=e.size===0?0:Math.max(...e.keys()),r=[];for(let s=0;s<=t;s++){const o=e.get(s),l=o?Math.max(...o.keys()):0,u=[];for(let h=0;h<=l;h++)u.push((o==null?void 0:o.get(h))??"");r.push(u)}return r}function pg(n){const e=new Map;for(const r of Object.keys(n)){if(r.startsWith("!"))continue;const s=dn.decode_cell(r);if(s==null||typeof s.r!="number")continue;const o=s.r,l=s.c,u=n[r],h=u&&typeof u.w=="string"&&u.w.trim()||u&&typeof u.v=="string"&&u.v.trim()||(u&&typeof u.v=="number"&&!Number.isNaN(u.v)?String(u.v):"");if(!h)continue;e.has(o)||e.set(o,[]);const f=e.get(o);for(;f.length<=l;)f.push("");f[l]=h}const t=Array.from(e.keys()).sort((r,s)=>r-s);for(const r of t){const s=e.get(r)||[];let o=!1,l=!1;for(const u of s){const h=Wn(u);h&&(ya(h)&&(o=!0),ba(h)&&(l=!0))}if(o&&l)return r}return-1}const gg=["مدى","فيزا","ماستر كارد","ماستركارد","تحويل بنكي","تحويل","نقداً","نقدا","شيك","أمريكان إكسبريس"];function xg(n){const e=Wn(n);return!e||e.length>50?!1:gg.some(t=>e===t||e.includes(t))}function bg(n,e){const t=Math.min(n.length,200);for(let r=1;r<t;r++){const s=n[r];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);for(let l=0;l<o;l++){const u=e?ls(e,s,r,l):(s[l]??"").toString().trim();if(xg(u))return r-1}}return-1}function ec(n,e){const t=Math.min(n.length,200);for(let r=0;r<t;r++){const s=n[r];if(!s||!Array.isArray(s))continue;const o=Math.min(Math.max(s.length,50),120);let l=!1,u=!1;for(let h=0;h<o;h++){const f=e?ls(e,s,r,h):(s[h]??"").toString().trim(),m=Wn(f);m&&(ya(m)&&(l=!0),ba(m)&&(u=!0))}if(l&&u)return r}return-1}const yg=["الموظف","اسم الموظف","الاسم","اسم","المستخدم","اسم المستخدم","الموظف المسؤول","المسؤول","كاشير","الكاشير","المحاسب","اسم المحاسب"];function _g(n){const e=n.replace(/\s+/g," ").replace(/\u200e|\u200f/g,"").trim();return e?e.includes("موظف")||e.includes("كاشير")||e.includes("محاسب")?!0:yg.some(t=>e===t||e.includes(t)):!1}const wg=["الغرض","الوصف","البيان","الغرض من العملية","تفاصيل","ملاحظات","وصف العملية"];function vg(n){const e=n.replace(/\s+/g," ").trim();return e?wg.some(t=>e.includes(t)):!1}function kg(n){let e=-1,t=-1,r=-1,s=-1,o=-1,l=-1;const u=Math.min(Math.max((n==null?void 0:n.length)??0,10),120);let h=-1;for(let f=0;f<u;f++){const m=n[f],g=Wn(m);(g.includes("الوقت")||g.includes("التاريخ"))&&e<0&&(e=f),t<0&&ba(g)&&(t=f),(g.includes("الإتجاه")||g.includes("الاتجاه"))&&s<0&&(s=f),o<0&&_g(g)&&(o=f),l<0&&vg(g)&&(l=f),ya(g)&&((g.includes("المقبوضات")||g.includes("مقبوضات")||g.includes("قبوضات"))&&(h=f),r<0&&(r=f)),g.includes("رقم السند")&&g.includes("قيمة السند")}return h>=0&&(r=h),t>=0&&r>=0?{date:e,method:t,amount:r,direction:s,employeeName:o,purpose:l}:null}function Eg(n){const e=(n??"").toString().trim();return typeof n=="string"||typeof n=="number"&&n<3e4?e?Zl(e):null:dg(n)??(e?Zl(e):null)}const cd=999999;function Tg(n,e){try{const t=bd(n,{type:"array"}),r=t.SheetNames||[];if(r.length===0)return{sums:Wr,counts:Hr,details:to,employeeName:null,employeeNamesList:[],error:"الملف لا يحتوي على أي sheet"};let s=[],o={},l="",u=-1;for(let H=0;H<r.length;H++)if(l=r[H],o=t.Sheets[l],s=dn.sheet_to_json(o,{header:1,defval:""}),u=ec(s,o),u<0&&(s=Fs(o),u=ec(s,o)),u<0&&(u=pg(o)),u>=0){s.length<=u&&(s=Fs(o));break}if(u>=0&&s.length<=u&&(s=Fs(o)),u<0&&(u=bg(s,o)),u>=0&&s.length<=u&&(s=Fs(o)),u<0)return{sums:Wr,counts:Hr,details:to,employeeName:null,employeeNamesList:[],error:"لم يُعثر على صف العناوين (طريقة الدفع، المبلغ أو المقبوضات)"};const h=s[u],f=[];for(let H=0;H<Math.max((h==null?void 0:h.length)??0,80);H++)f.push(ls(o,h,u,H)||h[H]);let m=kg(f);if(!m){const H=mg(s,o,u+1);return{sums:H.sums,counts:H.counts,details:H.details,employeeName:null,employeeNamesList:[],error:null}}const E={...Wr},C={...Hr},j={mada:[],visa:[],mastercard:[],bankTransfer:[]},L=new Set,V=e.getTime();for(let H=u+1;H<s.length;H++){const Y=s[H],z=(Y[m.method]??"").toString().trim();if(!z||ld(z))continue;const te=m.date>=0?Y[m.date]:void 0,v=m.date>=0?Eg(te):null;if(m.date>=0&&(!v||v.getTime()<V))continue;const x=v??new Date(0),w=(m.direction>=0?(Y[m.direction]??"").toString().trim():"").replace(/\u200e/g,"").replace(/\u200f/g,"").trim();if(m.direction>=0&&w!=="داخل")continue;const k=Y[m.amount];if(m.employeeName>=0){const le=dn.encode_cell({r:H,c:m.employeeName}),he=o[le],me=(he&&typeof he.w=="string"?he.w.trim():"")||(Y[m.employeeName]??"").toString().trim();me&&L.add(me)}const A=dn.encode_cell({r:H,c:m.amount}),y=o[A],F=y&&typeof y.w=="string"?y.w.trim():"";let Z;if(F)Z=Ro(F);else if(typeof k=="number"&&Number.isFinite(k))Z=k;else{const le=(k??"").toString().trim();Z=Ro(le)}if(Z<=0||Z>cd)continue;const B=z.replace(/\s+/g," ").trim();if(B.includes("إجمالي")||B.includes("مجموع")||B.includes("المجموع"))continue;const ee=ad[z]??(z.toLowerCase().includes("مدى")?"mada":null);if(ee&&(E[ee]+=Z,C[ee]+=1,ee!=="cash")){const le=m.employeeName>=0?(()=>{const xe=dn.encode_cell({r:H,c:m.employeeName}),me=o[xe];return(me&&typeof me.w=="string"?me.w.trim():"")||(Y[m.employeeName]??"").toString().trim()||void 0})():void 0;let he;if(m.purpose>=0){const xe=dn.encode_cell({r:H,c:m.purpose}),me=o[xe];he=(me&&typeof me.w=="string"?me.w.trim():"")||(Y[m.purpose]??"").toString().trim()||void 0}j[ee].push({date:x,amount:Z,employeeName:le,purpose:he})}}const O=[...L],$=L.size===0?null:L.size===1?O[0]:"أكثر من موظف";return{sums:E,counts:C,details:j,employeeName:$,employeeNamesList:O,error:null}}catch(t){const r=t instanceof Error?t.message:String(t);return{sums:Wr,counts:Hr,details:to,employeeName:null,employeeNamesList:[],error:`خطأ في قراءة الملف: ${r}`}}}const ud=[500,200,100,50,20,10,5,1];function Ig(n){const e=n.getHours();return e>=5&&e<12?{label:"صباح الخير",kind:"morning"}:e>=12&&e<17?{label:"مساء الخير",kind:"noon"}:e>=17&&e<21?{label:"أمسية سعيدة",kind:"evening"}:{label:"ليلة سعيدة",kind:"night"}}function Ys(n){const e=n.mada+n.visa+n.mastercard;return Math.round((e-n.programBalanceBank)*100)/100}function Js(n){const e=n.cash??0,t=n.sentToTreasury??0,r=n.expenses??0,s=n.expenseCompensation??0,o=Math.max(0,r-s),l=e+t+o;return Math.round((l-n.programBalanceCash)*100)/100}function Bs(n){const e=n.cash+n.mada+n.visa+n.mastercard,t=n.programBalanceCash+n.programBalanceBank;return Math.round((e-t)*100)/100}function mi(n){const e=typeof n=="string"?new Date(n):n,t={calendar:"gregory",numberingSystem:"latn"},r=e.toLocaleDateString("ar-SA",{...t,weekday:"long"}),s=e.getDate(),o=e.toLocaleDateString("ar-SA",{...t,month:"long"}),l=e.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",numberingSystem:"latn"});return`${r} ${s} ${o} ${l}`}const Ag="٠١٢٣٤٥٦٧٨٩",Cg="0123456789";function Fn(n){if(typeof n!="string")return String(n);let e="";for(let t=0;t<n.length;t++){const r=Ag.indexOf(n[t]);e+=r>=0?Cg[r]:n[t]}return e}function G(n){return new Intl.NumberFormat("ar-SA",{minimumFractionDigits:0,maximumFractionDigits:2,numberingSystem:"latn"}).format(n)}function Ng(n){const e=new Date(n),t=new Date;return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Rg(n){const e=new Date(n),t=new Date;return t.setDate(t.getDate()-1),e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function Sg(n){const e=new Date(n),t=new Date,r=new Date(t);return r.setDate(r.getDate()-7),e>=r&&e<=t}function tc(n,e){return e==="today"?n.filter(t=>t.closedAt&&Ng(t.closedAt)):e==="yesterday"?n.filter(t=>t.closedAt&&Rg(t.closedAt)):e==="lastWeek"?n.filter(t=>t.closedAt&&Sg(t.closedAt)):n}const nc=["cash","sentToTreasury","expenseCompensation","expenses","programBalanceCash","mada","visa","mastercard","bankTransfer","programBalanceBank"],_a="border-stone-200 dark:border-teal-500/20",rc=`border-t-2 border-b-2 border-r-2 ${_a} rounded-s-xl`,Br=`border-t-2 border-b-2 ${_a}`,sc=`border-t-2 border-b-2 border-l-2 ${_a} rounded-e-xl`;function jg({row:n,rowNumber:e,rowIndex:t=0,isFirstActive:r,liveNow:s,closingRowId:o,closingSecondsLeft:l,onUpdate:u,isSelected:h=!1,onToggleSelect:f,onDeleteRow:m,onPrintRow:g,onOpenExpenseDetails:E,onClearExpensesAndOpen:C,onLockedFieldClick:j,onExpenseCompensationExceeded:L,lastExcelDetails:V,onShowExcelDetails:O,onRequestConfirmBankEdit:$,onShowEmployeeNames:H,onShowVarianceExplanation:Y,currentUserName:z,onClearRow:te,isStickyRows:v=!1,onOpenShiftNotesModal:x}){const _=r&&z?z:n.employeeName,w=I.useMemo(()=>Ys(n),[n.mada,n.visa,n.mastercard,n.bankTransfer,n.programBalanceBank]),k=I.useMemo(()=>Js(n),[n.cash,n.sentToTreasury,n.programBalanceCash,n.expenses,n.expenseCompensation]),A=I.useMemo(()=>{const X=n.carriedExpenseCount??0;return(n.expenseItems??[]).slice(0,X).reduce((_e,je)=>_e+je.amount,0)},[n.carriedExpenseCount,n.expenseItems]),y=n.status==="closed",F=o===n.id,Z=I.useCallback((X,Tt)=>{const _e=Fn(Tt);let je=parseFloat(_e)||0;X==="expenses"&&A>0&&je<A&&(je=A);const ct=n.expenses??0;X==="expenseCompensation"&&je>ct&&(L==null||L(ct),je=ct),u(n.id,X,je)},[n.id,n.expenses,u,A,L]),B=I.useCallback(X=>{if(X.key==="Enter"||X.key==="Tab"){const Tt=X.currentTarget.closest("tr");if(!Tt)return;const _e=Array.from(Tt.querySelectorAll("input:not([disabled])")),je=_e.indexOf(X.currentTarget),ct=X.key==="Tab"&&X.shiftKey,Re=X.key==="Enter"||X.key==="Tab"&&!X.shiftKey;ct&&je>0?(X.preventDefault(),_e[je-1].focus()):Re&&je>=0&&je<_e.length-1&&(X.preventDefault(),_e[je+1].focus())}},[]),ee=k>0?"text-emerald-700 dark:text-emerald-400":k<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",le=w>0?"text-emerald-700 dark:text-emerald-400":w<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",he=n.programBalanceCash>0,xe=["programBalanceCash","expenses"],[me,ke]=I.useState(!1),[Qe,Ce]=I.useState(null),[Ne,nt]=I.useState(null),pt=I.useCallback(X=>{j==null||j(),ke(!0),Ce(X)},[j]);I.useEffect(()=>{if(!me)return;const X=setTimeout(()=>ke(!1),3e3);return()=>clearTimeout(X)},[me]),I.useEffect(()=>{if(Qe===null)return;const X=setTimeout(()=>Ce(null),1200);return()=>clearTimeout(X)},[Qe]);const Ee=(X,Tt)=>{var Tn;const _e=n[X]??0,je=(X==="mada"||X==="visa"||X==="mastercard"||X==="bankTransfer")&&((Tn=V==null?void 0:V[X])==null?void 0:Tn.length)>0&&O;if(y||F)return X==="expenses"&&E?a.jsx("button",{type:"button",onClick:()=>E(n.id),className:"block w-full py-1 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center hover:text-stone-900 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/[0.06] rounded-xl transition cursor-pointer",title:"عرض تفاصيل المصروفات",children:_e===0?"—":G(_e)}):je&&O?a.jsxs("div",{className:"flex items-center gap-1 w-full",children:[a.jsx("span",{className:"flex-1 min-w-0 py-1 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center tabular-nums",children:_e===0?"—":G(_e)}),a.jsx("button",{type:"button",onClick:()=>O(X,n.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-stone-800 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 8v4l2 2"}),a.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):a.jsx("span",{className:"block py-1 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center",children:_e===0?"—":G(_e)});const ct=X==="expenses",Re=!xe.includes(X)&&!he,Be=X==="programBalanceCash"&&r?0:Re?-1:1,yt=je&&$&&["mada","visa","mastercard","bankTransfer"].includes(X),Cr=yt&&(Ne==null?void 0:Ne.field)===X?Ne.value===0?"":String(Ne.value):_e===0?"":String(_e),Dt=a.jsx("input",{type:"text",inputMode:"decimal",value:Cr,onChange:Pe=>{const $e=Fn(Pe.target.value).replace(/[^\d.]/g,""),_t=$e.indexOf("."),Mt=_t===-1?$e:$e.slice(0,_t+1)+$e.slice(_t+1).replace(/\./g,""),Hn=parseFloat(Mt)||0;yt?nt({field:X,value:Hn}):Z(X,Mt)},onBlur:()=>{if(yt&&(Ne==null?void 0:Ne.field)===X){const Pe=Ne.value;nt(null),Pe!==_e&&$(n.id,X,_e,Pe)}},dir:"ltr","aria-label":X,onKeyDown:B,onFocus:Pe=>{Pe.currentTarget.select(),ct&&E&&E(n.id)},placeholder:"—",tabIndex:Be,disabled:Re,title:Re?"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش":X==="expenseCompensation"?"يجب أن يكون مساوياً أو أقل من مبلغ المصروفات":void 0,className:"cashbox-input w-full min-h-[1.6rem] px-2 py-1.5 rounded-lg bg-white dark:bg-slate-900/70 border-2 border-stone-400 dark:border-white/[0.06] text-stone-900 dark:text-white text-sm font-cairo text-center focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 dark:focus:border-teal-500/40 dark:focus:ring-teal-500/20 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm"});return Re&&j?a.jsx("div",{role:"button",tabIndex:0,className:"locked-field-wrapper w-full cursor-not-allowed rounded-lg",onClick:Pe=>{Pe.preventDefault(),Pe.stopPropagation(),pt(X)},onKeyDown:Pe=>{(Pe.key==="Enter"||Pe.key===" ")&&(Pe.preventDefault(),pt(X))},title:"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش",children:Dt}):je&&O?a.jsxs("div",{className:"flex items-center gap-1 w-full",children:[a.jsx("div",{className:"flex-1 min-w-0",children:Dt}),a.jsx("button",{type:"button",onClick:()=>O(X,n.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-stone-800 hover:bg-stone-200 dark:hover:text-teal-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 8v4l2 2"}),a.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):Dt},bt=F&&l>0?l<=1?"0.35s":l<=2?"0.6s":l<=3?"1s":"1.5s":void 0,Et=y&&n.closedAt?mi(n.closedAt):mi(s),Yt=v?"sticky top-[6.5rem] sm:top-[7rem] z-[9] bg-[#ebe6df]/98 dark:bg-slate-800/98 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b-2 border-stone-500 dark:border-teal-500/20":"",Xe=v?"sticky top-[8.75rem] sm:top-[9.25rem] z-[9] bg-white dark:bg-slate-800/95 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b-2 border-stone-500 dark:border-teal-500/20":"",ot=F?"bg-sky-100 dark:bg-sky-500/10":y?t%2===0?"bg-[#f2ede5] dark:bg-slate-800/40":"bg-[#ebe6df] dark:bg-slate-800/25":t%2===0?"bg-[#f8f4ee] dark:bg-slate-800/30 hover:bg-[#f2ede5] dark:hover:bg-slate-800/40":"bg-[#f2ede5] dark:bg-slate-800/20 hover:bg-[#ebe6df] dark:hover:bg-slate-800/35";return a.jsxs(a.Fragment,{children:[a.jsx("tr",{"data-row-id":n.id,className:`bg-transparent border-l-4 border-l-teal-500 dark:border-l-teal-500/40 border-b-2 border-stone-500 dark:border-teal-500/20 ${v?"sticky-label-row":""}`,children:a.jsx("td",{colSpan:16,className:`py-0.5 px-2 sm:px-3 align-middle text-[10px] sm:text-[11px] font-semibold font-cairo whitespace-nowrap ${Yt}`,style:{lineHeight:1.2,verticalAlign:"middle",paddingInlineStart:"4%"},children:a.jsxs("span",{className:"inline-flex items-center gap-1.5 flex-wrap rounded-lg border-2 border-stone-400 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 px-2 py-0.5 shadow-sm dark:shadow-[0_2px_6px_rgba(20,184,166,0.08)]",children:[_==="أكثر من موظف"&&H?a.jsx("button",{type:"button",onClick:H,className:"text-stone-800 dark:text-teal-400 hover:text-stone-900 dark:hover:text-teal-300 underline underline-offset-1 cursor-pointer transition-colors font-semibold",title:"عرض أسماء الموظفين",children:"أكثر من موظف"}):a.jsx("span",{className:"font-semibold text-stone-900 dark:text-teal-300",children:_}),a.jsx("span",{className:"text-stone-500 dark:text-slate-400",children:"·"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-600 dark:text-slate-400",children:Et}),x&&a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-stone-500 dark:text-slate-400",children:"·"}),a.jsxs("span",{className:"inline-flex items-center gap-1.5",children:[!y&&r?a.jsx("button",{type:"button",onClick:()=>x(n,"edit"),className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-md text-[10px] sm:text-[11px] font-semibold font-cairo bg-teal-500/20 dark:bg-teal-500/25 text-teal-700 dark:text-teal-300 border border-teal-400/50 dark:border-teal-500/40 hover:bg-teal-500/30 dark:hover:bg-teal-500/35 transition-colors",title:"تسجيل ملاحظات الشيفت",children:"ملاحظات الشيفت"}):null,a.jsx("button",{type:"button",onClick:()=>x(n,"view"),title:(n.notes||"").trim()?"عرض ملاحظات الشيفت":"لا توجد ملاحظات",className:`inline-flex items-center justify-center w-6 h-6 rounded-md transition-colors ${(n.notes||"").trim()?"text-red-500 dark:text-red-400 animate-pulse":"text-stone-400 dark:text-slate-500"}`,"aria-label":"عرض ملاحظات الشيفت",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]})]})]})})}),a.jsxs("tr",{"data-row-id":n.id,className:`bg-transparent ${F?"animate-pulse border-l-2 border-r-2 border-l-sky-400/50 border-r-sky-400/50 border-b-2 border-stone-500 dark:border-teal-500/20":"border-b-2 border-stone-500 dark:border-slate-600 transition-colors"} ${v?"sticky-data-row":""}`,style:bt?{animationDuration:bt}:void 0,children:[a.jsx("td",{className:`p-1 text-center align-middle bg-transparent ${Xe}`,children:f&&a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("button",{type:"button",onClick:()=>f(n.id),"aria-label":h?"إلغاء تحديد الصف":"تحديد الصف للطباعة",className:`inline-flex items-center justify-center w-4 h-4 rounded-md border-2 transition-all ${h?"border-teal-500 bg-teal-100 text-teal-600 ring-2 ring-teal-500/30 ring-offset-2 ring-offset-stone-50 dark:border-teal-500/60 dark:bg-teal-500/20 dark:text-teal-400 dark:ring-teal-500/30 dark:ring-offset-slate-800":"border-2 border-stone-500 dark:border-white/20 bg-stone-300 dark:bg-slate-800/60 text-stone-800 dark:text-slate-400 hover:border-teal-400 dark:hover:border-teal-500/40 hover:text-teal-600 dark:hover:text-teal-400/90 shadow-sm"}`,children:h?a.jsx("svg",{className:"w-2 h-2 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})}):a.jsx("span",{className:"w-2 h-2 block shrink-0"})})})}),a.jsx("td",{className:`p-1 text-center text-stone-800 dark:text-slate-400 text-xs font-medium font-cairo align-middle tabular-nums bg-transparent ${Xe}`,children:e}),nc.slice(0,4).map(X=>a.jsx("td",{"data-transfer-target":!0,"data-field":X,"data-row-id":n.id,className:`p-1 text-center align-middle ${ot} ${Qe===X?"locked-cell-pulse":""} ${Xe} ${X==="cash"?rc:Br}`,children:Ee(X)},X)),a.jsx("td",{"data-transfer-target":!0,"data-field":"programBalanceCash","data-row-id":n.id,className:`p-1 text-center align-middle ${ot} ${me&&r?"program-balance-pulse-cell":""} ${Xe} ${Br}`,title:!he&&r?"لا يمكن الإدخال في الخانات الأخرى قبل إدخال رصيد البرنامج كاش هنا":void 0,children:Ee("programBalanceCash")}),a.jsx("td",{className:`p-1 text-center align-middle ${ot} ${Xe} ${sc}`,children:Y?a.jsx("button",{type:"button",onClick:()=>Y("cash",n),className:`block w-full min-h-[1.6rem] py-1.5 px-2 rounded-lg border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums transition cursor-pointer hover:bg-stone-50 dark:hover:bg-white/[0.06] focus:outline-none focus:ring-2 focus:ring-teal-500/20 ${k===0?"cursor-default text-stone-500 dark:text-slate-500":`${ee}`}`,title:k===0?void 0:"شرح سبب انحراف الكاش",disabled:k===0,children:k===0?"—":G(k)}):a.jsx("span",{className:`block w-full min-h-[1.6rem] py-1.5 px-2 rounded-lg border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums ${k===0?"text-stone-500 dark:text-slate-500":ee}`,children:k===0?"—":G(k)})}),nc.slice(5,9).map(X=>a.jsx("td",{"data-transfer-target":!0,"data-field":X,"data-row-id":n.id,className:`p-1 text-center align-middle ${ot} ${Qe===X?"locked-cell-pulse":""} ${Xe} ${X==="mada"?rc:Br}`,children:Ee(X)},X)),a.jsx("td",{className:`p-1 text-center align-middle ${ot} ${Xe} ${Br}`,children:a.jsx("span",{className:"block w-full min-h-[1.6rem] py-1.5 px-2 rounded-lg border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums text-stone-800 dark:text-slate-200 font-medium",children:(()=>{const X=n.mada+n.visa+n.mastercard;return X===0?"—":G(X)})()})}),a.jsx("td",{"data-transfer-target":!0,"data-field":"programBalanceBank","data-row-id":n.id,className:`p-1 text-center align-middle ${ot} ${Qe==="programBalanceBank"?"locked-cell-pulse":""} ${Xe} ${Br}`,children:Ee("programBalanceBank")}),a.jsx("td",{className:`p-1 text-center align-middle ${ot} ${Xe} ${sc}`,children:Y?a.jsx("button",{type:"button",onClick:()=>Y("bank",n),className:`block w-full min-h-[1.6rem] py-1.5 px-2 rounded-lg border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums transition cursor-pointer hover:bg-stone-50 dark:hover:bg-white/[0.06] focus:outline-none focus:ring-2 focus:ring-teal-500/20 ${w===0?"cursor-default text-stone-500 dark:text-slate-500":`${le}`}`,title:w===0?void 0:"شرح سبب انحراف البنك",disabled:w===0,children:w===0?"—":G(w)}):a.jsx("span",{className:`block w-full min-h-[1.6rem] py-1.5 px-2 rounded-lg border-2 border-stone-400 dark:border-white/[0.06] bg-white dark:bg-slate-900/70 text-sm font-cairo text-center tabular-nums ${w===0?"text-stone-500 dark:text-slate-500":le}`,children:w===0?"—":G(w)})}),a.jsx("td",{className:`px-0.5 py-0.5 text-center align-middle overflow-hidden min-w-0 bg-transparent ${Xe}`,children:y?a.jsxs("div",{className:"flex flex-row items-center justify-center gap-0.5 flex-wrap min-w-0 w-full",children:[a.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded-full px-1 py-0.5 bg-emerald-100 dark:bg-emerald-500/15 border border-emerald-300 dark:border-emerald-500/25 text-[8px] font-medium text-emerald-700 dark:text-emerald-400/95 font-cairo whitespace-nowrap shrink-0",children:[a.jsx("svg",{className:"w-2 h-2 text-emerald-600 dark:text-emerald-500 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})}),"تم الإغلاق"]}),(m||g)&&a.jsxs("div",{className:"inline-flex items-center justify-center gap-0.5 shrink-0",children:[m&&a.jsx("button",{type:"button",onClick:()=>m(n.id),"aria-label":"حذف الصف",className:"inline-flex items-center justify-center w-4 h-4 rounded border border-stone-400 dark:border-red-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 transition-all shrink-0",title:"حذف الصف",children:a.jsx("svg",{className:"w-2 h-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),g&&a.jsx("button",{type:"button",onClick:()=>g(n.id),"aria-label":"طباعة الصف",className:"inline-flex items-center justify-center w-4 h-4 rounded border border-stone-500 dark:border-teal-500/25 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-stone-300 dark:hover:bg-teal-500/15 hover:text-teal-400 transition-all shrink-0",title:"طباعة هذه التقفيلة",children:a.jsxs("svg",{className:"w-2 h-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M6 9V2h12v7"}),a.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),a.jsx("path",{d:"M6 14h12v8H6z"})]})})]})]}):te?a.jsx("button",{type:"button",onClick:()=>te(n.id),title:"افراغ كل المدخلات في الصف النشط",className:"inline-flex items-center justify-center rounded px-0.5 py-0.5 bg-stone-200 dark:bg-teal-500/15 border border-stone-400 dark:border-teal-500/30 text-[8px] font-medium text-stone-800 dark:text-teal-400 font-cairo whitespace-nowrap w-full min-w-0 truncate hover:bg-stone-300 dark:hover:bg-teal-500/25 transition",children:"افراغ"}):a.jsx("span",{className:"inline-flex items-center justify-center rounded px-0.5 py-0.5 bg-stone-200 dark:bg-teal-500/15 border border-stone-400 dark:border-teal-500/30 text-[8px] font-medium text-stone-800 dark:text-teal-400 font-cairo whitespace-nowrap w-full min-w-0 truncate",children:"الشفت الحالي"})})]})]})}const Pg={Enter:"=","=":"=",Backspace:"⌫",Escape:"C",",":"."},Vg="programBalanceBank",no="اجمالى الموازنه";function Dg({onTransfer:n,hasActiveRow:e}={}){const[t,r]=I.useState("0"),[s,o]=I.useState(""),[l,u]=I.useState([]),[h,f]=I.useState(!1),m=I.useRef(null),g=I.useRef(null),[E,C]=I.useState(null);I.useLayoutEffect(()=>{if(!h){C(null);return}const F=m.current;if(!F){C(null);return}const Z=F.getBoundingClientRect();C({right:window.innerWidth-Z.right,bottom:window.innerHeight-Z.top+8})},[h]);const j=I.useRef("0"),L=I.useRef(""),V=I.useRef(null),O=I.useRef(!1),$=I.useRef(()=>{}),H=I.useRef(null),Y=I.useCallback(F=>{j.current=F,r(F)},[]),z=I.useCallback(F=>{r(F)},[]),te=I.useCallback((F,Z,B)=>{const ee=parseFloat(F)||0,le=parseFloat(B)||0;return Z?Z==="+"?ee+le:Z==="-"?ee-le:Z==="*"?ee*le:Z==="/"?le===0?0:ee/le:Z==="%"?le===0?0:ee*le/100:le:le},[]),v=I.useCallback(()=>{const F=te(L.current,V.current,j.current),Z=`${L.current} ${V.current} ${j.current} = ${F}`;u(B=>[Z,...B].slice(0,20)),Y(String(F)),o(""),L.current="",V.current=null,O.current=!0},[Y,te]),x=I.useCallback(F=>{if(F==="C"){Y("0"),o(""),u([]),f(!1),L.current="",V.current=null,O.current=!1;return}if(F==="⌫"){const Z=j.current;if(Z.length<=1){Y("0");return}Y(Z.slice(0,-1));return}if(F==="="){V.current&&v();return}if(["+","-","*","/","%"].includes(F)){V.current&&v(),L.current=j.current,V.current=F,o(Z=>Z+" "+F),O.current=!0;return}if(F==="."){if(O.current){Y("0."),j.current="0.",O.current=!1;return}if(j.current.includes("."))return;const Z=j.current+".";j.current=Z,V.current?z(String(te(L.current,V.current,Z))):Y(Z),o(B=>B+F);return}if(/\d/.test(F)){if(O.current)j.current=F,V.current?z(String(te(L.current,V.current,F))):Y(F),O.current=!1;else{const Z=j.current==="0"?F:j.current+F;j.current=Z,V.current?z(String(te(L.current,V.current,Z))):Y(Z)}o(Z=>Z+F)}},[Y,z,v,te]);$.current=x,I.useEffect(()=>{const F=Z=>{var he;const B=Z.target;if(B.closest("input, textarea, select")||!((he=H.current)!=null&&he.contains(B)))return;const ee=Pg[Z.key]??(Z.key.length===1?Z.key:"");!ee||!["C","⌫","%","/","*","-","+","=",".","0","1","2","3","4","5","6","7","8","9"].includes(ee)&&!/^\d$/.test(ee)||(Z.preventDefault(),$.current(ee))};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[]);const _=[["C","⌫","%","/"],["7","8","9","*"],["4","5","6","-"],["1","2","3","+"],["0",".","="]],w=F=>["+","-","*","/","%"].includes(F),k=F=>F==="="?"col-span-2 bg-teal-500 hover:bg-teal-600 dark:bg-teal-500/20 dark:hover:bg-teal-500/30 text-white dark:text-teal-400 font-bold text-lg border-2 border-teal-400 dark:border-teal-500/40 shadow-sm":w(F)?"bg-teal-100 hover:bg-teal-200 dark:bg-teal-500/20 dark:hover:bg-teal-500/30 text-teal-700 dark:text-teal-400 font-bold border-2 border-teal-300 dark:border-teal-500/40 flex items-center justify-center shadow-sm":F==="C"?"bg-red-100 hover:bg-red-200 dark:bg-red-500/20 dark:hover:bg-red-500/30 text-red-600 dark:text-red-400 border-2 border-red-300 dark:border-red-500/40 text-base shadow-sm":F==="⌫"?"bg-stone-400 hover:bg-stone-500 dark:bg-slate-600/40 dark:hover:bg-slate-500/50 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 text-base shadow-sm":"bg-white dark:bg-slate-700/40 hover:bg-stone-100 dark:hover:bg-slate-600/50 text-stone-900 dark:text-slate-200 border-2 border-stone-400 dark:border-white/10 active:scale-[0.98] text-base shadow-sm",A={"+":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:a.jsx("path",{d:"M12 5v14M5 12h14"})}),"-":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:a.jsx("path",{d:"M5 12h14"})}),"*":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M7 7l10 10M17 7L7 17"})}),"/":a.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M5 4l14 16"})}),"%":a.jsxs("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"6",cy:"6",r:"2.5"}),a.jsx("circle",{cx:"18",cy:"18",r:"2.5"}),a.jsx("path",{d:"M6 18L18 6"})]})},y=F=>A[F]?A[F]:a.jsx("span",{className:"inline-block leading-none",children:F});return a.jsxs("div",{ref:H,className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",tabIndex:0,title:"انقر هنا ثم استخدم لوحة المفاتيح. النتيجة لا تتغير عند الكتابة في الجدول.",children:[a.jsxs("div",{className:"bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-3 sm:px-4 py-1.5 sm:py-2 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shadow-sm",children:[a.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide min-w-0",children:[a.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 shrink-0",children:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2"}),a.jsx("path",{d:"M6 6h12M6 10h12"}),a.jsx("rect",{x:"6.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"10.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"14.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"6.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"10.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),a.jsx("rect",{x:"14.5",y:"17.5",width:"3",height:"3",rx:"0.5"})]})}),"الآلة الحاسبة"]}),a.jsx("button",{ref:m,type:"button",onClick:()=>f(F=>!F),className:`p-1.5 rounded-lg transition ${h?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:h?"إخفاء السجل":"سجل العمليات","aria-label":"سجل العمليات",children:a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]})})]}),a.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 gap-2 sm:gap-3 min-h-0 overflow-hidden",children:[a.jsxs("div",{className:"shrink-0 rounded-xl bg-stone-100 dark:bg-slate-900/80 border-2 border-stone-400 dark:border-slate-600 p-2 shadow-inner dark:ring-0",children:[a.jsx("div",{className:"text-right text-stone-700 text-xs min-h-[14px] font-cairo tabular-nums select-none","aria-hidden":"true",children:s||"​"}),a.jsx("div",{className:"w-full px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/50 border-2 border-stone-300 dark:border-transparent text-stone-900 dark:text-white text-right font-cairo text-xl sm:text-2xl font-semibold tabular-nums min-h-[2.25rem] flex items-center justify-end","aria-live":"polite","aria-label":`النتيجة: ${t}`,children:t})]}),n&&a.jsxs("button",{ref:g,type:"button",onClick:()=>{const F=parseFloat(t)||0;if(!e||F<=0)return;let Z;if(g.current){const B=g.current.getBoundingClientRect();Z={x:B.x,y:B.y,width:B.width,height:B.height}}n(F,Vg,Z),u(B=>[`مرحّل → ${no}: ${F}`,...B].slice(0,20)),Y("0"),o("")},disabled:!e||!parseFloat(t),title:`ترحيل الرقم إلى ${no}`,className:"shrink-0 w-full py-1.5 sm:py-2 rounded-xl text-xs sm:text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition flex items-center justify-center gap-2 shadow-sm",children:[a.jsx("svg",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل إلى ",no]}),a.jsx("div",{className:"grid grid-cols-4 grid-rows-5 gap-1.5 sm:gap-2 min-h-0 flex-1",children:_.flat().map(F=>a.jsx("button",{type:"button",onClick:()=>x(F),className:`min-h-0 rounded-lg sm:rounded-xl font-cairo transition-all duration-150 flex items-center justify-center ${k(F)}`,"aria-label":F==="⌫"?"حذف":F,children:y(F)},F))}),h&&E&&bn.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>f(!1)}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[180px] max-h-[280px] overflow-y-auto",style:{right:E.right,bottom:E.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"سجل العمليات"}),l.length===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لا يوجد سجل بعد"}):a.jsx("ul",{className:"space-y-1 mb-1 max-h-48 overflow-y-auto scrollbar-thin",children:l.map((F,Z)=>a.jsx("li",{className:"tabular-nums px-2 py-1 rounded-md bg-stone-100 dark:bg-slate-800/40 text-stone-800 dark:text-slate-300 border border-stone-300 dark:border-transparent",children:F},Z))}),a.jsx("button",{type:"button",onClick:()=>f(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]})}const Gr=[...ud],ro=()=>Object.fromEntries(Gr.map(n=>[n,0]));function Mg({onApplyToCash:n,hasActiveRow:e}){const[t,r]=I.useState(ro()),[s,o]=I.useState(ro()),[l,u]=I.useState(!1),h=I.useRef(null),[f,m]=I.useState(null);I.useLayoutEffect(()=>{if(!l){m(null);return}const O=h.current;if(!O){m(null);return}const $=O.getBoundingClientRect();m({right:window.innerWidth-$.right,bottom:window.innerHeight-$.top+8})},[l]);const g=Gr.reduce((O,$)=>O+(t[$]??0)*$,0),E=Gr.reduce((O,$)=>O+(s[$]??0)*$,0),C=I.useCallback((O,$)=>{r(H=>({...H,[O]:$}))},[]),j=I.useCallback(()=>{r(ro())},[]),L=I.useRef(null),V=I.useCallback(()=>{if(!e)return;let O;if(L.current){const $=L.current.getBoundingClientRect();O={x:$.x,y:$.y,width:$.width,height:$.height}}o({...t}),n(g,O),j()},[e,g,n,j,t]);return a.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[a.jsxs("div",{className:"relative bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-3 sm:px-4 py-1.5 sm:py-2 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide min-w-0",children:[a.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 shrink-0",children:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),a.jsx("path",{d:"M2 10h20M2 14h20M7 8v8M12 8v8M17 8v8"})]})}),"حاسبة الكاش"]}),a.jsx("button",{ref:h,type:"button",onClick:()=>u(O=>!O),className:`p-1.5 rounded-lg transition shrink-0 ${l?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:"آخر عمليات رُحّلت إلى الكاش","aria-label":"سجل العمليات",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]})})]}),a.jsx("span",{className:"text-xs font-semibold text-stone-800 dark:text-teal-300 font-cairo",children:"المجموع"}),a.jsx("span",{className:"text-sm font-semibold text-stone-800 dark:text-teal-400 font-cairo tabular-nums",children:g>0?`${g} ريال سعودي`:"— ريال سعودي"}),l&&f&&bn.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>u(!1)}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[280px] overflow-y-auto",style:{right:f.right,bottom:f.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"آخر عمليات رُحّلت إلى الكاش:"}),E===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-0.5 mb-1",children:Gr.map(O=>{const $=s[O]??0;return $===0?null:a.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:["فئة ",O,": ",$," × ",O," = ",$*O," ريال"]},O)})}),a.jsxs("p",{className:"border-t border-stone-300 dark:border-white/10 pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",E," ريال سعودي"]})]}),a.jsx("button",{type:"button",onClick:()=>u(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]}),a.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 min-h-0 overflow-hidden gap-3 sm:gap-4",children:[a.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 shrink-0",children:Gr.map(O=>{const $=(t[O]??0)*O;return a.jsxs("div",{className:"flex flex-col items-center gap-2 rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-teal-500/20 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] px-2.5 py-2.5 sm:px-3 sm:py-3 overflow-hidden min-w-[120px]",children:[a.jsxs("span",{className:"text-stone-800 dark:text-teal-400/90 text-xs font-cairo font-semibold tabular-nums w-full text-center",children:["فئة النقد ",O]}),a.jsxs("div",{className:"flex items-center gap-1.5 w-full min-w-0 justify-center",children:[a.jsx("button",{type:"button","aria-label":"نقص واحد",onClick:()=>C(O,Math.max(0,(t[O]??0)-1)),disabled:(t[O]??0)<=0,className:"flex items-center justify-center w-8 h-8 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-red-100 dark:hover:bg-red-500/20 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 disabled:opacity-40 disabled:pointer-events-none transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:a.jsx("span",{className:"text-base font-bold leading-none",children:"−"})}),a.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",value:t[O]===0||t[O]==null?"":String(t[O]),onChange:H=>{const Y=Fn(H.target.value).replace(/\D/g,"");C(O,Math.max(0,parseInt(Y,10)||0))},onFocus:H=>{const Y=H.target.value;(Y===""||Number(Y)===0)&&C(O,0)},className:"flex-1 min-w-[2.5rem] max-w-[3.5rem] px-1.5 py-1.5 rounded-md bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums cashbox-input focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-teal-500/50 dark:focus:ring-teal-500/25 focus:outline-none"}),a.jsx("button",{type:"button","aria-label":"زد واحد",onClick:()=>C(O,(t[O]??0)+1),className:"flex items-center justify-center w-8 h-8 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-stone-500 dark:hover:bg-emerald-500/20 hover:text-white dark:hover:text-emerald-400 hover:border-stone-600 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:a.jsx("span",{className:"text-base font-bold leading-none",children:"+"})})]}),$>0?a.jsxs("span",{className:"text-stone-800 dark:text-slate-300 text-xs font-semibold font-cairo tabular-nums w-full text-center",children:[$," ريال سعودي"]}):a.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-semibold font-cairo w-full text-center",children:"— ريال سعودي"})]},O)})}),a.jsxs("div",{className:"w-full py-3 px-4 rounded-xl text-sm font-cairo font-semibold bg-stone-200 dark:bg-slate-700/80 border-2 border-stone-400 dark:border-slate-600 text-stone-900 dark:text-slate-200 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[a.jsx("span",{children:"المجموع"}),a.jsx("span",{className:"text-base font-semibold tabular-nums",children:g>0?`${g} ريال سعودي`:"— ريال سعودي"})]}),a.jsxs("div",{className:"flex gap-2 shrink-0",children:[a.jsxs("button",{ref:L,type:"button",onClick:V,disabled:!e||g===0,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل للكاش"]}),a.jsxs("button",{type:"button",onClick:j,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح"]})]})]})]})}const Lg=[{field:"mada",label:"مدى"},{field:"visa",label:"فيزا"},{field:"mastercard",label:"ماستر كارد"}];function Og({onTransfer:n,onTransferToBudget:e,hasActiveRow:t,disableTransferButtons:r=!1}){const[s,o]=I.useState({mada:[],visa:[],mastercard:[]}),[l,u]=I.useState({mada:"",visa:"",mastercard:""}),[h,f]=I.useState({mada:[],visa:[],mastercard:[]}),[m,g]=I.useState([]),[E,C]=I.useState(null),[j,L]=I.useState(!1),V=I.useRef(null),O=I.useRef(null),[$,H]=I.useState(null);I.useLayoutEffect(()=>{if(j){const le=O.current;if(!le){H(null);return}const he=le.getBoundingClientRect();H({left:he.right+8,bottom:window.innerHeight-he.top+8});return}if(E===null){H(null);return}const B=V.current;if(!B){H(null);return}const ee=B.getBoundingClientRect();H({left:ee.right+8,bottom:window.innerHeight-ee.top+8})},[E,j]);const Y=I.useCallback(B=>B.reduce((ee,le)=>ee+le,0),[]),z=Y(s.mada),te=Y(s.visa),v=Y(s.mastercard),x=z+te+v,_=I.useCallback(B=>{const ee=Fn(l[B]).replace(",",".").replace(/[^\d.]/g,""),le=parseFloat(ee)||0;le<=0||(o(he=>({...he,[B]:[...he[B],le]})),u(he=>({...he,[B]:""})))},[l]),w=I.useCallback((B,ee)=>{o(le=>({...le,[B]:le[B].filter((he,xe)=>xe!==ee)}))},[]),k=I.useCallback((B,ee)=>{u(le=>({...le,[B]:ee}))},[]),A=I.useCallback(()=>{o({mada:[],visa:[],mastercard:[]}),u({mada:"",visa:"",mastercard:""})},[]),y=I.useCallback((B,ee)=>{if(!t)return;const le=s[B],he=B==="mada"?z:B==="visa"?te:v;if(he===0)return;f(ke=>({...ke,[B]:[...ke[B],...le]}));const xe=B==="mada"?[he,0,0]:B==="visa"?[0,he,0]:[0,0,he],me=ee?{sourceRect:ee,targetField:B}:void 0;n(xe[0],xe[1],xe[2],me),o(ke=>({...ke,[B]:[]})),u(ke=>({...ke,[B]:""}))},[t,z,te,v,n,s]),F=I.useRef(null),Z=I.useCallback(()=>{if(!(!t||x===0))if(e){g(ee=>[...ee,x]);let B;if(F.current){const ee=F.current.getBoundingClientRect();B={x:ee.x,y:ee.y,width:ee.width,height:ee.height}}e(x,B),A()}else f(B=>({mada:[...B.mada,...s.mada],visa:[...B.visa,...s.visa],mastercard:[...B.mastercard,...s.mastercard]})),n(z,te,v),A()},[t,x,z,te,v,n,e,s,A]);return a.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/50 shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[a.jsxs("div",{className:"bg-stone-200 dark:bg-slate-800 dark:border-slate-600 px-4 py-2 border-b-2 border-stone-400 dark:border-slate-600 flex items-center justify-between gap-2 shrink-0 shadow-sm",children:[a.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-stone-900 dark:text-slate-200 font-cairo tracking-wide",children:[a.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200",children:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"1"}),a.jsx("path",{d:"M2 10h20M7 14h2"})]})}),"حاسبه العمليات البنكيه"]}),a.jsx("span",{className:"text-xs font-semibold text-slate-700 font-cairo tabular-nums",children:x>0?`${x} ريال`:"—"})]}),a.jsxs("div",{className:"flex-1 flex flex-col p-4 min-h-0 overflow-hidden gap-4",children:[a.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1 min-h-0",children:Lg.map(({field:B,label:ee})=>{const le=s[B],he=Y(le);return a.jsxs("div",{className:"relative flex flex-col rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-teal-500/20 px-3 py-3 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-h-0",children:[a.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1 shrink-0",children:[a.jsx("span",{className:"text-stone-800 dark:text-teal-400/90 text-xs font-cairo font-semibold",children:ee}),a.jsxs("div",{className:"relative shrink-0",children:[a.jsx("button",{ref:E===B?V:void 0,type:"button",onClick:()=>{L(!1),C(xe=>xe===B?null:B)},className:`p-1.5 rounded-lg transition ${E===B?"bg-stone-300 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400":"text-stone-700 dark:text-slate-400 hover:text-stone-900 hover:bg-stone-300 dark:hover:text-teal-400 dark:hover:bg-white/5"}`,title:"كل العمليات المرحّلة لهذا النوع","aria-label":"سجل العمليات",children:a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]})}),E===B&&$&&bn.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>{C(null),L(!1)}}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[140px] max-h-[220px] overflow-y-auto",style:{left:$.left,bottom:$.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"كل العمليات المرحّلة إلى الصف:"}),h[B].length===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-0.5 mb-1",children:h[B].map((xe,me)=>a.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[xe," ريال"]},me))}),a.jsxs("p",{className:"border-t border-stone-200 dark:border-white/10 pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",Y(h[B])," ريال"]})]}),a.jsx("button",{type:"button",onClick:()=>C(null),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]}),a.jsx("p",{className:"text-[9px] text-stone-500 dark:text-slate-500 font-cairo mb-1.5 shrink-0",children:"أدخل المبلغ ثم +"}),a.jsxs("div",{className:"flex items-center gap-1.5 mb-2 shrink-0",children:[a.jsx("input",{type:"text",inputMode:"decimal",dir:"ltr",placeholder:"مبلغ العملية",value:l[B],onChange:xe=>{const ke=(Fn(xe.target.value).replace(",",".").replace(/[^\d.]/g,"").match(/^\d*\.?\d*/)||[""])[0];k(B,ke)},onKeyDown:xe=>{xe.key==="Enter"&&(xe.preventDefault(),_(B))},className:"flex-1 min-w-0 px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums placeholder:text-xs placeholder:text-stone-400 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-teal-500/50 dark:focus:ring-teal-500/25 focus:outline-none"}),a.jsx("button",{type:"button","aria-label":`إضافة لـ ${ee}`,onClick:()=>_(B),className:"flex items-center justify-center w-8 h-8 rounded-lg bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-stone-500 dark:hover:bg-emerald-500/20 hover:text-white dark:hover:text-emerald-400 hover:border-stone-600 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm",children:a.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})]}),a.jsx("div",{className:"flex-1 min-h-0 overflow-auto space-y-1",children:le.length===0?a.jsx("span",{className:"text-stone-600 dark:text-slate-500 text-[10px] font-cairo",children:"لا عمليات — أضف مبالغ بالزر +"}):le.map((xe,me)=>a.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-lg bg-white dark:bg-slate-700/50 px-2 py-1 border-2 border-stone-400 dark:border-white/10 shadow-sm",children:[a.jsxs("span",{className:"text-xs font-cairo tabular-nums text-stone-800 dark:text-slate-200",children:[xe," ريال"]}),a.jsx("button",{type:"button",onClick:()=>w(B,me),"aria-label":"حذف",className:"w-5 h-5 rounded flex items-center justify-center text-stone-600 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-500/20 transition shrink-0",children:a.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},`${B}-${me}`))}),a.jsxs("div",{className:"pt-2 mt-auto border-t-2 border-stone-400 dark:border-white/10 shrink-0 space-y-2",children:[a.jsxs("span",{className:"text-xs font-semibold font-cairo text-stone-800 dark:text-teal-400 tabular-nums block",children:["المجموع: ",he>0?`${he} ريال`:"—"]}),a.jsxs("button",{type:"button",onClick:xe=>{const me=xe.currentTarget.getBoundingClientRect(),ke={x:me.x,y:me.y,width:me.width,height:me.height};y(B,ke)},disabled:r||!t||he===0,title:r?"معطّل — تم جلب القيم من إكسل":`ترحيل ${ee} إلى الصف النشط`,className:"w-full py-2 rounded-lg text-xs font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-1.5",children:[a.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل ",ee]})]})]},B)})}),a.jsxs("div",{className:"w-full py-2.5 px-4 rounded-xl text-xs font-cairo font-semibold bg-stone-200 dark:bg-slate-700/80 border-2 border-stone-400 dark:border-slate-600 text-stone-900 dark:text-slate-200 flex items-center justify-between gap-6 shrink-0 flex-wrap shadow-sm",children:[a.jsxs("span",{className:"tabular-nums",children:["مدى ",a.jsx("span",{className:"font-bold",children:z})]}),a.jsxs("span",{className:"tabular-nums",children:["فيزا ",a.jsx("span",{className:"font-bold",children:te})]}),a.jsxs("span",{className:"tabular-nums",children:["ماستر ",a.jsx("span",{className:"font-bold",children:v})]}),a.jsxs("span",{className:"tabular-nums font-bold text-stone-900 dark:text-slate-200 px-2 py-0.5 rounded-md bg-white/60 dark:bg-slate-600/60 border border-stone-300 dark:border-slate-500",children:["المجموع = ",a.jsx("span",{className:"font-bold",children:x})]})]}),a.jsxs("div",{className:"flex gap-2 shrink-0 items-center",children:[e?a.jsxs("div",{ref:F,className:"flex flex-1 min-w-0 min-h-[56px] rounded-xl overflow-hidden border-2 border-teal-400 dark:border-emerald-500/40 bg-teal-500 dark:bg-emerald-500/20 hover:bg-teal-600 dark:hover:bg-emerald-500/30 disabled:opacity-50 disabled:pointer-events-none transition-all shadow-sm",children:[a.jsxs("button",{type:"button",onClick:Z,disabled:!t||x===0,title:"ترحيل المجموع إلى خانة اجمالى الموازنه في الصف النشط",className:"flex-1 min-w-0 min-h-[52px] py-3 px-3 flex items-center justify-center gap-2 text-sm font-cairo font-medium text-white dark:text-emerald-400 whitespace-nowrap",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الى اجمالى الموازنه"]}),a.jsxs("button",{ref:O,type:"button",onClick:B=>{B.stopPropagation(),C(null),L(ee=>!ee)},title:"سجل ترحيلات اجمالى الموازنه","aria-label":"سجل ترحيلات اجمالى الموازنه",className:`relative shrink-0 w-10 min-h-[52px] h-full flex items-center justify-center border-s-2 border-teal-400/50 dark:border-emerald-500/40 transition-colors ${j?"bg-teal-600/90 dark:bg-emerald-500/40 text-white":"hover:bg-teal-600/70 dark:hover:bg-emerald-500/30 text-white/90 hover:text-white"}`,children:[a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 6v6l4 2"})]}),m.length>0&&a.jsx("span",{className:"absolute top-0.5 end-0.5 min-w-[14px] h-3.5 px-0.5 rounded-full bg-white/90 dark:bg-black/40 text-teal-700 dark:text-emerald-300 text-[9px] font-bold flex items-center justify-center leading-none shadow-sm",children:m.length})]})]}):a.jsxs("button",{ref:F,type:"button",onClick:Z,disabled:!t||x===0,title:"ترحيل مدى + فيزا + ماستر كارد معاً إلى الصف النشط",className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الكل"]}),j&&$&&bn.createPortal(a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>L(!1)}),a.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[220px] overflow-y-auto",style:{left:$.left,bottom:$.bottom},children:[a.jsx("div",{className:"font-semibold text-stone-800 dark:text-teal-400 mb-1.5",children:"ترحيلات إلى اجمالى الموازنه:"}),m.length===0?a.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):a.jsxs(a.Fragment,{children:[a.jsx("ul",{className:"space-y-0.5 mb-1",children:m.map((B,ee)=>a.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[B.toLocaleString("ar-SA",{minimumFractionDigits:2})," ريال"]},ee))}),a.jsxs("p",{className:"border-t border-stone-200 dark:border-white/10 pt-1 font-semibold text-stone-800 dark:text-teal-400 tabular-nums",children:["المجموع: ",m.reduce((B,ee)=>B+ee,0).toLocaleString("ar-SA",{minimumFractionDigits:2})," ريال"]})]}),a.jsx("button",{type:"button",onClick:()=>L(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body),a.jsxs("button",{type:"button",onClick:A,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح الكل"]})]})]})]})}const Fg={success:{bg:"bg-emerald-100 dark:bg-emerald-500/15",border:"border-emerald-400 dark:border-emerald-500/40",icon:"text-emerald-700 dark:text-emerald-400"},error:{bg:"bg-red-100 dark:bg-red-500/15",border:"border-red-400 dark:border-red-500/40",icon:"text-red-700 dark:text-red-400"},warning:{bg:"bg-amber-100 dark:bg-amber-500/15",border:"border-amber-400 dark:border-amber-500/40",icon:"text-amber-700 dark:text-amber-400"},info:{bg:"bg-sky-100 dark:bg-sky-500/15",border:"border-sky-400 dark:border-sky-500/40",icon:"text-sky-700 dark:text-sky-400"}},Bg={success:a.jsx("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})}),error:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),warning:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M12 9v4M12 17h.01"}),a.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})]}),info:a.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 16v-4M12 8h.01"})]})},ic=3e3;function $g({message:n,type:e,onClose:t,position:r="bottom",autoHideMs:s=ic}){const o=I.useRef(t);o.current=t,I.useEffect(()=>{const h=s>0?s:ic,f=setTimeout(()=>o.current(),h);return()=>clearTimeout(f)},[n,s]);const l=Fg[e],u=r==="center"?"fixed top-1/2 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2":"fixed bottom-6 left-1/2 z-50 -translate-x-1/2";return a.jsxs("div",{role:"alert",className:`${u} flex items-center gap-3 px-4 py-3 rounded-2xl border ${l.bg} ${l.border} shadow-xl shadow-black/10 dark:shadow-black/20 backdrop-blur-md min-w-[200px] max-w-[90vw]`,children:[a.jsx("span",{className:l.icon,"aria-hidden":"true",children:Bg[e]}),a.jsx("span",{className:"font-cairo text-sm text-stone-800 dark:text-slate-200 flex-1",children:n}),a.jsx("button",{type:"button",onClick:t,className:"p-1 rounded-lg text-stone-600 dark:text-slate-400 hover:text-stone-900 dark:hover:text-slate-200 hover:bg-stone-300 dark:hover:bg-white/10 transition focus-visible:ring-2 focus-visible:ring-teal-400 dark:focus-visible:ring-amber-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none","aria-label":"إغلاق",children:a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})}const Ug=550;function qg({sourceRect:n,targetRect:e,amount:t,formatCurrency:r,rowId:s,field:o,onEnd:l,onLanded:u}){const[h,f]=I.useState("start"),m=I.useRef(e);m.current=e;const g=I.useRef(u);g.current=u,I.useEffect(()=>{if(h!=="start")return;const V=requestAnimationFrame(()=>f("fly"));return()=>cancelAnimationFrame(V)},[h]),I.useEffect(()=>{var O;if(h!=="done")return;(O=g.current)==null||O.call(g,s,o);const V=setTimeout(l,120);return()=>clearTimeout(V)},[h,l,s,o]);const E=()=>{f("done")},C=h==="start"?n.x:m.current.x,j=h==="start"?n.y:m.current.y,L=a.jsx("div",{role:"presentation","aria-hidden":!0,className:"transfer-fly-badge pointer-events-none fixed z-[9999] flex items-center justify-center rounded-xl border-2 border-teal-500 dark:border-teal-500/80 bg-teal-500/95 dark:bg-teal-500/90 text-white font-cairo font-bold text-sm tabular-nums shadow-lg px-3 py-2 min-w-[72px]",style:{left:n.x,top:n.y,width:Math.max(72,n.width),height:n.height,transform:`translate(${C-n.x}px, ${j-n.y}px)`,transition:h==="fly"?`transform ${Ug}ms cubic-bezier(0.25, 0.1, 0.25, 1)`:"none"},onTransitionEnd:E,children:a.jsx("span",{className:"opacity-95",children:r(t)})});return bn.createPortal(L,document.body)}const so=4,oc=5;function zg(n,e){const[t,r]=I.useState([]),[s,o]=I.useState([]),[l,u]=I.useState(1),[h,f]=I.useState(!0),[m,g]=I.useState(!1),E=I.useRef({}),C=I.useRef({}),j=I.useRef(new Map),L=t.length>0||s.length>0?[...t.sort((z,te)=>new Date(te.createdAt).getTime()-new Date(z.createdAt).getTime()),...s].sort((z,te)=>z.status!=="closed"&&te.status==="closed"?-1:z.status==="closed"&&te.status!=="closed"?1:z.status==="closed"&&te.status==="closed"?new Date((te.closedAt??"").toString()).getTime()-new Date((z.closedAt??"").toString()).getTime():new Date(te.createdAt).getTime()-new Date(z.createdAt).getTime()):[],V=I.useCallback(async(z,te=!1)=>{const v=j.current.get(z);if(v&&!te)return o(v.rows),g(v.hasMore),v;const x=z===1?so:oc;let _=null;if(z>1){const k=j.current.get(z-1);_=(k==null?void 0:k.lastDoc)??null}const w=await Qs(e,x,_);return j.current.set(z,w),o(w.rows),g(w.hasMore),w},[e]),O=I.useCallback(async z=>{var x;if(z<1)return;f(!0);const te=j.current.get(z-1);if(z>1&&!te)for(let _=1;_<z;_++){const w=_===1?so:oc,k=_===1?null:((x=j.current.get(_-1))==null?void 0:x.lastDoc)??null,A=await Qs(e,w,k);if(j.current.set(_,A),!A.hasMore&&_<z-1)break}await V(z),u(z),f(!1)},[e,V]),$=I.useCallback(async()=>{f(!0);const z=Os(e);r(z),j.current.clear(),u(1);const te=await V(1,!0);[...z,...(te==null?void 0:te.rows)??[]].forEach(x=>{C.current[x.id]=x}),f(!1)},[e,V]),H=I.useRef([]);H.current=L;const Y=I.useCallback(z=>{const te=typeof z=="function"?z(H.current):z,v=te.filter(_=>_.status!=="closed"),x=te.filter(_=>_.status==="closed");r(v),o(x),te.forEach(_=>{C.current[_.id]=_})},[]);return I.useEffect(()=>{let z=!1;return(async()=>{if(Os(e).length===0&&id(e,n),z)return;f(!0),r(Os(e)),j.current.clear(),u(1);const v=await Qs(e,so);if(z)return;j.current.set(1,v),o(v.rows),g(v.hasMore),[...Os(e),...v.rows].forEach(_=>{C.current[_.id]=_}),f(!1)})(),()=>{z=!0,Object.values(E.current).forEach(clearTimeout),E.current={}}},[n,e]),{rows:L,setRows:Y,loadRows:$,loading:h,debounceRef:E,rowDataRef:C,currentClosedPage:l,setCurrentClosedPage:u,goToClosedPage:O,hasMoreClosedPages:m,closedPagesCache:j.current}}function Wg(){const[n,e]=I.useState(()=>new Date),[t,r]=I.useState(null),[s,o]=I.useState(null),[l,u]=I.useState(0);return I.useEffect(()=>{const h=setInterval(()=>{const f=Date.now();e(new Date(f)),s!==null&&u(Math.max(0,Math.ceil((s-f)/1e3)))},1e3);return()=>clearInterval(h)},[s]),{liveNow:n,closingRowId:t,setClosingRowId:r,closingEndsAt:s,setClosingEndsAt:o,closingSecondsLeft:l,setClosingSecondsLeft:u}}function Hg(n,e){const[t,r]=I.useState(null),[s,o]=I.useState(null),l=I.useRef({}),u=I.useRef(null),h=I.useRef(null);h.current=(t==null?void 0:t.rowId)??null;const f=I.useCallback(m=>{var H;if(h.current===m)return;l.current={},o(null);const g=n.find(Y=>Y.id===m)??e.current[m],E=(g==null?void 0:g.expenses)??0;let C=(H=g==null?void 0:g.expenseItems)!=null&&H.length?g.expenseItems.map(Y=>({amount:String(Y.amount),description:Y.description||""})):[{amount:E?String(E):"",description:""}];const j=Y=>(Number(Y.amount)||0)!==0||String(Y.description||"").trim()!=="",L=(g==null?void 0:g.carriedExpenseCount)??0,V=C.slice(0,L).filter(j).length;C=C.filter(j);let O=V;const $=(g==null?void 0:g.status)==="closed";if(!$&&C.length>0){const Y=C[C.length-1];if(String(Y.amount||"").trim()!==""||String(Y.description||"").trim()!==""){const z=C.reduce((x,_)=>x+(Number(_.amount)||0),0),te=E-z,v=te>0?String(te):"";C=[...C,{amount:v,description:""}]}}!$&&C.length===0&&(C=[{amount:E?String(E):"",description:""}]),r({rowId:m,items:C,readOnly:$,carriedCount:O})},[n,e]);return I.useEffect(()=>{t||(u.current=null)},[t]),I.useEffect(()=>{if(s===null)return;const m=setTimeout(()=>o(null),3e3);return()=>clearTimeout(m)},[s]),{expenseModal:t,setExpenseModal:r,pulseExpenseDescriptionIndex:s,setPulseExpenseDescriptionIndex:o,openExpenseDetails:f,expenseAmountRef:l,expenseModalFocusedRowIdRef:u}}const dd="cashbox_theme",Xr=typeof document<"u"?document.documentElement:null,ac=typeof document<"u"?document.body:null;function Gg(){try{if(typeof localStorage>"u")return"dark";const n=localStorage.getItem(dd);return n==="light"||n==="dark"?n:"dark"}catch{return"dark"}}function So(n){if(!Xr)return;const e=n==="dark";Xr.classList.toggle("dark",e),ac&&ac.classList.toggle("dark",e);try{localStorage.setItem(dd,n)}catch{}Xr.offsetHeight}function Kg(n){try{window.dispatchEvent(new CustomEvent("cashbox-theme-change",{detail:n}))}catch{}}function hd(){if(!Xr)return;const e=Xr.classList.contains("dark")?"light":"dark";So(e),Kg(e)}const $s=10,Qg=2;function io(){return"ayman5255"}const Yg=[{id:"today",label:"اليوم"},{id:"yesterday",label:"أمس"},{id:"lastWeek",label:"الأسبوع الماضي"}],$r={corniche:"الكورنيش",andalusia:"الأندلس"};function lc(){hd()}function Jg({name:n,branch:e,onExit:t,onSwitchBranch:r,theme:s,onToggleTheme:o}){const l=I.useRef(null),[u,h]=I.useState(null),{rows:f,setRows:m,loadRows:g,debounceRef:E,rowDataRef:C,currentClosedPage:j,goToClosedPage:L,hasMoreClosedPages:V}=zg(n,e),{liveNow:O,closingRowId:$,setClosingRowId:H,setClosingEndsAt:Y,closingSecondsLeft:z,setClosingSecondsLeft:te}=Wg(),[v,x]=I.useState("today"),[_,w]=I.useState(null),[k,A]=I.useState(null),[y,F]=I.useState(null),[Z,B]=I.useState(new Set),[ee,le]=I.useState(null),[he,xe]=I.useState(null),[me,ke]=I.useState(null),[Qe,Ce]=I.useState(""),[Ne,nt]=I.useState(!1),[pt,Ee]=I.useState(!1),[bt,Et]=I.useState(null),[Yt,Xe]=I.useState(null),[ot,X]=I.useState(0),Tt=I.useRef(null),[_e,je]=I.useState(null),[ct,Re]=I.useState([]),[Be,yt]=I.useState(null),[Cr,Dt]=I.useState(!1),[Tn,Pe]=I.useState(null),[$e,_t]=I.useState(null),[Mt,Hn]=I.useState(""),[Gn,Kn]=I.useState(null),[ut,Jt]=I.useState(null);I.useEffect(()=>{const b=l.current;if(!b)return;const T=R=>{R.preventDefault(),R.stopPropagation(),R.stopImmediatePropagation(),lc()};return b.addEventListener("click",T,!0),()=>b.removeEventListener("click",T,!0)},[]),I.useEffect(()=>{($e==null?void 0:$e.mode)==="edit"&&Hn($e.row.notes??"")},[$e==null?void 0:$e.row.id,$e==null?void 0:$e.mode]);const{expenseModal:we,setExpenseModal:It,pulseExpenseDescriptionIndex:Lt,setPulseExpenseDescriptionIndex:Nr,openExpenseDetails:Qn,expenseAmountRef:dt,expenseModalFocusedRowIdRef:sn}=Hg(f,C);I.useEffect(()=>{if($===null||z>0)return;const b=$,T=f.find(R=>R.id===b);if(!T||T.status==="closed"){H(null),Y(null);return}H(null),Y(null),(async()=>{try{const R=E.current[b];R&&(clearTimeout(R),delete E.current[b],St(e,b,T));const M=eg(e,b),U=M?{...M,...T,id:b,status:"active"}:T,Q=Bs(U);await tg(e,b,{...U,employeeName:n,variance:Q});const K=U.expenses??0,ie=U.expenseCompensation??0,oe=Math.max(0,K-ie),ne=U.expenseItems??[],De=ie>0?oe>0?[{amount:oe,description:"مرحّل (صافي بعد التعويض)"}]:[]:ne.map(Me=>({amount:Me.amount,description:Me.description||""}));id(e,n,{expenses:oe,expenseItems:De,carriedExpenseCount:De.length}),await g(),w({msg:"تم إغلاق الشفت وإضافة صف جديد",type:"success"}),X(Me=>Me+1)}catch{w({msg:"فشل ترحيل الصف المغلَق إلى السحابة — تحقق من الاتصال",type:"error"})}})()},[z,$,f,n,g,e]);const At=I.useMemo(()=>{const b=f.filter(R=>R.status!=="closed").sort((R,M)=>new Date(M.createdAt).getTime()-new Date(R.createdAt).getTime()),T=tc(f.filter(R=>R.status==="closed"),v).sort((R,M)=>new Date((M.closedAt??"").toString()).getTime()-new Date((R.closedAt??"").toString()).getTime());return v==="today"?[...b,...T]:T},[f,v]),We=At,se=I.useMemo(()=>{var b;return((b=At.find(T=>T.status!=="closed"))==null?void 0:b.id)??null},[At]);I.useMemo(()=>{const b=f.filter(T=>T.status==="closed"&&T.closedAt);return b.length===0?null:b.sort((T,R)=>new Date((R.closedAt??"").toString()).getTime()-new Date((T.closedAt??"").toString()).getTime())[0]??null},[f]);const ht=I.useMemo(()=>f.find(b=>b.status!=="closed")??null,[f]),Ot=I.useMemo(()=>{if(!ht)return!1;const b=ht.cash??0,T=ht.programBalanceCash??0,R=ht.programBalanceBank??0;return b>0&&T>0&&R>0},[ht]),Vi=I.useCallback(async b=>{var lt;const T=(lt=b.target.files)==null?void 0:lt[0];if(b.target.value="",!T)return;const R=ht;if(!R){w({msg:"لا يوجد صف نشط لملء البيانات",type:"warning"});return}let M;try{M=await T.arrayBuffer()}catch{w({msg:"تعذر قراءة الملف",type:"error"});return}const U=new Date(0),{sums:Q,counts:K,details:ie,employeeName:oe,employeeNamesList:ne,error:ae}=Tg(M,U);if(ae){w({msg:ae,type:"error"});return}je(ie),Re(ne??[]);const De=E.current[R.id];De&&(clearTimeout(De),delete E.current[R.id],St(e,R.id,C.current[R.id]??R));const Me=C.current[R.id]??R,$t={mada:Q.mada,visa:Q.visa,mastercard:Q.mastercard,bankTransfer:Q.bankTransfer},Ut=Q.mada+Q.visa+Q.mastercard,ft=oe&&oe.trim()!==""?oe.trim():Me.employeeName,Rt={...Me,...$t,employeeName:ft,variance:Bs({...Me,...$t})};St(e,R.id,Rt),C.current[R.id]=Rt,m(er=>er.map(an=>an.id===R.id?Rt:an)),g();const gt=[];K.mada>0&&gt.push(`مدى ${G(Q.mada)}`),K.visa>0&&gt.push(`فيزا ${G(Q.visa)}`),K.mastercard>0&&gt.push(`ماستر كارد ${G(Q.mastercard)}`),K.bankTransfer>0&&gt.push(`تحويل بنكي ${G(Q.bankTransfer)}`);const Nn=gt.length>0?gt.join(" — ")+` — المجموع: ${G(Ut)}`:"";w({msg:Ut>0?`تم استخراج: ${Nn}`:"لم يُعثر على مدى/فيزا/ماستر كارد/تحويل بنكي في الملف",type:Ut>0?"success":"info"})},[ht,g]),Di=I.useCallback(()=>{var b;(b=Tt.current)==null||b.click()},[]),on=I.useCallback(b=>{const T=E.current[b];T&&(clearTimeout(T),delete E.current[b]);const R=f.find(K=>K.id===b),M=(R==null?void 0:R.carriedExpenseCount)??0,U=((R==null?void 0:R.expenseItems)??[]).slice(0,M),Q=U.reduce((K,ie)=>K+ie.amount,0);if(St(e,b,{expenses:Q,expenseItems:U}),R){const K={...R,expenses:Q,expenseItems:U,variance:Bs({...R})};C.current[b]=K,m(ie=>ie.map(oe=>oe.id!==b?oe:K))}g(),dt.current={}},[f,g]),ms=I.useCallback((b,T,R)=>{It(M=>M?{...M,items:M.items.map((U,Q)=>Q===b?{...U,[T]:String(R)}:U)}:null)},[]),Mi=I.useCallback(()=>{dt.current={},It(b=>b?{...b,items:[...b.items,{amount:"",description:""}]}:null)},[]),Yn=I.useCallback(b=>{It(T=>{if(!T)return T;const R=T.carriedCount??0;return b<R||T.items.length<=1?T:(dt.current={},{...T,items:T.items.filter((M,U)=>U!==b)})})},[]),ps=I.useCallback((b,T)=>{Ce(""),Ee(!1),ke({rowId:b,itemIndex:T,step:"confirm"})},[]),gs=I.useCallback(()=>{me&&ke(b=>b?{...b,step:"code"}:null)},[me]),Jn=I.useCallback(()=>{if(!me)return;if(Qe.trim()!==io()){Ee(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ee(!1);const{rowId:b,itemIndex:T}=me,R=f.find(oe=>oe.id===b)??C.current[b];if(!R){ke(null),Ce("");return}const M=(R.expenseItems??[]).slice(),U=R.carriedExpenseCount??0;if(T>=M.length||T>=U){ke(null),Ce("");return}M.splice(T,1);const Q=Math.max(0,U-1),K=M.reduce((oe,ne)=>oe+ne.amount,0);St(e,b,{expenseItems:M,expenses:K,carriedExpenseCount:Q});const ie={...R,expenseItems:M,expenses:K,carriedExpenseCount:Q};C.current[b]=ie,m(oe=>oe.map(ne=>ne.id===b?ie:ne)),It(oe=>{if(!oe||oe.rowId!==b)return oe;const ne=oe.items.filter((ae,De)=>De!==T);return{...oe,items:ne,carriedCount:Q}}),dt.current={},g(),ke(null),Ce(""),nt(!1),w({msg:"تم حذف البند المرحّل",type:"success"})},[me,Qe,f,g,St]),Ct=I.useCallback(()=>{if(!we)return;const b=we.rowId,T=we.carriedCount??0,R=we.items.map((K,ie)=>{const oe=dt.current[ie]!==void 0?dt.current[ie]:String(K.amount??"");return{amount:Number(String(oe).replace(/,/g,""))||0,description:String(K.description||"").trim(),index:ie}}),M=R.find(K=>K.index>=T&&K.amount>0&&!K.description);if(M){w({msg:"يجب إدخال وصف لكل بند فيه مبلغ",type:"warning"}),Nr(M.index);return}const U=R.map(({amount:K,description:ie})=>({amount:K,description:ie})),Q=U.reduce((K,ie)=>K+ie.amount,0);St(e,b,{expenseItems:U,expenses:Q}),It(null),g(),requestAnimationFrame(()=>{setTimeout(()=>{const K=document.querySelectorAll(`tr[data-row-id="${b}"] input.cashbox-input`);let ie=K[5]??K[0];for(let oe=5;oe<K.length;oe++)if(!K[oe].disabled){ie=K[oe];break}ie==null||ie.focus()},0)})},[we,g,St]),Li=I.useCallback(()=>{w({msg:"يجب إدخال رصيد البرنامج كاش أولاً",type:"warning"})},[]),Ft=I.useCallback(b=>{w({msg:`تعويض المصروفات يجب ألا يتخطى مبلغ المصروفات (المصروفات: ${G(b)})`,type:"warning"})},[]),Rr=I.useCallback(b=>{const T=f.find(M=>M.id===b);if(!T||T.status==="closed")return;const R={cash:0,sentToTreasury:0,expenseCompensation:0,expenses:0,expenseItems:[],carriedExpenseCount:0,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0};St(e,b,R),bn.flushSync(()=>{m(M=>{const U=M.map(K=>K.id!==b?K:{...K,...R}),Q=U.find(K=>K.id===b);return Q&&(C.current[b]=Q),U})}),g(),Kn(null),X(M=>M+1),w({msg:"تم إفراغ كل المدخلات في الصف النشط ومسح سجلات الحاسبات",type:"success"})},[f,g]),xs=I.useCallback(()=>{Gn&&Rr(Gn)},[Gn,Rr]),Sr=I.useCallback(()=>{Kn(null)},[]),Ve=I.useCallback((b,T,R)=>{const M=f.find(ie=>ie.id===b);if(!M||M.status==="closed")return;const U={[T]:R};if(T==="expenses"&&typeof R=="number"){const ie=M.expenseCompensation??0;R<ie&&(U.expenseCompensation=R)}if(Xg.includes(T)){const ie={...M,...U};U.variance=Bs(ie)}const K=E.current[b];K&&clearTimeout(K),E.current[b]=setTimeout(()=>{const ie=C.current[b];ie&&St(e,b,ie),g()},400),bn.flushSync(()=>{m(ie=>{const oe=ie.map(ae=>ae.id!==b?ae:{...ae,...U}),ne=oe.find(ae=>ae.id===b);return ne&&(C.current[b]=ne),oe})})},[f,g]),bs=I.useCallback(b=>{const T=f.find(U=>U.id===b);if(!T||T.status!=="active")return;const R=Js(T),M=Ys(T);if(R!==0||M!==0){Xe({rowId:b,cashVar:R,bankVar:M});return}w({msg:"الصندوق مظبوط — تم عمل جيد ✓",type:"success"}),H(b),Y(Date.now()+$s*1e3),te($s)},[f]),Oi=I.useCallback(()=>{if(!Yt)return;const{rowId:b}=Yt;Xe(null),H(b),Y(Date.now()+$s*1e3),te($s)},[Yt]),ys=I.useCallback(()=>{Xe(null)},[]),Fi=I.useCallback(()=>{H(null),Y(null),te(0),w({msg:"تم التراجع — يمكنك تعديل الصف",type:"info"})},[]),Nt=I.useCallback((b,T,R)=>{if(b.length===0){w({msg:"لا توجد تقفيلات للطباعة",type:"warning"});return}const M=window.open("","_blank","width=800,height=900");if(!M){w({msg:"السماح بالنوافذ المنبثقة للطباعة",type:"warning"});return}const{firstActiveId:U,currentUserName:Q,branchLabel:K}=R??{},ie=K?`<p class="page-branch">فرع ${K.replace(/&/g,"&amp;").replace(/</g,"&lt;")}</p>`:"",oe=ud.join("، "),ne=b.map((ae,De)=>{const $t=((ae.status==="closed"?ae.employeeName:U&&ae.id===U&&Q?Q:ae.employeeName)??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Ut=ae.mada+ae.visa+ae.mastercard,ft=Ys(ae),Rt=Js(ae),gt=ae.expenses??0,Nn=ae.expenseCompensation??0,lt=ae.sentToTreasury??0,er=ae.expenseItems??[],an=Rt>0?"variance pos":Rt<0?"variance neg":"variance",tr=ft>0?"variance pos":ft<0?"variance neg":"variance",Ts=er.length>0?`<div class="block expenses-detail">
                  <div class="block-title">تفاصيل المصروفات</div>
                  <div class="block-body">${er.map(rr=>`<div class="expense-item">${G(rr.amount)} — ${(rr.description||"—").replace(/</g,"&lt;")}</div>`).join("")}</div>
                </div>`:"",Rn=`<div class="block notes-block"><div class="block-title">ملاحظات الشيفت</div><div class="block-body">${(ae.notes||"").trim().length>0?(ae.notes||"").replace(/</g,"&lt;").replace(/\n/g,"<br>"):"— لا توجد —"}</div></div>`,Mr=(De>0?"page-break-before: always;":"")+(De<b.length-1?"page-break-after: always;":"");return`
            <div class="page" ${Mr?`style="${Mr}"`:""}>
              <header class="page-header">
                <h1 class="page-title">تقرير تقفيلة</h1>
                ${ie}
                <p class="page-sub">${$t}</p>
                <p class="page-time">${ae.closedAt?mi(ae.closedAt):"—"}</p>
              </header>
              <div class="page-main">
              <div class="grid">
                <div class="block cash-block">
                  <div class="block-title">الكاش</div>
                  <div class="block-body">
                    <div class="row"><span class="label">كاش</span><span class="val">${G(ae.cash)}</span></div>
                    <div class="row"><span class="label">مرسل للخزنة</span><span class="val">${G(lt)}</span></div>
                    <div class="row"><span class="label">المصروفات</span><span class="val">${G(gt)}</span></div>
                    <div class="row"><span class="label">تعويض مصروفات</span><span class="val">${G(Nn)}</span></div>
                    <div class="row"><span class="label">رصيد البرنامج كاش</span><span class="val">${G(ae.programBalanceCash)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف الكاش</span><span class="val ${an}">${G(Rt)}</span></div>
                  </div>
                </div>
                <div class="block bank-block">
                  <div class="block-title">البنك</div>
                  <div class="block-body">
                    <div class="row"><span class="label">مدى</span><span class="val">${G(ae.mada)}</span></div>
                    <div class="row"><span class="label">فيزا</span><span class="val">${G(ae.visa)}</span></div>
                    <div class="row"><span class="label">ماستر كارد</span><span class="val">${G(ae.mastercard)}</span></div>
                    <div class="row"><span class="label">تحويل بنكي</span><span class="val">${G(ae.bankTransfer)}</span></div>
                    <div class="row"><span class="label">بنك نزيل (مدى+فيزا+ماستر)</span><span class="val total">${G(Ut)}</span></div>
                    <div class="row"><span class="label">اجمالى الموازنه</span><span class="val">${G(ae.programBalanceBank??0)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف البنك</span><span class="val ${tr}">${G(ft)}</span></div>
                  </div>
                </div>
              </div>
              ${Ts}
              ${Rn}
              </div>
              <footer class="page-footer">
                <p class="footer-formulas">فئات الكاش (ريال): ${oe}. — بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط) — انحراف البنك = بنك نزيل − اجمالى الموازنه — انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش</p>
                <p>${K?`فرع ${K} — `:""}تاريخ الطباعة: ${mi(new Date)} ${b.length>1?` — تقفيلة ${De+1} من ${b.length}`:""}</p>
              </footer>
            </div>`}).join("");M.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
          <head>
            <meta charset="utf-8">
            <title>${K?`${T} — فرع ${K}`:T}</title>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
            <style>
              * { box-sizing: border-box; margin: 0; padding: 0; }
              @page { size: A4 portrait; margin: 12mm; }
              html, body {
                font-family: 'Cairo', sans-serif;
                background: #fff;
                color: #1e293b;
                font-size: 13px;
                line-height: 1.4;
                padding: 0;
                margin: 0;
                height: auto;
              }
              @media print {
                html, body {
                  padding: 0 !important;
                  margin: 0 !important;
                  height: auto !important;
                  min-height: unset !important;
                  overflow: visible !important;
                  background: #fff;
                  font-size: 12px !important;
                  line-height: 1.45 !important;
                }
                .page {
                  box-shadow: none !important;
                  margin: 0 auto !important;
                  min-height: 273mm !important;
                  height: 273mm !important;
                  max-height: 273mm !important;
                  page-break-inside: avoid;
                  display: flex !important;
                  flex-direction: column !important;
                  justify-content: space-between !important;
                }
                .page:last-child { page-break-after: avoid !important; }
                .page-main { flex: 1 1 auto; display: flex; flex-direction: column; justify-content: flex-start; min-height: 0; }
              }
              .page {
                width: 100%;
                max-width: 186mm;
                margin: 0 auto 12px;
                padding: 10px 12px 14px;
                background: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                min-height: 273mm;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
              }
              .page-main { flex: 1 1 auto; min-height: 0; }
              .page-header {
                text-align: center;
                padding: 14px 0 12px;
                border-bottom: 2px solid #0f172a;
                margin-bottom: 14px;
              }
              .page-title {
                font-size: 1.5rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 4px;
              }
              .page-sub {
                font-size: 1.15rem;
                font-weight: 600;
                color: #334155;
                margin-bottom: 3px;
              }
              .page-time {
                font-size: 1rem;
                color: #64748b;
              }
              .page-branch {
                font-size: 1.05rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 4px;
              }
              .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
                margin-bottom: 14px;
              }
              .block {
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                overflow: hidden;
              }
              .block-title {
                background: #f1f5f9;
                padding: 10px 12px;
                font-weight: 700;
                font-size: 1rem;
                color: #334155;
                border-bottom: 1px solid #e2e8f0;
              }
              .block-body {
                padding: 10px 12px;
                background: #fff;
              }
              .block .row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid #f1f5f9;
                font-size: 0.95rem;
              }
              .block .row:last-child { border-bottom: none; }
              .block .row.highlight { font-weight: 700; background: #f8fafc; margin: 4px -12px -4px; padding: 8px 12px; }
              .block .row.variance-row {
                margin: 8px -12px -4px;
                padding: 10px 12px;
                background: #f1f5f9;
                border-top: 1px solid #cbd5e1;
                font-size: 1.05rem;
              }
              .block .row.variance-row .label {
                font-size: 1.05rem;
                font-weight: 800;
                color: #0f172a;
              }
              .block .row.variance-row .val { font-size: 1.05rem; font-weight: 800; }
              .block .label { color: #475569; font-size: 0.95rem; }
              .block .val {
                font-variant-numeric: tabular-nums;
                font-weight: 500;
                color: #0f172a;
                font-size: 0.95rem;
              }
              .block .val.total { font-weight: 700; }
              .block .val.variance.pos { color: #059669; }
              .block .val.variance.neg { color: #dc2626; }
              .expenses-detail, .notes-block {
                margin-top: 12px;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                overflow: hidden;
              }
              .expenses-detail .block-title, .notes-block .block-title {
                padding: 8px 12px;
                font-size: 0.95rem;
              }
              .expenses-detail .block-body, .notes-block .block-body {
                padding: 8px 12px;
              }
              .expense-item {
                padding: 6px 12px;
                font-size: 0.9rem;
                border-bottom: 1px solid #f1f5f9;
              }
              .expense-item:last-child { border-bottom: none; }
              .page-footer {
                margin-top: 14px;
                padding-top: 12px;
                border-top: 1px solid #e2e8f0;
                font-size: 0.85rem;
                color: #64748b;
                text-align: center;
                flex-shrink: 0;
              }
              .page-footer .footer-formulas {
                font-size: 0.75rem;
                color: #94a3b8;
                margin-bottom: 6px;
                line-height: 1.4;
              }
            </style>
          </head>
          <body>
            ${ne}
            <script>setTimeout(function(){ window.print(); window.close(); }, 350);<\/script>
          </body>
        </html>
      `),M.document.close()},[]),_s=I.useCallback(async()=>{const T=await nd(e,v==="today"?50:v==="yesterday"?100:200),R=tc(T,v);Nt(R,`تقرير التقفيلات — ${v==="today"?"اليوم":v==="yesterday"?"أمس":"الأسبوع الماضي"}`,{firstActiveId:se,currentUserName:n,branchLabel:$r[e]})},[v,Nt,se,n,e]),jr=I.useCallback(b=>{B(T=>{const R=new Set(T);return R.has(b)?R.delete(b):R.add(b),R})},[]),In=I.useCallback(()=>{if(Z.size===0){w({msg:"لم تحدد أي صفوف للطباعة",type:"warning"});return}const b=At.filter(T=>Z.has(T.id));Nt(b,"طباعة الصفوف المحددة",{firstActiveId:se,currentUserName:n,branchLabel:$r[e]})},[Z,At,Nt,se,n,e]),Xt=I.useCallback(b=>{const T=At.find(R=>R.id===b);T&&Nt([T],"طباعة تقفيلة",{firstActiveId:se,currentUserName:n,branchLabel:$r[e]})},[At,Nt,se,n,e]),Pr=I.useCallback(b=>{Ce(""),Ee(!1),le({rowId:b,step:"confirm"})},[]),Bi=I.useCallback(()=>{ee&&le(b=>b?{...b,step:"code"}:null)},[ee]),Vr=I.useCallback(async()=>{if(!ee)return;if(Qe.trim()!==io()){Ee(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ee(!1);const b=f.find(R=>R.id===ee.rowId),T=(b==null?void 0:b.status)==="closed";await ng(e,ee.rowId,T),B(R=>{const M=new Set(R);return M.delete(ee.rowId),M}),await g(),le(null),Ce(""),nt(!1),w({msg:"تم حذف الصف",type:"success"})},[ee,Qe,g,e,f]),ws=I.useCallback(()=>{Ce(""),Ee(!1),xe({step:"confirm"})},[]),vs=I.useCallback(()=>{he&&xe(b=>b?{...b,step:"code"}:null)},[he]),Xn=I.useCallback(async()=>{if(he){if(Qe.trim()!==io()){Ee(!0),w({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Ee(!1),await rg(e),B(new Set),await g(),xe(null),Ce(""),nt(!1),w({msg:"تم حذف كل التقفيلات المغلقة",type:"success"})}},[he,Qe,g,e]),Zt=b=>b==="cash"?"الكاش":b==="programBalanceBank"?"اجمالى الموازنه":b==="mada"?"مدى":b==="visa"?"فيزا":b==="mastercard"?"ماستر كارد":"تحويل بنكي",at=I.useCallback((b,T)=>{const R=document.querySelector(`[data-transfer-target][data-field="${T}"][data-row-id="${b}"]`);if(!R)return null;const M=R.getBoundingClientRect();return{x:M.x,y:M.y,width:M.width,height:M.height}},[]),ks=I.useCallback((b,T)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل الكاش إليه",type:"warning"});return}const R=f.find(U=>U.id===se),M=(R==null?void 0:R.cash)??0;if(M>0){A({amount:b,currentValue:M,field:"cash"});return}if(T){const U=at(se,"cash");U&&Et({sourceRect:{...T},targetRect:{...U},amount:b,rowId:se,field:"cash"})}Ve(se,"cash",b),w({msg:`تم ترحيل ${G(b)} إلى خانة الكاش`,type:"success"})},[se,f,Ve,at]),Es=I.useCallback((b,T)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const R=f.find(U=>U.id===se);if(!R)return;const M=R.programBalanceBank??0;if(T){const U=at(se,"programBalanceBank");U&&Et({sourceRect:{...T},targetRect:{...U},amount:b,rowId:se,field:"programBalanceBank"})}Ve(se,"programBalanceBank",M+b),w({msg:`تم ترحيل ${G(b)} إلى اجمالى الموازنه`,type:"success"})},[se,f,Ve,at]),$i=I.useCallback((b,T,R,M)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل العمليات البنكية إليه",type:"warning"});return}const U=f.find(De=>De.id===se);if(!U)return;const Q=U.mada??0,K=U.visa??0,ie=U.mastercard??0;if(Q>0&&b>0||K>0&&T>0||ie>0&&R>0){F({mada:b,visa:T,mastercard:R,currentMada:Q,currentVisa:K,currentMaster:ie});return}const ne=b>0?b:T>0?T:R;if(M!=null&&M.sourceRect&&(M!=null&&M.targetField)&&ne>0){const De=at(se,M.targetField);De&&Et({sourceRect:{...M.sourceRect},targetRect:{...De},amount:ne,rowId:se,field:M.targetField})}Ve(se,"mada",Q+b),Ve(se,"visa",K+T),Ve(se,"mastercard",ie+R);const ae=[];b>0&&ae.push(`مدى ${G(b)}`),T>0&&ae.push(`فيزا ${G(T)}`),R>0&&ae.push(`ماستر ${G(R)}`),w({msg:`تم ترحيل العمليات البنكية: ${ae.join("، ")||"—"}`,type:"success"})},[se,f,Ve,at]),Bt=I.useCallback(b=>{if(!y||!se)return;const{mada:T,visa:R,mastercard:M,currentMada:U,currentVisa:Q,currentMaster:K}=y;if(b){const oe=b.currentTarget.getBoundingClientRect(),ne={x:oe.x,y:oe.y,width:oe.width,height:oe.height},ae=T>0?"mada":R>0?"visa":"mastercard",De=T>0?T:R>0?R:M,Me=at(se,ae);Me&&Et({sourceRect:{...ne},targetRect:{...Me},amount:De,rowId:se,field:ae})}Ve(se,"mada",U+T),Ve(se,"visa",Q+R),Ve(se,"mastercard",K+M);const ie=[];T>0&&ie.push(`مدى ${G(T)}`),R>0&&ie.push(`فيزا ${G(R)}`),M>0&&ie.push(`ماستر ${G(M)}`),w({msg:`تم ترحيل العمليات البنكية: ${ie.join("، ")||"—"}`,type:"success"}),F(null)},[y,se,Ve,at]),wt=I.useCallback(()=>{F(null)},[]),An=I.useCallback(()=>{if(!ut)return;Ve(ut.rowId,ut.field,ut.newValue);const b=Zt(ut.field);w({msg:`تم تعديل ${b} إلى ${G(ut.newValue)}`,type:"success"}),Jt(null)},[ut,Ve]),Cn=I.useCallback(()=>{Jt(null)},[]),Dr=I.useCallback(b=>{if(!(!k||!se)){if(b){const T=b.currentTarget.getBoundingClientRect(),R={x:T.x,y:T.y,width:T.width,height:T.height},M=at(se,k.field);M&&Et({sourceRect:{...R},targetRect:{...M},amount:k.amount,rowId:se,field:k.field})}Ve(se,k.field,k.amount),w({msg:`تم ترحيل ${G(k.amount)} إلى ${Zt(k.field)}`,type:"success"}),A(null)}},[k,se,Ve,at]),Te=I.useCallback(()=>{A(null)},[]),Zn=I.useCallback((b,T,R)=>{if(!se){w({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const M=f.find(Q=>Q.id===se),U=M?M[T]??0:0;if(U>0){A({amount:b,currentValue:U,field:T});return}if(R){const Q=at(se,T);Q&&Et({sourceRect:{...R},targetRect:{...Q},amount:b,rowId:se,field:T})}Ve(se,T,b),w({msg:`تم ترحيل ${G(b)} إلى ${Zt(T)}`,type:"success"})},[se,f,Ve,at]);return a.jsxs("div",{className:"min-h-screen min-h-[100dvh] page-bg-warm dark:bg-slate-900 text-stone-900 dark:text-slate-200 font-cairo page-bg-pattern flex flex-col",children:[a.jsx("header",{className:"header-glass sticky top-0 z-40 border-b-2 border-stone-300 dark:border-white/10 shadow-sm dark:shadow-none safe-top",children:a.jsxs("div",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-2 flex flex-wrap items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const{label:b,kind:T}=Ig(O),R="w-4 h-4 shrink-0",M={morning:a.jsxs("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),a.jsx("path",{d:"M12 2v1.5M12 20.5V22M4.22 4.22l1.06 1.06M18.72 18.72l1.06 1.06M2 12h1.5M20.5 12H22M4.22 19.78l1.06-1.06M18.72 5.28l1.06-1.06"})]}),noon:a.jsxs("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),a.jsx("path",{d:"M12 2.5v2M12 19.5V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2.5 12H5M19 12h2.5M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"}),a.jsx("path",{d:"M12 7.5v4l2.5 2.5",strokeWidth:"1.8"})]}),evening:a.jsxs("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}),a.jsx("path",{d:"M12 2v3M12 19v3M3.5 12H6.5M17.5 12h3M4.93 4.93l2.12 2.12M16.95 16.95l2.12 2.12M4.93 19.07l2.12-2.12M16.95 7.05l2.12-2.12",strokeWidth:"1.2",opacity:"0.7"})]}),night:a.jsx("svg",{className:R,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})},U=T==="night";return a.jsxs("h1",{className:"flex items-center gap-1.5 sm:gap-2 py-1.5 px-2 sm:px-3 rounded-lg sm:rounded-xl border-2 border-stone-300 dark:border-white/10 bg-[#f0ebe3] dark:bg-slate-800/50 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)]",children:[a.jsx("span",{className:`flex items-center justify-center w-7 h-7 sm:w-8 sm:h-8 rounded-lg shrink-0 ${U?"bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300":"bg-stone-200 text-stone-700 dark:bg-teal-500/15 dark:text-teal-400"}`,children:M[T]}),a.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-stone-800 dark:text-slate-200 tracking-tight flex items-center gap-1 min-w-0 truncate max-w-[120px] sm:max-w-none",children:[a.jsx("span",{className:U?"text-indigo-700 dark:text-indigo-300/90":"text-stone-800 dark:text-teal-400/95",children:b}),a.jsx("span",{className:"text-stone-600 dark:text-slate-400 font-normal",children:"،"}),a.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-cairo text-right",children:n})]})]})})(),a.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-lg bg-stone-200 dark:bg-teal-500/15 text-stone-800 dark:text-teal-300 text-xs font-cairo font-semibold border-2 border-stone-400 dark:border-teal-500/30 shadow-sm dark:shadow-none",children:["فرع ",$r[e]]}),a.jsx("div",{className:"relative z-[50] rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsx("button",{ref:l,type:"button",onClick:b=>{b.preventDefault(),b.stopPropagation(),lc()},className:"flex items-center justify-center w-9 h-9 rounded-lg text-stone-700 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 transition cursor-pointer select-none touch-manipulation",title:s==="dark"?"الوضع الفاتح":"الوضع الداكن","aria-label":s==="dark"?"الوضع الفاتح":"الوضع الداكن",children:s==="dark"?a.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("circle",{cx:"12",cy:"12",r:"4"}),a.jsx("path",{d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"})]}):a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})}),a.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsxs("button",{type:"button",onClick:()=>h(e==="corniche"?"andalusia":"corniche"),className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 text-xs font-cairo transition",title:"تغيير الفرع",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),a.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),a.jsx("span",{children:"تغيير الفرع"})]})}),a.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-red-600 hover:text-red-700 hover:bg-red-500/15 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-500/10 text-xs font-cairo font-semibold transition border border-red-200 dark:border-red-500/30",title:"خروج — العودة لتسجيل الاسم والفرع",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"}),a.jsx("polyline",{points:"16 17 21 12 16 7"}),a.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),a.jsx("span",{children:"خروج"})]})}),a.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:a.jsxs("button",{type:"button",onClick:t,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-stone-900 hover:bg-stone-300 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 text-xs font-cairo transition",title:"تغيير المستخدم",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("circle",{cx:"12",cy:"8",r:"4"}),a.jsx("path",{d:"M4 20c0-3.3 2.7-6 6-6s6 2.7 6 6"}),a.jsx("path",{d:"M16 11l3 3-3 3"}),a.jsx("path",{d:"M19 14h-5"})]}),a.jsx("span",{children:"تغيير المستخدم"})]})})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("input",{ref:Tt,type:"file",accept:".xlsx,.xls",className:"hidden","aria-hidden":!0,onChange:Vi}),a.jsx("div",{className:"rounded-xl border border-violet-300 dark:border-violet-500/25 bg-violet-100 dark:bg-violet-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_8px_rgba(139,92,246,0.12)]",children:a.jsxs("button",{type:"button",onClick:Di,className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg text-sm font-cairo font-bold bg-teal-500 hover:bg-teal-600 dark:bg-gradient-to-r dark:from-violet-600 dark:to-indigo-600 dark:hover:from-violet-500 dark:hover:to-indigo-500 text-white border border-teal-400/50 dark:border-violet-400/30 shadow-md transition-all hover:scale-[1.02] active:scale-[0.98]",title:"استخراج قيم مدى، فيزا، ماستر كارد، تحويل بنكي من تقرير إكسل",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),a.jsx("path",{d:"M17 8l-5-5-5 5"}),a.jsx("path",{d:"M12 3v12"})]}),a.jsx("span",{children:"استخراج قيم"})]})}),a.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),a.jsxs("div",{className:"flex items-center gap-1 rounded-xl border-2 border-stone-400 dark:border-teal-500/30 page-surface-warm dark:bg-teal-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(20,184,166,0.12)]",children:[a.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-200 text-stone-800 dark:bg-teal-500/20 dark:text-teal-400 shrink-0","aria-hidden":"true",children:a.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})}),Yg.map(b=>a.jsx("button",{type:"button",onClick:()=>x(b.id),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition ${v===b.id?"bg-teal-500/30 text-teal-900 border-2 border-teal-600 dark:bg-teal-500/25 dark:text-teal-300 dark:border-teal-500/40 shadow-sm":"text-stone-700 border border-transparent hover:bg-stone-300 hover:text-stone-900 dark:text-slate-400 dark:hover:bg-white/5 dark:hover:text-slate-300"}`,children:b.label},b.id))]}),a.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),a.jsxs("div",{className:"flex items-center gap-1.5 rounded-xl border border-stone-300 dark:border-sky-500/25 bg-stone-200 dark:bg-sky-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(14,165,233,0.08)]",children:[a.jsxs("button",{type:"button",onClick:_s,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-500 hover:bg-teal-600 dark:bg-sky-600 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:"طباعة كل الصفوف المعروضة",children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M6 9V2h12v7"}),a.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),a.jsx("path",{d:"M6 14h12v8H6z"})]}),a.jsx("span",{children:"الكل"})]}),Z.size>0&&a.jsxs("button",{type:"button",onClick:In,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-400 hover:bg-teal-500 dark:bg-sky-500/90 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:`طباعة ${Z.size} صف محدد`,children:[a.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M6 9V2h12v7"}),a.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),a.jsx("path",{d:"M6 14h12v8H6z"})]}),a.jsxs("span",{children:["المحددة (",Z.size,")"]})]})]})]})]})}),a.jsxs("main",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-1 sm:py-2 flex flex-col gap-2 sm:gap-3 flex-1 min-h-0",children:[a.jsxs("div",{className:"rounded-2xl sm:rounded-3xl flex flex-col border-2 border-stone-400 dark:border-teal-500/25 page-surface-warm-card dark:bg-slate-800/30 backdrop-blur-sm shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_0_1px_rgba(0,0,0,0.08)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] min-h-[200px] sm:min-h-[240px] min-w-0 overflow-hidden",children:[a.jsx("div",{className:"px-3 sm:px-4 py-1 sm:py-1.5 border-b border-stone-300 dark:border-slate-600 flex items-center justify-end gap-2 shrink-0 rounded-t-2xl sm:rounded-t-3xl bg-stone-50/80 dark:bg-slate-800/50",children:a.jsx("span",{className:"text-[9px] sm:text-[10px] font-cairo text-stone-600 dark:text-slate-400 tabular-nums",children:(()=>{const b=We.filter(R=>R.status!=="closed").length,T=We.filter(R=>R.status==="closed").length;return a.jsxs(a.Fragment,{children:[b>0&&a.jsxs("span",{children:["صف نشط: ",b]}),b>0&&T>0&&a.jsx("span",{className:"text-stone-400 dark:text-slate-500",children:"·"}),a.jsxs("span",{children:["تقفيلات مغلقة: ",T]})]})})()})}),a.jsx("div",{className:"cashbox-table-scroll min-w-0 w-full overflow-x-auto overflow-y-hidden rounded-t-2xl sm:rounded-t-3xl scrollbar-thin",style:{scrollbarGutter:"stable"},children:a.jsxs("table",{className:"text-xs sm:text-sm border-separate w-full min-w-[1380px]",style:{tableLayout:"fixed",width:"100%",borderSpacing:0},children:[a.jsxs("colgroup",{children:[a.jsx("col",{style:{width:"2.2%"}}),a.jsx("col",{style:{width:"1.8%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"8%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"5%"}}),a.jsx("col",{style:{width:"5%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"6%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"7%"}}),a.jsx("col",{style:{width:"5%"}})]}),a.jsx("thead",{className:"border-b-2 border-stone-400 dark:border-slate-600",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-0.5 sm:px-1 py-3 sm:py-4 text-center text-xs font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[36px] rounded-t-2xl rounded-s-2xl sm:rounded-t-3xl sm:rounded-s-3xl bg-transparent",children:"تحديد"}),a.jsx("th",{className:"px-0.5 sm:px-1 py-3 sm:py-4 text-center text-xs font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[28px] bg-transparent",children:"م"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-r-2 border-stone-200 dark:border-teal-500/20 rounded-s-xl bg-stone-300/90 dark:bg-slate-700/90",children:"كاش"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"مرسل للخزنة — يدخل في معادلة انحراف الكاش",children:"مرسل للخزنة"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"يُخصم من المصروفات في انحراف الكاش",children:"تعويض م"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[76px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"المصروفات"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[110px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"كاش نزيل"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-rose-700 dark:text-rose-400 align-middle font-cairo whitespace-nowrap min-w-[92px] border-t-2 border-b-2 border-l-2 border-stone-200 dark:border-teal-500/20 rounded-e-xl bg-stone-300/90 dark:bg-slate-700/90",title:"الفرق بين المتوقع والفعلي للكاش",children:"انحراف الكاش"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-r-2 border-stone-200 dark:border-teal-500/20 rounded-s-xl bg-stone-300/90 dark:bg-slate-700/90",children:"مدى"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[52px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"فيزا"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[82px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"ماستر كارد"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-sky-600 dark:text-sky-400 align-middle font-cairo whitespace-nowrap min-w-[82px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"للعرض فقط — لا يدخل في بنك نزيل ولا انحراف البنك",children:"تحويل بنكي"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[76px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",title:"بنك نزيل = مدى + فيزا + ماستر كارد",children:"بنك نزيل"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-stone-700 dark:text-slate-300 align-middle font-cairo whitespace-nowrap min-w-[100px] border-t-2 border-b-2 border-stone-200 dark:border-teal-500/20 bg-stone-300/90 dark:bg-slate-700/90",children:"اجمالى الموازنه"}),a.jsx("th",{className:"px-2 sm:px-3 py-3 sm:py-4 text-center text-xs sm:text-sm font-medium text-rose-700 dark:text-rose-400 align-middle font-cairo whitespace-nowrap min-w-[92px] border-t-2 border-b-2 border-l-2 border-stone-200 dark:border-teal-500/20 rounded-e-xl bg-stone-300/90 dark:bg-slate-700/90",title:"الفرق بين بنك نزيل واجمالى الموازنه",children:"انحراف البنك"}),a.jsx("th",{className:"px-0.5 py-1.5 sm:py-2 text-center align-middle font-cairo min-w-[44px] rounded-t-2xl rounded-e-2xl sm:rounded-t-3xl sm:rounded-e-3xl bg-transparent",children:a.jsxs("div",{className:"flex flex-col items-center justify-center gap-0.5 min-w-0",children:[a.jsx("span",{className:"text-[9px] sm:text-[10px] font-medium text-stone-700 dark:text-slate-300 whitespace-nowrap leading-none",children:"إجراءات"}),a.jsx("button",{type:"button",onClick:ws,"aria-label":"حذف كل التقفيلات المغلقة",className:"inline-flex items-center justify-center w-5 h-5 rounded border border-stone-300 dark:border-white/10 bg-white dark:bg-slate-700/50 text-stone-600 dark:text-slate-400 hover:bg-rose-50 dark:hover:bg-red-500/10 hover:text-rose-600 dark:hover:text-rose-400 hover:border-rose-200 dark:hover:border-red-500/20 transition-all shrink-0",title:"حذف كل التقفيلات المغلقة",children:a.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]})})]})})]})}),a.jsx("tbody",{children:We.map((b,T)=>a.jsx(jg,{row:b,rowNumber:T+1,rowIndex:T,isFirstActive:b.id===se,liveNow:O,closingRowId:$,closingSecondsLeft:$===b.id?z:0,onUpdate:Ve,isSelected:Z.has(b.id),onToggleSelect:jr,onDeleteRow:Pr,onPrintRow:Xt,onOpenExpenseDetails:Qn,onClearExpensesAndOpen:on,onLockedFieldClick:Li,onExpenseCompensationExceeded:Ft,lastExcelDetails:_e,onShowExcelDetails:(R,M)=>yt({field:R,rowId:M}),onRequestConfirmBankEdit:_e?(R,M,U,Q)=>Jt({rowId:R,field:M,oldValue:U,newValue:Q}):void 0,onShowEmployeeNames:ct.length>0?()=>Dt(!0):void 0,onShowVarianceExplanation:(R,M)=>Pe({type:R,row:M}),currentUserName:n,onClearRow:R=>Kn(R),isStickyRows:!1,onOpenShiftNotesModal:(R,M)=>_t({row:R,mode:M})},b.id))})]})}),(j>1||V)&&a.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-t-2 border-stone-400 dark:border-white/10 flex items-center justify-center gap-2 flex-wrap rounded-b-2xl sm:rounded-b-3xl page-surface-warm dark:bg-slate-800/50 backdrop-blur-sm",children:[a.jsxs("button",{type:"button",onClick:()=>L(j-1),disabled:j<=1,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-stone-300 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 hover:border-stone-400 dark:hover:bg-teal-500/20 dark:hover:border-teal-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة السابقة",children:[a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M15 18l-6-6 6-6"})}),"السابق"]}),a.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.max(j,1)},(b,T)=>T+1).map(b=>a.jsx("button",{type:"button",onClick:()=>L(b),className:`inline-flex items-center justify-center min-w-[2.25rem] px-2 py-2 rounded-xl text-sm font-cairo font-medium transition-all ${b===j?"bg-teal-500 dark:bg-teal-500/40 text-white border border-teal-500 dark:border-teal-500/50":"border border-stone-300 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 dark:hover:bg-teal-500/20"}`,"aria-label":b===1?"الرئيسية":`صفحة ${b}`,children:b===1?"١":b},b))}),a.jsxs("button",{type:"button",onClick:()=>L(j+1),disabled:!V,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-stone-300 dark:border-teal-500/30 bg-stone-50 dark:bg-teal-500/10 text-stone-800 dark:text-teal-400/95 hover:bg-stone-200 hover:border-stone-400 dark:hover:bg-teal-500/20 dark:hover:border-teal-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة التالية",children:["التالي",a.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M9 18l6-6-6-6"})})]})]}),At.length===0&&a.jsxs("div",{className:"py-16 px-4 text-center rounded-b-3xl page-surface-warm dark:bg-slate-800/20",children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-500 font-cairo mb-1",children:"لا توجد تقفيلات"}),a.jsx("p",{className:"text-stone-700 dark:text-slate-600 text-sm font-cairo",children:"اختر فلتراً مختلفاً أو ابدأ شفتاً جديداً"})]})]}),a.jsx("div",{className:"flex flex-col items-center justify-center gap-1.5 py-2 px-3 rounded-xl border-2 border-stone-400 dark:border-slate-600 page-surface-warm dark:bg-slate-800/90 min-h-0 shadow-sm dark:shadow-none",children:$?a.jsx("div",{className:"flex flex-wrap items-center justify-center w-full",dir:"ltr",children:z>0?a.jsxs("button",{type:"button",onClick:Fi,className:"btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 border-teal-400 bg-teal-500 hover:bg-teal-600 text-white shadow-md dark:border-emerald-500/60 dark:bg-gradient-to-b dark:from-emerald-500/30 dark:to-emerald-600/20 dark:text-emerald-50 dark:shadow-[0_4px_24px_rgba(16,185,129,0.25)] dark:hover:from-emerald-500/40 dark:hover:to-emerald-600/30 dark:hover:shadow-[0_6px_28px_rgba(16,185,129,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all select-none touch-manipulation min-h-[36px]",children:[a.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3 10h10a5 5 0 015 5v2"}),a.jsx("path",{d:"M7 15l-4-4 4-4"})]}),a.jsx("span",{className:"tracking-wide",children:"تراجع"}),a.jsxs("span",{className:"tabular-nums font-cairo",children:["(",z," ثانية)"]})]}):a.jsx("span",{className:"text-sm font-cairo font-medium text-stone-900 dark:text-teal-400 tabular-nums",children:"جاري الإغلاق..."})}):se&&ht?a.jsxs("button",{type:"button",onClick:()=>bs(se),disabled:!Ot,className:`btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 w-full sm:w-auto sm:min-w-[180px] rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 select-none transition-all touch-manipulation min-h-[36px]
                ${Ot?"bg-teal-500 hover:bg-teal-600 text-white border-teal-400 shadow-md dark:bg-gradient-to-b dark:from-teal-500/50 dark:to-teal-600/40 dark:text-white dark:border-teal-400 dark:shadow-[0_4px_24px_rgba(20,184,166,0.25)] dark:hover:from-teal-500/60 dark:hover:to-teal-600/50 dark:hover:shadow-[0_6px_28px_rgba(20,184,166,0.3)] hover:scale-[1.02] active:scale-[0.98]":"opacity-60 bg-stone-200 text-stone-500 border-stone-300 dark:opacity-50 dark:bg-slate-800/40 dark:text-slate-500 dark:border-slate-600/50 cursor-not-allowed"}`,title:Ot?"إغلاق الشفت وحفظ التقفيلة":"أدخل رصيد البرنامج كاش وإجمالي الموازنة (البنك) أولاً",children:[a.jsxs("svg",{className:`btn-close-shift-icon w-5 h-5 shrink-0 ${Ot?"text-white dark:text-teal-200":"text-stone-500 dark:text-slate-500"}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[a.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),a.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]}),a.jsx("span",{className:"tracking-wide",children:n?`إغلاق شفت ${n}`:"إغلاق الشفت الحالي"})]}):null}),a.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-[minmax(260px,320px)_1fr_1fr] gap-2 sm:gap-3 w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] items-stretch min-h-[101px] sm:min-h-[122px] xl:min-h-[137px] [&>div]:min-h-[86px] sm:[&>div]:min-h-[107px] xl:[&>div]:min-h-[122px]",children:[a.jsx("div",{className:"min-h-0 flex flex-col",children:a.jsx(Dg,{onTransfer:Zn,hasActiveRow:!!se},`calculator-${ot}`)}),a.jsx("div",{className:"min-h-0 flex flex-col",children:a.jsx(Mg,{onApplyToCash:ks,hasActiveRow:!!se},`cashCalculator-${ot}`)}),a.jsx("div",{className:"min-h-0 flex flex-col",children:a.jsx(Og,{onTransfer:$i,onTransferToBudget:Es,hasActiveRow:!!se,disableTransferButtons:!!_e},`bankOps-${ot}`)})]})]}),_&&a.jsx($g,{message:_.msg,type:_.type,onClose:()=>w(null),position:"center",autoHideMs:_.autoHideMs}),bt&&a.jsx(qg,{sourceRect:bt.sourceRect,targetRect:bt.targetRect,amount:bt.amount,formatCurrency:G,rowId:bt.rowId,field:bt.field,onEnd:()=>Et(null),onLanded:(b,T)=>{const R=document.querySelector(`[data-transfer-target][data-field="${T}"][data-row-id="${b}"]`);R&&(R.classList.add("transfer-land-pulse"),setTimeout(()=>R.classList.remove("transfer-land-pulse"),450))}}),Be&&_e&&(()=>{const{field:b,rowId:T}=Be,R=_e[b]??[],M=R.reduce((ne,ae)=>ne+ae.amount,0),U=f.find(ne=>ne.id===T),Q=U?U[b]??0:0,K=Q-M,oe=`سجل التغيير — ${{mada:"مدى",visa:"فيزا",mastercard:"ماستر كارد",bankTransfer:"تحويل بنكي"}[b]}`;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"excel-detail-title",onClick:()=>yt(null),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-sm w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:ne=>ne.stopPropagation(),children:[a.jsx("h2",{id:"excel-detail-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:oe}),a.jsxs("div",{className:"p-3 space-y-2 border-b border-stone-200 dark:border-white/10",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"من إكسل (مرفوع):"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-200",children:G(M)})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الحالي في الخانة:"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-slate-200",children:G(Q)})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الفرق (ترحيل أو تعديل يدوي):"}),a.jsx("span",{className:`tabular-nums font-medium ${K>=0?"text-stone-800 dark:text-teal-400":"text-rose-600 dark:text-rose-400"}`,children:G(K)})]})]}),R.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-2",children:[a.jsxs("p",{className:"text-xs font-cairo text-stone-500 dark:text-slate-400 mb-1",children:[R.length," عملية من الإكسل"]}),R.map((ne,ae)=>a.jsxs("div",{className:"py-2 border-b border-stone-200 dark:border-white/5",children:[a.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm text-stone-800 dark:text-slate-300",children:[a.jsx("div",{className:"flex flex-col items-start gap-0.5 min-w-0",children:ne.employeeName?a.jsx("span",{className:"text-xs text-stone-500 font-cairo",children:ne.employeeName}):null}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-200 shrink-0",children:G(ne.amount)})]}),ne.purpose&&a.jsx("p",{className:"text-xs font-cairo text-stone-600 dark:text-slate-300 mt-1 pr-0 border-t border-stone-300 dark:border-teal-500/25 pt-1",children:ne.purpose})]},ae))]}),a.jsxs("div",{className:"p-4 pt-2 border-t border-stone-300 dark:border-teal-500/30 flex justify-between items-center bg-stone-100 dark:bg-slate-900/50",children:[a.jsx("span",{className:"font-bold text-stone-800 dark:text-slate-200",children:"إجمالي الإكسل"}),a.jsx("span",{className:"tabular-nums font-bold text-stone-800 dark:text-teal-400",children:G(M)})]})]}),a.jsx("div",{className:"p-3",children:a.jsx("button",{type:"button",onClick:()=>yt(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-500 hover:bg-teal-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white dark:text-slate-200 transition",children:"إغلاق"})})]})})})(),Cr&&ct.length>0&&(()=>{const b=ct.map(T=>{let R=0,M=0;if(_e)for(const U of["mada","visa","mastercard","bankTransfer"]){const Q=_e[U]??[];for(const K of Q)(K.employeeName??"").trim()===T&&(R+=1,M+=K.amount)}return{name:T,count:R,total:M}});return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"employee-names-title",onClick:()=>Dt(!1),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:T=>T.stopPropagation(),children:[a.jsx("h2",{id:"employee-names-title",className:"text-base font-bold text-stone-800 dark:text-teal-400 p-4 pb-2 border-b border-white/10",children:"أسماء الموظفين في العمليات المستوردة"}),a.jsx("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-1.5",children:b.map((T,R)=>a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm text-slate-300 py-2 px-3 rounded-lg bg-slate-900/50 border border-white/5 font-cairo",children:[a.jsx("span",{className:"font-medium text-slate-200",children:T.name}),a.jsxs("span",{className:"tabular-nums text-stone-800 dark:text-slate-200 text-xs",children:[T.count," عملية — الإجمالي: ",G(T.total)]})]},R))}),a.jsx("div",{className:"p-3 border-t border-white/10",children:a.jsx("button",{type:"button",onClick:()=>Dt(!1),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إغلاق"})})]})})})(),Tn&&(()=>{const{type:b,row:T}=Tn,R=T.cash??0,M=T.sentToTreasury??0,U=T.expenses??0,Q=T.expenseCompensation??0,K=Math.max(0,U-Q),ie=T.programBalanceCash??0,oe=R+M+K,ne=Js(T),ae=T.mada+T.visa+T.mastercard,De=T.programBalanceBank??0,Me=Ys(T),$t=b==="cash",Ut=$t?"شرح انحراف الكاش":"شرح انحراف البنك",ft=ne!==0&&Me!==0&&ne>0!=Me>0,Rt=Math.abs(Math.abs(ne)-Math.abs(Me))<=Qg,gt=ft&&Rt,Nn=gt?Math.abs(ne):0;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"variance-explanation-title",onClick:()=>Pe(null),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:lt=>lt.stopPropagation(),children:[a.jsx("h2",{id:"variance-explanation-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:Ut}),a.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-4 space-y-3 text-sm text-stone-800 dark:text-slate-300",children:[$t?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"font-semibold text-stone-900 dark:text-teal-300",children:"انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش"}),a.jsxs("ul",{className:"space-y-1.5 list-none",children:[a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"كاش"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(R)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مرسل للخزنة"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(M)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مصروفات"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(U)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"تعويض مصروفات"}),a.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",G(Q)]})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5",children:[a.jsx("span",{children:"مصروفات فعّالة (صافي)"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(K)})]}),a.jsxs("li",{className:"flex justify-between gap-2 font-medium",children:[a.jsx("span",{children:"كاش + مرسل للخزنة + مصروفات فعّالة"}),a.jsx("span",{className:"tabular-nums font-bold text-stone-900 dark:text-teal-300",children:G(oe)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"رصيد البرنامج كاش"}),a.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",G(ie)]})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-stone-400 dark:border-teal-500/30 pt-2 font-bold text-stone-900 dark:text-teal-300",children:[a.jsx("span",{children:"انحراف الكاش"}),a.jsxs("span",{className:"tabular-nums",children:[ne>0?"+":"",G(ne)]})]})]}),a.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:ne>0?"زيادة: الكاش الفعلي (أو المرسل + المصروف الفعلي) أكبر من رصيد البرنامج.":ne<0?"عجز: رصيد البرنامج كاش أكبر من المتوقّع من الكاش والمرسل والمصروف.":"لا يوجد انحراف."})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"font-semibold text-stone-900 dark:text-teal-300",children:"انحراف البنك = بنك نزيل − اجمالى الموازنه"}),a.jsxs("ul",{className:"space-y-1.5 list-none",children:[a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مدى"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(T.mada)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"فيزا"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(T.visa)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"ماستر كارد"}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(T.mastercard)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsxs("span",{children:["تحويل بنكي ",a.jsx("span",{className:"text-stone-500 dark:text-slate-500 text-[10px]",children:"(للعرض فقط)"})]}),a.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:G(T.bankTransfer)})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5 font-medium",children:[a.jsx("span",{children:"بنك نزيل (مدى+فيزا+ماستر)"}),a.jsx("span",{className:"tabular-nums font-bold text-stone-900 dark:text-teal-300",children:G(ae)})]}),a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"اجمالى الموازنه"}),a.jsxs("span",{className:"tabular-nums font-medium text-stone-800 dark:text-teal-400",children:["− ",G(De)]})]}),a.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-stone-400 dark:border-teal-500/30 pt-2 font-bold text-stone-900 dark:text-teal-300",children:[a.jsx("span",{children:"انحراف البنك"}),a.jsxs("span",{className:"tabular-nums",children:[Me>0?"+":"",G(Me)]})]})]}),a.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:Me>0?"زيادة: بنك نزيل أكبر من اجمالى الموازنه المدخل.":Me<0?"عجز: اجمالى الموازنه أكبر من بنك نزيل.":"لا يوجد انحراف."})]}),gt&&a.jsxs("div",{className:"mt-3 p-3 rounded-xl border-2 border-stone-400 dark:border-teal-500/30 bg-stone-100 dark:bg-teal-900/20 text-stone-800 dark:text-teal-200 text-sm font-medium",children:["تنبيه: قد تكون سندات بقيمة ",a.jsx("strong",{children:Nn.toLocaleString("ar-SA",{minimumFractionDigits:2})})," ريال دخلت في خانة خاطئة (نقداً ↔ شبكة). راجع تحويل المبلغ بين الكاش وبنك نزيل."]})]}),a.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/10",children:a.jsx("button",{type:"button",onClick:()=>Pe(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),$e&&(()=>{const{row:b,mode:T}=$e,R=T==="edit",M=()=>{St(e,b.id,{notes:Mt}),m(U=>U.map(Q=>Q.id===b.id?{...Q,notes:Mt}:Q)),_t(null),w({msg:"تم حفظ ملاحظات الشيفت",type:"success"})};return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"shift-notes-title",onClick:()=>_t(null),children:a.jsxs("div",{className:"rounded-2xl border-2 border-stone-300 dark:border-teal-500/30 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:U=>U.stopPropagation(),children:[a.jsx("h2",{id:"shift-notes-title",className:"text-base font-bold text-stone-900 dark:text-teal-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:"ملاحظات الشيفت"}),a.jsx("div",{className:"flex-1 min-h-0 overflow-hidden p-4",children:R?a.jsx("textarea",{dir:"auto",value:Mt,onChange:U=>Hn(U.target.value),placeholder:"اكتب ملاحظاتك قبل إغلاق الشيفت...",className:"w-full h-40 sm:h-48 px-3 py-2 rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-900/70 text-stone-900 dark:text-slate-200 text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 focus:outline-none resize-none",autoFocus:!0}):a.jsx("div",{className:"text-sm text-stone-800 dark:text-slate-300 font-cairo whitespace-pre-wrap break-words max-h-48 overflow-y-auto py-2",children:(b.notes||"").trim()||"— لا توجد ملاحظات —"})}),a.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/10 flex gap-2",children:R?a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:M,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"حفظ"}),a.jsx("button",{type:"button",onClick:()=>_t(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-stone-400 hover:bg-stone-500 text-stone-800 transition",children:"إلغاء"})]}):a.jsx("button",{type:"button",onClick:()=>_t(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),Yt&&(()=>{const{cashVar:b,bankVar:T}=Yt,R=b!==0?b>0?"زيادة في صندوق الكاش — راجع الرصيد الفعلي":"عجز في صندوق الكاش — راجع الكاش والرصيد والمصروف":"",M=T!==0?T>0?"زيادة في البنك — راجع إدخالات مدى/فيزا/ماستر أو اجمالى الموازنه":"عجز في البنك — راجع بنك نزيل أو اجمالى الموازنه":"";return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"close-variance-title",children:a.jsxs("div",{className:"rounded-2xl border-2 border-teal-300 dark:border-teal-500/30 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"close-variance-title",className:"text-lg font-bold text-stone-900 dark:text-teal-400 mb-3",children:"تنبيه: يوجد انحراف"}),a.jsxs("div",{className:"text-stone-800 dark:text-slate-300 text-sm leading-relaxed mb-4 space-y-2",children:[b!==0&&a.jsxs("p",{className:"block",children:[a.jsx("span",{className:"font-medium",children:"انحراف الكاش: "}),a.jsxs("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:[b>0?"+":"",G(b)]}),R&&a.jsx("span",{className:"block text-stone-600 dark:text-slate-200 text-xs mt-0.5",children:R})]}),T!==0&&a.jsxs("p",{className:"block",children:[a.jsx("span",{className:"font-medium",children:"انحراف البنك: "}),a.jsxs("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:[T>0?"+":"",G(T)]}),M&&a.jsx("span",{className:"block text-stone-600 dark:text-slate-200 text-xs mt-0.5",children:M})]}),a.jsx("p",{className:"pt-2 text-stone-700 dark:text-slate-200",children:"هل تريد الإغلاق مع هذا الانحراف؟"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Oi,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، إغلاق الشفت"}),a.jsx("button",{type:"button",onClick:ys,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا، متابعة التعديل"})]})]})})})(),k&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"transfer-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsxs("h2",{id:"transfer-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:["ترحيل إلى ",Zt(k.field)]}),a.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد ترحيل الرقم الجديد وهو ",a.jsx("span",{className:"font-bold text-white tabular-nums",children:G(k.amount)}),"؟ يوجد رقم في الخانة وهو ",a.jsx("span",{className:"font-bold text-white tabular-nums",children:G(k.currentValue)}),"."]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:b=>Dr(b),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:Te,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),y&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-transfer-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"bank-transfer-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"ترحيل العمليات البنكية"}),a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"هل تريد ترحيل الأرقام الجديدة؟ توجد قيم في الخانات:"}),a.jsxs("ul",{className:"text-sm text-stone-700 dark:text-slate-300 space-y-1.5 mb-4",children:[y.mada>0&&a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"مدى:"}),a.jsxs("span",{className:"tabular-nums",children:["مرحّل ",a.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:G(y.mada)})," — في الخانة ",a.jsx("strong",{children:G(y.currentMada)})]})]}),y.visa>0&&a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"فيزا:"}),a.jsxs("span",{className:"tabular-nums",children:["مرحّل ",a.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:G(y.visa)})," — في الخانة ",a.jsx("strong",{children:G(y.currentVisa)})]})]}),y.mastercard>0&&a.jsxs("li",{className:"flex justify-between gap-2",children:[a.jsx("span",{children:"ماستر:"}),a.jsxs("span",{className:"tabular-nums",children:["مرحّل ",a.jsx("strong",{className:"text-stone-800 dark:text-teal-400",children:G(y.mastercard)})," — في الخانة ",a.jsx("strong",{children:G(y.currentMaster)})]})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:b=>Bt(b),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:wt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),ut&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-edit-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsxs("h2",{id:"bank-edit-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:["تعديل خانة ",Zt(ut.field)]}),a.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد تعديل الرقم من ",a.jsx("span",{className:"font-bold tabular-nums",children:G(ut.oldValue)})," إلى ",a.jsx("span",{className:"font-bold tabular-nums text-stone-800 dark:text-teal-400",children:G(ut.newValue)}),"؟"]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:An,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:Cn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),Gn&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"clear-row-confirm-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"clear-row-confirm-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"إفراغ الصف"}),a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد إفراغ كل المدخلات في هذا الصف؟ (كاش، مدى، فيزا، ماستر، اجمالى الموازنه، مصروفات، وغيرها)"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:xs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:Sr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),we&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"expense-modal-title",onClick:()=>It(null),children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-lg w-full max-h-[85vh] flex flex-col font-cairo cursor-auto",onClick:b=>b.stopPropagation(),onKeyDown:b=>{b.key==="Enter"&&!we.readOnly&&(b.preventDefault(),Ct())},children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[a.jsx("h2",{id:"expense-modal-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400",children:we.readOnly?"تفاصيل المصروفات":"تصنيف المبلغ المصروف"}),a.jsx("button",{type:"button",onClick:()=>It(null),className:"p-2 rounded-lg text-stone-500 hover:text-white hover:bg-white/10 transition","aria-label":"إغلاق",children:a.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),!we.readOnly&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-500 text-sm px-4 pt-2",children:"أدخل تفاصيل المصروف (مثال: 10 ريال كتب، 10 ريال مسطرة)"}),(we.carriedCount??0)>0&&a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-xs px-4 pt-0.5 font-cairo",children:"البنود المرحّلة للعرض فقط — يمكنك إضافة تصنيف ومبلغ جديد فقط، ويُحدَّث المجموع وخانة المصروفات تلقائياً."})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[!we.readOnly&&we.items.length>0&&a.jsxs("div",{className:"flex gap-2 items-center pb-0.5",children:[a.jsx("span",{className:"flex-1 text-xs font-medium text-stone-700 font-cairo",children:"بند المصروف"}),a.jsx("span",{className:"w-24 text-xs font-medium text-stone-700 font-cairo text-center",children:"مبلغ المصروف"}),a.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}),we.items.map((b,T)=>{const R=we.carriedCount??0,M=!we.readOnly&&T<R;return a.jsx("div",{className:"flex gap-2 items-center",children:we.readOnly||M?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"w-24 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm text-center tabular-nums",children:G(Number(b.amount)||0)}),a.jsxs("span",{className:"flex-1 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm font-cairo",children:[b.description||"—",M&&a.jsx("span",{className:"mr-1 text-[10px] text-stone-600 font-cairo",title:"من الشفت السابق",children:" (مرحّل)"})]}),!we.readOnly&&M?a.jsx("button",{type:"button",onClick:()=>ps(we.rowId,T),className:"shrink-0 w-8 h-8 flex items-center justify-center rounded-lg border border-red-500/20 text-slate-400 hover:text-red-400 hover:border-red-500/40",title:"حذف البند المرحّل (يتطلب كود أدمن)","aria-label":"حذف بند مرحّل",children:a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}):a.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}):a.jsxs(a.Fragment,{children:[(()=>{const U=dt.current[T]!==void 0?dt.current[T]:String(b.amount??""),Q=(Number(String(U).replace(/,/g,""))||0)>0,K=!String(b.description||"").trim(),ie=Q&&K,oe=Lt===T;return a.jsx("input",{ref:ne=>{!ne||T!==R||we.readOnly||sn.current===we.rowId||(sn.current=we.rowId,ne.focus())},type:"text",tabIndex:T===R?0:-1,value:b.description,onChange:ne=>{ms(T,"description",ne.target.value),Lt===T&&Nr(null)},onKeyDown:ne=>{ne.key==="Enter"&&(ne.preventDefault(),Ct())},placeholder:Q?"الوصف إلزامي":"الوصف",title:Q?"الوصف إلزامي عند وجود مبلغ":void 0,"aria-required":Q,className:`flex-1 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 dark:focus:border-teal-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-teal-500/25 ${ie?"border-teal-500 dark:border-teal-500/50 ring-1 ring-teal-500/25":"border-stone-300 dark:border-teal-500/30"} ${oe?"expense-description-pulse":""}`})})(),a.jsx("input",{type:"text",inputMode:"decimal",tabIndex:-1,dir:"ltr",value:Fn(dt.current[T]!==void 0?dt.current[T]:String(b.amount??"")),onChange:U=>{let Q=Fn(U.target.value).replace(/[^\d.]/g,"");const K=Q.indexOf(".");K>=0&&(Q=Q.slice(0,K+1)+Q.slice(K+1).replace(/\./g,"")),dt.current[T]=Q,ms(T,"amount",Q)},onKeyDown:U=>{U.key==="Enter"&&(U.preventDefault(),Ct())},placeholder:"مبلغ",className:"cashbox-input w-24 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border border-stone-300 dark:border-teal-500/30 text-stone-900 dark:text-white text-sm text-center focus:border-teal-500/50 dark:focus:border-teal-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-teal-500/25"}),a.jsx("button",{type:"button",tabIndex:-1,onClick:()=>Yn(T),disabled:we.items.length<=1,className:"p-2 rounded-lg text-stone-500 hover:text-red-400 hover:bg-red-500/20 disabled:opacity-40 disabled:pointer-events-none transition","aria-label":"حذف السطر",title:"حذف",children:a.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})},T)})]}),a.jsxs("div",{className:"p-4 border-t border-white/10 flex flex-wrap items-center gap-3",children:[!we.readOnly&&a.jsxs("button",{type:"button",tabIndex:-1,onClick:Mi,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium bg-stone-200 text-stone-800 border-2 border-stone-400 hover:bg-stone-300 transition",children:[a.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("path",{d:"M12 5v14M5 12h14"})}),"إضافة سطر"]}),a.jsx("div",{className:"flex-1"}),we.readOnly?a.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",a.jsx("span",{className:"font-bold text-stone-800 dark:text-teal-400 tabular-nums",children:G(we.items.reduce((b,T)=>b+(Number(T.amount)||0),0))})]}):a.jsxs("div",{className:"flex flex-col items-end gap-2",children:[a.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",a.jsx("span",{className:"font-bold text-stone-800 dark:text-teal-400 tabular-nums",children:G(we.items.reduce((b,T)=>b+(Number(T.amount)||0),0))})]}),a.jsx("button",{type:"button",onClick:Ct,onKeyDown:b=>{(b.key==="Enter"||b.key===" "||b.key==="Tab")&&(b.preventDefault(),Ct())},className:"px-4 py-2 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-slate-800 focus:shadow-[0_0_16px_rgba(16,185,129,0.4)]",children:"تعديل مبلغ المصروفات"})]})]})]})}),me&&a.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-carried-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"delete-carried-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:me.step==="confirm"?"حذف بند مرحّل":"كود الأدمن"}),me.step==="confirm"?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف هذا البند المرحّل؟ يتطلب إدخال كود الأدمن في الخطوة التالية."}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:gs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:()=>{ke(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),pt&&a.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx("input",{type:Ne?"text":"password",value:Qe,onChange:b=>{Ce(b.target.value),Ee(!1)},onKeyDown:b=>{b.key==="Enter"&&Jn(),b.key==="Escape"&&(ke(null),Ce(""),Ee(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${pt?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/10"}`,autoFocus:!0}),a.jsx("button",{type:"button",onClick:()=>nt(b=>!b),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":Ne?"إخفاء الكود":"إظهار الكود",children:Ne?a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),a.jsx("path",{d:"M1 1l22 22"})]}):a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Jn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),a.jsx("button",{type:"button",onClick:()=>{ke(null),Ce(""),nt(!1),Ee(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),ee&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"delete-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:ee.step==="confirm"?"حذف الصف":"كود الأدمن"}),ee.step==="confirm"?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف الصف؟"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Bi,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:()=>le(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),pt&&a.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx("input",{type:Ne?"text":"password",value:Qe,onChange:b=>{Ce(b.target.value),Ee(!1)},onKeyDown:b=>{b.key==="Enter"&&Vr(),b.key==="Escape"&&(le(null),Ce(""),Ee(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${pt?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/10"}`,autoFocus:!0}),a.jsx("button",{type:"button",onClick:()=>nt(b=>!b),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":Ne?"إخفاء الكود":"إظهار الكود",title:Ne?"إخفاء":"إظهار",children:Ne?a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),a.jsx("path",{d:"M1 1l22 22"})]}):a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Vr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),a.jsx("button",{type:"button",onClick:()=>{le(null),Ce(""),nt(!1),Ee(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),he&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-all-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"delete-all-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:he.step==="confirm"?"حذف كل التقفيلات المغلقة":"كود الأدمن"}),he.step==="confirm"?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف كل التقفيلات المغلقة؟"}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:vs,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),a.jsx("button",{type:"button",onClick:()=>xe(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),pt&&a.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),a.jsxs("div",{className:"relative mb-4",children:[a.jsx("input",{type:Ne?"text":"password",value:Qe,onChange:b=>{Ce(b.target.value),Ee(!1)},onKeyDown:b=>{b.key==="Enter"&&Xn(),b.key==="Escape"&&(xe(null),Ce(""),Ee(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-stone-50 dark:bg-slate-900 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-400 focus:ring-1 focus:ring-teal-500/25 focus:border-teal-500/50 dark:focus:border-teal-500/50 ${pt?"border-red-500 dark:border-red-400":"border-stone-300 dark:border-white/10"}`,autoFocus:!0}),a.jsx("button",{type:"button",onClick:()=>nt(b=>!b),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-stone-800 transition","aria-label":Ne?"إخفاء الكود":"إظهار الكود",title:Ne?"إخفاء":"إظهار",children:Ne?a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),a.jsx("path",{d:"M1 1l22 22"})]}):a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),a.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:Xn,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),a.jsx("button",{type:"button",onClick:()=>{xe(null),Ce(""),nt(!1),Ee(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),u&&a.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"switch-branch-dialog-title",children:a.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[a.jsx("h2",{id:"switch-branch-dialog-title",className:"text-lg font-bold text-stone-800 dark:text-teal-400 mb-3",children:"تغيير الفرع"}),a.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد الانتقال إلى فرع ",$r[u],"؟"]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{type:"button",onClick:()=>{r(u),h(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، الانتقال"}),a.jsx("button",{type:"button",onClick:()=>h(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})})]})}const Xg=["cash","sentToTreasury","expenseCompensation","expenses","mada","visa","mastercard","bankTransfer","programBalanceCash","programBalanceBank"],oo="cashbox_name",Us="cashbox_branch",jo="cashbox_session_start",Zg=6*60*60*1e3;function ex(n){return n==="corniche"||n==="andalusia"}function cc(){const n=sessionStorage.getItem(jo);if(!n)return!0;const e=parseInt(n,10);return Number.isNaN(e)?!0:Date.now()-e>=Zg}function tx(){const[n,e]=I.useState(null),[t,r]=I.useState("corniche"),[s,o]=I.useState(!1),[l,u]=I.useState("dark");I.useEffect(()=>{const E=sessionStorage.getItem(oo),C=sessionStorage.getItem(Us);E!=null&&E.trim()&&ex(C)&&!cc()&&(e(E.trim()),r(C));const j=Gg();u(j),So(j),o(!0)},[]),I.useEffect(()=>{const E=C=>u(C.detail);return window.addEventListener("cashbox-theme-change",E),()=>window.removeEventListener("cashbox-theme-change",E)},[]),I.useEffect(()=>{So(l)},[l]);const h=I.useCallback(()=>{sessionStorage.removeItem(oo),sessionStorage.removeItem(Us),sessionStorage.removeItem(jo),e(null),r("corniche")},[]),f=(E,C)=>{sessionStorage.setItem(oo,E),sessionStorage.setItem(Us,C),sessionStorage.setItem(jo,Date.now().toString()),e(E),r(C)},m=E=>{sessionStorage.setItem(Us,E),r(E)};if(I.useEffect(()=>{if(!n)return;const C=setInterval(()=>{cc()&&h()},6e4);return()=>clearInterval(C)},[n,h]),!s)return a.jsx("div",{className:"min-h-screen page-bg-warm dark:bg-slate-900 flex items-center justify-center",children:a.jsx("div",{className:"text-slate-700 dark:text-slate-500 font-cairo",children:"جاري التحميل..."})});const g=()=>hd();return n?a.jsx(Jg,{name:n,branch:t,onExit:h,onSwitchBranch:m,theme:l,onToggleTheme:g},t):a.jsx(Cd,{onEnter:f})}ao.createRoot(document.getElementById("root")).render(a.jsx(xd.StrictMode,{children:a.jsx(tx,{})}));
