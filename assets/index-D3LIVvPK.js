import{r as o,a as $e,R as _r}from"./vendor-react-wGySg1uH.js";import{r as Sr,u as Ne}from"./vendor-xlsx-DLNWaC59.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))i(d);new MutationObserver(d=>{for(const n of d)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function a(d){const n={};return d.integrity&&(n.integrity=d.integrity),d.referrerPolicy&&(n.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?n.credentials="include":d.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(d){if(d.ep)return;d.ep=!0;const n=a(d);fetch(d.href,n)}})();var It={exports:{}},it={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lr=o,Tr=Symbol.for("react.element"),Er=Symbol.for("react.fragment"),Dr=Object.prototype.hasOwnProperty,Br=Lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Rr={key:!0,ref:!0,__self:!0,__source:!0};function Wt(t,r,a){var i,d={},n=null,u=null;a!==void 0&&(n=""+a),r.key!==void 0&&(n=""+r.key),r.ref!==void 0&&(u=r.ref);for(i in r)Dr.call(r,i)&&!Rr.hasOwnProperty(i)&&(d[i]=r[i]);if(t&&t.defaultProps)for(i in r=t.defaultProps,r)d[i]===void 0&&(d[i]=r[i]);return{$$typeof:Tr,type:t,key:n,ref:u,props:d,_owner:Br.current}}it.Fragment=Er;it.jsx=Wt;it.jsxs=Wt;It.exports=it;var e=It.exports,pt={},St=$e;pt.createRoot=St.createRoot,pt.hydrateRoot=St.hydrateRoot;const Ar=/^[\p{L}\s]*$/u;function $r(t){return Ar.test(t)&&t.length>0&&new RegExp("\\p{L}","u").test(t)}function Ir({onEnter:t}){const[r,a]=o.useState(""),[i,d]=o.useState(""),n=$r(r.trim());function u(x){const h=x.target.value;/\d/.test(h)||(a(h),d(""))}function m(x){x.preventDefault();const h=r.trim();if(/\d/.test(h)){d("الاسم حروف فقط — بدون أرقام");return}if(!new RegExp("\\p{L}","u").test(h)){d("أدخل اسمك (حروف فقط)");return}d(""),t(h)}return e.jsx("div",{className:"min-h-screen min-h-[100dvh] bg-gradient-to-br from-[#f4ebe0] via-[#f8f3ed] to-[#efe6dc] dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex flex-col items-center justify-center p-4 sm:p-6 safe-top safe-bottom",children:e.jsxs("div",{className:"w-full max-w-[95vw] sm:max-w-md bg-stone-50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl sm:rounded-3xl border border-stone-300 dark:border-white/20 shadow-xl dark:shadow-2xl p-5 sm:p-8",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-primary-500 font-cairo mb-2",children:"أهلاً بك"}),e.jsx("p",{className:"text-sm sm:text-base text-stone-700 dark:text-slate-400 font-cairo",children:"اكتب اسمك للدخول"})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4 sm:space-y-5",children:[i&&e.jsx("div",{className:"p-3 rounded-xl bg-red-50 dark:bg-red-500/20 border border-red-200 dark:border-red-500/40 text-red-700 dark:text-red-300 text-sm font-cairo",children:i}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-stone-800 dark:text-slate-300 mb-2 font-cairo",children:"الاسم (حروف فقط)"}),e.jsx("input",{id:"name",type:"text",value:r,onChange:u,placeholder:"أدخل اسمك",className:"w-full px-4 py-3 rounded-xl bg-stone-100 dark:bg-slate-900/80 border border-stone-300 dark:border-white/20 text-stone-900 dark:text-white placeholder-stone-500 dark:placeholder-slate-500 focus:border-primary-500/50 focus:ring-1 focus:ring-primary-500/25 focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-900 font-cairo",autoComplete:"off",autoFocus:!0})]}),e.jsx("button",{type:"submit",disabled:!n,className:"w-full py-3 sm:py-3.5 rounded-xl font-bold font-cairo text-sm sm:text-base bg-primary-500 hover:bg-primary-600 text-white disabled:opacity-40 disabled:cursor-not-allowed transition focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none min-h-[44px] touch-manipulation",children:"دخول"})]})]})})}const Ft="cashbox_rows";function Wr(){return`${Date.now()}-${Math.random().toString(36).slice(2,10)}`}function Ce(){try{const t=localStorage.getItem(Ft);return t?JSON.parse(t).map(a=>{const i=a,d=Array.isArray(i.expenseItems)?i.expenseItems.filter(n=>typeof n.amount=="number"&&typeof n.description=="string"):[];return{...a,sentToTreasury:typeof i.sentToTreasury=="number"?i.sentToTreasury:0,expenseCompensation:typeof i.expenseCompensation=="number"?i.expenseCompensation:0,expenses:typeof a.expenses=="number"?a.expenses:0,carriedExpenseCount:typeof i.carriedExpenseCount=="number"&&i.carriedExpenseCount>=0?i.carriedExpenseCount:0,expenseItems:d,mastercard:typeof a.mastercard=="number"?a.mastercard:0,programBalanceCash:typeof a.programBalanceCash=="number"?a.programBalanceCash:0,programBalanceBank:typeof a.programBalanceBank=="number"?a.programBalanceBank:0}}):[]}catch{return[]}}function Xe(t){try{localStorage.setItem(Ft,JSON.stringify(t))}catch{}}function Lt(){const t=Ce(),r=t.filter(i=>i.status!=="closed").sort((i,d)=>new Date(d.createdAt).getTime()-new Date(i.createdAt).getTime()),a=t.filter(i=>i.status==="closed").sort((i,d)=>new Date((d.closedAt??"").toString()).getTime()-new Date((i.closedAt??"").toString()).getTime());return[...r,...a]}function Fr(t){return Ce().find(a=>a.id===t)??null}function Ot(t,r){const a=Ce(),i=new Date().toISOString(),d=(r==null?void 0:r.expenses)??0,n=(r==null?void 0:r.expenseItems)??[],u=(r==null?void 0:r.carriedExpenseCount)??0;a.push({id:Wr(),employeeName:t,cash:0,sentToTreasury:0,expenseCompensation:0,expenses:d,carriedExpenseCount:u,expenseItems:n,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0,status:"active",notes:"",closedAt:null,createdAt:i}),Xe(a)}function he(t,r){const a=Ce(),i=a.findIndex(d=>d.id===t);i!==-1&&(a[i]={...a[i],...r},Xe(a))}function Or(t,r){const a=Ce(),i=a.findIndex(n=>n.id===t);if(i===-1)return;const d=new Date().toISOString();a[i]={...a[i],...r,status:"closed",closedAt:d},Xe(a)}function Pr(t){const r=Ce().filter(a=>a.id!==t);Xe(r)}function zr(){const t=Ce().filter(r=>r.status!=="closed");Xe(t)}function Vr(t){return Ce().filter(r=>r.status==="closed"&&r.closedAt).sort((r,a)=>new Date((a.closedAt??"").toString()).getTime()-new Date((r.closedAt??"").toString()).getTime()).slice(0,t)}const Hr="٠١٢٣٤٥٦٧٨٩",Kr="0123456789";function Pt(t){let r="";for(let a=0;a<t.length;a++){const i=Hr.indexOf(t[a]);r+=i>=0?Kr[i]:t[a]}return r}function Ur(t){return t.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a/g,"").replace(/\u202b/g,"").replace(/\u202c/g,"").replace(/[\u0640\u066a]/g,"").replace(/\/\s*/g,"/").trim()}function Yr(t){const r=t.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2})\s*([صم])/);if(!r)return null;const a=parseInt(r[2],10)-1,i=parseInt(r[3],10),d=parseInt(r[1],10);let n=parseInt(r[4],10);const u=parseInt(r[5],10),m=r[6];m==="م"&&n!==12&&(n+=12),m==="ص"&&n===12&&(n=0);const x=new Date(i,a,d,n,u,0,0);return isNaN(x.getTime())?null:x}function qr(t){let r=t.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(r){let a=parseInt(r[1],10);const i=parseInt(r[2],10),d=r[3],n=parseInt(r[4],10),u=parseInt(r[5],10)-1,m=parseInt(r[6],10);d==="م"&&a!==12&&(a+=12),d==="ص"&&a===12&&(a=0);const x=new Date(n,u,m,a,i,0,0);return isNaN(x.getTime())?null:x}if(r=t.match(/^(\d{1,2}):(\d{2})\s*([صم])\s+(\d{1,2})\/(\d{1,2})\/(\d{4})/),r){let a=parseInt(r[1],10);const i=parseInt(r[2],10),d=r[3],n=parseInt(r[4],10),u=parseInt(r[5],10)-1,m=parseInt(r[6],10);d==="م"&&a!==12&&(a+=12),d==="ص"&&a===12&&(a=0);const x=new Date(m,u,n,a,i,0,0);return isNaN(x.getTime())?null:x}return null}function Tt(t){const r=Ur((t||"").toString());if(!r)return null;const a=Pt(r);return qr(a)??Yr(a)}const Gr=32874,Xr=52100;function Jr(t){if(t instanceof Date)return isNaN(t.getTime())?null:t;if(typeof t=="number"&&Number.isFinite(t)){if(t<Gr||t>Xr)return null;const a=(t-25569)*86400*1e3,i=new Date(a);return isNaN(i.getTime())?null:i}return null}const Qr="٫";function ht(t){let r=(t||"").toString().trim();r=r.replace(/\s*SAR\s*/gi," ").replace(/\s*ر\.?\s*س\.?\s*/g," ").replace(/\s*ريال\s*(سعودي)?\s*/gi," ").trim();let i=Pt(r).replace(Qr,".").replace(/[^\d.,\-]/g,"");if(!i)return 0;if(/^-?\d+,\d{1,3}$/.test(i)?i=i.replace(",","."):i=i.replace(/,/g,""),i.includes(".")){const u=i.split("."),m=u[u.length-1];m&&m.length===3&&/^\d+$/.test(m)&&(i=i.replace(/\./g,""))}const n=parseFloat(i);return Number.isFinite(n)?n:0}const zt={مدى:"mada",فيزا:"visa","ماستر كارد":"mastercard",ماستركارد:"mastercard","تحويل بنكي":"bankTransfer",تحويل:"bankTransfer"},Zr=["شيك","أمريكان إكسبريس","امريكان اكسبريس","نقداً","نقدا","كاش"];function Vt(t){const r=t.replace(/\s+/g," ").trim();return Zr.some(a=>r===a||r.includes(a))}function es(t,r,a){const i={...Ke},d={...Ue},n={mada:[],visa:[],mastercard:[],bankTransfer:[]},u=Math.min(t.length,500);for(let m=a;m<u;m++){const x=t[m];if(!x||!Array.isArray(x))continue;const h=Math.min(Math.max(x.length,4),120);let y=null,C=-1;for(let E=0;E<h;E++){const R=r?Ge(r,x,m,E):(x[E]??"").toString().trim(),p=Ee(R);if(!p||Vt(p))continue;const A=zt[p]??(p.includes("مدى")?"mada":null);if(A&&A!=="cash"){y=A,C=E;break}}if(y==null||y==="cash")continue;let P=0;for(let E=0;E<h;E++){if(E===C)continue;const R=r?Ge(r,x,m,E):(x[E]??"").toString().trim(),p=ht(R);if(p>0&&p<=Ht){P=p;break}}if(P<=0)continue;const _=(x[C]??"").toString().trim();_.includes("إجمالي")||_.includes("مجموع")||_.includes("المجموع")||(i[y]+=P,d[y]+=1,n[y].push({date:new Date(0),amount:P,employeeName:void 0,purpose:void 0}))}return{sums:i,counts:d,details:n}}const Ke={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},Ue={cash:0,mada:0,visa:0,mastercard:0,bankTransfer:0},ct={mada:[],visa:[],mastercard:[],bankTransfer:[]};function Ee(t){let r=(t??"").toString();return r=r.replace(/\u200e/g,"").replace(/\u200f/g,"").replace(/\u202a|\u202b|\u202c/g,"").replace(/\u200b|\u200c|\u200d|\ufeff/g,"").replace(/\s+/g," "),r=r.replace(/SAR/gi,"").replace(/ر\.?\s*س\.?/g,"").replace(/ريال\s*(سعودي)?/g,""),r.trim()}function Ge(t,r,a,i){const d=Ne.encode_cell({r:a,c:i}),n=t[d];if(n!=null){if(typeof n.w=="string"&&n.w.trim())return n.w.trim();if(typeof n.v=="number"&&!Number.isNaN(n.v))return String(n.v);if(typeof n.v=="string")return n.v.trim()}return(r[i]??"").toString().trim()}function gt(t){const r=Ee(t);return r.includes("طريقةالدفع")||r.includes("طريقة الدفع")||r.includes("الدفع")&&r.length<30||r.includes("طريقة")&&(r.includes("دفع")||r.includes("الدفع"))}function kt(t){const r=Ee(t);return r.includes("المبلغ")||r.includes("قيمةالسند")||r.includes("قيمة السند")||r.includes("المقبوضات")||r.includes("مقبوضات")||r.includes("قبوضات")||r.includes("المصروفات")||r.includes("مصروفات")||r.includes("الصافي")||r.includes("صافي")||r.includes("مبلغ")||r.includes("قيمة")&&!r.includes("رقم")&&r.length<35}function rt(t){const r=new Map;for(const d of Object.keys(t)){if(d.startsWith("!"))continue;const n=Ne.decode_cell(d);if(n==null||typeof n.r!="number")continue;const u=n.r,m=n.c,x=t[d],h=x&&typeof x.w=="string"&&x.w.trim()||x&&typeof x.v=="string"&&x.v.trim()||(x&&typeof x.v=="number"&&!Number.isNaN(x.v)?String(x.v):"");r.has(u)||r.set(u,new Map),r.get(u).set(m,h)}const a=r.size===0?0:Math.max(...r.keys()),i=[];for(let d=0;d<=a;d++){const n=r.get(d),u=n?Math.max(...n.keys()):0,m=[];for(let x=0;x<=u;x++)m.push((n==null?void 0:n.get(x))??"");i.push(m)}return i}function ts(t){const r=new Map;for(const i of Object.keys(t)){if(i.startsWith("!"))continue;const d=Ne.decode_cell(i);if(d==null||typeof d.r!="number")continue;const n=d.r,u=d.c,m=t[i],x=m&&typeof m.w=="string"&&m.w.trim()||m&&typeof m.v=="string"&&m.v.trim()||(m&&typeof m.v=="number"&&!Number.isNaN(m.v)?String(m.v):"");if(!x)continue;r.has(n)||r.set(n,[]);const h=r.get(n);for(;h.length<=u;)h.push("");h[u]=x}const a=Array.from(r.keys()).sort((i,d)=>i-d);for(const i of a){const d=r.get(i)||[];let n=!1,u=!1;for(const m of d){const x=Ee(m);x&&(kt(x)&&(n=!0),gt(x)&&(u=!0))}if(n&&u)return i}return-1}const rs=["مدى","فيزا","ماستر كارد","ماستركارد","تحويل بنكي","تحويل","نقداً","نقدا","شيك","أمريكان إكسبريس"];function ss(t){const r=Ee(t);return!r||r.length>50?!1:rs.some(a=>r===a||r.includes(a))}function as(t,r){const a=Math.min(t.length,200);for(let i=1;i<a;i++){const d=t[i];if(!d||!Array.isArray(d))continue;const n=Math.min(Math.max(d.length,50),120);for(let u=0;u<n;u++){const m=r?Ge(r,d,i,u):(d[u]??"").toString().trim();if(ss(m))return i-1}}return-1}function Et(t,r){const a=Math.min(t.length,200);for(let i=0;i<a;i++){const d=t[i];if(!d||!Array.isArray(d))continue;const n=Math.min(Math.max(d.length,50),120);let u=!1,m=!1;for(let x=0;x<n;x++){const h=r?Ge(r,d,i,x):(d[x]??"").toString().trim(),y=Ee(h);y&&(kt(y)&&(u=!0),gt(y)&&(m=!0))}if(u&&m)return i}return-1}const ns=["الموظف","اسم الموظف","الاسم","اسم","المستخدم","اسم المستخدم","الموظف المسؤول","المسؤول","كاشير","الكاشير","المحاسب","اسم المحاسب"];function os(t){const r=t.replace(/\s+/g," ").replace(/\u200e|\u200f/g,"").trim();return r?r.includes("موظف")||r.includes("كاشير")||r.includes("محاسب")?!0:ns.some(a=>r===a||r.includes(a)):!1}const ls=["الغرض","الوصف","البيان","الغرض من العملية","تفاصيل","ملاحظات","وصف العملية"];function is(t){const r=t.replace(/\s+/g," ").trim();return r?ls.some(a=>r.includes(a)):!1}function ds(t){let r=-1,a=-1,i=-1,d=-1,n=-1,u=-1;const m=Math.min(Math.max((t==null?void 0:t.length)??0,10),120);let x=-1;for(let h=0;h<m;h++){const y=t[h],C=Ee(y);(C.includes("الوقت")||C.includes("التاريخ"))&&r<0&&(r=h),a<0&&gt(C)&&(a=h),(C.includes("الإتجاه")||C.includes("الاتجاه"))&&d<0&&(d=h),n<0&&os(C)&&(n=h),u<0&&is(C)&&(u=h),kt(C)&&((C.includes("المقبوضات")||C.includes("مقبوضات")||C.includes("قبوضات"))&&(x=h),i<0&&(i=h)),C.includes("رقم السند")&&C.includes("قيمة السند")}return x>=0&&(i=x),a>=0&&i>=0?{date:r,method:a,amount:i,direction:d,employeeName:n,purpose:u}:null}function cs(t){const r=(t??"").toString().trim();return typeof t=="string"||typeof t=="number"&&t<3e4?r?Tt(r):null:Jr(t)??(r?Tt(r):null)}const Ht=999999;function ms(t,r){try{const a=Sr(t,{type:"array"}),i=a.SheetNames||[];if(i.length===0)return{sums:Ke,counts:Ue,details:ct,employeeName:null,employeeNamesList:[],error:"الملف لا يحتوي على أي sheet"};let d=[],n={},u="",m=-1;for(let L=0;L<i.length;L++)if(u=i[L],n=a.Sheets[u],d=Ne.sheet_to_json(n,{header:1,defval:""}),m=Et(d,n),m<0&&(d=rt(n),m=Et(d,n)),m<0&&(m=ts(n)),m>=0){d.length<=m&&(d=rt(n));break}if(m>=0&&d.length<=m&&(d=rt(n)),m<0&&(m=as(d,n)),m>=0&&d.length<=m&&(d=rt(n)),m<0)return{sums:Ke,counts:Ue,details:ct,employeeName:null,employeeNamesList:[],error:"لم يُعثر على صف العناوين (طريقة الدفع، المبلغ أو المقبوضات)"};const x=d[m],h=[];for(let L=0;L<Math.max((x==null?void 0:x.length)??0,80);L++)h.push(Ge(n,x,m,L)||x[L]);let y=ds(h);if(!y){const L=es(d,n,m+1);return{sums:L.sums,counts:L.counts,details:L.details,employeeName:null,employeeNamesList:[],error:null}}const P={...Ke},_={...Ue},E={mada:[],visa:[],mastercard:[],bankTransfer:[]},R=new Set,p=r.getTime();for(let L=m+1;L<d.length;L++){const O=d[L],S=(O[y.method]??"").toString().trim();if(!S||Vt(S))continue;const q=y.date>=0?O[y.date]:void 0,se=y.date>=0?cs(q):null;if(y.date>=0&&(!se||se.getTime()<p))continue;const f=se??new Date(0),W=(y.direction>=0?(O[y.direction]??"").toString().trim():"").replace(/\u200e/g,"").replace(/\u200f/g,"").trim();if(y.direction>=0&&W!=="داخل")continue;const H=O[y.amount];if(y.employeeName>=0){const te=Ne.encode_cell({r:L,c:y.employeeName}),U=n[te],G=(U&&typeof U.w=="string"?U.w.trim():"")||(O[y.employeeName]??"").toString().trim();G&&R.add(G)}const $=Ne.encode_cell({r:L,c:y.amount}),g=n[$],T=g&&typeof g.w=="string"?g.w.trim():"";let X;if(T)X=ht(T);else if(typeof H=="number"&&Number.isFinite(H))X=H;else{const te=(H??"").toString().trim();X=ht(te)}if(X<=0||X>Ht)continue;const J=S.replace(/\s+/g," ").trim();if(J.includes("إجمالي")||J.includes("مجموع")||J.includes("المجموع"))continue;const K=zt[S]??(S.toLowerCase().includes("مدى")?"mada":null);if(K&&(P[K]+=X,_[K]+=1,K!=="cash")){const te=y.employeeName>=0?(()=>{const re=Ne.encode_cell({r:L,c:y.employeeName}),G=n[re];return(G&&typeof G.w=="string"?G.w.trim():"")||(O[y.employeeName]??"").toString().trim()||void 0})():void 0;let U;if(y.purpose>=0){const re=Ne.encode_cell({r:L,c:y.purpose}),G=n[re];U=(G&&typeof G.w=="string"?G.w.trim():"")||(O[y.purpose]??"").toString().trim()||void 0}E[K].push({date:f,amount:X,employeeName:te,purpose:U})}}const A=[...R],z=R.size===0?null:R.size===1?A[0]:"أكثر من موظف";return{sums:P,counts:_,details:E,employeeName:z,employeeNamesList:A,error:null}}catch(a){const i=a instanceof Error?a.message:String(a);return{sums:Ke,counts:Ue,details:ct,employeeName:null,employeeNamesList:[],error:`خطأ في قراءة الملف: ${i}`}}}function xs(t){const r=t.getHours();return r>=5&&r<12?{label:"صباح الخير",kind:"morning"}:r>=12&&r<17?{label:"مساء الخير",kind:"noon"}:r>=17&&r<21?{label:"أمسية سعيدة",kind:"evening"}:{label:"ليلة سعيدة",kind:"night"}}function nt(t){const r=t.mada+t.visa+t.mastercard;return Math.round((r-t.programBalanceBank)*100)/100}function ot(t){const r=t.cash??0,a=t.sentToTreasury??0,i=t.expenses??0,d=t.expenseCompensation??0,n=Math.max(0,i-d),u=r+a+n;return Math.round((u-t.programBalanceCash)*100)/100}function st(t){const r=t.cash+t.mada+t.visa+t.mastercard,a=t.programBalanceCash+t.programBalanceBank;return Math.round((r-a)*100)/100}function lt(t){const r=typeof t=="string"?new Date(t):t,a={calendar:"gregory",numberingSystem:"latn"},i=r.toLocaleDateString("ar-SA",{...a,weekday:"long"}),d=r.getDate(),n=r.toLocaleDateString("ar-SA",{...a,month:"long"}),u=r.toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit",numberingSystem:"latn"});return`${i} ${d} ${n} ${u}`}const us="٠١٢٣٤٥٦٧٨٩",bs="0123456789";function Te(t){if(typeof t!="string")return String(t);let r="";for(let a=0;a<t.length;a++){const i=us.indexOf(t[a]);r+=i>=0?bs[i]:t[a]}return r}function k(t){return new Intl.NumberFormat("ar-SA",{minimumFractionDigits:2,maximumFractionDigits:2,numberingSystem:"latn"}).format(t)}function ps(t){const r=new Date(t),a=new Date;return r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()}function hs(t){const r=new Date(t),a=new Date;return a.setDate(a.getDate()-1),r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()}function fs(t){const r=new Date(t),a=new Date,i=new Date(a);return i.setDate(i.getDate()-7),r>=i&&r<=a}function Dt(t,r){return r==="today"?t.filter(a=>a.closedAt&&ps(a.closedAt)):r==="yesterday"?t.filter(a=>a.closedAt&&hs(a.closedAt)):r==="lastWeek"?t.filter(a=>a.closedAt&&fs(a.closedAt)):t}const Bt=["cash","sentToTreasury","expenseCompensation","expenses","programBalanceCash","mada","visa","mastercard","bankTransfer","programBalanceBank"];function gs({row:t,rowNumber:r,isFirstActive:a,liveNow:i,closingRowId:d,closingSecondsLeft:n,onUpdate:u,isSelected:m=!1,onToggleSelect:x,onDeleteRow:h,onPrintRow:y,onOpenExpenseDetails:C,onClearExpensesAndOpen:P,onLockedFieldClick:_,onExpenseCompensationExceeded:E,lastExcelDetails:R,onShowExcelDetails:p,onRequestConfirmBankEdit:A,onShowEmployeeNames:z,onShowVarianceExplanation:L,currentUserName:O,onClearRow:S,isStickyRows:q=!1}){const se=a&&O?O:t.employeeName,f=o.useMemo(()=>nt(t),[t.mada,t.visa,t.mastercard,t.bankTransfer,t.programBalanceBank]),I=o.useMemo(()=>ot(t),[t.cash,t.sentToTreasury,t.programBalanceCash,t.expenses,t.expenseCompensation]),W=o.useMemo(()=>{const N=t.carriedExpenseCount??0;return(t.expenseItems??[]).slice(0,N).reduce((Q,ee)=>Q+ee.amount,0)},[t.carriedExpenseCount,t.expenseItems]),H=t.status==="closed",$=d===t.id,g=o.useCallback((N,je)=>{const Q=Te(je);let ee=parseFloat(Q)||0;N==="expenses"&&W>0&&ee<W&&(ee=W);const fe=t.expenses??0;N==="expenseCompensation"&&ee>fe&&(E==null||E(fe),ee=fe),u(t.id,N,ee)},[t.id,t.expenses,u,W,E]),T=o.useCallback(N=>{if(N.key==="Enter"||N.key==="Tab"){const je=N.currentTarget.closest("tr");if(!je)return;const Q=Array.from(je.querySelectorAll("input:not([disabled])")),ee=Q.indexOf(N.currentTarget),fe=N.key==="Tab"&&N.shiftKey,pe=N.key==="Enter"||N.key==="Tab"&&!N.shiftKey;fe&&ee>0?(N.preventDefault(),Q[ee-1].focus()):pe&&ee>=0&&ee<Q.length-1&&(N.preventDefault(),Q[ee+1].focus())}},[]),X=I>0?"text-emerald-700 dark:text-emerald-400":I<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",J=f>0?"text-emerald-700 dark:text-emerald-400":f<0?"text-red-700 dark:text-red-400":"text-stone-800 dark:text-slate-500",K=t.programBalanceCash>0,te=["programBalanceCash","expenses"],[U,re]=o.useState(!1),[G,ce]=o.useState(null),[Y,ke]=o.useState(null),De=o.useCallback(N=>{_==null||_(),re(!0),ce(N)},[_]);o.useEffect(()=>{if(!U)return;const N=setTimeout(()=>re(!1),3e3);return()=>clearTimeout(N)},[U]),o.useEffect(()=>{if(G===null)return;const N=setTimeout(()=>ce(null),1200);return()=>clearTimeout(N)},[G]);const we=(N,je)=>{var le;const Q=t[N]??0,ee=(N==="mada"||N==="visa"||N==="mastercard"||N==="bankTransfer")&&((le=R==null?void 0:R[N])==null?void 0:le.length)>0&&p;if(H||$)return N==="expenses"&&C?e.jsx("button",{type:"button",onClick:()=>C(t.id),className:"block w-full py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/[0.06] rounded-xl transition cursor-pointer",title:"عرض تفاصيل المصروفات",children:Q===0?"—":k(Q)}):ee&&p?e.jsxs("div",{className:"flex items-center gap-1 w-full",children:[e.jsx("span",{className:"flex-1 min-w-0 py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center tabular-nums",children:Q===0?"—":k(Q)}),e.jsx("button",{type:"button",onClick:()=>p(N,t.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 8v4l2 2"}),e.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):e.jsx("span",{className:"block py-1.5 text-sm text-stone-800 dark:text-slate-300 font-cairo text-center",children:Q===0?"—":k(Q)});const fe=N==="expenses",pe=!te.includes(N)&&!K,Qe=N==="programBalanceCash"&&a?0:pe?-1:1,Me=ee&&A&&["mada","visa","mastercard","bankTransfer"].includes(N),Be=Me&&(Y==null?void 0:Y.field)===N?Y.value===0?"":String(Y.value):Q===0?"":String(Q),_e=e.jsx("input",{type:"text",inputMode:"decimal",value:Be,onChange:ne=>{const V=Te(ne.target.value).replace(/[^\d.]/g,""),me=V.indexOf("."),We=me===-1?V:V.slice(0,me+1)+V.slice(me+1).replace(/\./g,""),Ze=parseFloat(We)||0;Me?ke({field:N,value:Ze}):g(N,We)},onBlur:()=>{if(Me&&(Y==null?void 0:Y.field)===N){const ne=Y.value;ke(null),ne!==Q&&A(t.id,N,Q,ne)}},dir:"ltr","aria-label":N,onKeyDown:T,onFocus:ne=>{ne.currentTarget.select(),fe&&C&&C(t.id)},placeholder:"—",tabIndex:Qe,disabled:pe,title:pe?"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش":N==="expenseCompensation"?"يجب أن يكون مساوياً أو أقل من مبلغ المصروفات":void 0,className:"cashbox-input w-full px-2 py-2 rounded-xl bg-white dark:bg-slate-900/70 border-2 border-stone-400 dark:border-white/[0.06] text-stone-900 dark:text-white text-sm font-cairo text-center focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/20 dark:focus:border-amber-500/40 dark:focus:ring-amber-500/20 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm"});return pe&&_?e.jsx("div",{role:"button",tabIndex:0,className:"locked-field-wrapper w-full cursor-not-allowed rounded-lg",onClick:ne=>{ne.preventDefault(),ne.stopPropagation(),De(N)},onKeyDown:ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),De(N))},title:"لا يمكن الإدخال قبل إدخال رصيد البرنامج كاش",children:_e}):ee&&p?e.jsxs("div",{className:"flex items-center gap-1 w-full",children:[e.jsx("div",{className:"flex-1 min-w-0",children:_e}),e.jsx("button",{type:"button",onClick:()=>p(N,t.id),className:"shrink-0 p-1 rounded-lg text-stone-500 hover:text-teal-600 hover:bg-stone-200 dark:hover:text-amber-400 dark:hover:bg-white/10 transition",title:"سجل التغيير (من إكسل / مرحّل / معدّل يدوياً)","aria-label":"سجل التغيير",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 8v4l2 2"}),e.jsx("circle",{cx:"12",cy:"12",r:"10"})]})})]}):_e},Ie=$&&n>0?n<=1?"0.35s":n<=2?"0.6s":n<=3?"1s":"1.5s":void 0,Je=H&&t.closedAt?lt(t.closedAt):lt(i),ve=q?"sticky top-[6.5rem] sm:top-[7rem] z-[9] bg-stone-50 dark:bg-slate-800/95 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b border-stone-300 dark:border-amber-500/15":"",ie=q?"sticky top-[8.75rem] sm:top-[9.25rem] z-[9] bg-white dark:bg-slate-800/95 shadow-[0_2px_8px_rgba(0,0,0,0.08)] dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)] border-b border-stone-400 dark:border-amber-500/15":"";return e.jsxs(e.Fragment,{children:[e.jsx("tr",{"data-row-id":t.id,className:`bg-stone-50 dark:bg-amber-500/[0.06] border-l-2 border-l-teal-500 dark:border-l-amber-500/40 border-b-2 border-stone-400 dark:border-amber-500/15 ${q?"sticky-label-row":""}`,children:e.jsx("td",{colSpan:16,className:`py-1 px-2 sm:px-3 align-middle text-[10px] sm:text-[11px] font-semibold font-cairo text-stone-800 dark:text-amber-200/90 whitespace-nowrap ${ve}`,style:{lineHeight:1.2,verticalAlign:"middle"},children:e.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap rounded-lg border-2 border-teal-400 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 px-2.5 py-1 shadow-md dark:shadow-[0_2px_6px_rgba(245,158,11,0.08)]",children:[se==="أكثر من موظف"&&z?e.jsx("button",{type:"button",onClick:z,className:"text-teal-600 dark:text-amber-400/95 hover:text-teal-700 dark:hover:text-amber-300 underline underline-offset-1 cursor-pointer transition-colors",title:"عرض أسماء الموظفين",children:"أكثر من موظف"}):e.jsx("span",{className:"font-semibold",children:se}),e.jsx("span",{className:"text-stone-500 dark:text-slate-400",children:"·"}),e.jsx("span",{className:"tabular-nums font-semibold text-stone-600 dark:text-slate-400",children:Je})]})})}),e.jsxs("tr",{"data-row-id":t.id,className:`${$?"bg-sky-100 dark:bg-sky-500/10 animate-pulse border-l-2 border-r-2 border-l-sky-400/50 border-r-sky-400/50 border-b-2 border-stone-400 dark:border-amber-500/15":H?"bg-stone-100 dark:bg-slate-800/30 border-b-2 border-stone-400 dark:border-amber-500/15":"bg-white dark:bg-slate-800/20 hover:bg-stone-50 dark:hover:bg-slate-800/35 border-b-2 border-stone-400 dark:border-amber-500/15 transition-colors"} ${q?"sticky-data-row":""}`,style:Ie?{animationDuration:Ie}:void 0,children:[e.jsx("td",{className:`p-1.5 text-center align-middle border-r-2 border-stone-400 dark:border-amber-500/10 ${ie}`,children:x&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("button",{type:"button",onClick:()=>x(t.id),"aria-label":m?"إلغاء تحديد الصف":"تحديد الصف للطباعة",className:`inline-flex items-center justify-center w-5 h-5 rounded-lg border-2 transition-all ${m?"border-teal-500 bg-teal-100 text-teal-600 ring-2 ring-teal-500/30 ring-offset-2 ring-offset-stone-50 dark:border-amber-500/60 dark:bg-amber-500/20 dark:text-amber-400 dark:ring-amber-500/30 dark:ring-offset-slate-800":"border-2 border-stone-400 dark:border-white/20 bg-stone-300 dark:bg-slate-800/60 text-stone-800 dark:text-slate-400 hover:border-teal-400 dark:hover:border-amber-500/40 hover:text-teal-600 dark:hover:text-amber-400/90 shadow-sm"}`,children:m?e.jsx("svg",{className:"w-2.5 h-2.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}):e.jsx("span",{className:"w-2.5 h-2.5 block shrink-0"})})})}),e.jsx("td",{className:`p-1.5 text-center text-stone-800 dark:text-slate-500 text-sm font-medium font-cairo border-r-2 border-stone-400 dark:border-amber-500/10 align-middle tabular-nums ${ie}`,children:r}),Bt.slice(0,4).map(N=>e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${G===N?"locked-cell-pulse":""} ${ie}`,children:we(N)},N)),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${U&&a?"program-balance-pulse-cell":""} ${ie}`,title:!K&&a?"لا يمكن الإدخال في الخانات الأخرى قبل إدخال رصيد البرنامج كاش هنا":void 0,children:we("programBalanceCash")}),e.jsx("td",{className:`p-1.5 text-center font-bold font-cairo align-middle border-2 border-red-300 dark:border-red-500/20 rounded-xl bg-red-50 dark:bg-slate-800/40 shadow-sm dark:shadow-[0_0_0_1px_rgba(248,113,113,0.08)] ${X} ${ie}`,children:L?e.jsx("button",{type:"button",onClick:()=>L("cash",t),className:`block w-full py-1.5 rounded-lg transition cursor-pointer hover:bg-red-100/50 dark:hover:bg-white/[0.06] ${I===0?"cursor-default hover:bg-transparent":""}`,title:I===0?void 0:"شرح سبب انحراف الكاش",disabled:I===0,children:I===0?"—":k(I)}):e.jsx("span",{className:"block py-1",children:I===0?"—":k(I)})}),Bt.slice(5,9).map(N=>e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${G===N?"locked-cell-pulse":""} ${ie}`,children:we(N)},N)),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle bg-stone-300 dark:bg-slate-800/40 ${ie}`,children:e.jsx("span",{className:"block py-1.5 text-sm text-teal-700 dark:text-emerald-400/95 font-semibold font-cairo tabular-nums",children:(()=>{const N=t.mada+t.visa+t.mastercard;return N===0?"—":k(N)})()})}),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle ${G==="programBalanceBank"?"locked-cell-pulse":""} ${ie}`,children:we("programBalanceBank")}),e.jsx("td",{className:`p-1.5 text-center font-bold font-cairo align-middle border-2 border-red-300 dark:border-red-500/20 rounded-xl bg-red-50 dark:bg-slate-800/40 shadow-sm dark:shadow-[0_0_0_1px_rgba(248,113,113,0.08)] ${J} ${ie}`,children:L?e.jsx("button",{type:"button",onClick:()=>L("bank",t),className:`block w-full py-1.5 rounded-lg transition cursor-pointer hover:bg-red-100/50 dark:hover:bg-white/[0.06] ${f===0?"cursor-default hover:bg-transparent":""}`,title:f===0?void 0:"شرح سبب انحراف البنك",disabled:f===0,children:f===0?"—":k(f)}):e.jsx("span",{className:"block py-1",children:f===0?"—":k(f)})}),e.jsx("td",{className:`p-1.5 text-center border-r-2 border-stone-400 dark:border-amber-500/10 align-middle overflow-hidden min-w-0 ${ie}`,children:H?e.jsxs("div",{className:"flex flex-row items-center justify-center gap-1 flex-wrap min-w-0 w-full",children:[e.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded-full px-1.5 py-0.5 bg-emerald-100 dark:bg-emerald-500/15 border border-emerald-300 dark:border-emerald-500/25 text-[9px] font-medium text-emerald-700 dark:text-emerald-400/95 font-cairo whitespace-nowrap shrink-0",children:[e.jsx("svg",{className:"w-2 h-2 text-emerald-600 dark:text-emerald-500 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),"تم الإغلاق"]}),(h||y)&&e.jsxs("div",{className:"inline-flex items-center justify-center gap-0.5 shrink-0",children:[h&&e.jsx("button",{type:"button",onClick:()=>h(t.id),"aria-label":"حذف الصف",className:"inline-flex items-center justify-center w-5 h-5 rounded-md border-2 border-stone-400 dark:border-red-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 transition-all shrink-0 shadow-sm",title:"حذف الصف",children:e.jsx("svg",{className:"w-2.5 h-2.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),y&&e.jsx("button",{type:"button",onClick:()=>y(t.id),"aria-label":"طباعة الصف",className:"inline-flex items-center justify-center w-5 h-5 rounded-md border-2 border-teal-400 dark:border-amber-500/20 bg-stone-400 dark:bg-slate-700/50 text-white dark:text-slate-400 hover:bg-teal-100 dark:hover:bg-amber-500/15 hover:text-teal-600 dark:hover:text-amber-400 hover:border-teal-300 dark:hover:border-amber-500/30 transition-all shrink-0 shadow-sm",title:"طباعة هذه التقفيلة",children:e.jsxs("svg",{className:"w-2.5 h-2.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 9V2h12v7"}),e.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),e.jsx("path",{d:"M6 14h12v8H6z"})]})})]})]}):S?e.jsx("button",{type:"button",onClick:()=>S(t.id),title:"افراغ كل المدخلات في الصف النشط",className:"inline-flex items-center justify-center gap-0.5 rounded-full px-1.5 py-0.5 bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/25 text-[9px] font-medium text-teal-700 dark:text-amber-400 font-cairo whitespace-nowrap w-full min-w-0 truncate hover:bg-teal-200 dark:hover:bg-amber-500/25 transition",children:"افراغ الصف"}):e.jsx("span",{className:"inline-flex items-center justify-center gap-0.5 rounded-full px-1.5 py-0.5 bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/25 text-[9px] font-medium text-teal-700 dark:text-amber-400 font-cairo whitespace-nowrap w-full min-w-0 truncate",children:"الشفت الحالي"})})]})]})}const ks={Enter:"=","=":"=",Backspace:"⌫",Escape:"C",",":"."},ws="programBalanceBank",mt="اجمالى الموازنه";function vs({onTransfer:t,hasActiveRow:r}={}){const[a,i]=o.useState("0"),[d,n]=o.useState(""),[u,m]=o.useState([]),[x,h]=o.useState(!1),y=o.useRef(null),[C,P]=o.useState(null);o.useLayoutEffect(()=>{if(!x){P(null);return}const g=y.current;if(!g){P(null);return}const T=g.getBoundingClientRect();P({right:window.innerWidth-T.right,bottom:window.innerHeight-T.top+8})},[x]);const _=o.useRef("0"),E=o.useRef(""),R=o.useRef(null),p=o.useRef(!1),A=o.useRef(()=>{}),z=o.useRef(null),L=o.useCallback(g=>{_.current=g,i(g)},[]),O=o.useCallback(g=>{i(g)},[]),S=o.useCallback((g,T,X)=>{const J=parseFloat(g)||0,K=parseFloat(X)||0;return T?T==="+"?J+K:T==="-"?J-K:T==="*"?J*K:T==="/"?K===0?0:J/K:T==="%"?K===0?0:J*K/100:K:K},[]),q=o.useCallback(()=>{const g=S(E.current,R.current,_.current),T=`${E.current} ${R.current} ${_.current} = ${g}`;m(X=>[T,...X].slice(0,20)),L(String(g)),n(""),E.current="",R.current=null,p.current=!0},[L,S]),se=o.useCallback(g=>{if(g==="C"){L("0"),n(""),m([]),h(!1),E.current="",R.current=null,p.current=!1;return}if(g==="⌫"){const T=_.current;if(T.length<=1){L("0");return}L(T.slice(0,-1));return}if(g==="="){R.current&&q();return}if(["+","-","*","/","%"].includes(g)){R.current&&q(),E.current=_.current,R.current=g,n(T=>T+" "+g),p.current=!0;return}if(g==="."){if(p.current){L("0."),_.current="0.",p.current=!1;return}if(_.current.includes("."))return;const T=_.current+".";_.current=T,R.current?O(String(S(E.current,R.current,T))):L(T),n(X=>X+g);return}if(/\d/.test(g)){if(p.current)_.current=g,R.current?O(String(S(E.current,R.current,g))):L(g),p.current=!1;else{const T=_.current==="0"?g:_.current+g;_.current=T,R.current?O(String(S(E.current,R.current,T))):L(T)}n(T=>T+g)}},[L,O,q,S]);A.current=se,o.useEffect(()=>{const g=T=>{var te;const X=T.target;if(X.closest("input, textarea, select")||!((te=z.current)!=null&&te.contains(X)))return;const J=ks[T.key]??(T.key.length===1?T.key:"");!J||!["C","⌫","%","/","*","-","+","=",".","0","1","2","3","4","5","6","7","8","9"].includes(J)&&!/^\d$/.test(J)||(T.preventDefault(),A.current(J))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[]);const f=[["C","⌫","%","/"],["7","8","9","*"],["4","5","6","-"],["1","2","3","+"],["0",".","="]],I=g=>["+","-","*","/","%"].includes(g),W=g=>g==="="?"col-span-2 bg-teal-500 hover:bg-teal-600 dark:bg-amber-500/20 dark:hover:bg-amber-500/30 text-white dark:text-amber-400 font-bold text-lg border-2 border-teal-400 dark:border-amber-500/40 shadow-sm":I(g)?"bg-teal-100 hover:bg-teal-200 dark:bg-amber-500/20 dark:hover:bg-amber-500/30 text-teal-700 dark:text-amber-400 font-bold border-2 border-teal-300 dark:border-amber-500/40 flex items-center justify-center shadow-sm":g==="C"?"bg-red-100 hover:bg-red-200 dark:bg-red-500/20 dark:hover:bg-red-500/30 text-red-600 dark:text-red-400 border-2 border-red-300 dark:border-red-500/40 text-base shadow-sm":g==="⌫"?"bg-stone-400 hover:bg-stone-500 dark:bg-slate-600/40 dark:hover:bg-slate-500/50 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 text-base shadow-sm":"bg-white dark:bg-slate-700/40 hover:bg-stone-100 dark:hover:bg-slate-600/50 text-stone-900 dark:text-slate-200 border-2 border-stone-400 dark:border-white/10 active:scale-[0.98] text-base shadow-sm",H={"+":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),"-":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round","aria-hidden":"true",children:e.jsx("path",{d:"M5 12h14"})}),"*":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M7 7l10 10M17 7L7 17"})}),"/":e.jsx("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M5 4l14 16"})}),"%":e.jsxs("svg",{className:"w-[0.875rem] h-[0.875rem]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"6",cy:"6",r:"2.5"}),e.jsx("circle",{cx:"18",cy:"18",r:"2.5"}),e.jsx("path",{d:"M6 18L18 6"})]})},$=g=>H[g]?H[g]:e.jsx("span",{className:"inline-block leading-none",children:g});return e.jsxs("div",{ref:z,className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",tabIndex:0,title:"انقر هنا ثم استخدم لوحة المفاتيح. النتيجة لا تتغير عند الكتابة في الجدول.",children:[e.jsxs("div",{className:"bg-gradient-to-b from-teal-100 to-stone-200 dark:from-amber-500/15 dark:to-slate-800/60 px-3 sm:px-4 py-2 sm:py-3 border-b-2 border-teal-400 dark:border-amber-500/25 flex items-center justify-between gap-2 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[e.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide min-w-0",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400 shrink-0",children:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"4",y:"2",width:"16",height:"20",rx:"2"}),e.jsx("path",{d:"M6 6h12M6 10h12"}),e.jsx("rect",{x:"6.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"10.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"14.5",y:"13.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"6.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"10.5",y:"17.5",width:"3",height:"3",rx:"0.5"}),e.jsx("rect",{x:"14.5",y:"17.5",width:"3",height:"3",rx:"0.5"})]})}),"الآلة الحاسبة"]}),e.jsx("button",{ref:y,type:"button",onClick:()=>h(g=>!g),className:`p-1.5 rounded-lg transition ${x?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:x?"إخفاء السجل":"سجل العمليات","aria-label":"سجل العمليات",children:e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 space-y-2 sm:space-y-3 min-h-0",children:[e.jsxs("div",{className:"rounded-xl bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-amber-500/30 p-2 shadow-inner dark:shadow-[0_0_18px_rgba(245,158,11,0.14)]",children:[e.jsx("div",{className:"text-right text-stone-700 text-xs min-h-[16px] font-cairo tabular-nums select-none","aria-hidden":"true",children:d||"​"}),e.jsx("div",{className:"w-full px-3 py-2.5 rounded-lg bg-stone-50 dark:bg-slate-900/50 border-2 border-stone-300 dark:border-transparent text-stone-900 dark:text-white text-right font-cairo text-2xl font-semibold tabular-nums min-h-[2.5rem] flex items-center justify-end","aria-live":"polite","aria-label":`النتيجة: ${a}`,children:a})]}),t&&e.jsxs("button",{type:"button",onClick:()=>{const g=parseFloat(a)||0;!r||g<=0||(t(g,ws),m(T=>[`مرحّل → ${mt}: ${g}`,...T].slice(0,20)),L("0"),n(""))},disabled:!r||!parseFloat(a),title:`ترحيل الرقم إلى ${mt}`,className:"w-full py-2 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border-2 border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition flex items-center justify-center gap-2 shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل إلى ",mt]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:f.flat().map(g=>e.jsx("button",{type:"button",onClick:()=>se(g),className:`py-2.5 rounded-xl font-cairo transition-all duration-150 ${W(g)}`,"aria-label":g==="⌫"?"حذف":g,children:$(g)},g))}),x&&C&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>h(!1)}),e.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[180px] max-h-[280px] overflow-y-auto",style:{right:C.right,bottom:C.bottom},children:[e.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"سجل العمليات"}),u.length===0?e.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لا يوجد سجل بعد"}):e.jsx("ul",{className:"space-y-1 mb-1 max-h-48 overflow-y-auto scrollbar-thin",children:u.map((g,T)=>e.jsx("li",{className:"tabular-nums px-2 py-1 rounded-md bg-stone-100 dark:bg-slate-800/40 text-stone-800 dark:text-slate-300 border border-stone-300 dark:border-transparent",children:g},T))}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]})}const Ye=[500,200,100,50,10,5,1],xt=()=>Object.fromEntries(Ye.map(t=>[t,0]));function js({onApplyToCash:t,hasActiveRow:r}){const[a,i]=o.useState(xt()),[d,n]=o.useState(xt()),[u,m]=o.useState(!1),x=o.useRef(null),[h,y]=o.useState(null);o.useLayoutEffect(()=>{if(!u){y(null);return}const p=x.current;if(!p){y(null);return}const A=p.getBoundingClientRect();y({right:window.innerWidth-A.right,bottom:window.innerHeight-A.top+8})},[u]);const C=Ye.reduce((p,A)=>p+(a[A]??0)*A,0),P=Ye.reduce((p,A)=>p+(d[A]??0)*A,0),_=o.useCallback((p,A)=>{i(z=>({...z,[p]:A}))},[]),E=o.useCallback(()=>{i(xt())},[]),R=o.useCallback(()=>{r&&(n({...a}),t(C),E())},[r,C,t,E,a]);return e.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[e.jsxs("div",{className:"relative bg-gradient-to-b from-teal-100 to-stone-200 dark:from-amber-500/15 dark:to-slate-800/60 px-3 sm:px-4 py-2 sm:py-3 border-b-2 border-teal-300 dark:border-amber-500/25 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("h3",{className:"flex items-center gap-2 sm:gap-2.5 text-sm sm:text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide min-w-0",children:[e.jsx("span",{className:"flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-lg sm:rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400 shrink-0",children:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),e.jsx("path",{d:"M2 10h20M2 14h20M7 8v8M12 8v8M17 8v8"})]})}),"حاسبة الكاش"]}),e.jsx("button",{ref:x,type:"button",onClick:()=>m(p=>!p),className:`p-1.5 rounded-lg transition shrink-0 ${u?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:"آخر عمليات رُحّلت إلى الكاش","aria-label":"سجل العمليات",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]})})]}),e.jsx("span",{className:"text-xs font-semibold text-stone-800 dark:text-amber-200/95 font-cairo",children:"المجموع"}),e.jsx("span",{className:"text-sm font-semibold text-teal-700 dark:text-amber-400 font-cairo tabular-nums",children:C>0?`${C} ريال سعودي`:"— ريال سعودي"}),u&&h&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>m(!1)}),e.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[160px] max-h-[280px] overflow-y-auto",style:{right:h.right,bottom:h.bottom},children:[e.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"آخر عمليات رُحّلت إلى الكاش:"}),P===0?e.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-0.5 mb-1",children:Ye.map(p=>{const A=d[p]??0;return A===0?null:e.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:["فئة ",p,": ",A," × ",p," = ",A*p," ريال"]},p)})}),e.jsxs("p",{className:"border-t border-stone-300 dark:border-white/10 pt-1 font-semibold text-teal-700 dark:text-amber-400 tabular-nums",children:["المجموع: ",P," ريال سعودي"]})]}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]}),e.jsxs("div",{className:"flex-1 flex flex-col p-3 sm:p-4 min-h-0 overflow-hidden gap-3 sm:gap-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-5 shrink-0",children:Ye.map(p=>{const A=(a[p]??0)*p;return e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:gap-4 rounded-lg sm:rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-amber-500/15 px-2 sm:px-6 py-3 sm:py-5 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-w-0",children:[e.jsxs("span",{className:"text-teal-700 dark:text-amber-400/90 text-xs font-cairo font-semibold tabular-nums",children:["فئة النقد ",p]}),e.jsxs("div",{className:"flex items-center gap-2.5 w-full justify-center px-1",children:[e.jsx("button",{type:"button","aria-label":"نقص واحد",onClick:()=>_(p,Math.max(0,(a[p]??0)-1)),disabled:(a[p]??0)<=0,className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-red-100 dark:hover:bg-red-500/20 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 disabled:opacity-40 disabled:pointer-events-none transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"−"})}),e.jsx("input",{type:"text",inputMode:"numeric",dir:"ltr",value:a[p]===0||a[p]==null?"":String(a[p]),onChange:z=>{const L=Te(z.target.value).replace(/\D/g,"");_(p,Math.max(0,parseInt(L,10)||0))},onFocus:z=>{const L=z.target.value;(L===""||Number(L)===0)&&_(p,0)},className:"w-full min-w-[3rem] max-w-[4.5rem] px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums cashbox-input focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-amber-500/50 dark:focus:ring-amber-500/25 focus:outline-none"}),e.jsx("button",{type:"button","aria-label":"زد واحد",onClick:()=>_(p,(a[p]??0)+1),className:"flex items-center justify-center w-6 h-6 rounded-md bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-teal-100 dark:hover:bg-emerald-500/20 hover:text-teal-700 dark:hover:text-emerald-400 hover:border-teal-300 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm dark:shadow-[0_1px_3px_rgba(0,0,0,0.2)]",children:e.jsx("span",{className:"text-sm font-bold leading-none",children:"+"})})]}),A>0?e.jsxs("span",{className:"text-stone-800 dark:text-slate-300 text-[10px] font-semibold font-cairo tabular-nums whitespace-nowrap",children:[A," ريال سعودي"]}):e.jsx("span",{className:"text-stone-600 dark:text-slate-500/60 text-[10px] font-semibold font-cairo whitespace-nowrap",children:"— ريال سعودي"})]},p)})}),e.jsxs("div",{className:"w-full py-3 px-4 rounded-xl text-sm font-cairo font-semibold bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/30 text-teal-800 dark:text-amber-400 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_0_12px_rgba(245,158,11,0.08)]",children:[e.jsx("span",{children:"المجموع"}),e.jsx("span",{className:"text-base font-semibold tabular-nums",children:C>0?`${C} ريال سعودي`:"— ريال سعودي"})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsxs("button",{type:"button",onClick:R,disabled:!r||C===0,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل للكاش"]}),e.jsxs("button",{type:"button",onClick:E,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),e.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح"]})]})]})]})}const ys=[{field:"mada",label:"مدى"},{field:"visa",label:"فيزا"},{field:"mastercard",label:"ماستر كارد"}];function Ns({onTransfer:t,hasActiveRow:r}){const[a,i]=o.useState({mada:[],visa:[],mastercard:[]}),[d,n]=o.useState({mada:"",visa:"",mastercard:""}),[u,m]=o.useState({mada:[],visa:[],mastercard:[]}),[x,h]=o.useState(null),y=o.useRef(null),[C,P]=o.useState(null);o.useLayoutEffect(()=>{if(x===null){P(null);return}const f=y.current;if(!f){P(null);return}const I=f.getBoundingClientRect();P({right:window.innerWidth-I.right,bottom:window.innerHeight-I.top+8})},[x]);const _=o.useCallback(f=>f.reduce((I,W)=>I+W,0),[]),E=_(a.mada),R=_(a.visa),p=_(a.mastercard),A=E+R+p,z=o.useCallback(f=>{const I=Te(d[f]).replace(",",".").replace(/[^\d.]/g,""),W=parseFloat(I)||0;W<=0||(i(H=>({...H,[f]:[...H[f],W]})),n(H=>({...H,[f]:""})))},[d]),L=o.useCallback((f,I)=>{i(W=>({...W,[f]:W[f].filter((H,$)=>$!==I)}))},[]),O=o.useCallback((f,I)=>{n(W=>({...W,[f]:I}))},[]),S=o.useCallback(()=>{i({mada:[],visa:[],mastercard:[]}),n({mada:"",visa:"",mastercard:""})},[]),q=o.useCallback(f=>{if(!r)return;const I=a[f],W=f==="mada"?E:f==="visa"?R:p;if(W===0)return;m($=>({...$,[f]:[...$[f],...I]}));const H=f==="mada"?[W,0,0]:f==="visa"?[0,W,0]:[0,0,W];t(H[0],H[1],H[2]),i($=>({...$,[f]:[]})),n($=>({...$,[f]:""}))},[r,E,R,p,t,a]),se=o.useCallback(()=>{!r||E===0&&R===0&&p===0||(m(f=>({mada:[...f.mada,...a.mada],visa:[...f.visa,...a.visa],mastercard:[...f.mastercard,...a.mastercard]})),t(E,R,p),S())},[r,E,R,p,t,a,S]);return e.jsxs("div",{className:"w-full h-full min-h-0 flex flex-col rounded-2xl overflow-hidden border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/50 shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] backdrop-blur-sm",children:[e.jsxs("div",{className:"bg-gradient-to-b from-teal-100 to-slate-200 dark:from-amber-500/15 dark:to-slate-800/60 px-4 py-3 border-b-2 border-teal-300 dark:border-amber-500/25 flex items-center justify-between gap-2 shrink-0 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)]",children:[e.jsxs("h3",{className:"flex items-center gap-2.5 text-base font-semibold text-teal-700 dark:text-amber-400 font-cairo tracking-wide",children:[e.jsx("span",{className:"flex items-center justify-center w-9 h-9 rounded-xl bg-teal-100 dark:bg-amber-500/20 text-teal-600 dark:text-amber-400",children:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"1"}),e.jsx("path",{d:"M2 10h20M7 14h2"})]})}),"حاسبه العمليات البنكيه"]}),e.jsx("span",{className:"text-xs font-semibold text-slate-700 font-cairo tabular-nums",children:A>0?`${A} ريال`:"—"})]}),e.jsxs("div",{className:"flex-1 flex flex-col p-4 min-h-0 overflow-hidden gap-4",children:[e.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1 min-h-0",children:ys.map(({field:f,label:I})=>{const W=a[f],H=_(W);return e.jsxs("div",{className:"relative flex flex-col rounded-xl bg-white dark:bg-slate-800/60 border-2 border-stone-400 dark:border-amber-500/15 px-3 py-3 shadow-md dark:shadow-[0_2px_8px_rgba(0,0,0,0.1)] min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-1 mb-1 shrink-0",children:[e.jsx("span",{className:"text-teal-700 dark:text-amber-400/90 text-xs font-cairo font-semibold",children:I}),e.jsxs("div",{className:"relative shrink-0",children:[e.jsx("button",{ref:x===f?y:void 0,type:"button",onClick:()=>h($=>$===f?null:f),className:`p-1.5 rounded-lg transition ${x===f?"bg-teal-100 text-teal-700 dark:bg-amber-500/20 dark:text-amber-400":"text-stone-700 dark:text-slate-400 hover:text-teal-600 hover:bg-stone-300 dark:hover:text-amber-400 dark:hover:bg-white/5"}`,title:"كل العمليات المرحّلة لهذا النوع","aria-label":"سجل العمليات",children:e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]})}),x===f&&C&&$e.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]","aria-hidden":!0,onClick:()=>h(null)}),e.jsxs("div",{className:"fixed z-[101] rounded-xl border-2 border-stone-400 dark:border-white/10 bg-white dark:bg-slate-800 shadow-xl py-2 px-3 text-xs font-cairo min-w-[140px] max-h-[220px] overflow-y-auto",style:{right:C.right,bottom:C.bottom},children:[e.jsx("div",{className:"font-semibold text-teal-700 dark:text-amber-400 mb-1.5",children:"كل العمليات المرحّلة إلى الصف:"}),u[f].length===0?e.jsx("p",{className:"text-stone-600 dark:text-slate-400",children:"لم يُرحّل أي مبلغ بعد"}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-0.5 mb-1",children:u[f].map(($,g)=>e.jsxs("li",{className:"tabular-nums text-stone-800 dark:text-slate-200",children:[$," ريال"]},g))}),e.jsxs("p",{className:"border-t border-stone-200 dark:border-white/10 pt-1 font-semibold text-teal-700 dark:text-amber-400 tabular-nums",children:["المجموع: ",_(u[f])," ريال"]})]}),e.jsx("button",{type:"button",onClick:()=>h(null),className:"mt-2 w-full py-1 rounded bg-stone-300 dark:bg-slate-600 text-stone-800 dark:text-slate-200 text-[10px] font-medium",children:"إغلاق"})]})]}),document.body)]})]}),e.jsx("p",{className:"text-[9px] text-stone-500 dark:text-slate-500 font-cairo mb-1.5 shrink-0",children:"أدخل المبلغ ثم +"}),e.jsxs("div",{className:"flex items-center gap-1.5 mb-2 shrink-0",children:[e.jsx("input",{type:"text",inputMode:"decimal",dir:"ltr",placeholder:"مبلغ العملية",value:d[f],onChange:$=>{const T=(Te($.target.value).replace(",",".").replace(/[^\d.]/g,"").match(/^\d*\.?\d*/)||[""])[0];O(f,T)},onKeyDown:$=>{$.key==="Enter"&&($.preventDefault(),z(f))},className:"flex-1 min-w-0 px-2 py-2 rounded-lg bg-white dark:bg-slate-900/80 border-2 border-stone-400 dark:border-white/10 text-stone-900 dark:text-white text-center text-sm font-cairo tabular-nums placeholder:text-xs placeholder:text-stone-400 dark:placeholder:text-slate-500 focus:border-teal-500/50 focus:ring-2 focus:ring-teal-500/25 dark:focus:border-amber-500/50 dark:focus:ring-amber-500/25 focus:outline-none"}),e.jsx("button",{type:"button","aria-label":`إضافة لـ ${I}`,onClick:()=>z(f),className:"flex items-center justify-center w-8 h-8 rounded-lg bg-stone-400 dark:bg-slate-700/80 border-2 border-stone-500 dark:border-white/10 text-white dark:text-slate-300 hover:bg-teal-100 dark:hover:bg-emerald-500/20 hover:text-teal-700 dark:hover:text-emerald-400 hover:border-teal-300 dark:hover:border-emerald-500/30 transition shrink-0 shadow-sm",children:e.jsx("span",{className:"text-lg font-bold leading-none",children:"+"})})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-auto space-y-1",children:W.length===0?e.jsx("span",{className:"text-stone-600 dark:text-slate-500 text-[10px] font-cairo",children:"لا عمليات — أضف مبالغ بالزر +"}):W.map(($,g)=>e.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-lg bg-white dark:bg-slate-700/50 px-2 py-1 border-2 border-stone-400 dark:border-white/10 shadow-sm",children:[e.jsxs("span",{className:"text-xs font-cairo tabular-nums text-stone-800 dark:text-slate-200",children:[$," ريال"]}),e.jsx("button",{type:"button",onClick:()=>L(f,g),"aria-label":"حذف",className:"w-5 h-5 rounded flex items-center justify-center text-stone-600 hover:text-red-600 hover:bg-red-100 dark:hover:bg-red-500/20 transition shrink-0",children:e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]},`${f}-${g}`))}),e.jsxs("div",{className:"pt-2 mt-auto border-t-2 border-stone-400 dark:border-white/10 shrink-0 space-y-2",children:[e.jsxs("span",{className:"text-xs font-semibold font-cairo text-teal-700 dark:text-amber-400 tabular-nums block",children:["المجموع: ",H>0?`${H} ريال`:"—"]}),e.jsxs("button",{type:"button",onClick:()=>q(f),disabled:!r||H===0,title:`ترحيل ${I} إلى الصف النشط`,className:"w-full py-2 rounded-lg text-xs font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-1.5",children:[e.jsx("svg",{className:"w-3.5 h-3.5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل ",I]})]})]},f)})}),e.jsxs("div",{className:"w-full py-2.5 px-4 rounded-xl text-xs font-cairo font-semibold bg-teal-100 dark:bg-amber-500/15 border-2 border-teal-400 dark:border-amber-500/30 text-teal-800 dark:text-amber-400 flex items-center justify-between gap-6 shrink-0",children:[e.jsxs("span",{className:"tabular-nums",children:["مدى ",e.jsx("span",{className:"font-bold",children:E})]}),e.jsxs("span",{className:"tabular-nums",children:["فيزا ",e.jsx("span",{className:"font-bold",children:R})]}),e.jsxs("span",{className:"tabular-nums",children:["ماستر ",e.jsx("span",{className:"font-bold",children:p})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsxs("button",{type:"button",onClick:se,disabled:!r||E===0&&R===0&&p===0,title:"ترحيل مدى + فيزا + ماستر كارد معاً إلى الصف النشط",className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-teal-500 hover:bg-teal-600 dark:bg-emerald-500/20 dark:hover:bg-emerald-500/30 text-white dark:text-emerald-400 border border-teal-400 dark:border-emerald-500/40 disabled:opacity-50 disabled:pointer-events-none transition-all flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 19V5M5 12l7-7 7 7"})}),"ترحيل الكل"]}),e.jsxs("button",{type:"button",onClick:S,className:"flex-1 min-w-0 py-2.5 rounded-xl text-sm font-cairo font-medium bg-stone-400 dark:bg-slate-600/50 hover:bg-stone-500 dark:hover:bg-slate-500/60 text-white dark:text-slate-300 border-2 border-stone-500 dark:border-white/10 transition-all flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),e.jsx("path",{d:"M10 11v6M14 11v6"})]}),"مسح الكل"]})]})]})]})}const Cs={success:{bg:"bg-emerald-100 dark:bg-emerald-500/15",border:"border-emerald-400 dark:border-emerald-500/40",icon:"text-emerald-700 dark:text-emerald-400"},error:{bg:"bg-red-100 dark:bg-red-500/15",border:"border-red-400 dark:border-red-500/40",icon:"text-red-700 dark:text-red-400"},warning:{bg:"bg-amber-100 dark:bg-amber-500/15",border:"border-amber-400 dark:border-amber-500/40",icon:"text-amber-700 dark:text-amber-400"},info:{bg:"bg-sky-100 dark:bg-sky-500/15",border:"border-sky-400 dark:border-sky-500/40",icon:"text-sky-700 dark:text-sky-400"}},Ms={success:e.jsx("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),error:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),warning:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 9v4M12 17h.01"}),e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})]}),info:e.jsxs("svg",{className:"w-5 h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4M12 8h.01"})]})},Rt=3e3;function _s({message:t,type:r,onClose:a,position:i="bottom",autoHideMs:d=Rt}){const n=o.useRef(a);n.current=a,o.useEffect(()=>{const x=d>0?d:Rt,h=setTimeout(()=>n.current(),x);return()=>clearTimeout(h)},[t,d]);const u=Cs[r],m=i==="center"?"fixed top-1/2 left-1/2 z-50 -translate-x-1/2 -translate-y-1/2":"fixed bottom-6 left-1/2 z-50 -translate-x-1/2";return e.jsxs("div",{role:"alert",className:`${m} flex items-center gap-3 px-4 py-3 rounded-2xl border ${u.bg} ${u.border} shadow-xl shadow-black/10 dark:shadow-black/20 backdrop-blur-md min-w-[200px] max-w-[90vw]`,children:[e.jsx("span",{className:u.icon,"aria-hidden":"true",children:Ms[r]}),e.jsx("span",{className:"font-cairo text-sm text-stone-800 dark:text-slate-200 flex-1",children:t}),e.jsx("button",{type:"button",onClick:a,className:"p-1 rounded-lg text-stone-600 dark:text-slate-400 hover:text-stone-900 dark:hover:text-slate-200 hover:bg-stone-300 dark:hover:bg-white/10 transition focus-visible:ring-2 focus-visible:ring-teal-400 dark:focus-visible:ring-amber-400 focus-visible:ring-offset-2 focus-visible:ring-offset-stone-50 dark:focus-visible:ring-offset-slate-800 focus-visible:outline-none","aria-label":"إغلاق",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})}function Ss(t){const[r,a]=o.useState([]),i=o.useRef({}),d=o.useRef({}),n=o.useCallback(()=>{const u=Lt();a(u),u.forEach(m=>{d.current[m.id]=m})},[]);return o.useEffect(()=>(n(),Lt().length===0&&(Ot(t),n()),()=>{Object.values(i.current).forEach(clearTimeout),i.current={}}),[t,n]),{rows:r,setRows:a,loadRows:n,debounceRef:i,rowDataRef:d}}function Ls(){const[t,r]=o.useState(()=>new Date),[a,i]=o.useState(null),[d,n]=o.useState(null),[u,m]=o.useState(0);return o.useEffect(()=>{const x=setInterval(()=>{const h=Date.now();r(new Date(h)),d!==null&&m(Math.max(0,Math.ceil((d-h)/1e3)))},1e3);return()=>clearInterval(x)},[d]),{liveNow:t,closingRowId:a,setClosingRowId:i,closingEndsAt:d,setClosingEndsAt:n,closingSecondsLeft:u,setClosingSecondsLeft:m}}function Ts(t,r){const[a,i]=o.useState(null),[d,n]=o.useState(null),u=o.useRef({}),m=o.useRef(null),x=o.useRef(null);x.current=(a==null?void 0:a.rowId)??null;const h=o.useCallback(y=>{var L;if(x.current===y)return;u.current={},n(null);const C=t.find(O=>O.id===y)??r.current[y],P=(C==null?void 0:C.expenses)??0;let _=(L=C==null?void 0:C.expenseItems)!=null&&L.length?C.expenseItems.map(O=>({amount:String(O.amount),description:O.description||""})):[{amount:P?String(P):"",description:""}];const E=O=>(Number(O.amount)||0)!==0||String(O.description||"").trim()!=="",R=(C==null?void 0:C.carriedExpenseCount)??0,p=_.slice(0,R).filter(E).length;_=_.filter(E);let A=p;const z=(C==null?void 0:C.status)==="closed";if(!z&&_.length>0){const O=_[_.length-1];if(String(O.amount||"").trim()!==""||String(O.description||"").trim()!==""){const S=_.reduce((f,I)=>f+(Number(I.amount)||0),0),q=P-S,se=q>0?String(q):"";_=[..._,{amount:se,description:""}]}}!z&&_.length===0&&(_=[{amount:P?String(P):"",description:""}]),i({rowId:y,items:_,readOnly:z,carriedCount:A})},[t,r]);return o.useEffect(()=>{a||(m.current=null)},[a]),o.useEffect(()=>{if(d===null)return;const y=setTimeout(()=>n(null),3e3);return()=>clearTimeout(y)},[d]),{expenseModal:a,setExpenseModal:i,pulseExpenseDescriptionIndex:d,setPulseExpenseDescriptionIndex:n,openExpenseDetails:h,expenseAmountRef:u,expenseModalFocusedRowIdRef:m}}const Kt="cashbox_theme",qe=typeof document<"u"?document.documentElement:null,At=typeof document<"u"?document.body:null;function Es(){try{if(typeof localStorage>"u")return"dark";const t=localStorage.getItem(Kt);return t==="light"||t==="dark"?t:"dark"}catch{return"dark"}}function ft(t){if(!qe)return;const r=t==="dark";qe.classList.toggle("dark",r),At&&At.classList.toggle("dark",r);try{localStorage.setItem(Kt,t)}catch{}qe.offsetHeight}function Ds(t){try{window.dispatchEvent(new CustomEvent("cashbox-theme-change",{detail:t}))}catch{}}function Ut(){if(!qe)return;const r=qe.classList.contains("dark")?"light":"dark";ft(r),Ds(r)}const He=4,at=10,Bs=2;function ut(){return"ayman5255"}const Rs=[{id:"today",label:"اليوم"},{id:"yesterday",label:"أمس"},{id:"lastWeek",label:"الأسبوع الماضي"}];function $t(){Ut()}function As({name:t,onExit:r,theme:a,onToggleTheme:i}){const d=o.useRef(null),{rows:n,setRows:u,loadRows:m,debounceRef:x,rowDataRef:h}=Ss(t),{liveNow:y,closingRowId:C,setClosingRowId:P,setClosingEndsAt:_,closingSecondsLeft:E,setClosingSecondsLeft:R}=Ls(),[p,A]=o.useState("today"),[z,L]=o.useState(1),[O,S]=o.useState(null),[q,se]=o.useState(null),[f,I]=o.useState(null),[W,H]=o.useState(new Set),[$,g]=o.useState(null),[T,X]=o.useState(null),[J,K]=o.useState(null),[te,U]=o.useState(""),[re,G]=o.useState(!1),[ce,Y]=o.useState(!1),[ke,De]=o.useState(null),[we,Ie]=o.useState(0),Je=o.useRef(null),[ve,ie]=o.useState(null),[N,je]=o.useState([]),[Q,ee]=o.useState(null),[fe,pe]=o.useState(!1),[Qe,Me]=o.useState(null),[Be,_e]=o.useState(null),[le,ne]=o.useState(null);o.useEffect(()=>{const s=d.current;if(!s)return;const l=c=>{c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation(),$t()};return s.addEventListener("click",l,!0),()=>s.removeEventListener("click",l,!0)},[]);const{expenseModal:V,setExpenseModal:me,pulseExpenseDescriptionIndex:We,setPulseExpenseDescriptionIndex:Ze,openExpenseDetails:Yt,expenseAmountRef:xe,expenseModalFocusedRowIdRef:wt}=Ts(n,h);o.useEffect(()=>{if(C===null||E>0)return;const s=C,l=n.find(Z=>Z.id===s);if(!l||l.status==="closed"){P(null),_(null);return}P(null),_(null);const c=x.current[s];c&&(clearTimeout(c),delete x.current[s],he(s,l));const b=Fr(s),j=b?{...b,...l,id:s,status:"active"}:l,M=st(j);Or(s,{...j,employeeName:t,variance:M});const w=j.expenses??0,v=j.expenseCompensation??0,D=Math.max(0,w-v),B=j.expenseItems??[],be=v>0?D>0?[{amount:D,description:"مرحّل (صافي بعد التعويض)"}]:[]:B.map(Z=>({amount:Z.amount,description:Z.description||""}));Ot(t,{expenses:D,expenseItems:be,carriedExpenseCount:be.length}),m(),S({msg:"تم إغلاق الشفت وإضافة صف جديد",type:"success"}),Ie(Z=>Z+1)},[E,C,n,t,m]);const ue=o.useMemo(()=>{const s=n.filter(c=>c.status!=="closed").sort((c,b)=>new Date(b.createdAt).getTime()-new Date(c.createdAt).getTime()),l=Dt(n.filter(c=>c.status==="closed"),p).sort((c,b)=>new Date((b.closedAt??"").toString()).getTime()-new Date((c.closedAt??"").toString()).getTime());return p==="today"?[...s,...l]:l},[n,p]),Fe=Math.max(1,Math.ceil(ue.length/He));o.useEffect(()=>{z>Fe&&L(1)},[z,Fe]);const qt=o.useMemo(()=>ue.slice((z-1)*He,z*He),[ue,z]),F=o.useMemo(()=>{var s;return((s=ue.find(l=>l.status!=="closed"))==null?void 0:s.id)??null},[ue]);o.useMemo(()=>{const s=n.filter(l=>l.status==="closed"&&l.closedAt);return s.length===0?null:s.sort((l,c)=>new Date((c.closedAt??"").toString()).getTime()-new Date((l.closedAt??"").toString()).getTime())[0]??null},[n]);const ye=o.useMemo(()=>n.find(s=>s.status!=="closed")??null,[n]),et=o.useMemo(()=>{if(!ye)return!1;const s=ye.cash??0,l=ye.programBalanceCash??0,c=ye.programBalanceBank??0;return s>0&&l>0&&c>0},[ye]),Gt=o.useCallback(async s=>{var Ae;const l=(Ae=s.target.files)==null?void 0:Ae[0];if(s.target.value="",!l)return;const c=ye;if(!c){S({msg:"لا يوجد صف نشط لملء البيانات",type:"warning"});return}let b;try{b=await l.arrayBuffer()}catch{S({msg:"تعذر قراءة الملف",type:"error"});return}const j=new Date(0),{sums:M,counts:w,details:v,employeeName:D,employeeNamesList:B,error:ae}=ms(b,j);if(ae){S({msg:ae,type:"error"});return}ie(v),je(B??[]);const be=x.current[c.id];be&&(clearTimeout(be),delete x.current[c.id],he(c.id,h.current[c.id]??c));const Z=h.current[c.id]??c,ge={mada:M.mada,visa:M.visa,mastercard:M.mastercard,bankTransfer:M.bankTransfer},Se=M.mada+M.visa+M.mastercard,ze=D&&D.trim()!==""?D.trim():Z.employeeName,Le={...Z,...ge,employeeName:ze,variance:st({...Z,...ge})};he(c.id,Le),h.current[c.id]=Le,u(dt=>dt.map(tt=>tt.id===c.id?Le:tt)),m();const de=[];w.mada>0&&de.push(`مدى ${k(M.mada)}`),w.visa>0&&de.push(`فيزا ${k(M.visa)}`),w.mastercard>0&&de.push(`ماستر كارد ${k(M.mastercard)}`),w.bankTransfer>0&&de.push(`تحويل بنكي ${k(M.bankTransfer)}`);const Ve=de.length>0?de.join(" — ")+` — المجموع: ${k(Se)}`:"";S({msg:Se>0?`تم استخراج: ${Ve}`:"لم يُعثر على مدى/فيزا/ماستر كارد/تحويل بنكي في الملف",type:Se>0?"success":"info"})},[ye,m]),Xt=o.useCallback(()=>{var s;(s=Je.current)==null||s.click()},[]),Jt=o.useCallback(s=>{const l=x.current[s];l&&(clearTimeout(l),delete x.current[s]);const c=n.find(w=>w.id===s),b=(c==null?void 0:c.carriedExpenseCount)??0,j=((c==null?void 0:c.expenseItems)??[]).slice(0,b),M=j.reduce((w,v)=>w+v.amount,0);if(he(s,{expenses:M,expenseItems:j}),c){const w={...c,expenses:M,expenseItems:j,variance:st({...c})};h.current[s]=w,u(v=>v.map(D=>D.id!==s?D:w))}m(),xe.current={}},[n,m]),vt=o.useCallback((s,l,c)=>{me(b=>b?{...b,items:b.items.map((j,M)=>M===s?{...j,[l]:String(c)}:j)}:null)},[]),Qt=o.useCallback(()=>{xe.current={},me(s=>s?{...s,items:[...s.items,{amount:"",description:""}]}:null)},[]),Zt=o.useCallback(s=>{me(l=>{if(!l)return l;const c=l.carriedCount??0;return s<c||l.items.length<=1?l:(xe.current={},{...l,items:l.items.filter((b,j)=>j!==s)})})},[]),er=o.useCallback((s,l)=>{U(""),Y(!1),K({rowId:s,itemIndex:l,step:"confirm"})},[]),tr=o.useCallback(()=>{J&&K(s=>s?{...s,step:"code"}:null)},[J]),jt=o.useCallback(()=>{if(!J)return;if(te.trim()!==ut()){Y(!0),S({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Y(!1);const{rowId:s,itemIndex:l}=J,c=n.find(D=>D.id===s)??h.current[s];if(!c){K(null),U("");return}const b=(c.expenseItems??[]).slice(),j=c.carriedExpenseCount??0;if(l>=b.length||l>=j){K(null),U("");return}b.splice(l,1);const M=Math.max(0,j-1),w=b.reduce((D,B)=>D+B.amount,0);he(s,{expenseItems:b,expenses:w,carriedExpenseCount:M});const v={...c,expenseItems:b,expenses:w,carriedExpenseCount:M};h.current[s]=v,u(D=>D.map(B=>B.id===s?v:B)),me(D=>{if(!D||D.rowId!==s)return D;const B=D.items.filter((ae,be)=>be!==l);return{...D,items:B,carriedCount:M}}),xe.current={},m(),K(null),U(""),G(!1),S({msg:"تم حذف البند المرحّل",type:"success"})},[J,te,n,m,he]),Oe=o.useCallback(()=>{if(!V)return;const s=V.rowId,l=V.carriedCount??0,c=V.items.map((w,v)=>{const D=xe.current[v]!==void 0?xe.current[v]:String(w.amount??"");return{amount:Number(String(D).replace(/,/g,""))||0,description:String(w.description||"").trim(),index:v}}),b=c.find(w=>w.index>=l&&w.amount>0&&!w.description);if(b){S({msg:"يجب إدخال وصف لكل بند فيه مبلغ",type:"warning"}),Ze(b.index);return}const j=c.map(({amount:w,description:v})=>({amount:w,description:v})),M=j.reduce((w,v)=>w+v.amount,0);he(s,{expenseItems:j,expenses:M}),me(null),m(),requestAnimationFrame(()=>{setTimeout(()=>{const w=document.querySelectorAll(`tr[data-row-id="${s}"] input.cashbox-input`);let v=w[5]??w[0];for(let D=5;D<w.length;D++)if(!w[D].disabled){v=w[D];break}v==null||v.focus()},0)})},[V,m,he]),rr=o.useCallback(()=>{S({msg:"يجب إدخال رصيد البرنامج كاش أولاً",type:"warning"})},[]),sr=o.useCallback(s=>{S({msg:`تعويض المصروفات يجب ألا يتخطى مبلغ المصروفات (المصروفات: ${k(s)})`,type:"warning"})},[]),yt=o.useCallback(s=>{const l=n.find(b=>b.id===s);if(!l||l.status==="closed")return;const c={cash:0,sentToTreasury:0,expenseCompensation:0,expenses:0,expenseItems:[],carriedExpenseCount:0,mada:0,visa:0,mastercard:0,bankTransfer:0,programBalanceCash:0,programBalanceBank:0,variance:0};he(s,c),$e.flushSync(()=>{u(b=>{const j=b.map(w=>w.id!==s?w:{...w,...c}),M=j.find(w=>w.id===s);return M&&(h.current[s]=M),j})}),m(),_e(null),Ie(b=>b+1),S({msg:"تم إفراغ كل المدخلات في الصف النشط ومسح سجلات الحاسبات",type:"success"})},[n,m]),ar=o.useCallback(()=>{Be&&yt(Be)},[Be,yt]),nr=o.useCallback(()=>{_e(null)},[]),oe=o.useCallback((s,l,c)=>{const b=n.find(v=>v.id===s);if(!b||b.status==="closed")return;const j={[l]:c};if(l==="expenses"&&typeof c=="number"){const v=b.expenseCompensation??0;c<v&&(j.expenseCompensation=c)}if($s.includes(l)){const v={...b,...j};j.variance=st(v)}const w=x.current[s];w&&clearTimeout(w),x.current[s]=setTimeout(()=>{const v=h.current[s];v&&he(s,v),m()},400),$e.flushSync(()=>{u(v=>{const D=v.map(ae=>ae.id!==s?ae:{...ae,...j}),B=D.find(ae=>ae.id===s);return B&&(h.current[s]=B),D})})},[n,m]),or=o.useCallback(s=>{const l=n.find(j=>j.id===s);if(!l||l.status!=="active")return;const c=ot(l),b=nt(l);if(c!==0||b!==0){De({rowId:s,cashVar:c,bankVar:b});return}S({msg:"الصندوق مظبوط — تم عمل جيد ✓",type:"success"}),P(s),_(Date.now()+at*1e3),R(at)},[n]),lr=o.useCallback(()=>{if(!ke)return;const{rowId:s}=ke;De(null),P(s),_(Date.now()+at*1e3),R(at)},[ke]),ir=o.useCallback(()=>{De(null)},[]),dr=o.useCallback(()=>{P(null),_(null),R(0),S({msg:"تم التراجع — يمكنك تعديل الصف",type:"info"})},[]),Re=o.useCallback((s,l,c)=>{if(s.length===0){S({msg:"لا توجد تقفيلات للطباعة",type:"warning"});return}const b=window.open("","_blank","width=800,height=900");if(!b){S({msg:"السماح بالنوافذ المنبثقة للطباعة",type:"warning"});return}const{firstActiveId:j,currentUserName:M}=c??{},w=s.map((v,D)=>{const ae=((v.status==="closed"?v.employeeName:j&&v.id===j&&M?M:v.employeeName)??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),be=v.mada+v.visa+v.mastercard,Z=nt(v),ge=ot(v),Se=v.expenses??0,ze=v.expenseCompensation??0,Le=v.sentToTreasury??0,de=v.expenseItems??[],Ve=ge>0?"variance pos":ge<0?"variance neg":"variance",Ae=Z>0?"variance pos":Z<0?"variance neg":"variance",dt=de.length>0?`<div class="block expenses-detail">
                  <div class="block-title">تفاصيل المصروفات</div>
                  <div class="block-body">${de.map(_t=>`<div class="expense-item">${k(_t.amount)} — ${(_t.description||"—").replace(/</g,"&lt;")}</div>`).join("")}</div>
                </div>`:"",tt=(v.notes||"").trim()?`<div class="block notes-block"><div class="block-title">ملاحظات</div><div class="block-body">${(v.notes||"").replace(/</g,"&lt;")}</div></div>`:"",Mt=(D>0?"page-break-before: always;":"")+(D<s.length-1?"page-break-after: always;":"");return`
            <div class="page" ${Mt?`style="${Mt}"`:""}>
              <header class="page-header">
                <h1 class="page-title">تقرير تقفيلة</h1>
                <p class="page-sub">${ae}</p>
                <p class="page-time">${v.closedAt?lt(v.closedAt):"—"}</p>
              </header>
              <div class="grid">
                <div class="block cash-block">
                  <div class="block-title">الكاش</div>
                  <div class="block-body">
                    <div class="row"><span class="label">كاش</span><span class="val">${k(v.cash)}</span></div>
                    <div class="row"><span class="label">مرسل للخزنة</span><span class="val">${k(Le)}</span></div>
                    <div class="row"><span class="label">المصروفات</span><span class="val">${k(Se)}</span></div>
                    <div class="row"><span class="label">تعويض مصروفات</span><span class="val">${k(ze)}</span></div>
                    <div class="row"><span class="label">رصيد البرنامج كاش</span><span class="val">${k(v.programBalanceCash)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف الكاش</span><span class="val ${Ve}">${k(ge)}</span></div>
                  </div>
                </div>
                <div class="block bank-block">
                  <div class="block-title">البنك</div>
                  <div class="block-body">
                    <div class="row"><span class="label">مدى</span><span class="val">${k(v.mada)}</span></div>
                    <div class="row"><span class="label">فيزا</span><span class="val">${k(v.visa)}</span></div>
                    <div class="row"><span class="label">ماستر كارد</span><span class="val">${k(v.mastercard)}</span></div>
                    <div class="row"><span class="label">تحويل بنكي</span><span class="val">${k(v.bankTransfer)}</span></div>
                    <div class="row"><span class="label">بنك نزيل (مدى+فيزا+ماستر)</span><span class="val total">${k(be)}</span></div>
                    <div class="row"><span class="label">اجمالى الموازنه</span><span class="val">${k(v.programBalanceBank??0)}</span></div>
                    <div class="row highlight variance-row"><span class="label">انحراف البنك</span><span class="val ${Ae}">${k(Z)}</span></div>
                  </div>
                </div>
              </div>
              ${dt}
              ${tt}
              <footer class="page-footer">
                <p class="footer-formulas">بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط) — انحراف البنك = بنك نزيل − اجمالى الموازنه — انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش</p>
                <p>تاريخ الطباعة: ${lt(new Date)} ${s.length>1?` — تقفيلة ${D+1} من ${s.length}`:""}</p>
              </footer>
            </div>`}).join("");b.document.write(`
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
          <head>
            <meta charset="utf-8">
            <title>${l}</title>
            <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
            <style>
              * { box-sizing: border-box; margin: 0; padding: 0; }
              @page { size: A4 portrait; margin: 10mm; }
              html, body {
                font-family: 'Cairo', sans-serif;
                background: #fff;
                color: #1e293b;
                font-size: 11px;
                line-height: 1.25;
                padding: 8px;
                margin: 0;
                height: auto;
              }
              @media print {
                html, body {
                  padding: 0 !important;
                  margin: 0 !important;
                  height: auto !important;
                  min-height: unset !important;
                  overflow: visible !important;
                  background: #fff;
                  font-size: 10px !important;
                }
                .page {
                  box-shadow: none !important;
                  margin: 0 auto !important;
                  min-height: 0 !important;
                  height: auto !important;
                  page-break-inside: avoid;
                }
                .page:last-child { page-break-after: avoid !important; }
              }
              .page {
                width: 100%;
                max-width: 210mm;
                margin: 0 auto 12px;
                padding: 0 8px 10px;
                background: #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
              }
              .page-header {
                text-align: center;
                padding: 8px 0 6px;
                border-bottom: 1px solid #0f172a;
                margin-bottom: 8px;
              }
              .page-title {
                font-size: 1.15rem;
                font-weight: 700;
                color: #0f172a;
                margin-bottom: 2px;
              }
              .page-sub {
                font-size: 0.95rem;
                font-weight: 600;
                color: #334155;
                margin-bottom: 1px;
              }
              .page-time {
                font-size: 0.8rem;
                color: #64748b;
              }
              .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-bottom: 8px;
              }
              .block {
                border: 1px solid #e2e8f0;
                border-radius: 4px;
                overflow: hidden;
              }
              .block-title {
                background: #f1f5f9;
                padding: 4px 8px;
                font-weight: 700;
                font-size: 0.8rem;
                color: #334155;
                border-bottom: 1px solid #e2e8f0;
              }
              .block-body {
                padding: 4px 8px;
                background: #fff;
              }
              .block .row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2px 0;
                border-bottom: 1px solid #f1f5f9;
                font-size: 0.8rem;
              }
              .block .row:last-child { border-bottom: none; }
              .block .row.highlight { font-weight: 700; background: #f8fafc; margin: 2px -8px -2px; padding: 4px 8px; }
              .block .row.variance-row {
                margin: 4px -8px -2px;
                padding: 6px 8px;
                background: #f1f5f9;
                border-top: 1px solid #cbd5e1;
                font-size: 0.9rem;
              }
              .block .row.variance-row .label {
                font-size: 0.9rem;
                font-weight: 800;
                color: #0f172a;
              }
              .block .row.variance-row .val { font-size: 0.9rem; font-weight: 800; }
              .block .label { color: #475569; }
              .block .val {
                font-variant-numeric: tabular-nums;
                font-weight: 500;
                color: #0f172a;
              }
              .block .val.total { font-weight: 700; }
              .block .val.variance.pos { color: #059669; }
              .block .val.variance.neg { color: #dc2626; }
              .expenses-detail, .notes-block {
                margin-top: 6px;
                border: 1px solid #e2e8f0;
                border-radius: 4px;
                overflow: hidden;
              }
              .expenses-detail .block-title, .notes-block .block-title {
                padding: 3px 8px;
                font-size: 0.75rem;
              }
              .expenses-detail .block-body, .notes-block .block-body {
                padding: 3px 8px;
              }
              .expense-item {
                padding: 2px 8px;
                font-size: 0.75rem;
                border-bottom: 1px solid #f1f5f9;
              }
              .expense-item:last-child { border-bottom: none; }
              .page-footer {
                margin-top: 8px;
                padding-top: 6px;
                border-top: 1px solid #e2e8f0;
                font-size: 0.7rem;
                color: #64748b;
                text-align: center;
              }
              .page-footer .footer-formulas {
                font-size: 0.6rem;
                color: #94a3b8;
                margin-bottom: 3px;
                line-height: 1.3;
              }
            </style>
          </head>
          <body>
            ${w}
            <script>setTimeout(function(){ window.print(); window.close(); }, 350);<\/script>
          </body>
        </html>
      `),b.document.close()},[]),cr=o.useCallback(()=>{const l=Dt(Vr(p==="today"?50:p==="yesterday"?100:200),p);Re(l,`تقرير التقفيلات — ${p==="today"?"اليوم":p==="yesterday"?"أمس":"الأسبوع الماضي"}`,{firstActiveId:F,currentUserName:t})},[p,Re,F,t]),mr=o.useCallback(s=>{H(l=>{const c=new Set(l);return c.has(s)?c.delete(s):c.add(s),c})},[]),xr=o.useCallback(()=>{if(W.size===0){S({msg:"لم تحدد أي صفوف للطباعة",type:"warning"});return}const s=ue.filter(l=>W.has(l.id));Re(s,"طباعة الصفوف المحددة",{firstActiveId:F,currentUserName:t})},[W,ue,Re,F,t]),ur=o.useCallback(s=>{const l=ue.find(c=>c.id===s);l&&Re([l],"طباعة تقفيلة",{firstActiveId:F,currentUserName:t})},[ue,Re,F,t]),br=o.useCallback(s=>{U(""),Y(!1),g({rowId:s,step:"confirm"})},[]),pr=o.useCallback(()=>{$&&g(s=>s?{...s,step:"code"}:null)},[$]),Nt=o.useCallback(()=>{if($){if(te.trim()!==ut()){Y(!0),S({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Y(!1),Pr($.rowId),H(s=>{const l=new Set(s);return l.delete($.rowId),l}),m(),g(null),U(""),G(!1),S({msg:"تم حذف الصف",type:"success"})}},[$,te,m]),hr=o.useCallback(()=>{U(""),Y(!1),X({step:"confirm"})},[]),fr=o.useCallback(()=>{T&&X(s=>s?{...s,step:"code"}:null)},[T]),Ct=o.useCallback(()=>{if(T){if(te.trim()!==ut()){Y(!0),S({msg:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة",type:"error"});return}Y(!1),zr(),H(new Set),m(),X(null),U(""),G(!1),S({msg:"تم حذف كل التقفيلات المغلقة",type:"success"})}},[T,te,m]),Pe=s=>s==="cash"?"الكاش":s==="programBalanceBank"?"اجمالى الموازنه":s==="mada"?"مدى":s==="visa"?"فيزا":s==="mastercard"?"ماستر كارد":"تحويل بنكي",gr=o.useCallback(s=>{if(!F){S({msg:"لا يوجد صف نشط لترحيل الكاش إليه",type:"warning"});return}const l=n.find(b=>b.id===F),c=(l==null?void 0:l.cash)??0;if(c>0){se({amount:s,currentValue:c,field:"cash"});return}oe(F,"cash",s),S({msg:`تم ترحيل ${k(s)} إلى خانة الكاش`,type:"success"})},[F,n,oe]),kr=o.useCallback((s,l,c)=>{if(!F){S({msg:"لا يوجد صف نشط لترحيل العمليات البنكية إليه",type:"warning"});return}const b=n.find(B=>B.id===F);if(!b)return;const j=b.mada??0,M=b.visa??0,w=b.mastercard??0;if(j>0&&s>0||M>0&&l>0||w>0&&c>0){I({mada:s,visa:l,mastercard:c,currentMada:j,currentVisa:M,currentMaster:w});return}oe(F,"mada",j+s),oe(F,"visa",M+l),oe(F,"mastercard",w+c);const D=[];s>0&&D.push(`مدى ${k(s)}`),l>0&&D.push(`فيزا ${k(l)}`),c>0&&D.push(`ماستر ${k(c)}`),S({msg:`تم ترحيل العمليات البنكية: ${D.join("، ")||"—"}`,type:"success"})},[F,n,oe]),wr=o.useCallback(()=>{if(!f||!F)return;const{mada:s,visa:l,mastercard:c,currentMada:b,currentVisa:j,currentMaster:M}=f;oe(F,"mada",b+s),oe(F,"visa",j+l),oe(F,"mastercard",M+c);const w=[];s>0&&w.push(`مدى ${k(s)}`),l>0&&w.push(`فيزا ${k(l)}`),c>0&&w.push(`ماستر ${k(c)}`),S({msg:`تم ترحيل العمليات البنكية: ${w.join("، ")||"—"}`,type:"success"}),I(null)},[f,F,oe]),vr=o.useCallback(()=>{I(null)},[]),jr=o.useCallback(()=>{if(!le)return;oe(le.rowId,le.field,le.newValue);const s=Pe(le.field);S({msg:`تم تعديل ${s} إلى ${k(le.newValue)}`,type:"success"}),ne(null)},[le,oe]),yr=o.useCallback(()=>{ne(null)},[]),Nr=o.useCallback(()=>{!q||!F||(oe(F,q.field,q.amount),S({msg:`تم ترحيل ${k(q.amount)} إلى ${Pe(q.field)}`,type:"success"}),se(null))},[q,F,oe]),Cr=o.useCallback(()=>{se(null)},[]),Mr=o.useCallback((s,l)=>{if(!F){S({msg:"لا يوجد صف نشط لترحيل إليه",type:"warning"});return}const c=n.find(j=>j.id===F),b=c?c[l]??0:0;if(b>0){se({amount:s,currentValue:b,field:l});return}oe(F,l,s),S({msg:`تم ترحيل ${k(s)} إلى ${Pe(l)}`,type:"success"})},[F,n,oe]);return e.jsxs("div",{className:"min-h-screen min-h-[100dvh] page-bg-warm dark:bg-slate-900 text-stone-900 dark:text-slate-200 font-cairo page-bg-pattern flex flex-col",children:[e.jsx("header",{className:"sticky top-0 z-40 border-b border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-900/95 backdrop-blur shadow-sm safe-top",children:e.jsxs("div",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-2 flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const{label:s,kind:l}=xs(y),c="w-4 h-4 shrink-0",b={morning:e.jsxs("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),e.jsx("path",{d:"M12 2v1.5M12 20.5V22M4.22 4.22l1.06 1.06M18.72 18.72l1.06 1.06M2 12h1.5M20.5 12H22M4.22 19.78l1.06-1.06M18.72 5.28l1.06-1.06"})]}),noon:e.jsxs("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"4.5"}),e.jsx("path",{d:"M12 2.5v2M12 19.5V22M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2.5 12H5M19 12h2.5M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"}),e.jsx("path",{d:"M12 7.5v4l2.5 2.5",strokeWidth:"1.8"})]}),evening:e.jsxs("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"}),e.jsx("path",{d:"M12 2v3M12 19v3M3.5 12H6.5M17.5 12h3M4.93 4.93l2.12 2.12M16.95 16.95l2.12 2.12M4.93 19.07l2.12-2.12M16.95 7.05l2.12-2.12",strokeWidth:"1.2",opacity:"0.7"})]}),night:e.jsx("svg",{className:c,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})},j=l==="night";return e.jsxs("h1",{className:"flex items-center gap-1.5 sm:gap-2 py-1.5 px-2 sm:px-3 rounded-lg sm:rounded-xl border border-stone-300 dark:border-white/10 bg-stone-200 dark:bg-slate-800/50 shadow-sm dark:shadow-[0_2px_8px_rgba(0,0,0,0.2)]",children:[e.jsx("span",{className:`flex items-center justify-center w-7 h-7 sm:w-8 sm:h-8 rounded-lg shrink-0 ${j?"bg-indigo-100 text-indigo-700 dark:bg-indigo-500/20 dark:text-indigo-300":"bg-teal-100 text-teal-700 dark:bg-amber-500/15 dark:text-amber-400"}`,children:b[l]}),e.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-stone-800 dark:text-slate-200 tracking-tight flex items-center gap-1 min-w-0 truncate max-w-[120px] sm:max-w-none",children:[e.jsx("span",{className:j?"text-indigo-700 dark:text-indigo-300/90":"text-teal-700 dark:text-amber-400/95",children:s}),e.jsx("span",{className:"text-stone-600 dark:text-slate-400 font-normal",children:"،"}),e.jsx("span",{className:"text-stone-600 dark:text-slate-400 text-xs font-cairo text-right",children:t})]})]})})(),e.jsx("div",{className:"relative z-[50] rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:e.jsx("button",{ref:d,type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),$t()},className:"flex items-center justify-center w-9 h-9 rounded-lg text-stone-700 hover:text-teal-600 hover:bg-teal-500/15 dark:text-slate-400 dark:hover:text-teal-400 dark:hover:bg-teal-500/10 transition cursor-pointer select-none touch-manipulation",title:a==="dark"?"الوضع الفاتح":"الوضع الداكن","aria-label":a==="dark"?"الوضع الفاتح":"الوضع الداكن",children:a==="dark"?e.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"4"}),e.jsx("path",{d:"M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"})]}):e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})}),e.jsx("div",{className:"rounded-xl border border-stone-300 dark:border-slate-600/50 bg-stone-200 dark:bg-slate-800/60 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(0,0,0,0.15)]",children:e.jsxs("button",{type:"button",onClick:r,className:"flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-stone-800 hover:text-teal-600 hover:bg-teal-500/15 dark:text-slate-400 dark:hover:text-amber-400 dark:hover:bg-amber-500/10 text-xs font-cairo transition",title:"تغيير المستخدم",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"8",r:"4"}),e.jsx("path",{d:"M4 20c0-3.3 2.7-6 6-6s6 2.7 6 6"}),e.jsx("path",{d:"M16 11l3 3-3 3"}),e.jsx("path",{d:"M19 14h-5"})]}),e.jsx("span",{children:"تغيير المستخدم"})]})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{ref:Je,type:"file",accept:".xlsx,.xls",className:"hidden","aria-hidden":!0,onChange:Gt}),e.jsx("div",{className:"rounded-xl border border-violet-300 dark:border-violet-500/25 bg-violet-100 dark:bg-violet-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_8px_rgba(139,92,246,0.12)]",children:e.jsxs("button",{type:"button",onClick:Xt,className:"inline-flex items-center justify-center gap-2 px-3 py-1.5 rounded-lg text-sm font-cairo font-bold bg-teal-500 hover:bg-teal-600 dark:bg-gradient-to-r dark:from-violet-600 dark:to-indigo-600 dark:hover:from-violet-500 dark:hover:to-indigo-500 text-white border border-teal-400/50 dark:border-violet-400/30 shadow-md transition-all hover:scale-[1.02] active:scale-[0.98]",title:"استخراج قيم مدى، فيزا، ماستر كارد، تحويل بنكي من تقرير إكسل",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),e.jsx("path",{d:"M17 8l-5-5-5 5"}),e.jsx("path",{d:"M12 3v12"})]}),e.jsx("span",{children:"استخراج قيم"})]})}),e.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-1 rounded-xl border-2 border-teal-300 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(245,158,11,0.08)]",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-md bg-teal-200 text-teal-800 dark:bg-amber-500/15 dark:text-amber-400/90 shrink-0","aria-hidden":"true",children:e.jsxs("svg",{className:"w-3 h-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})}),Rs.map(s=>e.jsx("button",{type:"button",onClick:()=>A(s.id),className:`px-2.5 py-1 rounded-lg text-xs font-medium transition ${p===s.id?"bg-teal-500/20 text-teal-800 border border-teal-600 dark:bg-amber-500/25 dark:text-amber-300 dark:border-amber-500/40 shadow-sm":"text-stone-700 border border-transparent hover:bg-stone-300 hover:text-stone-900 dark:text-slate-400 dark:hover:bg-white/5 dark:hover:text-slate-300"}`,children:s.label},s.id))]}),e.jsx("span",{className:"w-px h-5 bg-stone-300 dark:bg-white/10 rounded-full","aria-hidden":"true"}),e.jsxs("div",{className:"flex items-center gap-1.5 rounded-xl border border-stone-300 dark:border-sky-500/25 bg-stone-200 dark:bg-sky-500/10 px-1.5 py-1 shadow-sm dark:shadow-[0_2px_6px_rgba(14,165,233,0.08)]",children:[e.jsxs("button",{type:"button",onClick:cr,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-500 hover:bg-teal-600 dark:bg-sky-600 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:"طباعة كل الصفوف المعروضة",children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M6 9V2h12v7"}),e.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),e.jsx("path",{d:"M6 14h12v8H6z"})]}),e.jsx("span",{children:"الكل"})]}),W.size>0&&e.jsxs("button",{type:"button",onClick:xr,className:"inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-lg bg-teal-400 hover:bg-teal-500 dark:bg-sky-500/90 dark:hover:bg-sky-500 text-white text-xs font-bold transition",title:`طباعة ${W.size} صف محدد`,children:[e.jsxs("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("path",{d:"M6 9V2h12v7"}),e.jsx("path",{d:"M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"}),e.jsx("path",{d:"M6 14h12v8H6z"})]}),e.jsxs("span",{children:["المحددة (",W.size,")"]})]})]})]})]})}),e.jsxs("main",{className:"mx-auto w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] px-3 sm:px-4 py-1 sm:py-2 flex flex-col gap-2 sm:gap-3 flex-1 min-h-0",children:[e.jsxs("div",{className:"rounded-2xl sm:rounded-3xl overflow-x-auto overflow-hidden flex flex-col border-2 border-stone-400 dark:border-amber-500/20 bg-stone-50 dark:bg-slate-800/30 backdrop-blur-sm shadow-[0_4px_24px_rgba(0,0,0,0.08),0_0_0_1px_rgba(41,37,36,0.12)] dark:shadow-[0_4px_24px_rgba(0,0,0,0.25),0_0_1px_rgba(255,255,255,0.06)] min-h-[200px] sm:min-h-[240px]",children:[e.jsx("div",{className:"cashbox-table-scroll overflow-x-auto scrollbar-thin",style:{scrollbarGutter:"stable"},children:e.jsxs("table",{className:"w-full text-xs sm:text-sm border-separate table-fixed",style:{tableLayout:"fixed",width:"100%",minWidth:"880px",borderSpacing:0},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"3%"}}),e.jsx("col",{style:{width:"2.5%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"6.35%"}}),e.jsx("col",{style:{width:"12%"}})]}),e.jsx("thead",{className:"border-b-2 border-stone-500 dark:border-amber-500/20",children:e.jsxs("tr",{className:"h-12 sm:h-14 bg-stone-100 dark:bg-amber-500/[0.08]",children:[e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"تحديد"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"م"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"كاش"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"مرسل للخزنة — يدخل في معادلة انحراف الكاش",children:"مرسل للخزنة"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"يُخصم من المصروفات في انحراف الكاش",children:"تعويض مصروفات"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"المصروفات"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-semibold text-teal-800 dark:text-teal-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"رصيد البرنامج كاش"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-red-700 dark:text-red-400 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 bg-red-100 dark:bg-red-500/10 font-cairo rounded-sm shadow-sm",title:"خانة مهمة: الفرق بين المتوقع والفعلي للكاش",children:"انحراف الكاش"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"مدى"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"فيزا"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"ماستر كارد"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-semibold text-sky-700 dark:text-sky-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"للعرض فقط — لا يدخل في بنك نزيل ولا انحراف البنك",children:"تحويل بنكي"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-semibold text-teal-800 dark:text-teal-300 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",title:"بنك نزيل = مدى + فيزا + ماستر كارد (تحويل بنكي للعرض فقط)",children:"بنك نزيل"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 font-cairo",children:"اجمالى الموازنه"}),e.jsx("th",{className:"px-1.5 sm:px-2 py-2 sm:py-3 text-center text-[10px] sm:text-[11px] font-bold text-red-700 dark:text-red-400 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 bg-red-100 dark:bg-red-500/10 font-cairo rounded-sm shadow-sm",title:"خانة مهمة: الفرق بين بنك نزيل واجمالى الموازنه",children:"انحراف البنك"}),e.jsx("th",{className:"px-1 sm:px-1.5 py-2 sm:py-3 text-center text-[10px] font-semibold text-stone-900 dark:text-amber-200/90 tracking-tight align-middle border-r-2 border-stone-500 dark:border-amber-500/15 overflow-hidden min-w-0 font-cairo",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-1 h-full min-w-0",children:[e.jsx("span",{className:"truncate max-w-full",children:"الحالة / إجراءات"}),e.jsx("button",{type:"button",onClick:hr,"aria-label":"حذف كل التقفيلات المغلقة",className:"inline-flex items-center justify-center w-7 h-7 rounded-lg border-2 border-stone-400 dark:border-white/10 bg-stone-200 dark:bg-slate-700/50 text-stone-800 dark:text-slate-400 hover:bg-red-100 dark:hover:bg-red-500/15 hover:text-red-600 dark:hover:text-red-400 hover:border-red-400 dark:hover:border-red-500/30 transition-all shrink-0 shadow-sm",title:"حذف كل التقفيلات المغلقة",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"}),e.jsx("path",{d:"M10 11v6M14 11v6"})]})})]})})]})}),e.jsx("tbody",{children:qt.map((s,l)=>e.jsx(gs,{row:s,rowNumber:(z-1)*He+l+1,isFirstActive:s.id===F,liveNow:y,closingRowId:C,closingSecondsLeft:C===s.id?E:0,onUpdate:oe,isSelected:W.has(s.id),onToggleSelect:mr,onDeleteRow:br,onPrintRow:ur,onOpenExpenseDetails:Yt,onClearExpensesAndOpen:Jt,onLockedFieldClick:rr,onExpenseCompensationExceeded:sr,lastExcelDetails:ve,onShowExcelDetails:(c,b)=>ee({field:c,rowId:b}),onRequestConfirmBankEdit:ve?(c,b,j,M)=>ne({rowId:c,field:b,oldValue:j,newValue:M}):void 0,onShowEmployeeNames:N.length>0?()=>pe(!0):void 0,onShowVarianceExplanation:(c,b)=>Me({type:c,row:b}),currentUserName:t,onClearRow:c=>_e(c),isStickyRows:!1},s.id))})]})}),ue.length>He&&e.jsxs("div",{className:"px-3 sm:px-4 py-2 sm:py-3 border-t border-stone-300 dark:border-white/[0.06] flex items-center justify-center gap-2 flex-wrap rounded-b-2xl sm:rounded-b-3xl bg-stone-200 dark:bg-slate-800/50 backdrop-blur-sm",children:[e.jsxs("button",{type:"button",onClick:()=>L(s=>Math.max(1,s-1)),disabled:z<=1,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-teal-200 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 text-teal-700 dark:text-amber-400/95 hover:bg-teal-100 hover:border-teal-300 dark:hover:bg-amber-500/20 dark:hover:border-amber-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة السابقة",children:[e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})}),"السابق"]}),e.jsxs("span",{className:"inline-flex items-center min-w-[4rem] justify-center px-3 py-2 rounded-xl bg-teal-100 dark:bg-amber-500/15 border border-teal-200 dark:border-amber-500/30 text-teal-700 dark:text-amber-400 text-sm font-cairo font-semibold tabular-nums shadow-sm dark:shadow-[0_0_12px_rgba(245,158,11,0.1)]",children:[z===1?"الرئيسية":z," / ",Fe]}),e.jsxs("button",{type:"button",onClick:()=>L(s=>Math.min(Fe,s+1)),disabled:z>=Fe,className:"inline-flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl text-sm font-cairo font-medium border border-teal-200 dark:border-amber-500/25 bg-teal-50 dark:bg-amber-500/10 text-teal-700 dark:text-amber-400/95 hover:bg-teal-100 hover:border-teal-300 dark:hover:bg-amber-500/20 dark:hover:border-amber-500/40 disabled:opacity-40 disabled:pointer-events-none disabled:border-stone-300 disabled:bg-stone-300 disabled:text-stone-600 dark:disabled:border-white/10 dark:disabled:bg-slate-800/60 dark:disabled:text-slate-500 transition-all","aria-label":"الصفحة التالية",children:["التالي",e.jsx("svg",{className:"w-4 h-4 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})]})]}),ue.length===0&&e.jsxs("div",{className:"py-16 px-4 text-center rounded-b-3xl bg-stone-100 dark:bg-slate-800/20",children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-500 font-cairo mb-1",children:"لا توجد تقفيلات"}),e.jsx("p",{className:"text-stone-700 dark:text-slate-600 text-sm font-cairo",children:"اختر فلتراً مختلفاً أو ابدأ شفتاً جديداً"})]})]}),e.jsx("div",{className:"flex flex-col items-center justify-center gap-1.5 py-2 px-3 rounded-xl border-2 border-teal-500 dark:border-amber-500/30 bg-gradient-to-b from-teal-50 to-stone-200 dark:from-amber-500/10 dark:to-slate-800/60 min-h-0 shadow-md dark:shadow-[0_4px_20px_rgba(245,158,11,0.12),0_0_1px_rgba(255,255,255,0.06)]",children:C?e.jsx("div",{className:"flex flex-wrap items-center justify-center w-full",dir:"ltr",children:E>0?e.jsxs("button",{type:"button",onClick:dr,className:"btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 border-teal-400 bg-teal-500 hover:bg-teal-600 text-white shadow-md dark:border-emerald-500/60 dark:bg-gradient-to-b dark:from-emerald-500/30 dark:to-emerald-600/20 dark:text-emerald-50 dark:shadow-[0_4px_24px_rgba(16,185,129,0.25)] dark:hover:from-emerald-500/40 dark:hover:to-emerald-600/30 dark:hover:shadow-[0_6px_28px_rgba(16,185,129,0.3)] hover:scale-[1.02] active:scale-[0.98] transition-all select-none touch-manipulation min-h-[36px]",children:[e.jsxs("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 10h10a5 5 0 015 5v2"}),e.jsx("path",{d:"M7 15l-4-4 4-4"})]}),e.jsx("span",{className:"tracking-wide",children:"تراجع"}),e.jsxs("span",{className:"tabular-nums font-cairo",children:["(",E," ثانية)"]})]}):e.jsx("span",{className:"text-sm font-cairo font-medium text-teal-800 dark:text-amber-400 tabular-nums",children:"جاري الإغلاق..."})}):F&&ye?e.jsxs("button",{type:"button",onClick:()=>or(F),disabled:!et,className:`btn-close-shift inline-flex items-center justify-center gap-1.5 sm:gap-2 px-3 sm:px-5 py-2 sm:py-2.5 w-full sm:w-auto sm:min-w-[180px] rounded-xl text-xs sm:text-sm font-cairo font-bold whitespace-nowrap border-2 select-none transition-all touch-manipulation min-h-[36px]
                ${et?"bg-teal-500 hover:bg-teal-600 text-white border-teal-400 shadow-md dark:bg-gradient-to-b dark:from-amber-500/50 dark:to-amber-600/40 dark:text-amber-50 dark:border-amber-400 dark:shadow-[0_4px_24px_rgba(245,158,11,0.3)] dark:hover:from-amber-500/60 dark:hover:to-amber-600/50 dark:hover:shadow-[0_6px_28px_rgba(245,158,11,0.35)] hover:scale-[1.02] active:scale-[0.98]":"opacity-60 bg-stone-200 text-stone-500 border-stone-300 dark:opacity-50 dark:bg-slate-800/40 dark:text-slate-500 dark:border-slate-600/50 cursor-not-allowed"}`,title:et?"إغلاق الشفت وحفظ التقفيلة":"أدخل رصيد البرنامج كاش وإجمالي الموازنة (البنك) أولاً",children:[e.jsxs("svg",{className:`btn-close-shift-icon w-5 h-5 shrink-0 ${et?"text-white dark:text-amber-200":"text-stone-500 dark:text-slate-500"}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":!0,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0110 0v4"})]}),e.jsx("span",{className:"tracking-wide",children:t?`إغلاق شفت ${t}`:"إغلاق الشفت الحالي"})]}):null}),e.jsxs("section",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-[minmax(260px,320px)_1fr_1fr] gap-2 sm:gap-3 w-full max-w-[100%] max-w-7xl lg:max-w-[1400px] xl:max-w-[1600px] items-stretch min-h-[280px] sm:min-h-[340px] xl:min-h-[380px] [&>div]:min-h-[240px] sm:[&>div]:min-h-[300px] xl:[&>div]:min-h-[340px]",children:[e.jsx("div",{className:"min-h-0 flex flex-col",children:e.jsx(vs,{onTransfer:Mr,hasActiveRow:!!F},`calculator-${we}`)}),e.jsx("div",{className:"min-h-0 flex flex-col",children:e.jsx(js,{onApplyToCash:gr,hasActiveRow:!!F},`cashCalculator-${we}`)}),e.jsx("div",{className:"min-h-0 flex flex-col",children:e.jsx(Ns,{onTransfer:kr,hasActiveRow:!!F},`bankOps-${we}`)})]})]}),O&&e.jsx(_s,{message:O.msg,type:O.type,onClose:()=>S(null),position:"center",autoHideMs:O.autoHideMs}),Q&&ve&&(()=>{const{field:s,rowId:l}=Q,c=ve[s]??[],b=c.reduce((B,ae)=>B+ae.amount,0),j=n.find(B=>B.id===l),M=j?j[s]??0:0,w=M-b,D=`سجل التغيير — ${{mada:"مدى",visa:"فيزا",mastercard:"ماستر كارد",bankTransfer:"تحويل بنكي"}[s]}`;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"excel-detail-title",onClick:()=>ee(null),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-sm w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:B=>B.stopPropagation(),children:[e.jsx("h2",{id:"excel-detail-title",className:"text-base font-bold text-teal-800 dark:text-amber-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:D}),e.jsxs("div",{className:"p-3 space-y-2 border-b border-stone-200 dark:border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"من إكسل (مرفوع):"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-600 dark:text-amber-200/95",children:k(b)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الحالي في الخانة:"}),e.jsx("span",{className:"tabular-nums font-medium text-stone-800 dark:text-slate-200",children:k(M)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-stone-600 dark:text-slate-400",children:"الفرق (ترحيل أو تعديل يدوي):"}),e.jsx("span",{className:`tabular-nums font-medium ${w>=0?"text-teal-600 dark:text-amber-400":"text-rose-600 dark:text-rose-400"}`,children:k(w)})]})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-2",children:[e.jsxs("p",{className:"text-xs font-cairo text-stone-500 dark:text-slate-400 mb-1",children:[c.length," عملية من الإكسل"]}),c.map((B,ae)=>e.jsxs("div",{className:"py-2 border-b border-stone-200 dark:border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2 text-sm text-stone-800 dark:text-slate-300",children:[e.jsx("div",{className:"flex flex-col items-start gap-0.5 min-w-0",children:B.employeeName?e.jsx("span",{className:"text-xs text-stone-500 font-cairo",children:B.employeeName}):null}),e.jsx("span",{className:"tabular-nums font-medium text-teal-600 dark:text-amber-200/95 shrink-0",children:k(B.amount)})]}),B.purpose&&e.jsx("p",{className:"text-xs font-cairo text-stone-600 dark:text-amber-200/80 mt-1 pr-0 border-t border-stone-300 dark:border-amber-500/20 pt-1",children:B.purpose})]},ae))]}),e.jsxs("div",{className:"p-4 pt-2 border-t border-stone-300 dark:border-amber-500/30 flex justify-between items-center bg-stone-100 dark:bg-slate-900/50",children:[e.jsx("span",{className:"font-bold text-stone-800 dark:text-slate-200",children:"إجمالي الإكسل"}),e.jsx("span",{className:"tabular-nums font-bold text-teal-600 dark:text-amber-400",children:k(b)})]})]}),e.jsx("div",{className:"p-3",children:e.jsx("button",{type:"button",onClick:()=>ee(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-500 hover:bg-teal-600 dark:bg-slate-600 dark:hover:bg-slate-500 text-white dark:text-slate-200 transition",children:"إغلاق"})})]})})})(),fe&&N.length>0&&(()=>{const s=N.map(l=>{let c=0,b=0;if(ve)for(const j of["mada","visa","mastercard","bankTransfer"]){const M=ve[j]??[];for(const w of M)(w.employeeName??"").trim()===l&&(c+=1,b+=w.amount)}return{name:l,count:c,total:b}});return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"employee-names-title",onClick:()=>pe(!1),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:l=>l.stopPropagation(),children:[e.jsx("h2",{id:"employee-names-title",className:"text-base font-bold text-teal-700 dark:text-amber-400 p-4 pb-2 border-b border-white/10",children:"أسماء الموظفين في العمليات المستوردة"}),e.jsx("div",{className:"overflow-y-auto flex-1 min-h-0 p-3 space-y-1.5",children:s.map((l,c)=>e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 text-sm text-slate-300 py-2 px-3 rounded-lg bg-slate-900/50 border border-white/5 font-cairo",children:[e.jsx("span",{className:"font-medium text-slate-200",children:l.name}),e.jsxs("span",{className:"tabular-nums text-teal-600 dark:text-amber-200/90 text-xs",children:[l.count," عملية — الإجمالي: ",k(l.total)]})]},c))}),e.jsx("div",{className:"p-3 border-t border-white/10",children:e.jsx("button",{type:"button",onClick:()=>pe(!1),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إغلاق"})})]})})})(),Qe&&(()=>{const{type:s,row:l}=Qe,c=l.cash??0,b=l.sentToTreasury??0,j=l.expenses??0,M=l.expenseCompensation??0,w=Math.max(0,j-M),v=l.programBalanceCash??0,D=c+b+w,B=ot(l),ae=l.mada+l.visa+l.mastercard,be=l.programBalanceBank??0,Z=nt(l),ge=s==="cash",Se=ge?"شرح انحراف الكاش":"شرح انحراف البنك",ze=B!==0&&Z!==0&&B>0!=Z>0,Le=Math.abs(Math.abs(B)-Math.abs(Z))<=Bs,de=ze&&Le,Ve=de?Math.abs(B):0;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"variance-explanation-title",onClick:()=>Me(null),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-[95vw] sm:max-w-md w-full max-h-[85vh] overflow-hidden flex flex-col font-cairo cursor-auto",onClick:Ae=>Ae.stopPropagation(),children:[e.jsx("h2",{id:"variance-explanation-title",className:"text-base font-bold text-teal-800 dark:text-amber-400 p-4 pb-2 border-b-2 border-stone-400 dark:border-white/10",children:Se}),e.jsxs("div",{className:"overflow-y-auto flex-1 min-h-0 p-4 space-y-3 text-sm text-stone-800 dark:text-slate-300",children:[ge?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-800 dark:text-slate-200 font-semibold text-teal-800 dark:text-teal-300",children:"انحراف الكاش = (كاش + مرسل للخزنة + مصروفات فعّالة) − رصيد البرنامج كاش"}),e.jsxs("ul",{className:"space-y-1.5 list-none",children:[e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"كاش"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(c)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مرسل للخزنة"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(b)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مصروفات"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(j)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"تعويض مصروفات"}),e.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",k(M)]})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5",children:[e.jsx("span",{children:"مصروفات فعّالة (صافي)"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(w)})]}),e.jsxs("li",{className:"flex justify-between gap-2 font-medium",children:[e.jsx("span",{children:"كاش + مرسل للخزنة + مصروفات فعّالة"}),e.jsx("span",{className:"tabular-nums font-bold text-teal-800 dark:text-teal-300",children:k(D)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"رصيد البرنامج كاش"}),e.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",k(v)]})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-teal-400 dark:border-amber-500/30 pt-2 font-bold text-teal-800 dark:text-amber-300",children:[e.jsx("span",{children:"انحراف الكاش"}),e.jsxs("span",{className:"tabular-nums",children:[B>0?"+":"",k(B)]})]})]}),e.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:B>0?"زيادة: الكاش الفعلي (أو المرسل + المصروف الفعلي) أكبر من رصيد البرنامج.":B<0?"عجز: رصيد البرنامج كاش أكبر من المتوقّع من الكاش والمرسل والمصروف.":"لا يوجد انحراف."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-800 dark:text-slate-200 font-semibold text-teal-800 dark:text-teal-300",children:"انحراف البنك = بنك نزيل − اجمالى الموازنه"}),e.jsxs("ul",{className:"space-y-1.5 list-none",children:[e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مدى"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.mada)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"فيزا"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.visa)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"ماستر كارد"}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.mastercard)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsxs("span",{children:["تحويل بنكي ",e.jsx("span",{className:"text-stone-500 dark:text-slate-500 text-[10px]",children:"(للعرض فقط)"})]}),e.jsx("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:k(l.bankTransfer)})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t border-stone-300 dark:border-white/10 pt-1.5 font-medium",children:[e.jsx("span",{children:"بنك نزيل (مدى+فيزا+ماستر)"}),e.jsx("span",{className:"tabular-nums font-bold text-teal-800 dark:text-teal-300",children:k(ae)})]}),e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"اجمالى الموازنه"}),e.jsxs("span",{className:"tabular-nums font-medium text-teal-700 dark:text-teal-400",children:["− ",k(be)]})]}),e.jsxs("li",{className:"flex justify-between gap-2 border-t-2 border-teal-400 dark:border-amber-500/30 pt-2 font-bold text-teal-800 dark:text-amber-300",children:[e.jsx("span",{children:"انحراف البنك"}),e.jsxs("span",{className:"tabular-nums",children:[Z>0?"+":"",k(Z)]})]})]}),e.jsx("p",{className:"text-xs text-stone-600 dark:text-slate-400 pt-1",children:Z>0?"زيادة: بنك نزيل أكبر من اجمالى الموازنه المدخل.":Z<0?"عجز: اجمالى الموازنه أكبر من بنك نزيل.":"لا يوجد انحراف."})]}),de&&e.jsxs("div",{className:"mt-3 p-3 rounded-xl border-2 border-teal-400/60 dark:border-amber-500/30 bg-teal-50 dark:bg-amber-900/20 text-teal-800 dark:text-amber-200 text-sm font-medium",children:["تنبيه: قد تكون سندات بقيمة ",e.jsx("strong",{children:Ve.toLocaleString("ar-SA",{minimumFractionDigits:2})})," ريال دخلت في خانة خاطئة (نقداً ↔ شبكة). راجع تحويل المبلغ بين الكاش وبنك نزيل."]})]}),e.jsx("div",{className:"p-3 border-t-2 border-stone-400 dark:border-white/10",children:e.jsx("button",{type:"button",onClick:()=>Me(null),className:"w-full py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"إغلاق"})})]})})})(),ke&&(()=>{const{cashVar:s,bankVar:l}=ke,c=s!==0?s>0?"زيادة في صندوق الكاش — راجع الرصيد الفعلي":"عجز في صندوق الكاش — راجع الكاش والرصيد والمصروف":"",b=l!==0?l>0?"زيادة في البنك — راجع إدخالات مدى/فيزا/ماستر أو اجمالى الموازنه":"عجز في البنك — راجع بنك نزيل أو اجمالى الموازنه":"";return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"close-variance-title",children:e.jsxs("div",{className:"rounded-2xl border-2 border-teal-300 dark:border-amber-500/30 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"close-variance-title",className:"text-lg font-bold text-teal-800 dark:text-amber-400 mb-3",children:"تنبيه: يوجد انحراف"}),e.jsxs("div",{className:"text-stone-800 dark:text-slate-300 text-sm leading-relaxed mb-4 space-y-2",children:[s!==0&&e.jsxs("p",{className:"block",children:[e.jsx("span",{className:"font-medium",children:"انحراف الكاش: "}),e.jsxs("span",{className:"font-bold tabular-nums text-teal-700 dark:text-teal-400",children:[s>0?"+":"",k(s)]}),c&&e.jsx("span",{className:"block text-stone-600 dark:text-amber-200/90 text-xs mt-0.5",children:c})]}),l!==0&&e.jsxs("p",{className:"block",children:[e.jsx("span",{className:"font-medium",children:"انحراف البنك: "}),e.jsxs("span",{className:"font-bold tabular-nums text-teal-700 dark:text-teal-400",children:[l>0?"+":"",k(l)]}),b&&e.jsx("span",{className:"block text-stone-600 dark:text-amber-200/90 text-xs mt-0.5",children:b})]}),e.jsx("p",{className:"pt-2 text-stone-700 dark:text-slate-200",children:"هل تريد الإغلاق مع هذا الانحراف؟"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:lr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-teal-600 hover:bg-teal-500 text-white transition",children:"نعم، إغلاق الشفت"}),e.jsx("button",{type:"button",onClick:ir,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا، متابعة التعديل"})]})]})})})(),q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"transfer-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsxs("h2",{id:"transfer-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:["ترحيل إلى ",Pe(q.field)]}),e.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد ترحيل الرقم الجديد وهو ",e.jsx("span",{className:"font-bold text-white tabular-nums",children:k(q.amount)}),"؟ يوجد رقم في الخانة وهو ",e.jsx("span",{className:"font-bold text-white tabular-nums",children:k(q.currentValue)}),"."]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:Nr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:Cr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),f&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-transfer-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"bank-transfer-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:"ترحيل العمليات البنكية"}),e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"هل تريد ترحيل الأرقام الجديدة؟ توجد قيم في الخانات:"}),e.jsxs("ul",{className:"text-sm text-stone-700 dark:text-slate-300 space-y-1.5 mb-4",children:[f.mada>0&&e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"مدى:"}),e.jsxs("span",{className:"tabular-nums",children:["مرحّل ",e.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:k(f.mada)})," — في الخانة ",e.jsx("strong",{children:k(f.currentMada)})]})]}),f.visa>0&&e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"فيزا:"}),e.jsxs("span",{className:"tabular-nums",children:["مرحّل ",e.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:k(f.visa)})," — في الخانة ",e.jsx("strong",{children:k(f.currentVisa)})]})]}),f.mastercard>0&&e.jsxs("li",{className:"flex justify-between gap-2",children:[e.jsx("span",{children:"ماستر:"}),e.jsxs("span",{className:"tabular-nums",children:["مرحّل ",e.jsx("strong",{className:"text-teal-600 dark:text-amber-400",children:k(f.mastercard)})," — في الخانة ",e.jsx("strong",{children:k(f.currentMaster)})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:wr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:vr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),le&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"bank-edit-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsxs("h2",{id:"bank-edit-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:["تعديل خانة ",Pe(le.field)]}),e.jsxs("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:["هل تريد تعديل الرقم من ",e.jsx("span",{className:"font-bold tabular-nums",children:k(le.oldValue)})," إلى ",e.jsx("span",{className:"font-bold tabular-nums text-teal-600 dark:text-amber-400",children:k(le.newValue)}),"؟"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:jr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:yr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),Be&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"clear-row-confirm-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"clear-row-confirm-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:"إفراغ الصف"}),e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد إفراغ كل المدخلات في هذا الصف؟ (كاش، مدى، فيزا، ماستر، اجمالى الموازنه، مصروفات، وغيرها)"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:ar,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:nr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]})}),V&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm cursor-default",role:"dialog","aria-modal":"true","aria-labelledby":"expense-modal-title",onClick:()=>me(null),children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-lg w-full max-h-[85vh] flex flex-col font-cairo cursor-auto",onClick:s=>s.stopPropagation(),onKeyDown:s=>{s.key==="Enter"&&!V.readOnly&&(s.preventDefault(),Oe())},children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/10",children:[e.jsx("h2",{id:"expense-modal-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400",children:V.readOnly?"تفاصيل المصروفات":"تصنيف المبلغ المصروف"}),e.jsx("button",{type:"button",onClick:()=>me(null),className:"p-2 rounded-lg text-stone-500 hover:text-white hover:bg-white/10 transition","aria-label":"إغلاق",children:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),!V.readOnly&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-500 text-sm px-4 pt-2",children:"أدخل تفاصيل المصروف (مثال: 10 ريال كتب، 10 ريال مسطرة)"}),(V.carriedCount??0)>0&&e.jsx("p",{className:"text-stone-600 dark:text-amber-200/80 text-xs px-4 pt-0.5 font-cairo",children:"البنود المرحّلة للعرض فقط — يمكنك إضافة تصنيف ومبلغ جديد فقط، ويُحدَّث المجموع وخانة المصروفات تلقائياً."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[!V.readOnly&&V.items.length>0&&e.jsxs("div",{className:"flex gap-2 items-center pb-0.5",children:[e.jsx("span",{className:"flex-1 text-xs font-medium text-stone-700 font-cairo",children:"بند المصروف"}),e.jsx("span",{className:"w-24 text-xs font-medium text-stone-700 font-cairo text-center",children:"مبلغ المصروف"}),e.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}),V.items.map((s,l)=>{const c=V.carriedCount??0,b=!V.readOnly&&l<c;return e.jsx("div",{className:"flex gap-2 items-center",children:V.readOnly||b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-24 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm text-center tabular-nums",children:k(Number(s.amount)||0)}),e.jsxs("span",{className:"flex-1 px-3 py-2 rounded-lg bg-slate-900/60 border border-white/10 text-slate-200 text-sm font-cairo",children:[s.description||"—",b&&e.jsx("span",{className:"mr-1 text-[10px] text-stone-600 font-cairo",title:"من الشفت السابق",children:" (مرحّل)"})]}),!V.readOnly&&b?e.jsx("button",{type:"button",onClick:()=>er(V.rowId,l),className:"shrink-0 w-8 h-8 flex items-center justify-center rounded-lg border border-red-500/20 text-slate-400 hover:text-red-400 hover:border-red-500/40",title:"حذف البند المرحّل (يتطلب كود أدمن)","aria-label":"حذف بند مرحّل",children:e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}):e.jsx("span",{className:"w-10 shrink-0","aria-hidden":"true"})]}):e.jsxs(e.Fragment,{children:[(()=>{const j=xe.current[l]!==void 0?xe.current[l]:String(s.amount??""),M=(Number(String(j).replace(/,/g,""))||0)>0,w=!String(s.description||"").trim(),v=M&&w,D=We===l;return e.jsx("input",{ref:B=>{!B||l!==c||V.readOnly||wt.current===V.rowId||(wt.current=V.rowId,B.focus())},type:"text",tabIndex:l===c?0:-1,value:s.description,onChange:B=>{vt(l,"description",B.target.value),We===l&&Ze(null)},onKeyDown:B=>{B.key==="Enter"&&(B.preventDefault(),Oe())},placeholder:M?"الوصف إلزامي":"الوصف",title:M?"الوصف إلزامي عند وجود مبلغ":void 0,"aria-required":M,className:`flex-1 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border text-stone-900 dark:text-white text-sm font-cairo placeholder:text-stone-500 dark:placeholder:text-slate-500 focus:border-teal-500/50 dark:focus:border-amber-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-amber-500/25 ${v?"border-teal-500 dark:border-amber-500/50 ring-1 ring-teal-500/25":"border-stone-300 dark:border-amber-500/25"} ${D?"expense-description-pulse":""}`})})(),e.jsx("input",{type:"text",inputMode:"decimal",tabIndex:-1,dir:"ltr",value:Te(xe.current[l]!==void 0?xe.current[l]:String(s.amount??"")),onChange:j=>{let M=Te(j.target.value).replace(/[^\d.]/g,"");const w=M.indexOf(".");w>=0&&(M=M.slice(0,w+1)+M.slice(w+1).replace(/\./g,"")),xe.current[l]=M,vt(l,"amount",M)},onKeyDown:j=>{j.key==="Enter"&&(j.preventDefault(),Oe())},placeholder:"مبلغ",className:"cashbox-input w-24 px-3 py-2 rounded-lg bg-stone-50 dark:bg-slate-900/80 border border-stone-300 dark:border-amber-500/25 text-stone-900 dark:text-white text-sm text-center focus:border-teal-500/50 dark:focus:border-amber-500/50 focus:ring-1 focus:ring-teal-500/25 dark:focus:ring-amber-500/25"}),e.jsx("button",{type:"button",tabIndex:-1,onClick:()=>Zt(l),disabled:V.items.length<=1,className:"p-2 rounded-lg text-stone-500 hover:text-red-400 hover:bg-red-500/20 disabled:opacity-40 disabled:pointer-events-none transition","aria-label":"حذف السطر",title:"حذف",children:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]})},l)})]}),e.jsxs("div",{className:"p-4 border-t border-white/10 flex flex-wrap items-center gap-3",children:[!V.readOnly&&e.jsxs("button",{type:"button",tabIndex:-1,onClick:Qt,className:"inline-flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-medium bg-teal-100 text-teal-700 border-2 border-teal-400 hover:bg-teal-200 transition",children:[e.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M12 5v14M5 12h14"})}),"إضافة سطر"]}),e.jsx("div",{className:"flex-1"}),V.readOnly?e.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",e.jsx("span",{className:"font-bold text-teal-700 dark:text-amber-400 tabular-nums",children:k(V.items.reduce((s,l)=>s+(Number(l.amount)||0),0))})]}):e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("span",{className:"text-stone-500 text-sm font-cairo",children:["المجموع: ",e.jsx("span",{className:"font-bold text-teal-700 dark:text-amber-400 tabular-nums",children:k(V.items.reduce((s,l)=>s+(Number(l.amount)||0),0))})]}),e.jsx("button",{type:"button",onClick:Oe,onKeyDown:s=>{(s.key==="Enter"||s.key===" "||s.key==="Tab")&&(s.preventDefault(),Oe())},className:"px-4 py-2 rounded-xl text-sm font-bold bg-emerald-600 hover:bg-emerald-500 text-white transition focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-offset-2 focus:ring-offset-slate-800 focus:shadow-[0_0_16px_rgba(16,185,129,0.4)]",children:"تعديل مبلغ المصروفات"})]})]})]})}),J&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-carried-dialog-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"delete-carried-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:J.step==="confirm"?"حذف بند مرحّل":"كود الأدمن"}),J.step==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف هذا البند المرحّل؟ يتطلب إدخال كود الأدمن في الخطوة التالية."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:tr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:()=>{K(null)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),ce&&e.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:re?"text":"password",value:te,onChange:s=>{U(s.target.value),Y(!1)},onKeyDown:s=>{s.key==="Enter"&&jt(),s.key==="Escape"&&(K(null),U(""),Y(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border text-white text-sm font-cairo focus:ring-1 focus:ring-amber-500/25 ${ce?"border-red-500 dark:border-red-400":"border-white/10 focus:border-amber-500/50"}`,autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>G(s=>!s),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":re?"إخفاء الكود":"إظهار الكود",children:re?e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),e.jsx("path",{d:"M1 1l22 22"})]}):e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:jt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),e.jsx("button",{type:"button",onClick:()=>{K(null),U(""),G(!1),Y(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-dialog-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"delete-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:$.step==="confirm"?"حذف الصف":"كود الأدمن"}),$.step==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف الصف؟"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:pr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:()=>g(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),ce&&e.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:re?"text":"password",value:te,onChange:s=>{U(s.target.value),Y(!1)},onKeyDown:s=>{s.key==="Enter"&&Nt(),s.key==="Escape"&&(g(null),U(""),Y(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border text-white text-sm font-cairo focus:ring-1 focus:ring-amber-500/25 ${ce?"border-red-500 dark:border-red-400":"border-white/10 focus:border-amber-500/50"}`,autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>G(s=>!s),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":re?"إخفاء الكود":"إظهار الكود",title:re?"إخفاء":"إظهار",children:re?e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),e.jsx("path",{d:"M1 1l22 22"})]}):e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:Nt,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),e.jsx("button",{type:"button",onClick:()=>{g(null),U(""),G(!1),Y(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",role:"dialog","aria-modal":"true","aria-labelledby":"delete-all-dialog-title",children:e.jsxs("div",{className:"rounded-2xl border border-stone-300 dark:border-white/10 bg-stone-50 dark:bg-slate-800 shadow-2xl max-w-md w-full p-5 font-cairo",children:[e.jsx("h2",{id:"delete-all-dialog-title",className:"text-lg font-bold text-teal-700 dark:text-amber-400 mb-3",children:T.step==="confirm"?"حذف كل التقفيلات المغلقة":"كود الأدمن"}),T.step==="confirm"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-4",children:"هل تريد حذف كل التقفيلات المغلقة؟"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:fr,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"نعم"}),e.jsx("button",{type:"button",onClick:()=>X(null),className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"لا"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-stone-600 dark:text-slate-300 text-sm leading-relaxed mb-3",children:"ادخل كود الأدمن"}),ce&&e.jsx("p",{className:"mb-3 px-3 py-2 rounded-xl bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-500/30 text-red-700 dark:text-red-300 text-sm font-cairo font-semibold",role:"alert",children:"كود الأدمن غير صحيح — أدخل الكود الصحيح وأعد المحاولة"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:re?"text":"password",value:te,onChange:s=>{U(s.target.value),Y(!1)},onKeyDown:s=>{s.key==="Enter"&&Ct(),s.key==="Escape"&&(X(null),U(""),Y(!1))},placeholder:"كود الأدمن",className:`w-full pl-3 pr-10 py-2 rounded-xl bg-slate-900 border text-white text-sm font-cairo focus:ring-1 focus:ring-amber-500/25 ${ce?"border-red-500 dark:border-red-400":"border-white/10 focus:border-amber-500/50"}`,autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>G(s=>!s),className:"absolute left-2 top-1/2 -translate-y-1/2 p-1 rounded text-stone-500 hover:text-teal-600 transition","aria-label":re?"إخفاء الكود":"إظهار الكود",title:re?"إخفاء":"إظهار",children:re?e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24 4.24"}),e.jsx("path",{d:"M1 1l22 22"})]}):e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:Ct,className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-red-600 hover:bg-red-500 text-white transition",children:"تأكيد"}),e.jsx("button",{type:"button",onClick:()=>{X(null),U(""),G(!1),Y(!1)},className:"flex-1 py-2.5 rounded-xl text-sm font-bold bg-slate-600 hover:bg-slate-500 text-slate-200 transition",children:"إلغاء"})]})]})]})})]})}const $s=["cash","sentToTreasury","expenseCompensation","expenses","mada","visa","mastercard","bankTransfer","programBalanceCash","programBalanceBank"],bt="cashbox_name";function Is(){const[t,r]=o.useState(null),[a,i]=o.useState(!1),[d,n]=o.useState("dark");o.useEffect(()=>{const h=sessionStorage.getItem(bt);h!=null&&h.trim()&&r(h.trim());const y=Es();n(y),ft(y),i(!0)},[]),o.useEffect(()=>{const h=y=>n(y.detail);return window.addEventListener("cashbox-theme-change",h),()=>window.removeEventListener("cashbox-theme-change",h)},[]),o.useEffect(()=>{ft(d)},[d]);const u=h=>{sessionStorage.setItem(bt,h),r(h)},m=()=>{sessionStorage.removeItem(bt),r(null)};if(!a)return e.jsx("div",{className:"min-h-screen page-bg-warm dark:bg-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"text-slate-700 dark:text-slate-500 font-cairo",children:"جاري التحميل..."})});const x=()=>Ut();return t?e.jsx(As,{name:t,onExit:m,theme:d,onToggleTheme:x}):e.jsx(Ir,{onEnter:u})}pt.createRoot(document.getElementById("root")).render(e.jsx(_r.StrictMode,{children:e.jsx(Is,{})}));
