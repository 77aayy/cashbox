/* --- إعدادات الطباعة الأساسية (A4 عرضي) --- */
@media print {
  @page {
    size: A4 landscape; /* A4 بالعرض */
    margin: 15mm;
  }

  body {
    -webkit-print-color-adjust: exact !important; /* لضمان طباعة الألوان (للعناوين) */
    color-adjust: exact !important;
    background-color: #ffffff !important;
    color: #000000 !important;
  }

  /* --- 1. إخفاء كل شيء لا نريده --- */
  .sidebar,
  .topbar,
  .dashboard-metrics,
  .close-wrapper,
  .tools-wrapper,
  .table-header,
  #toastContainer {
    display: none !important;
    visibility: hidden !important;
  }

  /* --- 2. إظهار الجدول فقط وجعله يملأ الصفحة --- */
  .table-container {
    visibility: visible !important;
    display: block !important;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    box-shadow: none !important;
    border: none !important;
    background-color: #ffffff !important;
  }
  
  table {
    min-width: 100% !important;
    width: 100% !important;
  }

  /* --- 3. تنسيق الجدول للطباعة --- */
  th, td {
    border: 1px solid #666 !important;
    color: #000000 !important;
    padding: 8px 10px;
    font-size: 10pt; /* خط أصغر ليناسب الطباعة */
    white-space: normal !important; /* السماح بتعدد الأسطر */
  }

  thead th {
    background-color: #f0f0f0 !important;
    color: #000000 !important;
    font-weight: bold;
  }

  /* --- 4. إخفاء الأعمدة غير المناسبة للتقرير --- */
  /* إخفاء (م) - العمود 1 */
  th:nth-child(1), td:nth-child(1) {
    display: none !important;
  }
  /* إخفاء (إجراءات) - العمود 15 */
  th:nth-child(15), td:nth-child(15) {
    display: none !important;
  }

  /* --- 5. (تعديل) إخفاء الصفوف غير المرغوبة (النشط وقيد الانتظار) --- */
  .active-row,
  .undo-pending {
    display: none !important;
    visibility: hidden !important;
  }
  
  /* إزالة أي إضاءة أو ظلال */
  .closed-row {
    box-shadow: none !important;
    background-color: #ffffff !important;
  }

  /* --- 6. منطق "طباعة الأخير فقط" --- */
  
  /* إذا كنا نطبع الأخير فقط... */
  body.print-last-only {
    /* ...أخفي كل الصفوف المغلقة... */
    tr.closed-row {
      display: none !important;
      visibility: hidden !important;
    }
    
    /* ...ما عدا الصف الذي حددناه للطباعة (print-target) */
    tr.print-target {
      display: table-row !important;
      visibility: visible !important;
    }
  }
}